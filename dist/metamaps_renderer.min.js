(function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.4.4";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g in a)if(x.has(a,g)&&b.call(d,a[g],g,a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b,c){return x.isEmpty(b)?c?null:[]:x[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.findWhere=function(a,b){return x.where(a,b,!0)},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-(1/0);var d={computed:-(1/0),value:-(1/0)};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var C=function(a,b,c,d){var e={},f=B(b||x.identity);return y(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};x.groupBy=function(a,b,c){return C(a,b,c,function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)})},x.countBy=function(a,b,c){return C(a,b,c,function(a,b){x.has(a,b)||(a[b]=0),a[b]++})},x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return y(a,function(a){x.isArray(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(i.apply(d,arguments))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=h.call(arguments),b=x.max(x.pluck(a,"length")),c=new Array(b),d=0;b>d;d++)c[d]=x.pluck(a,""+d);return c},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f},x.bind=function(a,b){if(a.bind===w&&w)return w.apply(a,h.call(arguments,1));var c=h.call(arguments,2);return function(){return a.apply(b,c.concat(h.call(arguments)))}},x.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);return 0===b.length&&(b=x.functions(a)),y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b){var c,d,e,f,g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)};return function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},x.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return 0>=a?b():function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&(b[b.length]=c);return b},x.values=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push(a[c]);return b},x.pairs=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push([c,a[c]]);return b},x.invert=function(a){var b={};for(var c in a)x.has(a,c)&&(b[a[c]]=c);return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)null==a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var E=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;c.push(a),d.push(b);var g=0,h=!0;if("[object Array]"==e){if(g=a.length,h=g==b.length)for(;g--&&(h=E(a[g],b[g],c,d)););}else{var i=a.constructor,k=b.constructor;if(i!==k&&!(x.isFunction(i)&&i instanceof i&&x.isFunction(k)&&k instanceof k))return!1;for(var l in a)if(x.has(a,l)&&(g++,!(h=x.has(b,l)&&E(a[l],b[l],c,d))))break;if(h){for(l in b)if(x.has(b,l)&&!g--)break;h=!g}}return c.pop(),d.pop(),h};x.isEqual=function(a,b){return E(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=Array(a),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var F={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};F.unescape=x.invert(F.escape);var G={escape:new RegExp("["+x.keys(F.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(F.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(G[a],function(b){return F[a][b]})}}),x.result=function(a,b){if(null==a)return null;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),L.call(this,c.apply(x,a))}})};var H=0;x.uniqueId=function(a){var b=++H+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/(.)^/,J={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},K=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||I).source,(c.interpolate||I).source,(c.evaluate||I).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(K,function(a){return"\\"+J[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var L=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],L.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return L.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),function(){var a,b=this,c=b.Backbone,d=[],e=d.push,f=d.slice,g=d.splice;a="undefined"!=typeof exports?exports:b.Backbone={},a.VERSION="1.0.0";var h=b._;h||"undefined"==typeof require||(h=require("underscore")),a.$=b.jQuery||b.Zepto||b.ender||b.$,a.noConflict=function(){return b.Backbone=c,this},a.emulateHTTP=!1,a.emulateJSON=!1;var i=a.Events={on:function(a,b,c){if(!k(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!k(this,"once",a,[b,c])||!b)return this;var d=this,e=h.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,f,g,i,j,l,m;if(!this._events||!k(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:h.keys(this._events),i=0,j=g.length;j>i;i++)if(a=g[i],f=this._events[a]){if(this._events[a]=d=[],b||c)for(l=0,m=f.length;m>l;l++)e=f[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=f.call(arguments,1);if(!k(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&l(c,b),d&&l(d,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},j=/\s+/,k=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(j.test(c)){for(var f=c.split(j),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},l=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},m={listenTo:"on",listenToOnce:"once"};h.each(m,function(a,b){i[b]=function(b,c,d){var e=this._listeners||(this._listeners={}),f=b._listenerId||(b._listenerId=h.uniqueId("l"));return e[f]=b,"object"==typeof c&&(d=this),b[a](c,d,this),this}}),i.bind=i.on,i.unbind=i.off,h.extend(a,i);var n=a.Model=function(a,b){var c,d=a||{};b||(b={}),this.cid=h.uniqueId("c"),this.attributes={},h.extend(this,h.pick(b,o)),b.parse&&(d=this.parse(d,b)||{}),(c=h.result(this,"defaults"))&&(d=h.defaults({},d,c)),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)},o=["url","urlRoot","collection"];h.extend(n.prototype,i,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return h.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return h.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,f,g,i,j,k,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;f=c.unset,i=c.silent,g=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=h.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],h.isEqual(l[d],b)||g.push(d),h.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,f?delete l[d]:l[d]=b;if(!i){g.length&&(this._pending=!0);for(var m=0,n=g.length;n>m;m++)this.trigger("change:"+g[m],this,l[g[m]],c)}if(j)return this;if(!i)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,h.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,h.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!h.isEmpty(this.changed):h.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?h.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)h.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){return b.set(b.parse(d,a),a)?(c&&c(b,d,a),void b.trigger("sync",b,d,a)):!1},L(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,f,g=this.attributes;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,!(!d||c&&c.wait||this.set(d,c)))return!1;if(c=h.extend({validate:!0},c),!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=h.extend({},g,d)),void 0===c.parse&&(c.parse=!0);var i=this,j=c.success;return c.success=function(a){i.attributes=g;var b=i.parse(a,c);return c.wait&&(b=h.extend(d||{},b)),h.isObject(b)&&!i.set(b,c)?!1:(j&&j(i,a,c),void i.trigger("sync",i,a,c))},L(this,c),e=this.isNew()?"create":c.patch?"patch":"update","patch"===e&&(c.attrs=d),f=this.sync(e,this,c),d&&c.wait&&(this.attributes=g),f},destroy:function(a){a=a?h.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},this.isNew())return a.success(),!1;L(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=h.result(this,"urlRoot")||h.result(this.collection,"url")||K();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},h.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=h.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,h.extend(b||{},{validationError:c})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];h.each(p,function(a){n.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.attributes),h[a].apply(h,b)}});var q=a.Collection=function(a,b){b||(b={}),b.url&&(this.url=b.url),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,h.extend({silent:!0},b))},r={add:!0,remove:!0,merge:!0},s={add:!0,merge:!1,remove:!1};h.extend(q.prototype,i,{model:n,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return a.sync.apply(this,arguments)},add:function(a,b){return this.set(a,h.defaults(b||{},s))},remove:function(a,b){a=h.isArray(a)?a.slice():[a],b||(b={});var c,d,e,f;for(c=0,d=a.length;d>c;c++)f=this.get(a[c]),f&&(delete this._byId[f.id],delete this._byId[f.cid],e=this.indexOf(f),this.models.splice(e,1),this.length--,b.silent||(b.index=e,f.trigger("remove",f,this,b)),this._removeReference(f));return this},set:function(a,b){b=h.defaults(b||{},r),b.parse&&(a=this.parse(a,b)),h.isArray(a)||(a=a?[a]:[]);var c,d,f,i,j,k=b.at,l=this.comparator&&null==k&&b.sort!==!1,m=h.isString(this.comparator)?this.comparator:null,n=[],o=[],p={};for(c=0,d=a.length;d>c;c++)(f=this._prepareModel(a[c],b))&&((i=this.get(f))?(b.remove&&(p[i.cid]=!0),b.merge&&(i.set(f.attributes,b),l&&!j&&i.hasChanged(m)&&(j=!0))):b.add&&(n.push(f),f.on("all",this._onModelEvent,this),this._byId[f.cid]=f,null!=f.id&&(this._byId[f.id]=f)));if(b.remove){for(c=0,d=this.length;d>c;++c)p[(f=this.models[c]).cid]||o.push(f);o.length&&this.remove(o,b)}if(n.length&&(l&&(j=!0),this.length+=n.length,null!=k?g.apply(this.models,[k,0].concat(n)):e.apply(this.models,n)),j&&this.sort({silent:!0}),b.silent)return this;for(c=0,d=n.length;d>c;c++)(f=n[c]).trigger("add",f,this,b);return j&&this.trigger("sort",this,b),this},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),this.add(a,h.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:this.length},b)),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){return h.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),h.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(h.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=h.isFunction(b)?b:function(a){return a.get(b)};return h.sortedIndex(this.models,a,d,c)},pluck:function(a){return h.invoke(this.models,"get",a)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?h.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(e){b.wait&&c.add(a,b),d&&d(a,e,b)},a.save(null,b),a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof n)return a.collection||(a.collection=this),a;b||(b={}),b.collection=this;var c=new this.model(a,b);return c._validate(a,b)?c:(this.trigger("invalid",this,a,b),!1)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var t=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(t,function(a){q.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.models),h[a].apply(h,b)}});var u=["groupBy","countBy","sortBy"];h.each(u,function(a){q.prototype[a]=function(b,c){var d=h.isFunction(b)?b:function(a){return a.get(b)};return h[a](this.models,d,c)}});var v=a.View=function(a){this.cid=h.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];h.extend(v.prototype,i,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(b,c){return this.$el&&this.undelegateEvents(),this.$el=b instanceof a.$?b:a.$(b),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=h.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];if(h.isFunction(c)||(c=this[a[b]]),c){var d=b.match(w),e=d[1],f=d[2];c=h.bind(c,this),e+=".delegateEvents"+this.cid,""===f?this.$el.on(e,c):this.$el.on(e,f,c)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(a){this.options&&(a=h.extend({},h.result(this,"options"),a)),h.extend(this,h.pick(a,x)),this.options=a},_ensureElement:function(){if(this.el)this.setElement(h.result(this,"el"),!1);else{var b=h.extend({},h.result(this,"attributes"));this.id&&(b.id=h.result(this,"id")),this.className&&(b["class"]=h.result(this,"className"));var c=a.$("<"+h.result(this,"tagName")+">").attr(b);this.setElement(c,!1)}}}),a.sync=function(b,c,d){var e=y[b];h.defaults(d||(d={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var f={type:e,dataType:"json"};if(d.url||(f.url=h.result(c,"url")||K()),null!=d.data||!c||"create"!==b&&"update"!==b&&"patch"!==b||(f.contentType="application/json",f.data=JSON.stringify(d.attrs||c.toJSON(d))),d.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{}),d.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){f.type="POST",d.emulateJSON&&(f.data._method=e);var g=d.beforeSend;d.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",e),g?g.apply(this,arguments):void 0}}"GET"===f.type||d.emulateJSON||(f.processData=!1),"PATCH"!==f.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(f.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=d.xhr=a.ajax(h.extend(f,d));return c.trigger("request",c,i,d),i};var y={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var z=a.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},A=/\((.*?)\)/g,B=/(\(\?)?:\w+/g,C=/\*\w+/g,D=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(z.prototype,i,{initialize:function(){},route:function(b,c,d){h.isRegExp(b)||(b=this._routeToRegExp(b)),h.isFunction(c)&&(d=c,c=""),d||(d=this[c]);var e=this;return a.history.route(b,function(f){var g=e._extractParameters(b,f);d&&d.apply(e,g),e.trigger.apply(e,["route:"+c].concat(g)),e.trigger("route",c,g),a.history.trigger("route",e,c,g)}),this},navigate:function(b,c){return a.history.navigate(b,c),this},_bindRoutes:function(){if(this.routes){this.routes=h.result(this,"routes");for(var a,b=h.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(D,"\\$&").replace(A,"(?:$1)?").replace(B,function(a,b){return b?a:"([^/]+)"}).replace(C,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return h.map(c,function(a){return a?decodeURIComponent(a):null})}});var E=a.History=function(){this.handlers=[],h.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},F=/^[#\/]|\s+$/g,G=/^\/+|\/+$/g,H=/msie [\w.]+/,I=/\/$/;E.started=!1,h.extend(E.prototype,i,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(I,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(F,"")},start:function(b){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=h.extend({},{root:"/"},this.options,b),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var c=this.getFragment(),d=document.documentMode,e=H.exec(navigator.userAgent.toLowerCase())&&(!d||7>=d);this.root=("/"+this.root+"/").replace(G,"/"),e&&this._wantsHashChange&&(this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(c)),this._hasPushState?a.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?a.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=c;var f=this.location,g=f.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!g?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&g&&f.hash&&(this.fragment=this.getHash().replace(F,""),this.history.replaceState({},document.title,this.root+this.fragment+f.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();return b===this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe))),b===this.fragment?!1:(this.iframe&&this.navigate(b),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=h.any(this.handlers,function(a){return a.route.test(b)?(a.callback(b),!0):void 0});return c},navigate:function(a,b){if(!E.started)return!1;if(b&&b!==!0||(b={trigger:b}),a=this.getFragment(a||""),this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),a.history=new E;var J=function(a,b){var c,d=this;c=a&&h.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},h.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&h.extend(c.prototype,a),c.__super__=d.prototype,c};n.extend=q.extend=z.extend=v.extend=E.extend=J;var K=function(){
throw new Error('A "url" property or function must be specified')},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}}.call(this),function(a){"use strict";function b(a){for(var b,c,d=[],e=0,f=a.length;f>e;)b=a.charCodeAt(e++),b>=55296&&56319>=b&&f>e?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b,c),e--)):d.push(b);return d}function c(a,b){var c=a&&("[object NodeList]"===Object.prototype.toString.call(a)&&a.length||1===a.nodeType),d=b&&"function"==typeof b;return"console"in window&&"warn"in console&&(c||console.warn("Countable: No valid elements were found"),d||console.warn('Countable: "'+b+'" is not a valid callback function')),c&&d}function d(a){var b={hardReturns:!1,stripTags:!1,ignoreReturns:!1,ignoreZeroWidth:!0};for(var c in a)b.hasOwnProperty(c)&&(b[c]=a[c]);return b}function e(a,c){var d,e="value"in a?a.value:a.innerText||a.textContent;return c.stripTags&&(e=e.replace(/<\/?[a-z][^>]*>/gi,"")),c.ignoreZeroWidth&&(e=e.replace(/[\u200B]+/,"")),d=e.trim(),{paragraphs:d?(d.match(c.hardReturns?/\n{2,}/g:/\n+/g)||[]).length+1:0,sentences:d?(d.match(/[.?!…]+./g)||[]).length+1:0,words:d?(d.replace(/['";:,.?¿\-!¡]+/g,"").match(/\S+/g)||[]).length:0,characters:d?b(d.replace(/\s/g,"")).length:0,all:b(c.ignoreReturns?e.replace(/[\n\r]/g,""):e).length}}function f(a,b){var c=a.length;if("undefined"!=typeof c)for(;c--;)b(a[c]);else b(a)}var g=[],h="oninput"in document?"input":"keyup";navigator.userAgent.match(/MSIE 9.0/)&&(h="keyup"),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var i={live:function(a,b,i){var j=d(i),k=function(a){var c=function(){b.call(a,e(a,j))};g.push({element:a,handler:c}),c(),a.addEventListener?a.addEventListener(h,c,!1):a.attachEvent&&a.attachEvent("on"+h,c)};if(c(a,b))return a.length?f(a,k):k(a),this},die:function(a){return c(a,function(){})?(f(a,function(a){var b;f(g,function(c){c.element===a&&(b=c)}),b&&(a.removeEventListener?a.removeEventListener(h,b.handler,!1):a.detachEvent&&a.detachEvent("on"+h,b.handler),g.splice(g.indexOf(b),1))}),this):void 0},once:function(a,b,g){return c(a,b)?(f(a,function(a){b.call(a,e(a,d(g)))}),this):void 0},count:function(a,b,c){return this.once(a,b,c)},enabled:function(a){var b=!1;return a&&1===a.nodeType&&f(g,function(c){c.element===a&&(b=!0)}),b}};"object"==typeof exports?module.exports=i:"function"==typeof define&&define.amd?define(function(){return i}):a.Countable=i}(this);var io="undefined"==typeof module?{}:module.exports;!function(){if(function(a,b){var c=a;c.version="0.9.11",c.protocol=1,c.transports=[],c.j=[],c.sockets={},c.connect=function(a,d){var e,f,g=c.util.parseUri(a);b&&b.location&&(g.protocol=g.protocol||b.location.protocol.slice(0,-1),g.host=g.host||(b.document?b.document.domain:b.location.hostname),g.port=g.port||b.location.port),e=c.util.uniqueUri(g);var h={host:g.host,secure:"https"==g.protocol,port:g.port||("https"==g.protocol?443:80),query:g.query||""};return c.util.merge(h,d),(h["force new connection"]||!c.sockets[e])&&(f=new c.Socket(h)),!h["force new connection"]&&f&&(c.sockets[e]=f),f=f||c.sockets[e],f.of(g.path.length>1?g.path:"")}}("object"==typeof module?module.exports:this.io={},this),function(a,b){var c=a.util={},d=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];c.parseUri=function(a){for(var b=d.exec(a||""),c={},f=14;f--;)c[e[f]]=b[f]||"";return c},c.uniqueUri=function(a){var c=a.protocol,d=a.host,e=a.port;return"document"in b?(d=d||document.domain,e=e||("https"==c&&"https:"!==document.location.protocol?443:document.location.port)):(d=d||"localhost",e||"https"!=c||(e=443)),(c||"http")+"://"+d+":"+(e||80)},c.query=function(a,b){var d=c.chunkQuery(a||""),e=[];c.merge(d,c.chunkQuery(b||""));for(var f in d)d.hasOwnProperty(f)&&e.push(f+"="+d[f]);return e.length?"?"+e.join("&"):""},c.chunkQuery=function(a){for(var b,c={},d=a.split("&"),e=0,f=d.length;f>e;++e)b=d[e].split("="),b[0]&&(c[b[0]]=b[1]);return c};var f=!1;c.load=function(a){return"document"in b&&"complete"===document.readyState||f?a():void c.on(b,"load",a,!1)},c.on=function(a,b,c,d){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener&&a.addEventListener(b,c,d)},c.request=function(a){if(a&&"undefined"!=typeof XDomainRequest&&!c.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!a||c.ua.hasCORS))return new XMLHttpRequest;if(!a)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(b){}return null},"undefined"!=typeof window&&c.load(function(){f=!0}),c.defer=function(a){return c.ua.webkit&&"undefined"==typeof importScripts?void c.load(function(){setTimeout(a,100)}):a()},c.merge=function(a,b,d,e){var f,g=e||[],h="undefined"==typeof d?2:d;for(f in b)b.hasOwnProperty(f)&&c.indexOf(g,f)<0&&("object"==typeof a[f]&&h?c.merge(a[f],b[f],h-1,g):(a[f]=b[f],g.push(b[f])));return a},c.mixin=function(a,b){c.merge(a.prototype,b.prototype)},c.inherit=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c},c.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},c.intersect=function(a,b){for(var d=[],e=a.length>b.length?a:b,f=a.length>b.length?b:a,g=0,h=f.length;h>g;g++)~c.indexOf(e,f[g])&&d.push(f[g]);return d},c.indexOf=function(a,b,c){for(var d=a.length,c=0>c?0>c+d?0:c+d:c||0;d>c&&a[c]!==b;c++);return c>=d?-1:c},c.toArray=function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(a[c]);return b},c.ua={},c.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var a=new XMLHttpRequest}catch(b){return!1}return void 0!=a.withCredentials}(),c.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),c.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(a,b){function c(){}a.EventEmitter=c,c.prototype.on=function(a,c){return this.$events||(this.$events={}),this.$events[a]?b.util.isArray(this.$events[a])?this.$events[a].push(c):this.$events[a]=[this.$events[a],c]:this.$events[a]=c,this},c.prototype.addListener=c.prototype.on,c.prototype.once=function(a,b){function c(){d.removeListener(a,c),b.apply(this,arguments)}var d=this;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,c){if(this.$events&&this.$events[a]){var d=this.$events[a];if(b.util.isArray(d)){for(var e=-1,f=0,g=d.length;g>f;f++)if(d[f]===c||d[f].listener&&d[f].listener===c){e=f;break}if(0>e)return this;d.splice(e,1),d.length||delete this.$events[a]}else(d===c||d.listener&&d.listener===c)&&delete this.$events[a]}return this},c.prototype.removeAllListeners=function(a){return void 0===a?(this.$events={},this):(this.$events&&this.$events[a]&&(this.$events[a]=null),this)},c.prototype.listeners=function(a){return this.$events||(this.$events={}),this.$events[a]||(this.$events[a]=[]),b.util.isArray(this.$events[a])||(this.$events[a]=[this.$events[a]]),this.$events[a]},c.prototype.emit=function(a){if(!this.$events)return!1;var c=this.$events[a];if(!c)return!1;var d=Array.prototype.slice.call(arguments,1);if("function"==typeof c)c.apply(this,d);else{if(!b.util.isArray(c))return!1;for(var e=c.slice(),f=0,g=e.length;g>f;f++)e[f].apply(this,d)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){"use strict";function f(a){return 10>a?"0"+a:a}function date(a,b){return isFinite(a.valueOf())?a.getUTCFullYear()+"-"+f(a.getUTCMonth()+1)+"-"+f(a.getUTCDate())+"T"+f(a.getUTCHours())+":"+f(a.getUTCMinutes())+":"+f(a.getUTCSeconds())+"Z":null}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i instanceof Date&&(i=date(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})},JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(a,b){var c=a.parser={},d=c.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],e=c.reasons=["transport not supported","client not handshaken","unauthorized"],f=c.advice=["reconnect"],g=b.JSON,h=b.util.indexOf;c.encodePacket=function(a){var b=h(d,a.type),c=a.id||"",i=a.endpoint||"",j=a.ack,k=null;switch(a.type){case"error":var l=a.reason?h(e,a.reason):"",m=a.advice?h(f,a.advice):"";(""!==l||""!==m)&&(k=l+(""!==m?"+"+m:""));break;case"message":""!==a.data&&(k=a.data);break;case"event":var n={name:a.name};a.args&&a.args.length&&(n.args=a.args),k=g.stringify(n);break;case"json":k=g.stringify(a.data);break;case"connect":a.qs&&(k=a.qs);break;case"ack":k=a.ackId+(a.args&&a.args.length?"+"+g.stringify(a.args):"")}var o=[b,c+("data"==j?"+":""),i];return null!==k&&void 0!==k&&o.push(k),o.join(":")},c.encodePayload=function(a){var b="";if(1==a.length)return a[0];for(var c=0,d=a.length;d>c;c++){var e=a[c];b+="�"+e.length+"�"+a[c]}return b};var i=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;c.decodePacket=function(a){var b=a.match(i);if(!b)return{};var c=b[2]||"",a=b[5]||"",h={type:d[b[1]],endpoint:b[4]||""};switch(c&&(h.id=c,b[3]?h.ack="data":h.ack=!0),h.type){case"error":var b=a.split("+");h.reason=e[b[0]]||"",h.advice=f[b[1]]||"";break;case"message":h.data=a||"";break;case"event":try{var j=g.parse(a);h.name=j.name,h.args=j.args}catch(k){}h.args=h.args||[];break;case"json":try{h.data=g.parse(a)}catch(k){}break;case"connect":h.qs=a||"";break;case"ack":var b=a.match(/^([0-9]+)(\+)?(.*)/);if(b&&(h.ackId=b[1],h.args=[],b[3]))try{h.args=b[3]?g.parse(b[3]):[]}catch(k){}break;case"disconnect":case"heartbeat":}return h},c.decodePayload=function(a){if("�"==a.charAt(0)){for(var b=[],d=1,e="";d<a.length;d++)"�"==a.charAt(d)?(b.push(c.decodePacket(a.substr(d+1).substr(0,e))),d+=Number(e)+1,e=""):e+=a.charAt(d);return b}return[c.decodePacket(a)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b){function c(a,b){this.socket=a,this.sessid=b}a.Transport=c,b.util.mixin(c,b.EventEmitter),c.prototype.heartbeats=function(){return!0},c.prototype.onData=function(a){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==a){var c=b.parser.decodePayload(a);if(c&&c.length)for(var d=0,e=c.length;e>d;d++)this.onPacket(c[d])}return this},c.prototype.onPacket=function(a){return this.socket.setHeartbeatTimeout(),"heartbeat"==a.type?this.onHeartbeat():("connect"==a.type&&""==a.endpoint&&this.onConnect(),"error"==a.type&&"reconnect"==a.advice&&(this.isOpen=!1),this.socket.onPacket(a),this)},c.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var a=this;this.closeTimeout=setTimeout(function(){a.onDisconnect()},this.socket.closeTimeout)}},c.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},c.prototype.onConnect=function(){return this.socket.onConnect(),this},c.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},c.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},c.prototype.packet=function(a){this.send(b.parser.encodePacket(a))},c.prototype.onHeartbeat=function(a){this.packet({type:"heartbeat"})},c.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},c.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},c.prototype.prepareUrl=function(){var a=this.socket.options;return this.scheme()+"://"+a.host+":"+a.port+"/"+a.resource+"/"+b.protocol+"/"+this.name+"/"+this.sessid},c.prototype.ready=function(a,b){b.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b,c){function d(a){if(this.options={port:80,secure:!1,document:"document"in c?document:!1,resource:"socket.io",transports:b.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},b.util.merge(this.options,a),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||b.util.ua.hasCORS)){var d=this;b.util.on(c,"beforeunload",function(){d.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function e(){}a.Socket=d,b.util.mixin(d,b.EventEmitter),d.prototype.of=function(a){return this.namespaces[a]||(this.namespaces[a]=new b.SocketNamespace(this,a),""!==a&&this.namespaces[a].packet({type:"connect"})),this.namespaces[a]},d.prototype.publish=function(){this.emit.apply(this,arguments);var a;for(var b in this.namespaces)this.namespaces.hasOwnProperty(b)&&(a=this.of(b),a.$emit.apply(a,arguments))},d.prototype.handshake=function(a){function c(b){b instanceof Error?(d.connecting=!1,d.onError(b.message)):a.apply(null,b.split(":"))}var d=this,f=this.options,g=["http"+(f.secure?"s":"")+":/",f.host+":"+f.port,f.resource,b.protocol,b.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!b.util.ua.hasCORS){var h=document.getElementsByTagName("script")[0],i=document.createElement("script");i.src=g+"&jsonp="+b.j.length,h.parentNode.insertBefore(i,h),b.j.push(function(a){c(a),i.parentNode.removeChild(i)})}else{var j=b.util.request();j.open("GET",g,!0),this.isXDomain()&&(j.withCredentials=!0),j.onreadystatechange=function(){4==j.readyState&&(j.onreadystatechange=e,200==j.status?c(j.responseText):403==j.status?d.onError(j.responseText):(d.connecting=!1,!d.reconnecting&&d.onError(j.responseText)))},j.send(null)}},d.prototype.getTransport=function(a){for(var c,d=a||this.transports,e=0;c=d[e];e++)if(b.Transport[c]&&b.Transport[c].check(this)&&(!this.isXDomain()||b.Transport[c].xdomainCheck(this)))return new b.Transport[c](this,this.sessionid);return null},d.prototype.connect=function(a){if(this.connecting)return this;var c=this;return c.connecting=!0,this.handshake(function(d,e,f,g){function h(a){return c.transport&&c.transport.clearTimeouts(),c.transport=c.getTransport(a),c.transport?void c.transport.ready(c,function(){c.connecting=!0,c.publish("connecting",c.transport.name),c.transport.open(),c.options["connect timeout"]&&(c.connectTimeoutTimer=setTimeout(function(){if(!c.connected&&(c.connecting=!1,c.options["try multiple transports"])){for(var a=c.transports;a.length>0&&a.splice(0,1)[0]!=c.transport.name;);a.length?h(a):c.publish("connect_failed")}},c.options["connect timeout"]))}):c.publish("connect_failed")}c.sessionid=d,c.closeTimeout=1e3*f,c.heartbeatTimeout=1e3*e,c.transports||(c.transports=c.origTransports=g?b.util.intersect(g.split(","),c.options.transports):c.options.transports),c.setHeartbeatTimeout(),h(c.transports),c.once("connect",function(){clearTimeout(c.connectTimeoutTimer),a&&"function"==typeof a&&a()})}),this},d.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var a=this;this.heartbeatTimeoutTimer=setTimeout(function(){a.transport.onClose()},this.heartbeatTimeout)}},d.prototype.packet=function(a){return this.connected&&!this.doBuffer?this.transport.packet(a):this.buffer.push(a),this},d.prototype.setBuffer=function(a){this.doBuffer=a,!a&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},d.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},d.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},d.prototype.disconnectSync=function(){var a=b.util.request(),c=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,b.protocol,"",this.sessionid].join("/")+"/?disconnect=1";a.open("GET",c,!1),a.send(null),this.onDisconnect("booted")},d.prototype.isXDomain=function(){var a=c.location.port||("https:"==c.location.protocol?443:80);return this.options.host!==c.location.hostname||this.options.port!=a},d.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},d.prototype.onOpen=function(){this.open=!0},d.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},d.prototype.onPacket=function(a){this.of(a.endpoint).onPacket(a)},d.prototype.onError=function(a){a&&a.advice&&"reconnect"===a.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",a&&a.reason?a.reason:a)},d.prototype.onDisconnect=function(a){var b=this.connected,c=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(b||c)&&(this.transport.close(),this.transport.clearTimeouts(),b&&(this.publish("disconnect",a),"booted"!=a&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},d.prototype.reconnect=function(){function a(){if(c.connected){for(var a in c.namespaces)c.namespaces.hasOwnProperty(a)&&""!==a&&c.namespaces[a].packet({type:"connect"});c.publish("reconnect",c.transport.name,c.reconnectionAttempts)}clearTimeout(c.reconnectionTimer),c.removeListener("connect_failed",b),c.removeListener("connect",b),c.reconnecting=!1,delete c.reconnectionAttempts,delete c.reconnectionDelay,delete c.reconnectionTimer,delete c.redoTransports,c.options["try multiple transports"]=e}function b(){return c.reconnecting?c.connected?a():c.connecting&&c.reconnecting?c.reconnectionTimer=setTimeout(b,1e3):void(c.reconnectionAttempts++>=d?c.redoTransports?(c.publish("reconnect_failed"),a()):(c.on("connect_failed",b),c.options["try multiple transports"]=!0,c.transports=c.origTransports,c.transport=c.getTransport(),c.redoTransports=!0,c.connect()):(c.reconnectionDelay<f&&(c.reconnectionDelay*=2),c.connect(),c.publish("reconnecting",c.reconnectionDelay,c.reconnectionAttempts),c.reconnectionTimer=setTimeout(b,c.reconnectionDelay))):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var c=this,d=this.options["max reconnection attempts"],e=this.options["try multiple transports"],f=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(b,this.reconnectionDelay),this.on("connect",b)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b){function c(a,b){this.socket=a,this.name=b||"",this.flags={},this.json=new d(this,"json"),this.ackPackets=0,this.acks={}}function d(a,b){this.namespace=a,this.name=b}a.SocketNamespace=c,b.util.mixin(c,b.EventEmitter),c.prototype.$emit=b.EventEmitter.prototype.emit,c.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},c.prototype.packet=function(a){return a.endpoint=this.name,this.socket.packet(a),this.flags={},this},c.prototype.send=function(a,b){var c={type:this.flags.json?"json":"message",data:a};return"function"==typeof b&&(c.id=++this.ackPackets,c.ack=!0,this.acks[c.id]=b),this.packet(c)},c.prototype.emit=function(a){var b=Array.prototype.slice.call(arguments,1),c=b[b.length-1],d={type:"event",name:a};return"function"==typeof c&&(d.id=++this.ackPackets,d.ack="data",this.acks[d.id]=c,b=b.slice(0,b.length-1)),d.args=b,this.packet(d)},c.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},c.prototype.onPacket=function(a){function c(){d.packet({type:"ack",args:b.util.toArray(arguments),ackId:a.id})}var d=this;switch(a.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(a.reason||"booted"):this.$emit("disconnect",a.reason);break;case"message":case"json":var e=["message",a.data];"data"==a.ack?e.push(c):a.ack&&this.packet({type:"ack",ackId:a.id}),this.$emit.apply(this,e);break;case"event":var e=[a.name].concat(a.args);"data"==a.ack&&e.push(c),this.$emit.apply(this,e);break;case"ack":this.acks[a.ackId]&&(this.acks[a.ackId].apply(this,a.args),delete this.acks[a.ackId]);break;case"error":a.advice?this.socket.onError(a):"unauthorized"==a.reason?this.$emit("connect_failed",a.reason):this.$emit("error",a.reason)}},d.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},d.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b,c){function d(a){b.Transport.apply(this,arguments)}a.websocket=d,b.util.inherit(d,b.Transport),d.prototype.name="websocket",d.prototype.open=function(){var a,d=b.util.query(this.socket.options.query),e=this;return a||(a=c.MozWebSocket||c.WebSocket),this.websocket=new a(this.prepareUrl()+d),this.websocket.onopen=function(){e.onOpen(),e.socket.setBuffer(!1)},this.websocket.onmessage=function(a){e.onData(a.data)},this.websocket.onclose=function(){e.onClose(),e.socket.setBuffer(!0)},this.websocket.onerror=function(a){e.onError(a)},this},b.util.ua.iDevice?d.prototype.send=function(a){var b=this;return setTimeout(function(){b.websocket.send(a)},0),this}:d.prototype.send=function(a){return this.websocket.send(a),this},d.prototype.payload=function(a){for(var b=0,c=a.length;c>b;b++)this.packet(a[b]);return this},d.prototype.close=function(){return this.websocket.close(),this},d.prototype.onError=function(a){this.socket.onError(a)},d.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},d.check=function(){return"WebSocket"in c&&!("__addTask"in WebSocket)||"MozWebSocket"in c},d.xdomainCheck=function(){return!0},b.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b){function c(){b.Transport.websocket.apply(this,arguments)}a.flashsocket=c,b.util.inherit(c,b.Transport.websocket),c.prototype.name="flashsocket",c.prototype.open=function(){var a=this,c=arguments;return WebSocket.__addTask(function(){b.Transport.websocket.prototype.open.apply(a,c)}),this},c.prototype.send=function(){var a=this,c=arguments;return WebSocket.__addTask(function(){b.Transport.websocket.prototype.send.apply(a,c)}),this},c.prototype.close=function(){return WebSocket.__tasks.length=0,b.Transport.websocket.prototype.close.call(this),this},c.prototype.ready=function(a,d){function e(){var b=a.options,e=b["flash policy port"],g=["http"+(b.secure?"s":"")+":/",b.host+":"+b.port,b.resource,"static/flashsocket","WebSocketMain"+(a.isXDomain()?"Insecure":"")+".swf"];c.loaded||("undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=g.join("/")),843!==e&&WebSocket.loadFlashPolicyFile("xmlsocket://"+b.host+":"+e),WebSocket.__initialize(),c.loaded=!0),d.call(f)}var f=this;return document.body?e():void b.util.load(e)},c.check=function(){return"undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject?swfobject.getFlashPlayerVersion().major>=10:!1},c.xdomainCheck=function(){return!0},"undefined"!=typeof window&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0),b.transports.push("flashsocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),"undefined"!=typeof window)var swfobject=function(){function a(){if(!R){try{var a=K.getElementsByTagName("body")[0].appendChild(q("span"));a.parentNode.removeChild(a)}catch(b){return}R=!0;for(var c=N.length,d=0;c>d;d++)N[d]()}}function b(a){R?a():N[N.length]=a}function c(a){if(typeof J.addEventListener!=C)J.addEventListener("load",a,!1);else if(typeof K.addEventListener!=C)K.addEventListener("load",a,!1);else if(typeof J.attachEvent!=C)r(J,"onload",a);else if("function"==typeof J.onload){var b=J.onload;J.onload=function(){b(),a()}}else J.onload=a}function d(){M?e():f()}function e(){var a=K.getElementsByTagName("body")[0],b=q(D);b.setAttribute("type",G);var c=a.appendChild(b);if(c){var d=0;!function(){if(typeof c.GetVariable!=C){var e=c.GetVariable("$version");e&&(e=e.split(" ")[1].split(","),U.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)])}else if(10>d)return d++,void setTimeout(arguments.callee,10);a.removeChild(b),c=null,f()}()}else f()}function f(){var a=O.length;if(a>0)for(var b=0;a>b;b++){var c=O[b].id,d=O[b].callbackFn,e={success:!1,id:c};if(U.pv[0]>0){var f=p(c);if(f)if(!s(O[b].swfVersion)||U.wk&&U.wk<312)if(O[b].expressInstall&&h()){var k={};k.data=O[b].expressInstall,k.width=f.getAttribute("width")||"0",k.height=f.getAttribute("height")||"0",f.getAttribute("class")&&(k.styleclass=f.getAttribute("class")),f.getAttribute("align")&&(k.align=f.getAttribute("align"));for(var l={},m=f.getElementsByTagName("param"),n=m.length,o=0;n>o;o++)"movie"!=m[o].getAttribute("name").toLowerCase()&&(l[m[o].getAttribute("name")]=m[o].getAttribute("value"));i(k,l,c,d)}else j(f),d&&d(e);else u(c,!0),d&&(e.success=!0,e.ref=g(c),d(e))}else if(u(c,!0),d){var q=g(c);q&&typeof q.SetVariable!=C&&(e.success=!0,e.ref=q),d(e)}}}function g(a){var b=null,c=p(a);if(c&&"OBJECT"==c.nodeName)if(typeof c.SetVariable!=C)b=c;else{var d=c.getElementsByTagName(D)[0];d&&(b=d)}return b}function h(){return!S&&s("6.0.65")&&(U.win||U.mac)&&!(U.wk&&U.wk<312)}function i(a,b,c,d){S=!0,y=d||null,z={success:!1,id:c};var e=p(c);if(e){"OBJECT"==e.nodeName?(w=k(e),x=null):(w=e,x=c),a.id=H,(typeof a.width==C||!/%$/.test(a.width)&&parseInt(a.width,10)<310)&&(a.width="310"),(typeof a.height==C||!/%$/.test(a.height)&&parseInt(a.height,10)<137)&&(a.height="137"),K.title=K.title.slice(0,47)+" - Flash Player Installation";var f=U.ie&&U.win?["Active"].concat("").join("X"):"PlugIn",g="MMredirectURL="+J.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+K.title;if(typeof b.flashvars!=C?b.flashvars+="&"+g:b.flashvars=g,U.ie&&U.win&&4!=e.readyState){var h=q("div");c+="SWFObjectNew",h.setAttribute("id",c),e.parentNode.insertBefore(h,e),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}l(a,b,c)}}function j(a){if(U.ie&&U.win&&4!=a.readyState){var b=q("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(k(a),b),a.style.display="none",function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}else a.parentNode.replaceChild(k(a),a)}function k(a){var b=q("div");if(U.win&&U.ie)b.innerHTML=a.innerHTML;else{var c=a.getElementsByTagName(D)[0];if(c){var d=c.childNodes;if(d)for(var e=d.length,f=0;e>f;f++)1==d[f].nodeType&&"PARAM"==d[f].nodeName||8==d[f].nodeType||b.appendChild(d[f].cloneNode(!0))}}return b}function l(a,b,c){var d,e=p(c);if(U.wk&&U.wk<312)return d;if(e)if(typeof a.id==C&&(a.id=c),U.ie&&U.win){var f="";for(var g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?f+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(f+=" "+g+'="'+a[g]+'"'));var h="";for(var i in b)b[i]!=Object.prototype[i]&&(h+='<param name="'+i+'" value="'+b[i]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+h+"</object>",P[P.length]=a.id,d=p(a.id)}else{var j=q(D);j.setAttribute("type",G);for(var k in a)a[k]!=Object.prototype[k]&&("styleclass"==k.toLowerCase()?j.setAttribute("class",a[k]):"classid"!=k.toLowerCase()&&j.setAttribute(k,a[k]));for(var l in b)b[l]!=Object.prototype[l]&&"movie"!=l.toLowerCase()&&m(j,l,b[l]);e.parentNode.replaceChild(j,e),d=j}return d}function m(a,b,c){var d=q("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function n(a){var b=p(a);b&&"OBJECT"==b.nodeName&&(U.ie&&U.win?(b.style.display="none",function(){4==b.readyState?o(a):setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function o(a){var b=p(a);if(b){for(var c in b)"function"==typeof b[c]&&(b[c]=null);b.parentNode.removeChild(b)}}function p(a){var b=null;try{b=K.getElementById(a)}catch(c){}return b}function q(a){return K.createElement(a)}function r(a,b,c){a.attachEvent(b,c),Q[Q.length]=[a,b,c]}function s(a){var b=U.pv,c=a.split(".");return c[0]=parseInt(c[0],10),c[1]=parseInt(c[1],10)||0,c[2]=parseInt(c[2],10)||0,b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function t(a,b,c,d){if(!U.ie||!U.mac){var e=K.getElementsByTagName("head")[0];if(e){var f=c&&"string"==typeof c?c:"screen";if(d&&(A=null,B=null),!A||B!=f){var g=q("style");g.setAttribute("type","text/css"),g.setAttribute("media",f),A=e.appendChild(g),U.ie&&U.win&&typeof K.styleSheets!=C&&K.styleSheets.length>0&&(A=K.styleSheets[K.styleSheets.length-1]),B=f}U.ie&&U.win?A&&typeof A.addRule==D&&A.addRule(a,b):A&&typeof K.createTextNode!=C&&A.appendChild(K.createTextNode(a+" {"+b+"}"))}}}function u(a,b){if(T){var c=b?"visible":"hidden";R&&p(a)?p(a).style.visibility=c:t("#"+a,"visibility:"+c)}}function v(a){var b=/[\\\"<>\.;]/,c=null!=b.exec(a);return c&&typeof encodeURIComponent!=C?encodeURIComponent(a):a}var w,x,y,z,A,B,C="undefined",D="object",E="Shockwave Flash",F="ShockwaveFlash.ShockwaveFlash",G="application/x-shockwave-flash",H="SWFObjectExprInst",I="onreadystatechange",J=window,K=document,L=navigator,M=!1,N=[d],O=[],P=[],Q=[],R=!1,S=!1,T=!0,U=function(){var a=typeof K.getElementById!=C&&typeof K.getElementsByTagName!=C&&typeof K.createElement!=C,b=L.userAgent.toLowerCase(),c=L.platform.toLowerCase(),d=c?/win/.test(c):/win/.test(b),e=c?/mac/.test(c):/mac/.test(b),f=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,g=!1,h=[0,0,0],i=null;
if(typeof L.plugins!=C&&typeof L.plugins[E]==D)i=L.plugins[E].description,!i||typeof L.mimeTypes!=C&&L.mimeTypes[G]&&!L.mimeTypes[G].enabledPlugin||(M=!0,g=!1,i=i.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),h[0]=parseInt(i.replace(/^(.*)\..*$/,"$1"),10),h[1]=parseInt(i.replace(/^.*\.(.*)\s.*$/,"$1"),10),h[2]=/[a-zA-Z]/.test(i)?parseInt(i.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof J[["Active"].concat("Object").join("X")]!=C)try{var j=new(window[["Active"].concat("Object").join("X")])(F);j&&(i=j.GetVariable("$version"),i&&(g=!0,i=i.split(" ")[1].split(","),h=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]))}catch(k){}return{w3:a,pv:h,wk:f,ie:g,win:d,mac:e}}();(function(){U.w3&&((typeof K.readyState!=C&&"complete"==K.readyState||typeof K.readyState==C&&(K.getElementsByTagName("body")[0]||K.body))&&a(),R||(typeof K.addEventListener!=C&&K.addEventListener("DOMContentLoaded",a,!1),U.ie&&U.win&&(K.attachEvent(I,function(){"complete"==K.readyState&&(K.detachEvent(I,arguments.callee),a())}),J==top&&!function(){if(!R){try{K.documentElement.doScroll("left")}catch(b){return void setTimeout(arguments.callee,0)}a()}}()),U.wk&&!function(){return R?void 0:/loaded|complete/.test(K.readyState)?void a():void setTimeout(arguments.callee,0)}(),c(a)))})(),function(){U.ie&&U.win&&window.attachEvent("onunload",function(){for(var a=Q.length,b=0;a>b;b++)Q[b][0].detachEvent(Q[b][1],Q[b][2]);for(var c=P.length,d=0;c>d;d++)n(P[d]);for(var e in U)U[e]=null;U=null;for(var f in swfobject)swfobject[f]=null;swfobject=null})}();return{registerObject:function(a,b,c,d){if(U.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,O[O.length]=e,u(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){return U.w3?g(a):void 0},embedSWF:function(a,c,d,e,f,g,j,k,m,n){var o={success:!1,id:c};U.w3&&!(U.wk&&U.wk<312)&&a&&c&&d&&e&&f?(u(c,!1),b(function(){d+="",e+="";var b={};if(m&&typeof m===D)for(var p in m)b[p]=m[p];b.data=a,b.width=d,b.height=e;var q={};if(k&&typeof k===D)for(var r in k)q[r]=k[r];if(j&&typeof j===D)for(var t in j)typeof q.flashvars!=C?q.flashvars+="&"+t+"="+j[t]:q.flashvars=t+"="+j[t];if(s(f)){var v=l(b,q,c);b.id==c&&u(c,!0),o.success=!0,o.ref=v}else{if(g&&h())return b.data=g,void i(b,q,c,n);u(c,!0)}n&&n(o)})):n&&n(o)},switchOffAutoHideShow:function(){T=!1},ua:U,getFlashPlayerVersion:function(){return{major:U.pv[0],minor:U.pv[1],release:U.pv[2]}},hasFlashPlayerVersion:s,createSWF:function(a,b,c){return U.w3?l(a,b,c):void 0},showExpressInstall:function(a,b,c,d){U.w3&&h()&&i(a,b,c,d)},removeSWF:function(a){U.w3&&n(a)},createCSS:function(a,b,c,d){U.w3&&t(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=K.location.search||K.location.hash;if(b){if(/\?/.test(b)&&(b=b.split("?")[1]),null==a)return v(b);for(var c=b.split("&"),d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return v(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(S){var a=p(H);a&&w&&(a.parentNode.replaceChild(w,a),x&&(u(x,!0),U.ie&&U.win&&(w.style.display="block")),y&&y(z)),S=!1}}}}();!function(){if("undefined"!=typeof window&&!window.WebSocket){var a=window.console;if(a&&a.log&&a.error||(a={log:function(){},error:function(){}}),!swfobject.hasFlashPlayerVersion("10.0.0"))return void a.error("Flash Player >= 10.0.0 is required.");"file:"==location.protocol&&a.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(a,b,c,d,e){var f=this;f.__id=WebSocket.__nextId++,WebSocket.__instances[f.__id]=f,f.readyState=WebSocket.CONNECTING,f.bufferedAmount=0,f.__events={},b?"string"==typeof b&&(b=[b]):b=[],setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(f.__id,a,b,c||null,d||0,e||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var b=WebSocket.__flash.send(this.__id,encodeURIComponent(a));return 0>b?!0:(this.bufferedAmount+=b,!1)},WebSocket.prototype.close=function(){this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(a,b,c){a in this.__events||(this.__events[a]=[]),this.__events[a].push(b)},WebSocket.prototype.removeEventListener=function(a,b,c){if(a in this.__events)for(var d=this.__events[a],e=d.length-1;e>=0;--e)if(d[e]===b){d.splice(e,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var b=this.__events[a.type]||[],c=0;c<b.length;++c)b[c](a);var d=this["on"+a.type];d&&d(a)},WebSocket.prototype.__handleEvent=function(a){"readyState"in a&&(this.readyState=a.readyState),"protocol"in a&&(this.protocol=a.protocol);var b;if("open"==a.type||"error"==a.type)b=this.__createSimpleEvent(a.type);else if("close"==a.type)b=this.__createSimpleEvent("close");else{if("message"!=a.type)throw"unknown event type: "+a.type;var c=decodeURIComponent(a.message);b=this.__createMessageEvent("message",c)}this.dispatchEvent(b)},WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&window.Event){var b=document.createEvent("Event");return b.initEvent(a,!1,!1),b}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(a,b){if(document.createEvent&&window.MessageEvent&&!window.opera){var c=document.createEvent("MessageEvent");return c.initMessageEvent("message",!1,!1,b,null,null,window,null),c}return{type:a,data:b,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},WebSocket.__initialize=function(){if(!WebSocket.__flash){if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),!window.WEB_SOCKET_SWF_LOCATION)return void a.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");var b=document.createElement("div");b.id="webSocketContainer",b.style.position="absolute",WebSocket.__isFlashLite()?(b.style.left="0px",b.style.top="0px"):(b.style.left="-100px",b.style.top="-100px");var c=document.createElement("div");c.id="webSocketFlash",b.appendChild(c),document.body.appendChild(b),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(b){b.success||a.error("[WebSocket] swfobject.embedSWF failed")})}},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{for(var b=WebSocket.__flash.receiveEvents(),c=0;c<b.length;++c)WebSocket.__instances[b[c].webSocketId].__handleEvent(b[c])}catch(d){a.error(d)}},0),!0},WebSocket.__log=function(b){a.log(decodeURIComponent(b))},WebSocket.__error=function(b){a.error(decodeURIComponent(b))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return a&&a.enabledPlugin&&a.enabledPlugin.filename&&a.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))}}(),function(a,b,c){function d(a){a&&(b.Transport.apply(this,arguments),this.sendBuffer=[])}function e(){}a.XHR=d,b.util.inherit(d,b.Transport),d.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},d.prototype.payload=function(a){for(var c=[],d=0,e=a.length;e>d;d++)c.push(b.parser.encodePacket(a[d]));this.send(b.parser.encodePayload(c))},d.prototype.send=function(a){return this.post(a),this},d.prototype.post=function(a){function b(){4==this.readyState&&(this.onreadystatechange=e,f.posting=!1,200==this.status?f.socket.setBuffer(!1):f.onClose())}function d(){this.onload=e,f.socket.setBuffer(!1)}var f=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),c.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=d:this.sendXHR.onreadystatechange=b,this.sendXHR.send(a)},d.prototype.close=function(){return this.onClose(),this},d.prototype.request=function(a){var c=b.util.request(this.socket.isXDomain()),d=b.util.query(this.socket.options.query,"t="+ +new Date);if(c.open(a||"GET",this.prepareUrl()+d,!0),"POST"==a)try{c.setRequestHeader?c.setRequestHeader("Content-type","text/plain;charset=UTF-8"):c.contentType="text/plain"}catch(e){}return c},d.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},d.check=function(a,d){try{var e=b.util.request(d),f=c.XDomainRequest&&e instanceof XDomainRequest,g=a&&a.options&&a.options.secure?"https:":"http:",h=c.location&&g!=c.location.protocol;if(e&&(!f||!h))return!0}catch(i){}return!1},d.xdomainCheck=function(a){return d.check(a,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b){function c(a){b.Transport.XHR.apply(this,arguments)}a.htmlfile=c,b.util.inherit(c,b.Transport.XHR),c.prototype.name="htmlfile",c.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var a=this.doc.createElement("div");a.className="socketio",this.doc.body.appendChild(a),this.iframe=this.doc.createElement("iframe"),a.appendChild(this.iframe);var c=this,d=b.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+d,b.util.on(window,"unload",function(){c.destroy()})},c.prototype._=function(a,b){this.onData(a);try{var c=b.getElementsByTagName("script")[0];c.parentNode.removeChild(c)}catch(d){}},c.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(a){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},c.prototype.close=function(){return this.destroy(),b.Transport.XHR.prototype.close.call(this)},c.check=function(a){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{var c=new(window[["Active"].concat("Object").join("X")])("htmlfile");return c&&b.Transport.XHR.check(a)}catch(d){}return!1},c.xdomainCheck=function(){return!1},b.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b,c){function d(){b.Transport.XHR.apply(this,arguments)}function e(){}a["xhr-polling"]=d,b.util.inherit(d,b.Transport.XHR),b.util.merge(d,b.Transport.XHR),d.prototype.name="xhr-polling",d.prototype.heartbeats=function(){return!1},d.prototype.open=function(){var a=this;return b.Transport.XHR.prototype.open.call(a),!1},d.prototype.get=function(){function a(){4==this.readyState&&(this.onreadystatechange=e,200==this.status?(f.onData(this.responseText),f.get()):f.onClose())}function b(){this.onload=e,this.onerror=e,f.retryCounter=1,f.onData(this.responseText),f.get()}function d(){f.retryCounter++,!f.retryCounter||f.retryCounter>3?f.onClose():f.get()}if(this.isOpen){var f=this;this.xhr=this.request(),c.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=b,this.xhr.onerror=d):this.xhr.onreadystatechange=a,this.xhr.send(null)}},d.prototype.onClose=function(){if(b.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=e;try{this.xhr.abort()}catch(a){}this.xhr=null}},d.prototype.ready=function(a,c){var d=this;b.util.defer(function(){c.call(d)})},b.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b,c){function d(a){b.Transport["xhr-polling"].apply(this,arguments),this.index=b.j.length;var c=this;b.j.push(function(a){c._(a)})}var e=c.document&&"MozAppearance"in c.document.documentElement.style;a["jsonp-polling"]=d,b.util.inherit(d,b.Transport["xhr-polling"]),d.prototype.name="jsonp-polling",d.prototype.post=function(a){function c(){d(),e.socket.setBuffer(!1)}function d(){e.iframe&&e.form.removeChild(e.iframe);try{g=document.createElement('<iframe name="'+e.iframeId+'">')}catch(a){g=document.createElement("iframe"),g.name=e.iframeId}g.id=e.iframeId,e.form.appendChild(g),e.iframe=g}var e=this,f=b.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var g,h=document.createElement("form"),i=document.createElement("textarea"),j=this.iframeId="socketio_iframe_"+this.index;h.className="socketio",h.style.position="absolute",h.style.top="0px",h.style.left="0px",h.style.display="none",h.target=j,h.method="POST",h.setAttribute("accept-charset","utf-8"),i.name="d",h.appendChild(i),document.body.appendChild(h),this.form=h,this.area=i}this.form.action=this.prepareUrl()+f,d(),this.area.value=b.JSON.stringify(a);try{this.form.submit()}catch(k){}this.iframe.attachEvent?g.onreadystatechange=function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c,this.socket.setBuffer(!0)},d.prototype.get=function(){var a=this,c=document.createElement("script"),d=b.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),c.async=!0,c.src=this.prepareUrl()+d,c.onerror=function(){a.onClose()};var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(c,f),this.script=c,e&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a),document.body.removeChild(a)},100)},d.prototype._=function(a){return this.onData(a),this.isOpen&&this.get(),this},d.prototype.ready=function(a,c){var d=this;return e?void b.util.load(function(){c.call(d)}):c.call(this)},d.check=function(){return"document"in c},d.xdomainCheck=function(){return!0},b.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),"function"==typeof define&&define.amd&&define([],function(){return io})}();var matched,browser;jQuery.uaMatch=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},matched=jQuery.uaMatch(navigator.userAgent),browser={},matched.browser&&(browser[matched.browser]=!0,browser.version=matched.version),browser.chrome?browser.webkit=!0:browser.webkit&&(browser.safari=!0),jQuery.browser=browser,function(a){function b(b,c,d){var e,f,g,h,i=b.width,j=b.width;if(h=a(b.parentNode),this.element=e=h.append("<canvas class='reflection' style='position:absolute'/>").find(":last")[0],!e.getContext&&a.browser.msie)this.element=e=h.append("<img class='reflection' style='position:absolute'/>").find(":last")[0],e.src=b.src,e.style.filter="flipv progid:DXImageTransform.Microsoft.Alpha(opacity="+100*d+", style=1, finishOpacity=0, startx=0, starty=0, finishx=0, finishy="+c/j*100+")";else{f=e.getContext("2d");try{a(e).attr({width:i,height:c}),f.save(),f.translate(0,j-1),f.scale(1,-1),f.drawImage(b,0,0,i,j),f.restore(),f.globalCompositeOperation="destination-out",g=f.createLinearGradient(0,0,0,c),g.addColorStop(0,"rgba(255, 255, 255, "+(1-d)+")"),g.addColorStop(1,"rgba(255, 255, 255, 1.0)"),f.fillStyle=g,f.fillRect(0,0,i,c)}catch(k){return}}a(e).attr({alt:a(b).attr("alt"),title:a(b).attr("title")})}var c=function(c,d){this.orgWidth=c.width,this.orgHeight=c.height,this.image=c,this.reflection=null,this.alt=c.alt,this.title=c.title,this.imageOK=!1,this.options=d,this.imageOK=!0,this.options.reflHeight>0&&(this.reflection=new b(this.image,this.options.reflHeight,this.options.reflOpacity)),a(this.image).css("position","absolute")},d=function(b,d,e){var f=[],g=Math.sin,h=Math.cos,i=this;this.controlTimer=0,this.stopped=!1,this.container=b,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.showFrontTextTimer=0,this.autoRotateTimer=0,0===e.xRadius&&(this.xRadius=a(b).width()/2.3),0===e.yRadius&&(this.yRadius=a(b).height()/6),this.xCentre=e.xPos,this.yCentre=e.yPos,this.frontIndex=0,this.rotation=this.destRotation=Math.PI/2,this.timeDelay=1e3/e.FPS,null!==e.altBox&&(a(e.altBox).css("display","block"),a(e.titleBox).css("display","block")),a(b).css({position:"relative",overflow:"hidden"}),a(e.buttonLeft).css("display","inline"),a(e.buttonRight).css("display","inline"),a(e.buttonLeft).bind("mouseup",this,function(a){return a.data.rotate(-1),!1}),a(e.buttonRight).bind("mouseup",this,function(a){return a.data.rotate(1),!1}),e.tabbingEl&&e.tabbingEl.bind("keydown",this,function(a){9==a.keyCode&&a.shiftKey?(a.data.rotate(-1),a.preventDefault(),a.stopPropagation()):9==a.keyCode&&(a.data.rotate(1),a.preventDefault(),a.stopPropagation())}),e.mouseWheel&&a(b).bind("mousewheel",this,function(a,b){return a.data.rotate(b),!1}),a(b).bind("mouseover click",this,function(b){clearInterval(b.data.autoRotateTimer);var c=a(b.target).attr("alt");if(void 0!==c&&null!==c&&(clearTimeout(b.data.showFrontTextTimer),a(e.altBox).html(a(b.target).attr("alt")),e.bringToFront&&"click"==b.type)){a(e.titleBox).html(a(b.target).attr("title")),e.callback&&e.callback(a(b.target).attr("data-id"));var f=a(b.target).data("itemIndex"),g=b.data.frontIndex,h=(f-g)%d.length;Math.abs(h)>d.length/2&&(h+=h>0?-d.length:d.length),b.data.rotate(-h)}}),a(b).bind("mouseout",this,function(a){var b=a.data;clearTimeout(b.showFrontTextTimer),b.showFrontTextTimer=setTimeout(function(){b.showFrontText()},1e3),b.autoRotate()}),a(b).bind("mousedown",this,function(a){return a.data.container.focus(),!1}),b.onselectstart=function(){return!1},this.innerWrapper=a(b).wrapInner('<div style="position:absolute;width:100%;height:100%;"/>').children()[0],this.showFrontText=function(){void 0!==f[this.frontIndex]&&(e.callback&&e.callback(a(f[this.frontIndex].image).attr("data-id")),a(e.titleBox).html(a(f[this.frontIndex].image).attr("title")),a(e.altBox).html(a(f[this.frontIndex].image).attr("alt")))},this.go=function(){if(0===this.controlTimer){var a=this;this.controlTimer=setTimeout(function(){a.updateAll()},this.timeDelay)}},this.stop=function(){clearTimeout(this.controlTimer),this.controlTimer=0},this.rotate=function(a){this.frontIndex-=a,-1==this.frontIndex&&(this.frontIndex=f.length-1),this.frontIndex%=f.length,this.destRotation+=Math.PI/f.length*2*a,this.showFrontText(),this.go()},this.autoRotate=function(){if("no"!==e.autoRotate){var a="right"===e.autoRotate?1:-1;this.autoRotateTimer=setInterval(function(){i.rotate(a)},e.autoRotateDelay)}},this.updateAll=function(){var b,c,d,i,j,k,l,m=e.minScale,n=.5*(1-m),o=this.destRotation-this.rotation,p=Math.abs(o);this.rotation+=o*e.speed,.001>p&&(this.rotation=this.destRotation);var q=f.length,r=Math.PI/q*2,s=this.rotation,t=a.browser.msie;this.innerWrapper.style.display="none";for(var u,v,w="px",x=this,y=0;q>y;y++){if(k=f[y],l=g(s),j=(l+1)*n+m,d=this.xCentre+(h(s)*this.xRadius-.5*k.orgWidth)*j,i=this.yCentre+l*this.yRadius*j,k.imageOK){var z=k.image;z.style.zIndex=""+100*j>>0,b=z.width=k.orgWidth*j,c=z.height=k.orgHeight*j,z.style.left=d+w,z.style.top=i+w,null!==k.reflection&&(v=e.reflHeight*j,u=k.reflection.element.style,u.left=d+w,u.top=i+c+e.reflGap*j+w,u.width=b+w,t?u.filter.finishy=v/c*100:u.height=v+w)}s+=r}this.innerWrapper.style.display="block",p>=.001?this.controlTimer=setTimeout(function(){x.updateAll()},this.timeDelay):this.stop()},this.checkImagesLoaded=function(){var b;for(b=0;b<d.length;b++)if(void 0===d[b].width||void 0!==d[b].complete&&!d[b].complete)return;for(b=0;b<d.length;b++)f.push(new c(d[b],e)),a(d[b]).data("itemIndex",b);clearInterval(this.tt),this.showFrontText(),this.autoRotate(),this.updateAll()},this.tt=setInterval(function(){i.checkImagesLoaded()},50)};a.fn.CloudCarousel=function(b){return this.each(function(){b=a.extend({},{reflHeight:0,reflOpacity:.5,reflGap:0,minScale:.5,xPos:0,yPos:0,xRadius:0,yRadius:0,altBox:null,titleBox:null,FPS:30,autoRotate:"no",autoRotateDelay:1500,speed:.2,mouseWheel:!1,bringToFront:!1},b),a(this).data("cloudcarousel",new d(this,a(".cloudcarousel",a(this)),b))}),this}}(jQuery),!function(){var a=function b(c,d,e){function f(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof a&&a;if(!i&&j)return j(h,!0);if(g)return g(h,!0);throw new Error("Cannot find module '"+h+"'")}var k=d[h]={exports:{}};c[h][0].call(k.exports,function(a){var b=c[h][1][a];return f(b?b:a)},k,k.exports,b,c,d,e)}return d[h].exports}for(var g="function"==typeof a&&a,h=0;h<e.length;h++)f(e[h]);return f}({1:[function(a,b){var c=a("./utils.js"),d=a("./browser.js"),e=function(){return this instanceof e?void this.init():new e};e.prototype.init=function(){this.data={}},e.prototype.add=function(a,b,c,d){c=c===!0?!0:!1;var e={func:b,one:c,ctx:d};return this.data.hasOwnProperty(a)?this.data[a].push(e):this.data[a]=[e],this},e.prototype.on=function(a,b,c){return this.add(a,b,!1,c)},e.prototype.off=function(a,b){if(!this.data.hasOwnProperty(a))return this;var d=c.reduce(this.data[a],function(a,d){return c.isNone(b)||d.func!==b?c.isNone(b)?a:(a.push(d),a):a},[]);return 0===d.length?delete this.data[a]:this.data[a]=d,this},e.prototype.one=function(a,b,c){return this.add(a,b,!0,c)},e.prototype.get=function(a,b,c,d){this.one(a+".response",c,d),this.notify(a,b)},e.prototype.notify=function(){var a=Array.prototype.slice.call(arguments,0);if(0===a.length)return this;var b=a.splice(0,1)[0];if(!this.data.hasOwnProperty(b))return this;var e,f=[],g=[];return c.each(this.data[b],function(a){g.push(a),a.one===!1&&f.push(a)}),0===f.length?delete this.data[b]:this.data[b]=f,c.each(g,function(f){try{e=c.isNone(f.ctx)?this:f.ctx,f.func.apply(e,a)}catch(g){d.console.error(b,a,g)}},this),this},b.exports=e},{"./browser.js":2,"./utils.js":15}],2:[function(a,b){var c=a("./utils.js"),d=a("./dom.js"),e=a("./urlparse.js"),f=a("conf"),g={};g.supports={_test:function(a){var b=["Webkit","Moz","O","ms","Khtml"],d=document.createElement("div"),e=a.charAt(0).toUpperCase()+a.substr(1),f=[a];c.each(b,function(a){f.push(a+e)});for(var g=0;g<f.length;g++)if(""===d.style[f[g]])return!0;return!1},postMessage:function(){return!!window.postMessage},boxShadow:function(){return g.supports._test("boxShadow")},borderRadius:function(){return g.supports._test("borderRadius")},touch:function(){return!!("ontouchstart"in window)},svg:function(){return!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect},mediaQuery:function(){return!("undefined"==typeof window.matchMedia&&"undefined"==typeof window.msMatchMedia)},rgba:function(){var a=document.createElement("div"),b=a.style.color;try{a.style.color="rgba(1,5,13,0.44)"}catch(c){}return a.style.color!==b},cors:function(){if("undefined"==typeof XMLHttpRequest)return!1;var a=new XMLHttpRequest;return"withCredentials"in a?!0:"undefined"!=typeof XDomainRequest?!0:!1},flash:function(){if("undefined"!=typeof navigator.plugins&&0!==navigator.plugins.length)return!!navigator.plugins["Shockwave Flash"];try{return!!new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(a){return!1}}},g.detect=function(){var a=function(a,b){b?d.addClass(document.body,a):d.addClass(document.body,"no-"+a)};a("touch",g.supports.touch()),a("boxshadow",g.supports.boxShadow()),a("borderradius",g.supports.borderRadius()),a("rgba",g.supports.rgba()),a("mediaquery",g.supports.mediaQuery())},g.console={_log:function(a,b){if(f.EMB_DEBUG&&!c.isNone(window.console)&&window.console)if(window.console[a].apply)window.console[a].apply(window.console,b);else{var d=Array.prototype.join.call(b,", ");window.console[a](d)}},log:function(){this._log("log",arguments)},error:function(){this._log("error",arguments)}},g.open=function(a,b,d,e,f,h){if(c.isNone(f)||c.isNone(h)){var i=g.window.center(d,e);f=i.top,h=i.left}var j=window.open(a,b,"scrollbars=no, resizable=1, width="+d+", height="+e+", top="+f+", left="+h);window.focus&&j.focus()},g.cookie={set:function(a,b,c,d){var e="";if(c){var f=new Date;f.setTime(f.getTime()+24*c*60*60*1e3),e="; expires="+f.toGMTString()}document.cookie=a+"="+b+e+"; path=/"+(d?"; secure":"")},get:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},del:function(a){g.cookie.set(a,"",-1)}},g.window={innerHeight:function(){return c.isNone(window.innerHeight)?document.documentElement.clientHeight:window.innerHeight},innerWidth:function(){return c.isNone(window.innerWidth)?document.documentElement.clientWidth:window.innerWidth},scrollY:function(){return c.isNone(window.pageYOffset)?(document.documentElement||document.body.parentNode||document.body).scrollTop:window.pageYOffset},center:function(a,b){var c=void 0!==window.screenLeft?window.screenLeft:screen.left,d=void 0!==window.screenTop?window.screenTop:screen.top,e=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,f=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,g=e/2-a/2+c,h=f/2-b/2+d;return{left:g,top:h}}},g.location={hash:function(){var a=window.location.href.split("#");return 2===a.length?a[1]:""},params:function(){return c.extend({},e.parseQuery(document.location.search),e.parseQuery(g.location.hash()))}},g.mobile=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},g.isIE=function(){return/msie|trident/i.test(navigator.userAgent)},g.language=function(){return window.navigator.userLanguage||window.navigator.language},g.animateScroll=function(a,b){var c,e,f=g.window.scrollY(),h=a-f,i=(new Date).getTime(),j=!1;b=b?b:500;var k=Math.round(h/b*10),l=function(b){return b>a};0>k&&(l=function(b){return a>b});var m=function(){clearInterval(c),g.console.log("duration",(new Date).getTime()-i),d.detachEvent("scroll",e)};c=setInterval(function(){return f+=k,l(f)?(m(),!1):(window.scrollTo(0,f),void(j=!0))},10),e=function(){j&&f!==g.window.scrollY()&&m()},d.addEvent("scroll",e)},b.exports=g},{"./dom.js":5,"./urlparse.js":14,"./utils.js":15,conf:"AqyHQT"}],3:[function(a,b){var c=!1,d=/xyz/.test(function(){})?/\b_super\b/:/.*/,e=function(){};e.extend=function(a){function b(){!c&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;c=!0;var f=new this;c=!1;for(var g in a)f[g]="function"==typeof a[g]&&"function"==typeof e[g]&&d.test(a[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,a[g]):a[g];return b.prototype=f,b.prototype.constructor=b,b.extend=arguments.callee,b},b.exports=e},{}],4:[function(a,b){var c=a("./iframe.js"),d=a("./utils.js"),e={started:!1,instance:null};e.EVENTS=["xcomm.stats.access","xcomm.stats.card.realtime","xcomm.stats.card.week","xcomm.stats.media.realtime","xcomm.stats.media.week","xcomm.stats.media.recommend","xcomm.user.set","xcomm.user.get","xcomm.user.remove","xcomm.page.progress"],e.clear=function(){e.instance&&(e.instance.remove(),e.instance=null),e.started=!1},e.connect=function(a){if(!a||e.started)return!1;e.started=!0;var b=c.createComm(a);return d.each(e.EVENTS,function(c){b.on(c,function(b){a.notify(c+".response",b)}),a.on(c,function(a){b.send(c,a)})}),b.on("xcomm.ready",function(b){a.notify("xcomm.ready",b)}),e.instance=b,b},b.exports=e},{"./iframe.js":6,"./utils.js":15}],5:[function(a,b){var c=a("./utils.js"),d={};d.toArray=function(a){return c.map(a,function(a){return a})},d.all=function(a){var b=[];return document.querySelectorAll?d.toArray(document.querySelectorAll(a)):b},d.one=function(a,b){var c=d.all(a,b);return 0===c.length?null:c[0]},d.create=function(a,b,e,f){if(!a||!c.isString(a))return null;c.isString(b)&&c.isNone(e)&&(e=b,b={});var g;return g=f?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a),c.each(b,function(a,b){g.setAttribute(b,a)}),e&&d.text(g,e),g},d.set=function(a,b,e){if(!a||!c.isString(a))return null;c.isString(b)&&c.isNone(e)&&(e=b,b={});var f=d.one(a);return f?(c.each(b,function(a,b){f.setAttribute(b,a)}),c.isNone(e)||d.text(f,e),f):null},d.replace=function(a,b){c.assert(c.isElement(a),"replace requires an element to be replaced"),c.assert(c.isElement(b),"replace requires an element to replace with."),a.parentNode.replaceChild(b,a)},d.remove=function(a){return c.isElement(a)&&c.isElement(a.parentNode)?void a.parentNode.removeChild(a):!1},d.hide=function(a){return c.isString(a)&&(a=d.one(a)),c.isElement(a)&&(a.style.display="none"),a},d.show=function(a,b){return c.isString(a)&&(a=d.one(a)),c.isElement(a)&&(a.style.display=b?"inline-block":"block"),a},d.svg=function(a,b,c){return d.create(a,b,c,"http://www.w3.org/2000/svg")},d.children=function(a,b){return c.isElement(a)?c.reduce(a.childNodes,function(a,d){if(c.isElement(d)){if(!c.isNone(b))if(d.namespaceURI&&"http://www.w3.org/2000/svg"===d.namespaceURI){if(d.nodeName!==b)return a}else if(b.toUpperCase()!==d.nodeName)return a;a.push(d)}return a},[]):[]},d.child=function(a,b){var c=d.children(a,b);return 0!==c.length?c[0]:null},d.text=function(a,b){if(!a||!c.isElement(a))return null;if(c.isNone(b))return a.innerText||a.textContent;var d=void 0===a.textContent?"innerText":"textContent";a[d]=b},d.hasClass=function(a,b){if(c.isString(a)&&(a=d.one(a)),!c.isElement(a)||!c.isString(b)||!b)return!1;var e=a.getAttribute("class");return c.isNone(e)?!1:(" "+e+" ").indexOf(" "+b+" ")>-1?!0:!1},d.addClass=function(a,b){if(c.isString(a)&&(a=d.one(a)),!c.isElement(a)||!c.isString(b)||!b)return!1;if(d.hasClass(a,b))return!1;var e=a.getAttribute("class");if(c.isNone(e))return a.setAttribute("class",b),!0;var f=e.split(" "),g=[];return c.map(f,function(a){var b=c.trim(a);""!==b&&g.push(b)}),g.push(b),a.setAttribute("class",g.join(" ")),!0},d.removeClass=function(a,b){if(c.isString(a)&&(a=d.one(a)),!c.isElement(a)||!c.isString(b)||!b)return!1;var e=a.getAttribute("class");if(c.isNone(e))return!1;var f=!1,g=c.reduce(e.split(" "),function(a,d){var e=c.trim(d);return e?e===b?(f=!0,a):(a.push(e),a):a},[]);return a.setAttribute("class",g.join(" ")),f},d.data=function(a,b,d){c.assert(a&&c.isElement(a),"dom.data needs an element."),c.assert(b&&c.isString(b),"dom.data needs an attr.");var e=c.camelCase(b);return c.isNone(d)?c.isNone(a.dataset)?a.getAttribute("data-"+b):c.isNone(a.dataset[e])?null:a.dataset[e]:void(c.isNone(a.dataset)?a.setAttribute("data-"+b,d):a.dataset[e]=d)},d.attrize=function(a){return a&&c.isObject(a)?c.map(a,function(a,b){return b+'="'+a+'"'}).sort().join(" "):""},d.event=function(a){var b=c.extend({},a||window.event);return b.target||(b.target=b.srcElement||document),3===b.target.nodeType&&(b.target=b.target.parentNode),!a.metaKey&&a.ctrlKey&&(b.metaKey=b.ctrlKey),b.stop=function(){a.preventDefault?a.preventDefault():a.returnValue=!1},b.pageX||b.pageY||!b.clientX&&!b.clientY||(b.pageX=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,b.pageY=b.clientY+document.body.scrollTop+document.documentElement.scrollTop),b},d.addEvent=function(a,b,d){c.isNone(a)||(a.addEventListener?a.addEventListener(b,d,!1):a.attachEvent?a.attachEvent("on"+b,d):a["on"+b]=d)},d.detachEvent=function(a,b,d){
c.isNone(a)||(a.removeEventListener?a.removeEventListener(b,d,!1):a.detachEvent?a.detachEvent("on"+b,d):a["on"+b]=null)},d.trigger=function(a,b){c.assert(c.contains(["click"],b),"Not a valid event");var d;a.dispatchEvent?(d=document.createEvent("MouseEvents"),d.initEvent(b,!0,!0),a.dispatchEvent(d,!0)):(d=document.createEventObject(),a.fireEvent("on"+b,d))},d.rect=function(a){try{return a.getBoundingClientRect()}catch(b){}return!1},b.exports=d},{"./utils.js":15}],6:[function(a,b){var c=a("./utils.js"),d=a("./dom.js"),e=a("./urlparse.js"),f=a("./browser.js"),g=a("./class.js"),h=a("./json.js"),i=a("./a.js"),j=a("conf"),k={};k.connect=function(a,b){if(!a||!c.isElement(a.elem))return!1;var d=new i,g=[],j=a.elem.src,k=!1,l=e.getOrigin(j);a.on=function(a,b,c){d.on(a,b,c)},a.one=function(a,b,c){d.one(a,b,c)},a.off=function(a,b){d.off(a,b)},a.send=function(b,d){if(c.isNone(d)&&(d={}),c.isString(d)&&(d={msg:d}),d.method=b,k===!1)return f.console.log("Iframe.queue",d),g.push(d),!1;a.sid&&(d.sid=a.sid),f.console.log("iframe.send",d);var e=h.stringify(d);a.elem.contentWindow&&a.elem.contentWindow.postMessage&&a.elem.contentWindow.postMessage(e,l)},a.ready=function(){k||(f.console.log("iframe.ready",a.name),k=!0,c.each(g,function(b){a.send(b.method,b)}))};var m=function(b,c){if(b.origin===l){if(f.console.log("iframe.message",c),!c.src&&!c.sid&&!c.listener)return!1;if(a.sid&&c.sid!==a.sid)return!1;if(c.src&&c.src!==j)return!1;if(c.listener&&c.listener!==j)return!1;"resize"===c.method&&a.resize&&a.resize(c),!c.method&&c.event&&c.listener?d.notify(c.event,c):c.method&&d.notify(c.method,c)}};return b.on("window.message",m),a._remove=function(){b.off("window.message",m)},a},k.rendering=function(a){return"1"===d.data(a,"rendering")?!0:(d.data(a,"rendering","1"),!1)};var l=g.extend({secure:null,rendered:!1,init:function(a,b){this.sid=c.getUUID(),this.query=a,this.create(b)},getSrc:function(){var a="";return a=this.secure===!0||j.EMB_HTTPS?j.EMB_SECURE_FRAME_SRC:/https?:\/\/sulia\.com\/embed/.test(this.query.url)?"http://embed.sulia.com/widgets/":j.EMB_FRAME_SRC,a+=this.name+".html?"+e.createQuery(this.query)+"#sid="+this.sid},create:function(a){var b=c.extend({},this.attrs);return this.src=this.getSrc(),b.src=this.src,b.id="emb_"+(this.query&&this.query.url?c.hash(this.query.url):this.sid),b["class"]="embedly-"+this.name,this.elem=d.create("iframe",b),c.each(this.style,function(a,b){this.elem.style[b]=a},this),k.connect(this,a),this.after(),this.elem},after:function(){},replace:function(a){d.replace(a,this.elem)},append:function(a){a.appendChild(this.elem)},resize:function(a){a.width&&this.elem.setAttribute("width",a.width),a.height&&this.elem.setAttribute("height",a.height)},remove:function(){d.remove(this.elem),this._remove&&this._remove()}}),m=l.extend({name:"card",attrs:{frameborder:"0",scrolling:"no",allowtransparency:"true",allowfullscreen:"true"},style:{width:"1px",height:"0px",border:"none",position:"absolute",visibility:"hidden"}});k.createCard=function(a,b,f){if(!j.EMB_POST_MESSAGE)return null;if(!c.isElement(a)||!c.isElement(a.parentNode))return null;if(k.rendering(a))return null;var g={};if(b&&c.isFunction(b.off)&&(f=b,b=null),!c.isNone(b)&&b.url)g=b;else if(c.each(["type","via","chrome","theme","image","description","embed","controls","analytics"],function(b){var e=d.data(a,"card-"+b);c.isNone(e)||(g[b]=e)}),"BLOCKQUOTE"===a.nodeName){var h,i=d.child(a,"h4"),l=d.child(a,"p");if(c.isNone(i)){if(!l)return!1;var n=a.getElementsByTagName("a");if(0===n.length)return!1;h=n[n.length-1],g.url=h.getAttribute("href")}else h=d.child(i,"a"),g.url=h.getAttribute("href"),g.title=d.text(h),g.description=c.isNone(l)?"0":d.text(l)}else"A"===a.nodeName&&(g.url=a.getAttribute("href"));var o,p,q;if(c.each(document.getElementsByTagName("meta"),function(a){q=[a.getAttribute("name"),a.getAttribute("property")],c.contains(q,"twitter:site")?p=a.getAttribute("content"):c.contains(q,"twitter:creator")&&(o=a.getAttribute("content"))}),o?g.twitter_via=o:p&&(g.twitter_via=p),!g.url)return null;var r=e.parse(g.url);if(!r.valid())return null;g.url=r.url;var s={url:g.url};c.isNone(g.type)||(s.type=g.type);var t=new m(s,f);t.send("card.content",g);var u=a.parentNode;return u&&u.offsetWidth&&(t.elem.style.width=u.offsetWidth>600?"600px":u.offsetWidth+"px"),u.insertBefore(t.elem,a),t.on("card.repeat",function(a){var b={url:a.url,via:document.location.toString()};a.embed&&(b.embed=a.embed),k.createCardModal(b,f)}),t.on("modal.stats",function(a){k.createStatsModal(a,f)}),t.on("card.ready",function(){t.ready()}),t.on("card.rendered",function(e){return"error"===e.name?(t.remove(),!1):b&&c.isArray(b.types)&&b.types.length>0&&!c.contains(b.types,e.type)?(t.remove(),!1):(t.rendered=!0,t.elem.style.display="block",t.elem.style.margin="10px auto",t.elem.style.visibility="visible",t.elem.style.position="relative",t.elem.width="600",t.elem.height=e.height?e.height:"300",t.elem.style.width=null,t.elem.style.height=null,t.elem.style.maxWidth="99%",t.elem.style.minWidth="200px",void d.remove(a))}),t};var n=l.extend({name:"button",attrs:{frameborder:"0",scrolling:"no",allowtransparency:"true",height:"20",width:"80"},style:{border:"none"}});k.createButton=function(a,b){if(!c.isElement(a))return null;if(k.rendering(a))return null;var e=d.data(a,"url");c.isNone(e)&&(e=document.location.toString());var g,h={url:e};c.each(["theme","target","lang"],function(b){g=d.data(a,b),c.isNone(g)||(h[b]=g)});var i=f.window.center(635,500);h.left=i.left,h.top=i.top;var j=new n({url:e},b);return j.replace(a),j.on("button.click",c.bind(function(){f.window.innerWidth()<=768||f.mobile()?window.location="http://embed.ly/code?url="+encodeURIComponent(h.url):k.createCardModal(this,b)},h)),j.send("button.data",h),j.on("button.ready",function(){j.ready()}),j};var o=l.extend({name:"modal",attrs:{frameborder:"0",allowtransparency:"true"},style:{border:"none",position:"fixed",top:"0",left:"0",zIndex:"2147483647"},after:function(){this.elem.style.width=f.window.innerWidth()+"px",this.elem.style.height=f.window.innerHeight()+"px"}});k.createCardModal=function(a,b){if(c.isNone(a)&&(a={url:document.location.toString()}),c.isNone(a.url)&&(a.url=document.location.toString()),"window"===a.target)return f.open("http://cdn.embedly.com/widgets/embed?url="+encodeURIComponent(a.url),"Embed Code",635,500),!1;a.t="card";var e=new o(a,b);return e.append(document.body),d.addEvent(window,"resize",function(){e.elem.style.width=f.window.innerWidth()+"px",e.elem.style.height=f.window.innerHeight()+"px"}),e.on("modal.close",function(){document.body.removeChild(e.elem)}),e.on("modal.ready",function(){e.ready()}),e},k.createStatsModal=function(a,b){a.t="stats";var c=new o(a,b);c.append(document.body),c.on("modal.close",function(){document.body.removeChild(c.elem)}),c.on("modal.ready",function(){c.ready()}),d.addEvent(window,"resize",function(){c.elem.style.width=f.window.innerWidth()+"px",c.elem.style.height=f.window.innerHeight()+"px"})};var p=l.extend({name:"xcomm",attrs:{frameborder:"0",allowtransparency:"true"},style:{border:"none",position:"absolute",top:"-9999em",width:"10px",height:"10px"},secure:!0});k.createComm=function(a){var b=new p({},a);return b.append(document.body),b.on("xcomm.ready",function(){b.ready()}),b},b.exports=k},{"./a.js":1,"./browser.js":2,"./class.js":3,"./dom.js":5,"./json.js":7,"./urlparse.js":14,"./utils.js":15,conf:"AqyHQT"}],7:[function(a,b){var c=a("./browser.js");b.exports=function(a){function b(a){return 10>a?"0"+a:a}function c(a){return h.lastIndex=0,h.test(a)?'"'+a.replace(h,function(a){var b=i[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(a,e){var h,i,j,k,l,m=f,n=e[a];switch(n&&"[object Date]"===Object.prototype.toString.call(n)&&(n=isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null),typeof n){case"string":return c(n);case"number":return isFinite(n)?String(n):"null";case"boolean":case"null":return String(n);case"object":if(!n)return"null";if(f+=g,l=[],"[object Array]"===Object.prototype.toString.apply(n)){for(k=n.length,h=0;k>h;h+=1)l[h]=d(h,n)||"null";return j=0===l.length?"[]":f?"[\n"+f+l.join(",\n"+f)+"\n"+m+"]":"["+l.join(",")+"]",f=m,j}for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(j=d(i,n),j&&l.push(c(i)+(f?": ":":")+j));return j=0===l.length?"{}":f?"{\n"+f+l.join(",\n"+f)+"\n"+m+"}":"{"+l.join(",")+"}",f=m,j}}var e={};if(window.JSON&&JSON.parse&&JSON.stringify)return window.JSON;var f,g,h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return e.stringify=function(a,b){var c;if(f="",g="","number"==typeof b)for(c=0;b>c;c+=1)g+=" ";else"string"==typeof b&&(g=b);return d("",{"":a})},e.parse=function(){var b,c,d,e,f={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},g=function(c){a.console.error({name:"SyntaxError",message:c,at:b,text:d})},h=function(a){return a&&a!==c&&g("Expected '"+a+"' instead of '"+c+"'"),c=d.charAt(b),b+=1,c},i=function(){var a,b="";for("-"===c&&(b="-",h("-"));c>="0"&&"9">=c;)b+=c,h();if("."===c)for(b+=".";h()&&c>="0"&&"9">=c;)b+=c;if("e"===c||"E"===c)for(b+=c,h(),("-"===c||"+"===c)&&(b+=c,h());c>="0"&&"9">=c;)b+=c,h();return a=+b,isFinite(a)?a:void g("Bad number")},j=function(){var a,b,d,e="";if('"'===c)for(;h();){if('"'===c)return h(),e;if("\\"===c)if(h(),"u"===c){for(d=0,b=0;4>b&&(a=parseInt(h(),16),isFinite(a));b+=1)d=16*d+a;e+=String.fromCharCode(d)}else{if("string"!=typeof f[c])break;e+=f[c]}else e+=c}g("Bad string")},k=function(){for(;c&&" ">=c;)h()},l=function(){switch(c){case"t":return h("t"),h("r"),h("u"),h("e"),!0;case"f":return h("f"),h("a"),h("l"),h("s"),h("e"),!1;case"n":return h("n"),h("u"),h("l"),h("l"),null}g("Unexpected '"+c+"'")},m=function(){var a=[];if("["===c){if(h("["),k(),"]"===c)return h("]"),a;for(;c;){if(a.push(e()),k(),"]"===c)return h("]"),a;h(","),k()}}g("Bad array")},n=function(){var a,b={};if("{"===c){if(h("{"),k(),"}"===c)return h("}"),b;for(;c;){if(a=j(),k(),h(":"),Object.hasOwnProperty.call(b,a)&&g('Duplicate key "'+a+'"'),b[a]=e(),k(),"}"===c)return h("}"),b;h(","),k()}}g("Bad object")};return e=function(){switch(k(),c){case"{":return n();case"[":return m();case'"':return j();case"-":return i();default:return c>="0"&&"9">=c?i():l()}},function(a){var f;return d=a,b=0,c=" ",f=e(),k(),c&&g("Syntax error"),f}}(),e}(c)},{"./browser.js":2}],8:[function(a,b){var c=a("./browser.js"),d=a("./utils.js"),e=a("./dom.js"),f={_data:null};f.COOKIE_NAME="em_p_uid",f.format=function(a){return a&&d.isObject(a)?d.map(a,function(a,b){return b+":"+a}).sort().join("|"):null},f.parse=function(a){if(!a)return null;var b;return d.reduce(a.split("|"),function(a,c){return null===a?null:(b=c.split(":"),2!==b.length?null:(a[b[0]]=b[1],a))},{})},f.timestamp=function(a){var b;try{b=parseInt(a,10)}catch(c){return!1}return b},f.get=function(){var a=c.cookie.get(f.COOKIE_NAME);if(d.isNone(a))return f.set();var b=f.parse(a),e=f.timestamp(b.t);return e===!1?f.set():d.getTimestamp()-e>15552e6?f.set({u:b.u,l:b.l}):b},f.set=function(a){var b={u:d.getUUID(),t:d.getTimestamp(),l:0};a&&(b=d.extend(b,a));var e=f.format(b);return c.cookie.set(f.COOKIE_NAME,e,365,"https:"===window.location.protocol),e=c.cookie.get(f.COOKIE_NAME),d.isNone(e)?null:f.parse(e)},f.update=function(a){var b=f.get();return b?(b=d.extend(b,a),f.set(b)):!1},f.data=function(){if(f._data)return f._data;var a={mt:d.getTimestamp(),mr:document.referrer,msw:c.window.innerWidth(),msh:c.window.innerHeight()},b=f.get();return b?(a.muu=b.u,a.mut=b.t,a.mul=b.l):a.muu=0,f._data=a,f.update({l:d.getTimestamp()}),f._data},f.send=function(a,b){if(!b||!d.isElement(b.elem))return!1;var c=d.extend(f.data(),{}),g=e.rect(b.elem);g&&(c.mft=g.top,c.mfl=g.left,c.mfw=g.width,c.mfh=g.height),b.send(a,c)},b.exports=f},{"./browser.js":2,"./dom.js":5,"./utils.js":15}],9:[function(a,b){var c=a("./dom.js"),d=a("./utils"),e={_event:null,_observer:null};e.nodeNames=["iframe","a","blockquote"],e.html=function(){var a=document.getElementsByTagName("html");return 0===a.length?null:a[0]},e.recurse=function(a){var b=[];return d.isElement(a)&&b.push(a),d.reduce(a.childNodes,function(a,b){return d.isElement(b)?a.concat(e.recurse(b)):a},b)},e.observer=function(a){var b=e.html();if(null===b)return!1;if(!window.MutationObserver)return!1;e._observer=new window.MutationObserver(function(b){d.each(b,function(b){if("childList"===b.type&&b.addedNodes){var c=Array.prototype.slice.call(b.addedNodes);d.each(c,function(b){d.each(e.recurse(b),function(b){b.nodeName&&d.contains(e.nodeNames,b.nodeName.toLowerCase())&&a.notify("mutation.insert."+b.nodeName.toLowerCase(),b)})})}})});var c={childList:!0,subtree:!0};return e._observer.observe(b,c),!0},e.events=function(a){var b=e.html();return null===b?!1:(e._event=function(b){d.each(e.recurse(b.target),function(b){b.nodeName&&d.contains(e.nodeNames,b.nodeName.toLowerCase())&&a.notify("mutation.insert."+b.nodeName.toLowerCase(),b)})},c.addEvent(b,"DOMNodeInserted",e._event),!0)},e.stop=function(){var a=e.html();return null===a?!1:(e._event&&(c.detachEvent(a,"DOMNodeInserted",e._event),e._event=null),void(e._observer&&(e._observer.disconnect(),e._observer=null)))},e.connect=function(a){return e._event||e._observer?!1:void(e.observer(a)||e.events(a))},b.exports=e},{"./dom.js":5,"./utils":15}],10:[function(a,b){var c=a("./utils.js"),d=a("./urlparse.js"),e=a("./comms.js"),f=a("conf"),g={started:!1};g.connect=function(a,b){var h=d.getDomain(document.location.toString());if(!b&&f.PAGE_PROGRESS_DOMAINS&&!c.contains(f.PAGE_PROGRESS_DOMAINS,h))return!1;if(g.started)return!1;g.started=!0;var i=function(){a.notify("xcomm.page.progress")};e.started?i():(e.connect(a),a.one("xcomm.ready",i))},b.exports=g},{"./comms.js":4,"./urlparse.js":14,"./utils.js":15,conf:"AqyHQT"}],11:[function(a,b){var c=a("./utils.js"),d=a("./dom.js"),e=function(){this.init()};e.prototype.init=function(){var a=this;document.addEventListener?document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,!1),a.ready()},!1):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),a.ready())}),document.documentElement.doScroll&&window===window.top&&!function(){if(!a.isReady){try{document.documentElement.doScroll("left")}catch(b){return void setTimeout(arguments.callee,0)}a.ready()}}()),d.addEvent(window,"load",a.ready)},e.prototype.ready=function(){return this.isReady?!1:(this.isReady=!1,void(this.callback&&this.callback()))},e.prototype.bind=function(a){this.isReady&&a(),this.callback=a},e.prototype.elem=function(a,b,c){var e=!1,f=function(){e===!1&&(e=!0,b.call(c))};a.onload=f,d.addEvent(a,"load",f),a.onreadystatechange=function(){var b=a.readyState;("loaded"===b||"complete"===b)&&(a.onreadystatechange=null,f())}},e.prototype.firstNode=function(){var a=document.getElementsByTagName("head")[0],b=d.child(a,"link");if(b)return b;var c=d.child(a,"style");if(c)return c;var e=d.child(a,"script");return e?e:null},e.prototype.script=function(a,b,d,e){var f=this.firstNode(),g=document.createElement("script");g.type="text/javascript",g.src=a,c.isNone(e)||(g.async=1),this.elem(g,b,d),f.parentNode.insertBefore(g,f)},e.prototype.css=function(a,b,c){var d=this.firstNode(),e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href=a,this.elem(e,b,c),d.parentNode.insertBefore(e,d)},b.exports=new e},{"./dom.js":5,"./utils.js":15}],12:[function(a,b){var c=a("./urlparse.js"),d={data:{},results:{},enabled:!1};d.show=function(a){var b=d.data[a],c=d.results[a];d.hub.notify("recommend.show",b,c)},d.add=function(a){var b=c.getQuery(a.elem.src);d.data[b.url]=a,d.enabled&&(a.on("media.stats.recommend",function(c){d.results[c.url]=c.results,a.on("pause",function(){d.show(b.url)}),a.send("addEventListener",{context:"player.js",version:"0.0.8",method:"addEventListener",value:"pause",listener:a.elem.src})}),a.send("media.stats.recommend",{key:b.key,url:b.url}))},d.connect=function(a){a.on("recommend",function(){d.enabled=!0}),a.on("recommend.add",function(a){d.add(a)}),d.hub=a},b.exports=d},{"./urlparse.js":14}],13:[function(a,b){var c=a("./utils.js"),d=a("./urlparse.js"),e=a("conf"),f={};f.youtube={schema:"youtube",re:/youtube\.com\/embed\/([^\/?#]+)/i,url:function(a){var b=f.youtube.re.exec(a);return 2!==b.length?a:"http://www.youtube.com/watch?v="+b[1]}},f.vimeo={schema:"vimeo",re:/player\.vimeo\.com\/video\/([^\/?#]+)/i,url:function(a){var b=f.vimeo.re.exec(a);return 2!==b.length?a:"http://vimeo.com/"+b[1]}},f.soundcloud={schema:"soundcloud",re:/w\.soundcloud\.com\/player\/\?/,url:function(a){var b=d.getQuery(a);if(b.url){var c=/api\.soundcloud\.com\/tracks\/([^\/?#]+)/.exec(b.url);if(2===c.length)return"https://soundcloud.com/track/"+c[1]}return a}},f.providers=[f.youtube,f.vimeo,f.soundcloud],f.provider=function(a){return c.reduce(f.providers,function(b,c){return c.re.test(a)?c:b},null)},f.replace=function(a,b){if(c.isNone(a)||!c.isElement(a))return null;if("IFRAME"!==a.nodeName)return null;if(!a.src||!c.isString(a.src))return null;if(!b.key)return!1;var g=a.src;g=g.replace(/&amp;/g,"&");var h=f.provider(g);if(null===h)return null;var i="https:"===window.location.protocol?"https:":"http:";"file://"===g.substr(0,7)&&(g=g.substr(5)),"//"===g.substr(0,2)&&(g=i+g);var j=c.extend({},b,{url:h.url(g),src:g,schema:h.schema,type:"text/html"}),k=i+"//cdn.embedly.com/widgets/";e.EMB_DEBUG&&(k=e.EMB_FRAME_SRC);var l=k+"media.html?"+d.createQuery(j);return a.src=l,a},b.exports=f},{"./urlparse.js":14,"./utils.js":15,conf:"AqyHQT"}],14:[function(a,b){var c=a("./utils.js"),d={};d.createQuery=function(a){var b=[],d="";return a&&c.isObject(a)&&!c.isEmptyObject(a)?(c.each(a,function(a,c){b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}),b.sort(),b.join("&")):d},d.parseQuery=function(a){var b={};if(!a||!c.isString(a))return b;("#"===a.substr(0,1)||"?"===a.substr(0,1))&&(a=a.substr(1));var d=a.split("&");return c.each(d,function(a){if(!a)return!0;var c=a.split("="),d=decodeURIComponent(c[0]);b[d]=1===c.length?"":decodeURIComponent(2===c.length?c[1]:c.slice(1).join("="))}),b},d.getQuery=function(a){if(!a||!c.isString(a))return{};var b=a.split("?");return 2===b.length?d.parseQuery(b[1]):b.length>2?d.parseQuery(b.slice(1).join("?")):{}},d.appendQuery=function(a,b){if(!a||!c.isString(a))return null;var e=a.split("?"),f=e[0];if(!b||!c.isObject(b)||c.isEmptyObject(b))return a;var g=d.getQuery(a);return g=c.extend(g,b),c.isEmptyObject(g)?a:[f,d.createQuery(g)].join("?")},d.removeQuery=function(a,b){if(!a||!c.isString(a))return null;var e=a.split("?"),f=e[0],g=d.getQuery(a);return g.hasOwnProperty(b)&&delete g[b],c.isEmptyObject(g)?f:[f,d.createQuery(g)].join("?")},d.getOrigin=function(a){if(!a||!c.isString(a))return null;if(!/^https?:\/\//.test(a))return null;var b=a.split("/").slice(0,3).join("/");return-1===b.indexOf(".")?null:b},d.getDomain=function(a){var b=d.getOrigin(a);return b?b.replace(/^https?:\/\//,""):null},d.Parsed=function(a,b){this.init(a,b)},d.Parsed.prototype.init=function(a,b){this.original=a,this.url=b,this._valid=!1,this.url=b},d.Parsed.prototype.valid=function(a){return(a===!0||a===!1)&&(this._valid=a),this._valid},d.parse=function(a){var b=a,e="https:"===window.location.protocol?"https:":"http:";a=a?c.trim(a):a;var f=new d.Parsed(b,a);return a?/^https?:\/\/[^\/]+\.[^\/]/i.test(a)?(f.valid(!0),f):/^\w+:/i.test(a)?f:"#"===a[0]?f:/^\/\/[^\/]+\.[^\/]/i.test(a)?(f.valid(!0),f.url=e+a,f):/^\/([^\/]+|$)/i.test(a)?(f.valid(!0),f.url=d.getOrigin(window.location.toString())+a,f):/^[^\/]+\.[^\/]/i.test(a)?(f.valid(!0),f.url="http://"+a,f):f:f},d.addHash=function(a,b){return-1===a.indexOf("#")?a+"#"+b:a+"&"+b},b.exports=d},{"./utils.js":15}],15:[function(a,b){var c=a("conf"),d={},e={},f=Array.prototype,g=Object.prototype,h=Function.prototype,i=(f.push,f.slice),j=(f.concat,g.toString),k=f.forEach,l=(f.map,f.reduce),m=(f.reduceRight,f.filter,f.every),n=(f.some,f.indexOf),o=(f.lastIndexOf,Array.isArray,Object.keys,h.bind);d.identity=function(a){return a},d.each=function(a,b,c){if(null!=a)if(k&&a.forEach===k)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,f=a.length;f>d;d++)if(d in a&&b.call(c,a[d],d,a)===e)return}else for(var h in a)if(g.hasOwnProperty.call(a,h)&&b.call(c,a[h],h,a)===e)return},d.map=function(a,b,c){var e=[];return null==a?e:Array.prototype.map&&a.map===Array.prototype.map?a.map(b,c):(d.each(a,function(a,d,f){e[e.length]=b.call(c,a,d,f)}),e)},d.reduce=function(a,b,c,e){var f=arguments.length>2;if(null==a&&(a=[]),l&&a.reduce===l)return e&&(b=d.bind(b,e)),f?a.reduce(b,c):a.reduce(b);if(d.each(a,function(a,d,g){f?c=b.call(e,c,a,d,g):(c=a,f=!0)}),!f)throw new TypeError("Reduce of empty array with no initial value");return c},d.zip=function(a){return d.map(a[0],function(b,c){return b.map(a,function(a){return a[c]})})},d.extend=function(a){return d.each(Array.prototype.slice.call(arguments,1),function(b){for(var c in b)void 0!==b[c]&&(a[c]=b[c])}),a},d.contains=function(a,b){if(!n){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return!0;return!1}return a.indexOf(b)>-1},d.every=function(a,b,c){b||(b=d.identity);var f=!0;return null==a?f:m&&a.every===m?a.every(b,c):(d.each(a,function(a,d,g){return(f=f&&b.call(c,a,d,g))?void 0:e}),!!f)},d.indexOf=function(a,b){if(null==a)return-1;var c=0,d=a.length;if(n&&a.indexOf===n)return a.indexOf(b);for(;d>c;c++)if(a[c]===b)return c;return-1};var p=function(){};d.bind=function(a,b){var c,e;if(o&&a.bind===o)return o.apply(a,i.call(arguments,1));if(!d.isFunction(a))throw new TypeError;return c=i.call(arguments,2),e=function(){if(!(this instanceof e))return a.apply(b,c.concat(i.call(arguments)));p.prototype=a.prototype;var d=new p;p.prototype=null;var f=a.apply(d,c.concat(i.call(arguments)));return Object(f)===f?f:d}},d.get=function(a,b,c){if(c=d.isNone(c)?null:c,d.isNone(b)||!d.isString(b)||!a)return c;if(""===b)return a;var e=b.split("."),f=e.splice(0,1)[0];return a.hasOwnProperty(f)?d.get(a[f],e.join("."),c):c},d.isFunction=function(a){try{return/^\s*\bfunction\b/.test(a)}catch(b){return!1}},d.isNone=function(a){return null===a||void 0===a},d.isString=function(a){return"[object String]"===j.call(a)},d.isNumber=function(a){return"[object Number]"===j.call(a)},d.isDate=function(a){return"[object Date]"===j.call(a)},d.isObject=function(a){return"[object Object]"===j.call(a)},d.isArray=function(a){return"[object Array]"===j.call(a)},d.isElement=function(a){return!d.isNone(a)&&!d.isNone(a.nodeType)&&1===a.nodeType},d.isEmptyObject=function(a){if(d.isObject(a)){for(var b in a)if(g.hasOwnProperty.call(a,b))return!1;return!0}return!1},d.bool=function(a){return d.isNone(a)?null:"true"===a||"1"===a||1===a||a===!0?!0:"false"===a||"0"===a||0===a||a===!1?!1:null},d.assert=function(a,b){if(!a)throw b||"Assertion Failed"},d.getUUID=function(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})},d.getTimestamp=function(){var a=new Date;return a.getTime()},d.trim=function(a){return a.replace(/^\s+|\s+$/g,"")},d.capitalize=function(a){return a.charAt(0).toUpperCase()+a.substr(1)},d.camelCase=function(a){var b=a.split("-");return b.length>1&&(a=b[0],a+=d.map(b.slice(1),function(a){return a[0].toUpperCase()+a.substr(1)}).join("")),a},d.truncate=function(a,b){return a?(b=b?b:50,a.length<b?a:(a=a.substr(0,b-3),d.trim(a)+"...")):""},d.hash=function(a){for(var b=0,c=0,d=a.length;d>c;c++)b=31*b+a.charCodeAt(c)<<0;return(Math.pow(2,31)+b).toString()},d.rgbToHex=function(a,b,c){return"#"+((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)},c.EMB_DEBUG===!0&&(window._=d),b.exports=d},{conf:"AqyHQT"}],16:[function(a,b){var c=a("./utils.js"),d=a("./dom.js"),e=a("./browser.js"),f=function(){this.init()};f.prototype.init=function(){this._elements=[],this._listening=!1},f.prototype.viewable=function(a){if(!a.getBoundingClientRect)return!0;var b;try{b=a.getBoundingClientRect()}catch(c){return!1}return b.bottom>=0&&b.right>=0&&b.top<=(window.innerHeight||document.documentElement.clientHeight)&&b.left<=(window.innerWidth||document.documentElement.clientWidth)},f.prototype.check=function(){this.freeze=!0;var a=[];c.each(this._elements,c.bind(function(b,c){if(this.viewable(b.elem)){try{b.func.call(this)}catch(d){e.console.log(d)}a.push(c)}},this)),c.each(a,function(a){this._elements.splice(a,1)},this),0===this._elements.length&&this.stop(),this.freeze=!1},f.prototype.stop=function(){try{d.detachEvent(window,"DOMContentLoaded",this.handler),d.detachEvent(window,"load",this.handler),d.detachEvent(window,"resize",this.handler),d.detachEvent(window,"scroll",this.handler)}catch(a){}this.handler=null,this._listening=!1},f.prototype.listen=function(){return this._listening?!1:(this._listening=!0,this.handler=c.bind(function(){!this.freeze&&this._elements.length&&this.check()},this),d.addEvent(window,"DOMContentLoaded",this.handler),d.addEvent(window,"load",this.handler),d.addEvent(window,"resize",this.handler),void d.addEvent(window,"scroll",this.handler))},f.prototype.on=function(a,b,c){"viewable"===a&&(this._elements.push({elem:b,func:c}),this.listen(),this.check())},b.exports=f},{"./browser.js":2,"./dom.js":5,"./utils.js":15}],conf:[function(a,b){b.exports=a("AqyHQT")},{}],AqyHQT:[function(a,b){!function(a){a.EMB_DEBUG=!1,a.EMB_HTTPS="https:"===window.location.protocol?!0:!1,a.EMB_ORIGIN=(a.EMB_HTTPS?"https":"http")+"://cdn.embedly.com",a.EMB_FRAME_SRC=a.EMB_ORIGIN+"/widgets/",a.EMB_SECURE_FRAME_SRC="https://cdn.embedly.com/widgets/",a.EMB_POST_MESSAGE=!!window.postMessage,a.EMB_PROGRESS=!0,a.EMB_APP_API="https://app.embed.ly",a.EMB_API_KEY="fd92ebbc52fc43fb98f69e50e7893c13";var b=window.location.pathname.split(".")[0].split("/");a.EMB_GROUP=b[b.length-1].toLowerCase(),a.PAGE_PROGRESS_DOMAINS=[]}("undefined"==typeof b?this.conf={}:b.exports)},{}],19:[function(a){if(window.embedly&&window.embedly.look)return window.embedly.look(),!1;var b=a("./common/iframe.js"),c=a("./common/browser.js"),d=a("./common/utils.js"),e=a("./common/a.js"),f=a("./common/dom.js"),g=a("./common/ready.js"),h=a("./common/mutations.js"),i=a("./common/swap.js"),j=a("./common/meta.js"),k=a("./common/json.js"),l=a("./common/viewport.js"),m=a("./common/page.js"),n=a("./common/recommend.js"),o=new e,p=new l;n.connect(o);var q=function(){var a=/emb_(\d+)/.exec(c.location.hash());return a?a[1]:null},r={cardSelectors:[{selector:".embedly-card"}],buttonSelectors:[".embedly-button"],analytics:null,recommend:!1,shared:q()},s=function(a){var b;try{b=k.parse(a.data)}catch(d){return c.console.error(d),!1}o.notify("window.message",a,b)};f.addEvent(window,"message",s);var t=function(a,c,e){var f;if(d.isFunction(c)&&(e=c,c={}),d.isString(a))return".embedly-card"===a?!1:(r.cardSelectors.push({selector:a}),B(),!0);if(!d.isElement(a)&&d.isObject(a)){if(!a.selector&&!a.types)return!1;var g={};if(d.isArray(a.types)&&a.types.length>0&&(g.types=a.types),a.selector)g.selector=a.selector,r.cardSelectors.push(g);else{var h=r.cardSelectors.reduce(function(a,b){return".embedly-card"===b.selector?b:a},{});if(!h)return!1;h.types=g.types}}return!d.isElement(a)||"a"!==a.nodeName.toLowerCase()&&"blockquote"!==a.nodeName.toLowerCase()||(f=b.createCard(a,c,o)),f&&(f.one("card.rendered",function(){o.notify("card.rendered",f.elem,f),p.on("viewable",f.elem,function(){f.send("card.view")})}),f.on("resize",function(){o.notify("card.resize",f.elem,f)})),d.isFunction(e)&&e.call(f,f),o.notify("card.created",f),f},u=function(a){var c;return d.isString(a)?(r.buttonSelectors.push(a),B(),!0):(d.isElement(a)&&"a"===a.nodeName.toLowerCase()&&(c=b.createButton(a,o)),o.notify("button.created",c),c)},v=function(a,c){var e;e=d.isString(a)?{url:a}:a;var f=b.createCardModal(e,o);return d.isFunction(c)&&c.call(f,f),f},w=function(a){if("1"===f.data(a,"connected"))return!1;f.data(a,"connected","1");var c=b.connect({elem:a},o);c.one("media.ready",function(){c.ready(),p.on("viewable",c.elem,function(){c.send("media.view")}),o.notify("recommend.add",c),o.notify("media.ready",c)}),c.send("media.ready")},x=function(a){return a&&a.key?(r.analytics=a,void B()):!1},y=function(){o.notify("recommend"),B()},z=function(a,b){return"."===a.substr(0,1)?f.hasClass(b,a.substr(1))?!0:!1:d.contains(f.all(a),b)?!0:!1},A=function(a){if(("A"===a.nodeName||"BLOCKQUOTE"===a.nodeName)&&d.each(r.cardSelectors,function(b){z(b.selector,a)&&t(a,b)}),"A"===a.nodeName&&d.each(r.buttonSelectors,function(b){z(b,a)&&u(a)}),"IFRAME"===a.nodeName)if("embedly-embed"===a.className)w(a);else if(a.src&&/\/\/cdn\.embedly\.com\/widgets\/media\.html/.test(a.src))w(a);else if(null!==r.analytics&&r.analytics.replace){var b=i.replace(a,r.analytics);null!==b&&w(b)}},B=function(){d.each(r.cardSelectors,function(a){d.each(f.all(a.selector),function(a){A(a)})}),d.each(r.buttonSelectors,function(a){d.each(f.all(a),function(a){A(a)})}),d.each(f.all("iframe"),function(a){A(a)}),o.notify("look.done")};o.on("mutation.insert.a",A),o.on("mutation.insert.blockquote",A),o.on("mutation.insert.iframe",A),o.on("media.ready",function(a){j.send("media.meta",a)}),o.on("card.rendered",function(a,b){j.send("card.meta",b)}),o.on("card.rendered",function(a,b){if(!r.shared)return!1;if(!b.query||!b.query.url)return!1;var e=d.hash(b.query.url);return e!==r.shared?!1:(r.shared=null,void setTimeout(function(){var a=f.rect(b.elem);return a&&a.top?void c.animateScroll(a.top-5,500):!1},500))});var C=function(a,b){o.on(a,b)},D=function(a,b){o.off(a,b)},E=function(){f.detachEvent(window,"message",s),h.stop(),o.data={},window.embedly=null},F=function(){var a=Array.prototype.slice.call(arguments,0);if(0===a.length)return null;var b=a.splice(0,1)[0];switch(b){case"card":return t.apply(window,a);case"button":return u.apply(window,a);case"modal":return v.apply(window,a);case"look":return B.apply(window,a);case"on":return C.apply(window,a);case"off":return D.apply(window,a);case"kill":return E.apply(window,a);case"analytics":return x.apply(window,a);case"recommend":return y.apply(window,a)}return null},G=[];window.embedly&&d.isFunction(window.embedly)&&d.isArray(window.embedly.q)&&(G=window.embedly.q),window.embedly=function(){return F.apply(window,arguments)},window.embedly.card=function(a){return t(a)},window.embedly.button=function(a){return u(a)},window.embedly.modal=function(a){return v(a)},window.embedly.look=function(a){return B(a)},d.each(G,function(a){window.embedly.apply(window,a)}),h.connect(o),m.connect(o),g.bind(B),B(),d.isFunction(window.onEmbedlyReady)&&window.onEmbedlyReady.apply(this,[window.embedly])},{"./common/a.js":1,"./common/browser.js":2,"./common/dom.js":5,"./common/iframe.js":6,"./common/json.js":7,"./common/meta.js":8,"./common/mutations.js":9,"./common/page.js":10,"./common/ready.js":11,"./common/recommend.js":12,"./common/swap.js":13,"./common/utils.js":15,"./common/viewport.js":16}]},{},[19])}();var Hogan={};!function(a,b){function c(a){return String(null===a||void 0===a?"":a)}function d(a){return a=c(a),j.test(a)?a.replace(e,"&amp;").replace(f,"&lt;").replace(g,"&gt;").replace(h,"&#39;").replace(i,"&quot;"):a}a.Template=function(a,c,d,e){this.r=a||this.r,this.c=d,this.options=e,this.text=c||"",this.buf=b?[]:""},a.Template.prototype={r:function(a,b,c){return""},v:d,t:c,render:function(a,b,c){return this.ri([a],b||{},c)},ri:function(a,b,c){return this.r(a,b,c)},rp:function(a,b,c,d){var e=c[a];return e?(this.c&&"string"==typeof e&&(e=this.c.compile(e,this.options)),e.ri(b,c,d)):""},rs:function(a,b,c){var d=a[a.length-1];if(!k(d))return void c(a,b,this);for(var e=0;e<d.length;e++)a.push(d[e]),c(a,b,this),a.pop()},s:function(a,b,c,d,e,f,g){var h;return k(a)&&0===a.length?!1:("function"==typeof a&&(a=this.ls(a,b,c,d,e,f,g)),h=""===a||!!a,!d&&h&&b&&b.push("object"==typeof a?a:b[b.length-1]),
h)},d:function(a,b,c,d){var e=a.split("."),f=this.f(e[0],b,c,d),g=null;if("."===a&&k(b[b.length-2]))return b[b.length-1];for(var h=1;h<e.length;h++)f&&"object"==typeof f&&e[h]in f?(g=f,f=f[e[h]]):f="";return d&&!f?!1:(d||"function"!=typeof f||(b.push(g),f=this.lv(f,b,c),b.pop()),f)},f:function(a,b,c,d){for(var e=!1,f=null,g=!1,h=b.length-1;h>=0;h--)if(f=b[h],f&&"object"==typeof f&&a in f){e=f[a],g=!0;break}return g?(d||"function"!=typeof e||(e=this.lv(e,b,c)),e):d?!1:""},ho:function(a,b,c,d,e){var f=this.c,g=this.options;g.delimiters=e;var d=a.call(b,d);return d=null==d?String(d):d.toString(),this.b(f.compile(d,g).render(b,c)),!1},b:b?function(a){this.buf.push(a)}:function(a){this.buf+=a},fl:b?function(){var a=this.buf.join("");return this.buf=[],a}:function(){var a=this.buf;return this.buf="",a},ls:function(a,b,c,d,e,f,g){var h=b[b.length-1],i=null;if(!d&&this.c&&a.length>0)return this.ho(a,h,c,this.text.substring(e,f),g);if(i=a.call(h),"function"==typeof i){if(d)return!0;if(this.c)return this.ho(i,h,c,this.text.substring(e,f),g)}return i},lv:function(a,b,d){var e=b[b.length-1],f=a.call(e);return"function"==typeof f&&(f=c(f.call(e)),this.c&&~f.indexOf("{{"))?this.c.compile(f,this.options).render(e,d):c(f)}};var e=/&/g,f=/</g,g=/>/g,h=/\'/g,i=/\"/g,j=/[&<>\"\']/,k=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}}("undefined"!=typeof exports?exports:Hogan),function(a){function b(a){"}"===a.n.substr(a.n.length-1)&&(a.n=a.n.substring(0,a.n.length-1))}function c(a){return a.trim?a.trim():a.replace(/^\s*|\s*$/g,"")}function d(a,b,c){if(b.charAt(c)!=a.charAt(0))return!1;for(var d=1,e=a.length;e>d;d++)if(b.charAt(c+d)!=a.charAt(d))return!1;return!0}function e(a,b,c,d){for(var h=[],i=null,j=null;a.length>0;)if(j=a.shift(),"#"==j.tag||"^"==j.tag||f(j,d))c.push(j),j.nodes=e(a,j.tag,c,d),h.push(j);else{if("/"==j.tag){if(0===c.length)throw new Error("Closing tag without opener: /"+j.n);if(i=c.pop(),j.n!=i.n&&!g(j.n,i.n,d))throw new Error("Nesting error: "+i.n+" vs. "+j.n);return i.end=j.i,h}h.push(j)}if(c.length>0)throw new Error("missing closing tag: "+c.pop().n);return h}function f(a,b){for(var c=0,d=b.length;d>c;c++)if(b[c].o==a.n)return a.tag="#",!0}function g(a,b,c){for(var d=0,e=c.length;e>d;d++)if(c[d].c==a&&c[d].o==b)return!0}function h(a){return a.replace(u,"\\\\").replace(r,'\\"').replace(s,"\\n").replace(t,"\\r")}function i(a){return~a.indexOf(".")?"d":"f"}function j(a){for(var b="",c=0,d=a.length;d>c;c++){var e=a[c].tag;"#"==e?b+=k(a[c].nodes,a[c].n,i(a[c].n),a[c].i,a[c].end,a[c].otag+" "+a[c].ctag):"^"==e?b+=l(a[c].nodes,a[c].n,i(a[c].n)):"<"==e||">"==e?b+=m(a[c]):"{"==e||"&"==e?b+=n(a[c].n,i(a[c].n)):"\n"==e?b+=p('"\\n"'+(a.length-1==c?"":" + i")):"_v"==e?b+=o(a[c].n,i(a[c].n)):void 0===e&&(b+=p('"'+h(a[c])+'"'))}return b}function k(a,b,c,d,e,f){return"if(_.s(_."+c+'("'+h(b)+'",c,p,1),c,p,0,'+d+","+e+',"'+f+'")){_.rs(c,p,function(c,p,_){'+j(a)+"});c.pop();}"}function l(a,b,c){return"if(!_.s(_."+c+'("'+h(b)+'",c,p,1),c,p,1,0,0,"")){'+j(a)+"};"}function m(a){return'_.b(_.rp("'+h(a.n)+'",c,p,"'+(a.indent||"")+'"));'}function n(a,b){return"_.b(_.t(_."+b+'("'+h(a)+'",c,p,0)));'}function o(a,b){return"_.b(_.v(_."+b+'("'+h(a)+'",c,p,0)));'}function p(a){return"_.b("+a+");"}var q=/\S/,r=/\"/g,s=/\n/g,t=/\r/g,u=/\\/g,v={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};a.scan=function(a,e){function f(){r.length>0&&(s.push(new String(r)),r="")}function g(){for(var a=!0,b=w;b<s.length;b++)if(a=s[b].tag&&v[s[b].tag]<v._v||!s[b].tag&&null===s[b].match(q),!a)return!1;return a}function h(a,b){if(f(),a&&g())for(var c,d=w;d<s.length;d++)s[d].tag||((c=s[d+1])&&">"==c.tag&&(c.indent=s[d].toString()),s.splice(d,1));else b||s.push({tag:"\n"});t=!1,w=s.length}function i(a,b){var d="="+y,e=a.indexOf(d,b),f=c(a.substring(a.indexOf("=",b)+1,e)).split(" ");return x=f[0],y=f[1],e+d.length-1}var j=a.length,k=0,l=1,m=2,n=k,o=null,p=null,r="",s=[],t=!1,u=0,w=0,x="{{",y="}}";for(e&&(e=e.split(" "),x=e[0],y=e[1]),u=0;j>u;u++)n==k?d(x,a,u)?(--u,f(),n=l):"\n"==a.charAt(u)?h(t):r+=a.charAt(u):n==l?(u+=x.length-1,p=v[a.charAt(u+1)],o=p?a.charAt(u+1):"_v","="==o?(u=i(a,u),n=k):(p&&u++,n=m),t=u):d(y,a,u)?(s.push({tag:o,n:c(r),otag:x,ctag:y,i:"/"==o?t-y.length:u+x.length}),r="",u+=y.length-1,n=k,"{"==o&&("}}"==y?u++:b(s[s.length-1]))):r+=a.charAt(u);return h(t,!0),s},a.generate=function(b,c,d){var e='var _=this;_.b(i=i||"");'+j(b)+"return _.fl();";return d.asString?"function(c,p,i){"+e+";}":new a.Template(new Function("c","p","i",e),c,a,d)},a.parse=function(a,b,c){return c=c||{},e(a,"",[],c.sectionTags||[])},a.cache={},a.compile=function(a,b){b=b||{};var c=a+"||"+!!b.asString,d=this.cache[c];return d?d:(d=this.generate(this.parse(this.scan(a,b.delimiters),a,b),a,b),this.cache[c]=d)}}("undefined"!=typeof exports?exports:Hogan),!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.famous=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(){var a=this.container;return[a.clientWidth,a.clientHeight]}function d(a){this.container=a,this._allocator=new g(a),this._node=new e,this._eventOutput=new f,this._size=c.call(this),this._perspectiveState=new i(0),this._perspective=void 0,this._nodeContext={allocator:this._allocator,transform:h.identity,opacity:1,origin:j,align:j,size:this._size},this._eventOutput.on("resize",function(){this.setSize(c.call(this))}.bind(this))}var e=a("./RenderNode"),f=a("./EventHandler"),g=a("./ElementAllocator"),h=a("./Transform"),i=a("../transitions/Transitionable"),j=[0,0],k=!("perspective"in document.documentElement.style),l=k?function(a,b){a.style.webkitPerspective=b?b.toFixed()+"px":""}:function(a,b){a.style.perspective=b?b.toFixed()+"px":""};d.prototype.getAllocator=function(){return this._allocator},d.prototype.add=function(a){return this._node.add(a)},d.prototype.migrate=function(a){a!==this.container&&(this.container=a,this._allocator.migrate(a))},d.prototype.getSize=function(){return this._size},d.prototype.setSize=function(a){a||(a=c.call(this)),this._size[0]=a[0],this._size[1]=a[1]},d.prototype.update=function(a){a&&(a.transform&&(this._nodeContext.transform=a.transform),a.opacity&&(this._nodeContext.opacity=a.opacity),a.origin&&(this._nodeContext.origin=a.origin),a.align&&(this._nodeContext.align=a.align),a.size&&(this._nodeContext.size=a.size));var b=this._perspectiveState.get();b!==this._perspective&&(l(this.container,b),this._perspective=b),this._node.commit(this._nodeContext)},d.prototype.getPerspective=function(){return this._perspectiveState.get()},d.prototype.setPerspective=function(a,b,c){return this._perspectiveState.set(a,b,c)},d.prototype.emit=function(a,b){return this._eventOutput.emit(a,b)},d.prototype.on=function(a,b){return this._eventOutput.on(a,b)},d.prototype.removeListener=function(a,b){return this._eventOutput.removeListener(a,b)},d.prototype.pipe=function(a){return this._eventOutput.pipe(a)},d.prototype.unpipe=function(a){return this._eventOutput.unpipe(a)},b.exports=d},{"../transitions/Transitionable":88,"./ElementAllocator":2,"./EventHandler":7,"./RenderNode":11,"./Transform":15}],2:[function(a,b){function c(a){a||(a=document.createDocumentFragment()),this.container=a,this.detachedNodes={},this.nodeCount=0}c.prototype.migrate=function(a){var b=this.container;if(a!==b){if(b instanceof DocumentFragment)a.appendChild(b);else for(;b.hasChildNodes();)a.appendChild(b.firstChild);this.container=a}},c.prototype.allocate=function(a){a=a.toLowerCase(),a in this.detachedNodes||(this.detachedNodes[a]=[]);var b,c=this.detachedNodes[a];return c.length>0?b=c.pop():(b=document.createElement(a),this.container.appendChild(b)),this.nodeCount++,b},c.prototype.deallocate=function(a){var b=a.nodeName.toLowerCase(),c=this.detachedNodes[b];c.push(a),this.nodeCount--},c.prototype.getNodeCount=function(){return this.nodeCount},b.exports=c},{}],3:[function(a,b){function c(a){this._matrix=null,this._opacity=1,this._origin=null,this._size=null,this._eventOutput=new j,this._eventOutput.bindThis(this),this.eventForwarder=function(a){this._eventOutput.emit(a.type,a)}.bind(this),this.id=i.register(this),this._element=null,this._sizeDirty=!1,this._originDirty=!1,this._transformDirty=!1,this._invisible=!1,a&&this.attach(a)}function d(a){for(var b in this._eventOutput.listeners)a.addEventListener(b,this.eventForwarder)}function e(a){for(var b in this._eventOutput.listeners)a.removeEventListener(b,this.eventForwarder)}function f(a){a[12]=Math.round(a[12]*m)/m,a[13]=Math.round(a[13]*m)/m;for(var b="matrix3d(",c=0;15>c;c++)b+=a[c]<1e-6&&a[c]>-1e-6?"0,":a[c]+",";return b+=a[15]+")"}function g(a){return 100*a[0]+"% "+100*a[1]+"%"}function h(a,b){return a&&b?a[0]!==b[0]||a[1]!==b[1]:a!==b}var i=a("./Entity"),j=a("./EventHandler"),k=a("./Transform"),l=!("transform"in document.documentElement.style),m=window.devicePixelRatio||1;c.prototype.on=function(a,b){this._element&&this._element.addEventListener(a,this.eventForwarder),this._eventOutput.on(a,b)},c.prototype.removeListener=function(a,b){this._eventOutput.removeListener(a,b)},c.prototype.emit=function(a,b){b&&!b.origin&&(b.origin=this);var c=this._eventOutput.emit(a,b);return c&&b&&b.stopPropagation&&b.stopPropagation(),c},c.prototype.pipe=function(a){return this._eventOutput.pipe(a)},c.prototype.unpipe=function(a){return this._eventOutput.unpipe(a)},c.prototype.render=function(){return this.id};var n;n=l?function(a,b){a.style.webkitTransform=f(b)}:function(a,b){a.style.transform=f(b)};var o=l?function(a,b){a.style.webkitTransformOrigin=g(b)}:function(a,b){a.style.transformOrigin=g(b)},p=l?function(a){a.style.webkitTransform="scale3d(0.0001,0.0001,0.0001)",a.style.opacity=0}:function(a){a.style.transform="scale3d(0.0001,0.0001,0.0001)",a.style.opacity=0};c.prototype.commit=function(a){var b=this._element;if(b){var c=a.transform,d=a.opacity,e=a.origin;if(a.size,!c&&this._matrix)return this._matrix=null,this._opacity=0,void p(b);if(h(this._origin,e)&&(this._originDirty=!0),k.notEquals(this._matrix,c)&&(this._transformDirty=!0),this._invisible&&(this._invisible=!1,this._element.style.display=""),this._opacity!==d&&(this._opacity=d,b.style.opacity=d>=1?"0.999999":d),this._transformDirty||this._originDirty||this._sizeDirty){this._sizeDirty&&(this._sizeDirty=!1),this._originDirty&&(e?(this._origin||(this._origin=[0,0]),this._origin[0]=e[0],this._origin[1]=e[1]):this._origin=null,o(b,this._origin),this._originDirty=!1),c||(c=k.identity),this._matrix=c;var f=this._size?k.thenMove(c,[-this._size[0]*e[0],-this._size[1]*e[1],0]):c;n(b,f),this._transformDirty=!1}}},c.prototype.cleanup=function(){this._element&&(this._invisible=!0,this._element.style.display="none")},c.prototype.attach=function(a){this._element=a,d.call(this,a)},c.prototype.detach=function(){var a=this._element;return a&&(e.call(this,a),this._invisible&&(this._invisible=!1,this._element.style.display="")),this._element=null,a},b.exports=c},{"./Entity":5,"./EventHandler":7,"./Transform":15}],4:[function(a,b){function c(){x.runLoop?(n.step(),window.requestAnimationFrame(c)):u=!1}function d(){for(var a=0;a<o.length;a++)o[a].emit("resize");w.emit("resize")}function e(){window.addEventListener("touchmove",function(a){a.preventDefault()},!0),f()}function f(){return document.body?(document.body.classList.add("famous-root"),void document.documentElement.classList.add("famous-root")):void n.nextTick(f)}function g(a,b){return document.body?void document.body.addEventListener(a,b):void n.nextTick(addEventListener.bind(this,a,b))}function h(a,b){return document.body?(document.body.appendChild(b),void a.emit("resize")):void n.nextTick(h.bind(this,a,b))}var i,j,k=a("./Context"),l=a("./EventHandler"),m=a("./OptionsManager"),n={},o=[],p=[],q=0,r=0,s=[],t=Date.now(),u=!0,v={},w=new l,x={containerType:"div",containerClass:"famous-container",fpsCap:void 0,runLoop:!0,appMode:!0},y=new m(x),z=10;n.step=function(){q++,r=q;var a=Date.now();if(!(j&&j>a-t)){var b=0;i=a-t,t=a,w.emit("prerender");for(var c=p.length;c--;)p.shift()(q);for(;s.length&&Date.now()-a<z;)s.shift().call(this);for(b=0;b<o.length;b++)o[b].update();w.emit("postrender")}},window.requestAnimationFrame(c),window.addEventListener("resize",d,!1),d();var A=!1;n.pipe=function(a){return a.subscribe instanceof Function?a.subscribe(n):w.pipe(a)},n.unpipe=function(a){return a.unsubscribe instanceof Function?a.unsubscribe(n):w.unpipe(a)},n.on=function(a,b){return a in v||(v[a]=w.emit.bind(w,a),g(a,v[a])),w.on(a,b)},n.emit=function(a,b){return w.emit(a,b)},n.removeListener=function(a,b){return w.removeListener(a,b)},n.getFPS=function(){return 1e3/i},n.setFPSCap=function(a){j=Math.floor(1e3/a)},n.getOptions=function(a){return y.getOptions(a)},n.setOptions=function(){return y.setOptions.apply(y,arguments)},n.createContext=function(a){!A&&x.appMode&&n.nextTick(e);var b=!1;a||(a=document.createElement(x.containerType),a.classList.add(x.containerClass),b=!0);var c=new k(a);return n.registerContext(c),b&&h(c,a),c},n.registerContext=function(a){return o.push(a),a},n.getContexts=function(){return o},n.deregisterContext=function(a){var b=o.indexOf(a);b>=0&&o.splice(b,1)},n.nextTick=function(a){p.push(a)},n.defer=function(a){s.push(a)},y.on("change",function(a){"fpsCap"===a.id?n.setFPSCap(a.value):"runLoop"===a.id&&!u&&a.value&&(u=!0,window.requestAnimationFrame(c))}),b.exports=n},{"./Context":1,"./EventHandler":7,"./OptionsManager":10}],5:[function(a,b){function c(a){return g[a]}function d(a,b){g[a]=b}function e(a){var b=g.length;return d(b,a),b}function f(a){d(a,null)}var g=[];b.exports={register:e,unregister:f,get:c,set:d}},{}],6:[function(a,b){function c(){this.listeners={},this._owner=this}c.prototype.emit=function(a,b){var c=this.listeners[a];if(c)for(var d=0;d<c.length;d++)c[d].call(this._owner,b);return this},c.prototype.on=function(a,b){a in this.listeners||(this.listeners[a]=[]);var c=this.listeners[a].indexOf(b);return 0>c&&this.listeners[a].push(b),this},c.prototype.addListener=c.prototype.on,c.prototype.removeListener=function(a,b){var c=this.listeners[a];if(void 0!==c){var d=c.indexOf(b);d>=0&&c.splice(d,1)}return this},c.prototype.bindThis=function(a){this._owner=a},b.exports=c},{}],7:[function(a,b){function c(){d.apply(this,arguments),this.downstream=[],this.downstreamFn=[],this.upstream=[],this.upstreamListeners={}}var d=a("./EventEmitter");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.setInputHandler=function(a,b){a.trigger=b.trigger.bind(b),b.subscribe&&b.unsubscribe&&(a.subscribe=b.subscribe.bind(b),a.unsubscribe=b.unsubscribe.bind(b))},c.setOutputHandler=function(a,b){b instanceof c&&b.bindThis(a),a.pipe=b.pipe.bind(b),a.unpipe=b.unpipe.bind(b),a.on=b.on.bind(b),a.addListener=a.on,a.removeListener=b.removeListener.bind(b)},c.prototype.emit=function(a,b){d.prototype.emit.apply(this,arguments);var c=0;for(c=0;c<this.downstream.length;c++)this.downstream[c].trigger&&this.downstream[c].trigger(a,b);for(c=0;c<this.downstreamFn.length;c++)this.downstreamFn[c](a,b);return this},c.prototype.trigger=c.prototype.emit,c.prototype.pipe=function(a){if(a.subscribe instanceof Function)return a.subscribe(this);var b=a instanceof Function?this.downstreamFn:this.downstream,c=b.indexOf(a);return 0>c&&b.push(a),a instanceof Function?a("pipe",null):a.trigger&&a.trigger("pipe",null),a},c.prototype.unpipe=function(a){if(a.unsubscribe instanceof Function)return a.unsubscribe(this);var b=a instanceof Function?this.downstreamFn:this.downstream,c=b.indexOf(a);return c>=0?(b.splice(c,1),a instanceof Function?a("unpipe",null):a.trigger&&a.trigger("unpipe",null),a):!1},c.prototype.on=function(a){if(d.prototype.on.apply(this,arguments),!(a in this.upstreamListeners)){var b=this.trigger.bind(this,a);this.upstreamListeners[a]=b;for(var c=0;c<this.upstream.length;c++)this.upstream[c].on(a,b)}return this},c.prototype.addListener=c.prototype.on,c.prototype.subscribe=function(a){var b=this.upstream.indexOf(a);if(0>b){this.upstream.push(a);for(var c in this.upstreamListeners)a.on(c,this.upstreamListeners[c])}return this},c.prototype.unsubscribe=function(a){var b=this.upstream.indexOf(a);if(b>=0){this.upstream.splice(b,1);for(var c in this.upstreamListeners)a.removeListener(c,this.upstreamListeners[c])}return this},b.exports=c},{"./EventEmitter":6}],8:[function(a,b){function c(a){f.call(this,a),this._shouldRecalculateSize=!1,this._container=document.createDocumentFragment(),this.context=new d(this._container),this.setContent(this._container),this._groupSize=[void 0,void 0]}var d=a("./Context"),e=a("./Transform"),f=a("./Surface");c.SIZE_ZERO=[0,0],c.prototype=Object.create(f.prototype),c.prototype.elementType="div",c.prototype.elementClass="famous-group",c.prototype.add=function(){return this.context.add.apply(this.context,arguments)},c.prototype.render=function(){return f.prototype.render.call(this)},c.prototype.deploy=function(a){this.context.migrate(a)},c.prototype.recall=function(){this._container=document.createDocumentFragment(),this.context.migrate(this._container)},c.prototype.commit=function(a){var b=a.transform,d=a.origin,g=a.opacity,h=a.size,i=f.prototype.commit.call(this,{allocator:a.allocator,transform:e.thenMove(b,[-d[0]*h[0],-d[1]*h[1],0]),opacity:g,origin:d,size:c.SIZE_ZERO});return(h[0]!==this._groupSize[0]||h[1]!==this._groupSize[1])&&(this._groupSize[0]=h[0],this._groupSize[1]=h[1],this.context.setSize(h)),this.context.update({transform:e.translate(-d[0]*h[0],-d[1]*h[1],0),origin:d,size:h}),i},b.exports=c},{"./Context":1,"./Surface":14,"./Transform":15}],9:[function(a,b){function c(a){this._transformGetter=null,this._opacityGetter=null,this._originGetter=null,this._alignGetter=null,this._sizeGetter=null,this._proportionGetter=null,this._legacyStates={},this._output={transform:e.identity,opacity:1,origin:null,align:null,size:null,proportions:null,target:null},a&&(a.transform&&this.transformFrom(a.transform),void 0!==a.opacity&&this.opacityFrom(a.opacity),a.origin&&this.originFrom(a.origin),a.align&&this.alignFrom(a.align),a.size&&this.sizeFrom(a.size),a.proportions&&this.proportionsFrom(a.proportions))}function d(){this._transformGetter&&(this._output.transform=this._transformGetter()),this._opacityGetter&&(this._output.opacity=this._opacityGetter()),this._originGetter&&(this._output.origin=this._originGetter()),this._alignGetter&&(this._output.align=this._alignGetter()),this._sizeGetter&&(this._output.size=this._sizeGetter()),this._proportionGetter&&(this._output.proportions=this._proportionGetter())}var e=a("./Transform"),f=a("../transitions/Transitionable"),g=a("../transitions/TransitionableTransform");c.prototype.transformFrom=function(a){return a instanceof Function?this._transformGetter=a:a instanceof Object&&a.get?this._transformGetter=a.get.bind(a):(this._transformGetter=null,this._output.transform=a),this},c.prototype.opacityFrom=function(a){return a instanceof Function?this._opacityGetter=a:a instanceof Object&&a.get?this._opacityGetter=a.get.bind(a):(this._opacityGetter=null,this._output.opacity=a),this},c.prototype.originFrom=function(a){return a instanceof Function?this._originGetter=a:a instanceof Object&&a.get?this._originGetter=a.get.bind(a):(this._originGetter=null,this._output.origin=a),this},c.prototype.alignFrom=function(a){return a instanceof Function?this._alignGetter=a:a instanceof Object&&a.get?this._alignGetter=a.get.bind(a):(this._alignGetter=null,this._output.align=a),this},c.prototype.sizeFrom=function(a){return a instanceof Function?this._sizeGetter=a:a instanceof Object&&a.get?this._sizeGetter=a.get.bind(a):(this._sizeGetter=null,this._output.size=a),this},c.prototype.proportionsFrom=function(a){return a instanceof Function?this._proportionGetter=a:a instanceof Object&&a.get?this._proportionGetter=a.get.bind(a):(this._proportionGetter=null,this._output.proportions=a),this},c.prototype.setTransform=function(a,b,c){return b||this._legacyStates.transform?(this._legacyStates.transform||(this._legacyStates.transform=new g(this._output.transform)),this._transformGetter||this.transformFrom(this._legacyStates.transform),this._legacyStates.transform.set(a,b,c),this):this.transformFrom(a)},c.prototype.setOpacity=function(a,b,c){return b||this._legacyStates.opacity?(this._legacyStates.opacity||(this._legacyStates.opacity=new f(this._output.opacity)),this._opacityGetter||this.opacityFrom(this._legacyStates.opacity),this._legacyStates.opacity.set(a,b,c)):this.opacityFrom(a)},c.prototype.setOrigin=function(a,b,c){return b||this._legacyStates.origin?(this._legacyStates.origin||(this._legacyStates.origin=new f(this._output.origin||[0,0])),this._originGetter||this.originFrom(this._legacyStates.origin),this._legacyStates.origin.set(a,b,c),this):this.originFrom(a)},c.prototype.setAlign=function(a,b,c){return b||this._legacyStates.align?(this._legacyStates.align||(this._legacyStates.align=new f(this._output.align||[0,0])),this._alignGetter||this.alignFrom(this._legacyStates.align),this._legacyStates.align.set(a,b,c),this):this.alignFrom(a)},c.prototype.setSize=function(a,b,c){return a&&(b||this._legacyStates.size)?(this._legacyStates.size||(this._legacyStates.size=new f(this._output.size||[0,0])),this._sizeGetter||this.sizeFrom(this._legacyStates.size),this._legacyStates.size.set(a,b,c),this):this.sizeFrom(a)},c.prototype.setProportions=function(a,b,c){return a&&(b||this._legacyStates.proportions)?(this._legacyStates.proportions||(this._legacyStates.proportions=new f(this._output.proportions||[0,0])),this._proportionGetter||this.proportionsFrom(this._legacyStates.proportions),this._legacyStates.proportions.set(a,b,c),this):this.proportionsFrom(a)},c.prototype.halt=function(){this._legacyStates.transform&&this._legacyStates.transform.halt(),this._legacyStates.opacity&&this._legacyStates.opacity.halt(),this._legacyStates.origin&&this._legacyStates.origin.halt(),this._legacyStates.align&&this._legacyStates.align.halt(),this._legacyStates.size&&this._legacyStates.size.halt(),this._legacyStates.proportions&&this._legacyStates.proportions.halt(),this._transformGetter=null,this._opacityGetter=null,this._originGetter=null,this._alignGetter=null,this._sizeGetter=null,this._proportionGetter=null},c.prototype.getTransform=function(){return this._transformGetter()},c.prototype.getFinalTransform=function(){return this._legacyStates.transform?this._legacyStates.transform.getFinal():this._output.transform},c.prototype.getOpacity=function(){return this._opacityGetter()},c.prototype.getOrigin=function(){return this._originGetter()},c.prototype.getAlign=function(){return this._alignGetter()},c.prototype.getSize=function(){return this._sizeGetter?this._sizeGetter():this._output.size},c.prototype.getProportions=function(){return this._proportionGetter?this._proportionGetter():this._output.proportions},c.prototype.modify=function(a){return d.call(this),this._output.target=a,this._output},b.exports=c},{"../transitions/Transitionable":88,"../transitions/TransitionableTransform":89,"./Transform":15}],10:[function(a,b){function c(a){this._value=a,this.eventOutput=null}function d(){this.eventOutput=new e,this.eventOutput.bindThis(this),e.setOutputHandler(this,this.eventOutput)}var e=a("./EventHandler");c.patch=function(a){for(var b=new c(a),d=1;d<arguments.length;d++)b.patch(arguments[d]);return a},c.prototype.patch=function(){for(var a=this._value,b=0;b<arguments.length;b++){var c=arguments[b];for(var d in c)d in a&&c[d]&&c[d].constructor===Object&&a[d]&&a[d].constructor===Object?(a.hasOwnProperty(d)||(a[d]=Object.create(a[d])),this.key(d).patch(c[d]),this.eventOutput&&this.eventOutput.emit("change",{id:d,value:this.key(d).value()})):this.set(d,c[d])}return this},c.prototype.setOptions=c.prototype.patch,c.prototype.key=function(a){var b=new c(this._value[a]);return(!(b._value instanceof Object)||b._value instanceof Array)&&(b._value={}),b},c.prototype.get=function(a){return a?this._value[a]:this._value},c.prototype.getOptions=c.prototype.get,c.prototype.set=function(a,b){var c=this.get(a);return this._value[a]=b,this.eventOutput&&b!==c&&this.eventOutput.emit("change",{id:a,value:b}),this},c.prototype.on=function(){return d.call(this),this.on.apply(this,arguments)},c.prototype.removeListener=function(){return d.call(this),this.removeListener.apply(this,arguments)},c.prototype.pipe=function(){return d.call(this),this.pipe.apply(this,arguments)},c.prototype.unpipe=function(){return d.call(this),this.unpipe.apply(this,arguments)},b.exports=c},{"./EventHandler":7}],11:[function(a,b){function c(a){this._object=null,this._child=null,this._hasMultipleChildren=!1,this._isRenderable=!1,this._isModifier=!1,this._resultCache={},this._prevResults={},this._childResult=null,a&&this.set(a)}function d(a,b,c){for(var g=f.parse(a,b),h=Object.keys(g),i=0;i<h.length;i++){var j=h[i],k=e.get(j),l=g[j];l.allocator=b.allocator;var m=k.commit(l);m?d(m,b,c):c[j]=l}}var e=a("./Entity"),f=a("./SpecParser");c.prototype.add=function(a){var b=a instanceof c?a:new c(a);return this._child instanceof Array?this._child.push(b):this._child?(this._child=[this._child,b],this._hasMultipleChildren=!0,this._childResult=[]):this._child=b,b},c.prototype.get=function(){return this._object||(this._hasMultipleChildren?null:this._child?this._child.get():null)},c.prototype.set=function(a){return this._childResult=null,this._hasMultipleChildren=!1,this._isRenderable=a.render?!0:!1,this._isModifier=a.modify?!0:!1,this._object=a,this._child=null,a instanceof c?a:this},c.prototype.getSize=function(){var a=null,b=this.get();return b&&b.getSize&&(a=b.getSize()),!a&&this._child&&this._child.getSize&&(a=this._child.getSize()),a},c.prototype.commit=function(a){for(var b=Object.keys(this._prevResults),c=0;c<b.length;c++){var f=b[c];if(void 0===this._resultCache[f]){var g=e.get(f);g.cleanup&&g.cleanup(a.allocator)}}this._prevResults=this._resultCache,this._resultCache={},d(this.render(),a,this._resultCache)},c.prototype.render=function(){if(this._isRenderable)return this._object.render();var a=null;if(this._hasMultipleChildren){a=this._childResult;for(var b=this._child,c=0;c<b.length;c++)a[c]=b[c].render()}else this._child&&(a=this._child.render());return this._isModifier?this._object.modify(a):a},b.exports=c},{"./Entity":5,"./SpecParser":13}],12:[function(a,b){function c(a){this.id=null,this._objects=null,this.node=new j,this._definition=null,a&&this.load(a)}function d(a){for(var b in k)if(b in a){var c=a[b];return c instanceof Array||(c=[c]),k[b].apply(this,c)}}function e(a){var b=a.transform,c=a.opacity,e=a.origin,f=a.align,g=a.size,j=h.identity;if(b instanceof Array)if(16===b.length&&"number"==typeof b[0])j=b;else for(var k=0;k<b.length;k++)j=h.multiply(j,d(b[k]));else b instanceof Function?j=b:b instanceof Object&&(j=d(b));var l=new i({transform:j,opacity:c,origin:e,align:f,size:g});return l}function f(a){for(var b=new j,c=0;c<a.length;c++){var d=g.call(this,a[c]);d&&b.add(d)}return b}function g(a){var b,c;if(a instanceof Array)b=f.call(this,a);else if(c=this._objects.length,a.render&&a.render instanceof Function)b=a;else if(a.target){var d=g.call(this,a.target),h=e.call(this,a);b=new j(h),b.add(d),a.id&&(this.id[a.id]=h)}else a.id&&(b=new j,this.id[a.id]=b);return this._objects[c]=b,b}var h=a("./Transform"),i=a("./Modifier"),j=a("./RenderNode"),k={translate:h.translate,rotate:h.rotate,rotateX:h.rotateX,rotateY:h.rotateY,rotateZ:h.rotateZ,rotateAxis:h.rotateAxis,scale:h.scale,skew:h.skew,matrix3d:function(){return arguments}};c.prototype.create=function(){return new c(this._definition)},c.prototype.load=function(a){this._definition=a,this.id={},this._objects=[],this.node.set(g.call(this,a))},c.prototype.add=function(){return this.node.add.apply(this.node,arguments)},c.prototype.render=function(){return this.node.render.apply(this.node,arguments)},b.exports=c},{"./Modifier":9,"./RenderNode":11,"./Transform":15}],13:[function(a,b){function c(){this.result={}}function d(a,b){return[a[0]*b[0]+a[1]*b[4]+a[2]*b[8],a[0]*b[1]+a[1]*b[5]+a[2]*b[9],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]]}var e=a("./Transform");c._instance=new c,c.parse=function(a,b){return c._instance.parse(a,b)},c.prototype.parse=function(a,b){return this.reset(),this._parseSpec(a,b,e.identity),this.result},c.prototype.reset=function(){this.result={}};var f=[0,0];c.prototype._parseSpec=function(a,b,c){var g,h,i,j,k,l,m;if("number"==typeof a){if(g=a,i=b.transform,l=b.align||f,b.size&&l&&(l[0]||l[1])){var n=[l[0]*b.size[0],l[1]*b.size[1],0];i=e.thenMove(i,d(n,c))}this.result[g]={transform:i,opacity:b.opacity,origin:b.origin||f,align:b.align||f,size:b.size}}else{if(!a)return;if(a instanceof Array)for(var o=0;o<a.length;o++)this._parseSpec(a[o],b,c);else{h=a.target,i=b.transform,j=b.opacity,k=b.origin,l=b.align,m=b.size;var p=c;if(void 0!==a.opacity&&(j=b.opacity*a.opacity),a.transform&&(i=e.multiply(b.transform,a.transform)),a.origin&&(k=a.origin,p=b.transform),a.align&&(l=a.align),a.size||a.proportions){var q=m;m=[m[0],m[1]],a.size&&(void 0!==a.size[0]&&(m[0]=a.size[0]),void 0!==a.size[1]&&(m[1]=a.size[1])),a.proportions&&(void 0!==a.proportions[0]&&(m[0]=m[0]*a.proportions[0]),void 0!==a.proportions[1]&&(m[1]=m[1]*a.proportions[1])),q&&(l&&(l[0]||l[1])&&(i=e.thenMove(i,d([l[0]*q[0],l[1]*q[1],0],c))),k&&(k[0]||k[1])&&(i=e.moveThen([-k[0]*m[0],-k[1]*m[1],0],i))),p=b.transform,k=null,l=null}this._parseSpec(h,{transform:i,opacity:j,origin:k,align:l,size:m},p)}}},b.exports=c},{"./Transform":15}],14:[function(a,b){function c(a){j.call(this),this.options={},this.properties={},this.attributes={},this.content="",this.classList=[],this.size=null,this._classesDirty=!0,this._stylesDirty=!0,this._attributesDirty=!0,this._sizeDirty=!0,this._contentDirty=!0,this._trueSizeCheck=!0,this._dirtyClasses=[],a&&this.setOptions(a),this._currentTarget=null}function d(a){for(var b=0;b<this._dirtyClasses.length;b++)a.classList.remove(this._dirtyClasses[b]);this._dirtyClasses=[]}function e(a){for(var b in this.properties)a.style[b]=this.properties[b]}function f(a){for(var b in this.properties)a.style[b]=""}function g(a){for(var b in this.attributes)a.setAttribute(b,this.attributes[b])}function h(a){for(var b in this.attributes)a.removeAttribute(b)}function i(a,b){return a&&b?a[0]!==b[0]||a[1]!==b[1]:a!==b}var j=a("./ElementOutput");c.prototype=Object.create(j.prototype),c.prototype.constructor=c,c.prototype.elementType="div",c.prototype.elementClass="famous-surface",c.prototype.setAttributes=function(a){for(var b in a){if("style"===b)throw new Error('Cannot set styles via "setAttributes" as it will break Famo.us.  Use "setProperties" instead.');this.attributes[b]=a[b]}this._attributesDirty=!0},c.prototype.getAttributes=function(){return this.attributes},c.prototype.setProperties=function(a){for(var b in a)this.properties[b]=a[b];return this._stylesDirty=!0,this},c.prototype.getProperties=function(){return this.properties},c.prototype.addClass=function(a){return this.classList.indexOf(a)<0&&(this.classList.push(a),this._classesDirty=!0),this},c.prototype.removeClass=function(a){var b=this.classList.indexOf(a);return b>=0&&(this._dirtyClasses.push(this.classList.splice(b,1)[0]),this._classesDirty=!0),this},c.prototype.toggleClass=function(a){var b=this.classList.indexOf(a);return b>=0?this.removeClass(a):this.addClass(a),this},c.prototype.setClasses=function(a){var b=0,c=[];for(b=0;b<this.classList.length;b++)a.indexOf(this.classList[b])<0&&c.push(this.classList[b]);for(b=0;b<c.length;b++)this.removeClass(c[b]);for(b=0;b<a.length;b++)this.addClass(a[b]);
return this},c.prototype.getClassList=function(){return this.classList},c.prototype.setContent=function(a){return this.content!==a&&(this.content=a,this._contentDirty=!0),this},c.prototype.getContent=function(){return this.content},c.prototype.setOptions=function(a){return a.size&&this.setSize(a.size),a.classes&&this.setClasses(a.classes),a.properties&&this.setProperties(a.properties),a.attributes&&this.setAttributes(a.attributes),a.content&&this.setContent(a.content),this},c.prototype.setup=function(a){var b=a.allocate(this.elementType);if(this.elementClass)if(this.elementClass instanceof Array)for(var c=0;c<this.elementClass.length;c++)b.classList.add(this.elementClass[c]);else b.classList.add(this.elementClass);b.style.display="",this.attach(b),this._opacity=null,this._currentTarget=b,this._stylesDirty=!0,this._classesDirty=!0,this._attributesDirty=!0,this._sizeDirty=!0,this._contentDirty=!0,this._originDirty=!0,this._transformDirty=!0},c.prototype.commit=function(a){this._currentTarget||this.setup(a.allocator);var b=this._currentTarget,c=a.size;if(this._classesDirty){d.call(this,b);for(var f=this.getClassList(),h=0;h<f.length;h++)b.classList.add(f[h]);this._classesDirty=!1,this._trueSizeCheck=!0}if(this._stylesDirty&&(e.call(this,b),this._stylesDirty=!1,this._trueSizeCheck=!0),this._attributesDirty&&(g.call(this,b),this._attributesDirty=!1,this._trueSizeCheck=!0),this.size){var k=a.size;if(c=[this.size[0],this.size[1]],void 0===c[0]&&(c[0]=k[0]),void 0===c[1]&&(c[1]=k[1]),c[0]===!0||c[1]===!0){if(c[0]===!0)if(this._trueSizeCheck||0===this._size[0]){var l=b.offsetWidth;this._size&&this._size[0]!==l&&(this._size[0]=l,this._sizeDirty=!0),c[0]=l}else this._size&&(c[0]=this._size[0]);if(c[1]===!0)if(this._trueSizeCheck||0===this._size[1]){var m=b.offsetHeight;this._size&&this._size[1]!==m&&(this._size[1]=m,this._sizeDirty=!0),c[1]=m}else this._size&&(c[1]=this._size[1]);this._trueSizeCheck=!1}}i(this._size,c)&&(this._size||(this._size=[0,0]),this._size[0]=c[0],this._size[1]=c[1],this._sizeDirty=!0),this._sizeDirty&&(this._size&&(b.style.width=this.size&&this.size[0]===!0?"":this._size[0]+"px",b.style.height=this.size&&this.size[1]===!0?"":this._size[1]+"px"),this._eventOutput.emit("resize")),this._contentDirty&&(this.deploy(b),this._eventOutput.emit("deploy"),this._contentDirty=!1,this._trueSizeCheck=!0),j.prototype.commit.call(this,a)},c.prototype.cleanup=function(a){var b=0,c=this._currentTarget;this._eventOutput.emit("recall"),this.recall(c),c.style.display="none",c.style.opacity="",c.style.width="",c.style.height="",f.call(this,c),h.call(this,c);var e=this.getClassList();for(d.call(this,c),b=0;b<e.length;b++)c.classList.remove(e[b]);if(this.elementClass)if(this.elementClass instanceof Array)for(b=0;b<this.elementClass.length;b++)c.classList.remove(this.elementClass[b]);else c.classList.remove(this.elementClass);this.detach(c),this._currentTarget=null,a.deallocate(c)},c.prototype.deploy=function(a){var b=this.getContent();if(b instanceof Node){for(;a.hasChildNodes();)a.removeChild(a.firstChild);a.appendChild(b)}else a.innerHTML=b},c.prototype.recall=function(a){for(var b=document.createDocumentFragment();a.hasChildNodes();)b.appendChild(a.firstChild);this.setContent(b)},c.prototype.getSize=function(){return this._size?this._size:this.size},c.prototype.setSize=function(a){return this.size=a?[a[0],a[1]]:null,this._sizeDirty=!0,this},b.exports=c},{"./ElementOutput":3}],15:[function(a,b){function c(a){return 2===a.length?a[0]*a[0]+a[1]*a[1]:a[0]*a[0]+a[1]*a[1]+a[2]*a[2]}function d(a){return Math.sqrt(c(a))}function e(a){return 0>a?-1:1}var f={};f.precision=1e-6,f.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f.multiply4x4=function(a,b){return[a[0]*b[0]+a[4]*b[1]+a[8]*b[2]+a[12]*b[3],a[1]*b[0]+a[5]*b[1]+a[9]*b[2]+a[13]*b[3],a[2]*b[0]+a[6]*b[1]+a[10]*b[2]+a[14]*b[3],a[3]*b[0]+a[7]*b[1]+a[11]*b[2]+a[15]*b[3],a[0]*b[4]+a[4]*b[5]+a[8]*b[6]+a[12]*b[7],a[1]*b[4]+a[5]*b[5]+a[9]*b[6]+a[13]*b[7],a[2]*b[4]+a[6]*b[5]+a[10]*b[6]+a[14]*b[7],a[3]*b[4]+a[7]*b[5]+a[11]*b[6]+a[15]*b[7],a[0]*b[8]+a[4]*b[9]+a[8]*b[10]+a[12]*b[11],a[1]*b[8]+a[5]*b[9]+a[9]*b[10]+a[13]*b[11],a[2]*b[8]+a[6]*b[9]+a[10]*b[10]+a[14]*b[11],a[3]*b[8]+a[7]*b[9]+a[11]*b[10]+a[15]*b[11],a[0]*b[12]+a[4]*b[13]+a[8]*b[14]+a[12]*b[15],a[1]*b[12]+a[5]*b[13]+a[9]*b[14]+a[13]*b[15],a[2]*b[12]+a[6]*b[13]+a[10]*b[14]+a[14]*b[15],a[3]*b[12]+a[7]*b[13]+a[11]*b[14]+a[15]*b[15]]},f.multiply=function(a,b){return[a[0]*b[0]+a[4]*b[1]+a[8]*b[2],a[1]*b[0]+a[5]*b[1]+a[9]*b[2],a[2]*b[0]+a[6]*b[1]+a[10]*b[2],0,a[0]*b[4]+a[4]*b[5]+a[8]*b[6],a[1]*b[4]+a[5]*b[5]+a[9]*b[6],a[2]*b[4]+a[6]*b[5]+a[10]*b[6],0,a[0]*b[8]+a[4]*b[9]+a[8]*b[10],a[1]*b[8]+a[5]*b[9]+a[9]*b[10],a[2]*b[8]+a[6]*b[9]+a[10]*b[10],0,a[0]*b[12]+a[4]*b[13]+a[8]*b[14]+a[12],a[1]*b[12]+a[5]*b[13]+a[9]*b[14]+a[13],a[2]*b[12]+a[6]*b[13]+a[10]*b[14]+a[14],1]},f.thenMove=function(a,b){return b[2]||(b[2]=0),[a[0],a[1],a[2],0,a[4],a[5],a[6],0,a[8],a[9],a[10],0,a[12]+b[0],a[13]+b[1],a[14]+b[2],1]},f.moveThen=function(a,b){a[2]||(a[2]=0);var c=a[0]*b[0]+a[1]*b[4]+a[2]*b[8],d=a[0]*b[1]+a[1]*b[5]+a[2]*b[9],e=a[0]*b[2]+a[1]*b[6]+a[2]*b[10];return f.thenMove(b,[c,d,e])},f.translate=function(a,b,c){return void 0===c&&(c=0),[1,0,0,0,0,1,0,0,0,0,1,0,a,b,c,1]},f.thenScale=function(a,b){return[b[0]*a[0],b[1]*a[1],b[2]*a[2],0,b[0]*a[4],b[1]*a[5],b[2]*a[6],0,b[0]*a[8],b[1]*a[9],b[2]*a[10],0,b[0]*a[12],b[1]*a[13],b[2]*a[14],1]},f.scale=function(a,b,c){return void 0===c&&(c=1),void 0===b&&(b=a),[a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1]},f.rotateX=function(a){var b=Math.cos(a),c=Math.sin(a);return[1,0,0,0,0,b,c,0,0,-c,b,0,0,0,0,1]},f.rotateY=function(a){var b=Math.cos(a),c=Math.sin(a);return[b,0,-c,0,0,1,0,0,c,0,b,0,0,0,0,1]},f.rotateZ=function(a){var b=Math.cos(a),c=Math.sin(a);return[b,c,0,0,-c,b,0,0,0,0,1,0,0,0,0,1]},f.rotate=function(a,b,c){var d=Math.cos(a),e=Math.sin(a),f=Math.cos(b),g=Math.sin(b),h=Math.cos(c),i=Math.sin(c),j=[f*h,d*i+e*g*h,e*i-d*g*h,0,-f*i,d*h-e*g*i,e*h+d*g*i,0,g,-e*f,d*f,0,0,0,0,1];return j},f.rotateAxis=function(a,b){var c=Math.sin(b),d=Math.cos(b),e=1-d,f=a[0]*a[0]*e,g=a[0]*a[1]*e,h=a[0]*a[2]*e,i=a[1]*a[1]*e,j=a[1]*a[2]*e,k=a[2]*a[2]*e,l=a[0]*c,m=a[1]*c,n=a[2]*c,o=[f+d,g+n,h-m,0,g-n,i+d,j+l,0,h+m,j-l,k+d,0,0,0,0,1];return o},f.aboutOrigin=function(a,b){var c=a[0]-(a[0]*b[0]+a[1]*b[4]+a[2]*b[8]),d=a[1]-(a[0]*b[1]+a[1]*b[5]+a[2]*b[9]),e=a[2]-(a[0]*b[2]+a[1]*b[6]+a[2]*b[10]);return f.thenMove(b,[c,d,e])},f.skew=function(a,b,c){return[1,Math.tan(b),0,0,Math.tan(c),1,0,0,0,Math.tan(a),1,0,0,0,0,1]},f.skewX=function(a){return[1,0,0,0,Math.tan(a),1,0,0,0,0,1,0,0,0,0,1]},f.skewY=function(a){return[1,Math.tan(a),0,0,0,1,0,0,0,0,1,0,0,0,0,1]},f.perspective=function(a){return[1,0,0,0,0,1,0,0,0,0,1,-1/a,0,0,0,1]},f.getTranslate=function(a){return[a[12],a[13],a[14]]},f.inverse=function(a){var b=a[5]*a[10]-a[6]*a[9],c=a[4]*a[10]-a[6]*a[8],d=a[4]*a[9]-a[5]*a[8],e=a[1]*a[10]-a[2]*a[9],f=a[0]*a[10]-a[2]*a[8],g=a[0]*a[9]-a[1]*a[8],h=a[1]*a[6]-a[2]*a[5],i=a[0]*a[6]-a[2]*a[4],j=a[0]*a[5]-a[1]*a[4],k=a[0]*b-a[1]*c+a[2]*d,l=1/k,m=[l*b,-l*e,l*h,0,-l*c,l*f,-l*i,0,l*d,-l*g,l*j,0,0,0,0,1];return m[12]=-a[12]*m[0]-a[13]*m[4]-a[14]*m[8],m[13]=-a[12]*m[1]-a[13]*m[5]-a[14]*m[9],m[14]=-a[12]*m[2]-a[13]*m[6]-a[14]*m[10],m},f.transpose=function(a){return[a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]]},f.interpret=function(a){var b=[a[0],a[1],a[2]],g=e(b[0]),h=d(b),i=[b[0]+g*h,b[1],b[2]],j=2/c(i);if(j>=1/0)return{translate:f.getTranslate(a),rotate:[0,0,0],scale:[0,0,0],skew:[0,0,0]};var k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];k[0]=1-j*i[0]*i[0],k[5]=1-j*i[1]*i[1],k[10]=1-j*i[2]*i[2],k[1]=-j*i[0]*i[1],k[2]=-j*i[0]*i[2],k[6]=-j*i[1]*i[2],k[4]=k[1],k[8]=k[2],k[9]=k[6];var l=f.multiply(k,a),m=[l[5],l[6]],n=e(m[0]),o=d(m),p=[m[0]+n*o,m[1]],q=2/c(p),r=[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];r[5]=1-q*p[0]*p[0],r[10]=1-q*p[1]*p[1],r[6]=-q*p[0]*p[1],r[9]=r[6];var s=f.multiply(r,k),t=f.multiply(s,a),u=f.scale(t[0]<0?-1:1,t[5]<0?-1:1,t[10]<0?-1:1);t=f.multiply(t,u),s=f.multiply(u,s);var v={};return v.translate=f.getTranslate(a),v.rotate=[Math.atan2(-s[6],s[10]),Math.asin(s[2]),Math.atan2(-s[1],s[0])],v.rotate[0]||(v.rotate[0]=0,v.rotate[2]=Math.atan2(s[4],s[5])),v.scale=[t[0],t[5],t[10]],v.skew=[Math.atan2(t[9],v.scale[2]),Math.atan2(t[8],v.scale[2]),Math.atan2(t[4],v.scale[0])],Math.abs(v.rotate[0])+Math.abs(v.rotate[2])>1.5*Math.PI&&(v.rotate[1]=Math.PI-v.rotate[1],v.rotate[1]>Math.PI&&(v.rotate[1]-=2*Math.PI),v.rotate[1]<-Math.PI&&(v.rotate[1]+=2*Math.PI),v.rotate[0]<0?v.rotate[0]+=Math.PI:v.rotate[0]-=Math.PI,v.rotate[2]<0?v.rotate[2]+=Math.PI:v.rotate[2]-=Math.PI),v},f.average=function(a,b,c){c=void 0===c?.5:c;for(var d=f.interpret(a),e=f.interpret(b),g={translate:[0,0,0],rotate:[0,0,0],scale:[0,0,0],skew:[0,0,0]},h=0;3>h;h++)g.translate[h]=(1-c)*d.translate[h]+c*e.translate[h],g.rotate[h]=(1-c)*d.rotate[h]+c*e.rotate[h],g.scale[h]=(1-c)*d.scale[h]+c*e.scale[h],g.skew[h]=(1-c)*d.skew[h]+c*e.skew[h];return f.build(g)},f.build=function(a){var b=f.scale(a.scale[0],a.scale[1],a.scale[2]),c=f.skew(a.skew[0],a.skew[1],a.skew[2]),d=f.rotate(a.rotate[0],a.rotate[1],a.rotate[2]);return f.thenMove(f.multiply(f.multiply(d,c),b),a.translate)},f.equals=function(a,b){return!f.notEquals(a,b)},f.notEquals=function(a,b){return a===b?!1:!(a&&b)||a[12]!==b[12]||a[13]!==b[13]||a[14]!==b[14]||a[0]!==b[0]||a[1]!==b[1]||a[2]!==b[2]||a[4]!==b[4]||a[5]!==b[5]||a[6]!==b[6]||a[8]!==b[8]||a[9]!==b[9]||a[10]!==b[10]},f.normalizeRotation=function(a){var b=a.slice(0);for((b[0]===.5*Math.PI||b[0]===.5*-Math.PI)&&(b[0]=-b[0],b[1]=Math.PI-b[1],b[2]-=Math.PI),b[0]>.5*Math.PI&&(b[0]=b[0]-Math.PI,b[1]=Math.PI-b[1],b[2]-=Math.PI),b[0]<.5*-Math.PI&&(b[0]=b[0]+Math.PI,b[1]=-Math.PI-b[1],b[2]-=Math.PI);b[1]<-Math.PI;)b[1]+=2*Math.PI;for(;b[1]>=Math.PI;)b[1]-=2*Math.PI;for(;b[2]<-Math.PI;)b[2]+=2*Math.PI;for(;b[2]>=Math.PI;)b[2]-=2*Math.PI;return b},f.inFront=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,.001,1],f.behind=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,-.001,1],b.exports=f},{}],16:[function(a,b){function c(a){this._node=new f,this._eventInput=new d,this._eventOutput=new d,d.setInputHandler(this,this._eventInput),d.setOutputHandler(this,this._eventOutput),this.options=g.clone(this.constructor.DEFAULT_OPTIONS||c.DEFAULT_OPTIONS),this._optionsManager=new e(this.options),a&&this.setOptions(a)}var d=a("./EventHandler"),e=a("./OptionsManager"),f=a("./RenderNode"),g=a("../utilities/Utility");c.DEFAULT_OPTIONS={},c.prototype.getOptions=function(a){return this._optionsManager.getOptions(a)},c.prototype.setOptions=function(a){this._optionsManager.patch(a)},c.prototype.add=function(){return this._node.add.apply(this._node,arguments)},c.prototype._add=c.prototype.add,c.prototype.render=function(){return this._node.render()},c.prototype.getSize=function(){return this._node&&this._node.getSize?this._node.getSize.apply(this._node,arguments)||this.options.size:this.options.size},b.exports=c},{"../utilities/Utility":95,"./EventHandler":7,"./OptionsManager":10,"./RenderNode":11}],17:[function(a,b){function c(a){a||(a=[]),a instanceof Array&&(a={array:a}),this._=null,this.index=a.index||0,a.array?this._=new this.constructor.Backing(a.array):a._&&(this._=a._),this.index===this._.firstIndex&&(this._.firstNode=this),this.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=this),void 0!==a.loop&&(this._.loop=a.loop),void 0!==a.trackSize&&(this._.trackSize=a.trackSize),this._previousNode=null,this._nextNode=null}c.Backing=function(a){this.array=a,this.firstIndex=0,this.loop=!1,this.firstNode=null,this.lastNode=null,this.cumulativeSizes=[[0,0]],this.sizeDirty=!0,this.trackSize=!1},c.Backing.prototype.getValue=function(a){var b=a-this.firstIndex;return 0>b||b>=this.array.length?null:this.array[b]},c.Backing.prototype.setValue=function(a,b){this.array[a-this.firstIndex]=b},c.Backing.prototype.getSize=function(a){return this.cumulativeSizes[a]},c.Backing.prototype.calculateSize=function(a){a=a||this.array.length;for(var b=[0,0],c=0;a>c;c++){var d=this.array[c].getSize();if(!d)return void 0;void 0!==b[0]&&(void 0===d[0]?b[0]=void 0:b[0]+=d[0]),void 0!==b[1]&&(void 0===d[1]?b[1]=void 0:b[1]+=d[1]),this.cumulativeSizes[c+1]=b.slice()}return this.sizeDirty=!1,b},c.Backing.prototype.reindex=function(a,b,c){if(this.array[0]){for(var d=0,e=this.firstIndex,f=c-b,g=this.firstNode;a-1>e;)g=g.getNext(),e++;var h=g;for(d=0;b>d;d++)g=g.getNext(),g&&(g._previousNode=h);var i=g?g.getNext():null;for(h._nextNode=null,g=h,d=0;c>d;d++)g=g.getNext();if(e+=c,g!==i&&(g._nextNode=i,i&&(i._previousNode=g)),i)for(g=i,e++;g&&e<this.array.length+this.firstIndex;)g._nextNode?g.index+=f:g.index=e,g=g.getNext(),e++;this.trackSize&&(this.sizeDirty=!0)}},c.prototype.getPrevious=function(){var a=this._.array.length;return a?this.index===this._.firstIndex?this._.loop?(this._previousNode=this._.lastNode||new this.constructor({_:this._,index:this._.firstIndex+a-1}),this._previousNode._nextNode=this):this._previousNode=null:this._previousNode||(this._previousNode=new this.constructor({_:this._,index:this.index-1}),this._previousNode._nextNode=this):this._previousNode=null,this._previousNode},c.prototype.getNext=function(){var a=this._.array.length;return a?this.index===this._.firstIndex+a-1?this._.loop?(this._nextNode=this._.firstNode||new this.constructor({_:this._,index:this._.firstIndex}),this._nextNode._previousNode=this):this._nextNode=null:this._nextNode||(this._nextNode=new this.constructor({_:this._,index:this.index+1}),this._nextNode._previousNode=this):this._nextNode=null,this._nextNode},c.prototype.indexOf=function(a){return this._.array.indexOf(a)},c.prototype.getIndex=function(){return this.index},c.prototype.toString=function(){return""+this.index},c.prototype.unshift=function(){this._.array.unshift.apply(this._.array,arguments),this._.firstIndex-=arguments.length,this._.trackSize&&(this._.sizeDirty=!0)},c.prototype.push=function(){this._.array.push.apply(this._.array,arguments),this._.trackSize&&(this._.sizeDirty=!0)},c.prototype.splice=function(a,b){var c=Array.prototype.slice.call(arguments,2);this._.array.splice.apply(this._.array,[a-this._.firstIndex,b].concat(c)),this._.reindex(a,b,c.length)},c.prototype.swap=function(a){var b=a.get(),c=this.get();this._.setValue(this.index,b),this._.setValue(a.index,c);var d=this._previousNode,e=this._nextNode,f=this.index,g=a._previousNode,h=a._nextNode,i=a.index;this.index=i,this._previousNode=g===this?a:g,this._previousNode&&(this._previousNode._nextNode=this),this._nextNode=h===this?a:h,this._nextNode&&(this._nextNode._previousNode=this),a.index=f,a._previousNode=d===a?this:d,a._previousNode&&(a._previousNode._nextNode=a),a._nextNode=e===a?this:e,a._nextNode&&(a._nextNode._previousNode=a),this.index===this._.firstIndex?this._.firstNode=this:this.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=this),a.index===this._.firstIndex?this._.firstNode=a:a.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=a),this._.trackSize&&(this._.sizeDirty=!0)},c.prototype.get=function(){return this._.getValue(this.index)},c.prototype.getSize=function(){var a=this.get();return a?a.getSize():null},c.prototype.render=function(){this._.trackSize&&this._.sizeDirty&&this._.calculateSize();var a=this.get();return a?a.render.apply(a,arguments):null},b.exports=c},{}],18:[function(a,b){b.exports={Context:a("./Context"),ElementAllocator:a("./ElementAllocator"),ElementOutput:a("./ElementOutput"),Engine:a("./Engine"),Entity:a("./Entity"),EventEmitter:a("./EventEmitter"),EventHandler:a("./EventHandler"),Group:a("./Group"),Modifier:a("./Modifier"),OptionsManager:a("./OptionsManager"),RenderNode:a("./RenderNode"),Scene:a("./Scene"),SpecParser:a("./SpecParser"),Surface:a("./Surface"),Transform:a("./Transform"),View:a("./View"),ViewSequence:a("./ViewSequence")}},{"./Context":1,"./ElementAllocator":2,"./ElementOutput":3,"./Engine":4,"./Entity":5,"./EventEmitter":6,"./EventHandler":7,"./Group":8,"./Modifier":9,"./OptionsManager":10,"./RenderNode":11,"./Scene":12,"./SpecParser":13,"./Surface":14,"./Transform":15,"./View":16,"./ViewSequence":17}],19:[function(a,b){function c(a){this.dispatchers={},this.currMode=void 0,this.setMode(a)}var d=a("../core/EventHandler");c.prototype.setMode=function(a){if(a!==this.currMode){var b=this.currMode;this.dispatchers[this.currMode]&&this.dispatchers[this.currMode].trigger("unpipe"),this.currMode=a,this.dispatchers[a]&&this.dispatchers[a].emit("pipe"),this.emit("change",{from:b,to:a})}},c.prototype.forMode=function(a){return this.dispatchers[a]||(this.dispatchers[a]=new d),this.dispatchers[a]},c.prototype.emit=function(a,b){if(void 0===this.currMode)return!1;b||(b={});var c=this.dispatchers[this.currMode];return c?c.trigger(a,b):void 0},b.exports=c},{"../core/EventHandler":7}],20:[function(a,b){function c(a){d.call(this),this._condition=a}var d=a("../core/EventHandler");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.emit=function(a,b){return this._condition(a,b)?d.prototype.emit.apply(this,arguments):void 0},c.prototype.trigger=c.prototype.emit,b.exports=c},{"../core/EventHandler":7}],21:[function(a,b){function c(a){d.call(this),this._mappingFunction=a}var d=a("../core/EventHandler");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.subscribe=null,c.prototype.unsubscribe=null,c.prototype.emit=function(a,b){var c=this._mappingFunction.apply(this,arguments);c&&c.emit instanceof Function&&c.emit(a,b)},c.prototype.trigger=c.prototype.emit,b.exports=c},{"../core/EventHandler":7}],22:[function(a,b){b.exports={EventArbiter:a("./EventArbiter"),EventFilter:a("./EventFilter"),EventMapper:a("./EventMapper")}},{"./EventArbiter":19,"./EventFilter":20,"./EventMapper":21}],23:[function(a,b){b.exports={core:a("./core"),events:a("./events"),inputs:a("./inputs"),math:a("./math"),modifiers:a("./modifiers"),physics:a("./physics"),surfaces:a("./surfaces"),transitions:a("./transitions"),utilities:a("./utilities"),views:a("./views"),widgets:a("./widgets")}},{"./core":18,"./events":22,"./inputs":36,"./math":42,"./modifiers":47,"./physics":71,"./surfaces":82,"./transitions":92,"./utilities":96,"./views":112,"./widgets":117}],24:[function(a,b){function c(a,b){void 0===b&&(b="update"),this._state=a&&a.get&&a.set?a:new f(a||0),this._eventInput=new e,e.setInputHandler(this,this._eventInput),this._eventInput.on(b,d.bind(this))}function d(a){var b=a.delta,c=this.get();if(b.constructor===c.constructor){var d=b instanceof Array?[c[0]+b[0],c[1]+b[1]]:c+b;this.set(d)}}var e=a("../core/EventHandler"),f=a("../transitions/Transitionable");c.prototype.get=function(){return this._state.get()},c.prototype.set=function(a){this._state.set(a)},b.exports=c},{"../core/EventHandler":7,"../transitions/Transitionable":88}],25:[function(){function a(a){window.addEventListener(a,function(a){return a.stopPropagation(),!1},!0)}var b="ontouchstart"in window;b&&(a("mousedown"),a("mousemove"),a("mouseup"),a("mouseleave"))},{}],26:[function(){!function(){if(window.CustomEvent){var a=300,b=500,c={},d={},e=Date.now;window.addEventListener("touchstart",function(a){for(var b=e(),d=0;d<a.changedTouches.length;d++){var f=a.changedTouches[d];c[f.identifier]=b}}),window.addEventListener("touchmove",function(a){for(var b=0;b<a.changedTouches.length;b++){var d=a.changedTouches[b];delete c[d.identifier]}}),window.addEventListener("touchend",function(b){for(var f=e(),g=0;g<b.changedTouches.length;g++){var h=b.changedTouches[g],i=c[h.identifier];if(i&&a>f-i){var j=new window.CustomEvent("click",{bubbles:!0,detail:h});d[f]=b,b.target.dispatchEvent(j)}delete c[h.identifier]}}),window.addEventListener("click",function(a){var c=e();for(var f in d){var g=d[f];b>c-f?a instanceof window.MouseEvent&&a.target===g.target&&a.stopPropagation():delete d[f]}},!0)}}()},{}],27:[function(a,b){function c(a,b){this._eventInput=new e,this._eventOutput=new e,e.setInputHandler(this,this._eventInput),e.setOutputHandler(this,this._eventOutput),this._syncs={},a&&this.addSync(a),b&&this.setOptions(b)}function d(a,b){f[a]&&(this._syncs[a]=new f[a](b),this.pipeSync(a))}var e=a("../core/EventHandler");c.DIRECTION_X=0,c.DIRECTION_Y=1,c.DIRECTION_Z=2;var f={};c.register=function(a){for(var b in a)if(f[b]){if(f[b]!==a[b])throw new Error("Conflicting sync classes for key: "+b)}else f[b]=a[b]},c.prototype.setOptions=function(a){for(var b in this._syncs)this._syncs[b].setOptions(a)},c.prototype.pipeSync=function(a){var b=this._syncs[a];this._eventInput.pipe(b),b.pipe(this._eventOutput)},c.prototype.unpipeSync=function(a){var b=this._syncs[a];this._eventInput.unpipe(b),b.unpipe(this._eventOutput)},c.prototype.addSync=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)d.call(this,a[b]);else if(a instanceof Object)for(var c in a)d.call(this,c,a[c])},b.exports=c},{"../core/EventHandler":7}],28:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),this._optionsManager=new i(this.options),a&&this.setOptions(a),this._eventInput=new h,this._eventOutput=new h,h.setInputHandler(this,this._eventInput),h.setOutputHandler(this,this._eventOutput),this._eventInput.on("mousedown",d.bind(this)),this._eventInput.on("mousemove",e.bind(this)),this._eventInput.on("mouseup",f.bind(this)),this.options.propogate?this._eventInput.on("mouseleave",g.bind(this)):this._eventInput.on("mouseleave",f.bind(this)),this.options.clickThreshold&&window.addEventListener("click",function(a){Math.sqrt(Math.pow(this._displacement[0],2)+Math.pow(this._displacement[1],2))>this.options.clickThreshold&&a.stopPropagation()}.bind(this),!0),this._payload={delta:null,position:null,velocity:null,clientX:0,clientY:0,offsetX:0,offsetY:0},this._positionHistory=[],this._position=null,this._prevCoord=void 0,this._prevTime=void 0,this._down=!1,this._moved=!1,this._displacement=[0,0],this._documentActive=!1}function d(a){var b,c;this.options.preventDefault&&a.preventDefault();var d=a.clientX,e=a.clientY;this._prevCoord=[d,e],this._prevTime=Date.now(),this._down=!0,this._move=!1,void 0!==this.options.direction?(this._position=0,b=0,c=0):(this._position=[0,0],b=[0,0],c=[0,0]),this.options.clickThreshold&&(this._displacement=[0,0]);var f=this._payload;f.delta=b,f.position=this._position,f.velocity=c,f.clientX=d,f.clientY=e,f.offsetX=a.offsetX,f.offsetY=a.offsetY,this._positionHistory.push({position:f.position.slice?f.position.slice(0):f.position,time:this._prevTime}),this._eventOutput.emit("start",f),this._documentActive=!1}function e(a){if(this._prevCoord){var b=this._prevCoord;this._prevTime;var d=a.clientX,e=a.clientY,f=Date.now(),g=d-b[0],h=e-b[1];this.options.rails&&(Math.abs(g)>Math.abs(h)?h=0:g=0);var i,k,l=Math.max(f-this._positionHistory[0].time,j),m=this.options.scale;this.options.direction===c.DIRECTION_X?(k=m*g,this._position+=k,i=m*(this._position-this._positionHistory[0].position)/l):this.options.direction===c.DIRECTION_Y?(k=m*h,this._position+=k,i=m*(this._position-this._positionHistory[0].position)/l):(k=[m*g,m*h],i=[m*(this._position[0]-this._positionHistory[0].position[0])/l,m*(this._position[1]-this._positionHistory[0].position[1])/l],this._position[0]+=k[0],this._position[1]+=k[1]),this.options.clickThreshold!==!1&&(this._displacement[0]+=g,this._displacement[1]+=h);var n=this._payload;n.delta=k,n.position=this._position,n.velocity=i,n.clientX=d,n.clientY=e,n.offsetX=a.offsetX,n.offsetY=a.offsetY,this._positionHistory.length===this.options.velocitySampleLength&&this._positionHistory.shift(),this._positionHistory.push({position:n.position.slice?n.position.slice(0):n.position,time:f}),this._eventOutput.emit("update",n),this._prevCoord=[d,e],this._prevTime=f,this._move=!0}}function f(){this._down&&(this._eventOutput.emit("end",this._payload),this._prevCoord=void 0,this._prevTime=void 0,this._down=!1,this._move=!1,this._positionHistory=[])}function g(a){if(this._down&&this._move&&!this._documentActive){var b=e.bind(this),c=function(a){f.call(this,a),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",c)}.bind(this,a);document.addEventListener("mousemove",b),document.addEventListener("mouseup",c),this._documentActive=!0}}var h=a("../core/EventHandler"),i=a("../core/OptionsManager");c.DEFAULT_OPTIONS={clickThreshold:void 0,direction:void 0,rails:!1,scale:1,propogate:!0,velocitySampleLength:10,preventDefault:!0},c.DIRECTION_X=0,c.DIRECTION_Y=1;var j=8;c.prototype.getOptions=function(){return this.options},c.prototype.setOptions=function(a){return this._optionsManager.setOptions(a)},b.exports=c},{"../core/EventHandler":7,"../core/OptionsManager":10}],29:[function(a,b){function c(a){d.call(this),this.options=Object.create(c.DEFAULT_OPTIONS),this._optionsManager=new e(this.options),a&&this.setOptions(a),this._displacement=0,this._previousDistance=0}var d=a("./TwoFingerSync"),e=a("../core/OptionsManager");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.DEFAULT_OPTIONS={scale:1},c.prototype._startUpdate=function(a){this._previousDistance=d.calculateDistance(this.posA,this.posB),this._displacement=0,this._eventOutput.emit("start",{count:a.touches.length,touches:[this.touchAId,this.touchBId],distance:this._dist,center:d.calculateCenter(this.posA,this.posB)})},c.prototype._moveUpdate=function(a){var b=d.calculateDistance(this.posA,this.posB),c=d.calculateCenter(this.posA,this.posB),e=this.options.scale,f=e*(b-this._previousDistance),g=f/a;this._previousDistance=b,this._displacement+=f,this._eventOutput.emit("update",{delta:f,velocity:g,distance:b,displacement:this._displacement,center:c,touches:[this.touchAId,this.touchBId]})},c.prototype.getOptions=function(){return this.options},c.prototype.setOptions=function(a){return this._optionsManager.setOptions(a)},b.exports=c},{"../core/OptionsManager":10,"./TwoFingerSync":35}],30:[function(a,b){function c(a){d.call(this),this.options=Object.create(c.DEFAULT_OPTIONS),this._optionsManager=new e(this.options),a&&this.setOptions(a),this._angle=0,this._previousAngle=0}var d=a("./TwoFingerSync"),e=a("../core/OptionsManager");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.DEFAULT_OPTIONS={scale:1},c.prototype._startUpdate=function(a){this._angle=0,this._previousAngle=d.calculateAngle(this.posA,this.posB);var b=d.calculateCenter(this.posA,this.posB);this._eventOutput.emit("start",{count:a.touches.length,angle:this._angle,center:b,touches:[this.touchAId,this.touchBId]})},c.prototype._moveUpdate=function(a){var b=this.options.scale,c=d.calculateAngle(this.posA,this.posB),e=d.calculateCenter(this.posA,this.posB),f=b*(c-this._previousAngle),g=f/a;this._angle+=f,this._eventOutput.emit("update",{delta:f,velocity:g,angle:this._angle,center:e,touches:[this.touchAId,this.touchBId]}),this._previousAngle=c},c.prototype.getOptions=function(){return this.options},c.prototype.setOptions=function(a){return this._optionsManager.setOptions(a)},b.exports=c},{"../core/OptionsManager":10,"./TwoFingerSync":35}],31:[function(a,b){function c(a){e.call(this),this.options=Object.create(c.DEFAULT_OPTIONS),this._optionsManager=new f(this.options),a&&this.setOptions(a),this._scaleFactor=1,this._startDist=0,this._eventInput.on("pipe",d.bind(this))}function d(){this.touchAId=void 0,this.touchBId=void 0}var e=a("./TwoFingerSync"),f=a("../core/OptionsManager");c.prototype=Object.create(e.prototype),c.prototype.constructor=c,c.DEFAULT_OPTIONS={scale:1},c.prototype._startUpdate=function(a){this._scaleFactor=1,this._startDist=e.calculateDistance(this.posA,this.posB),this._eventOutput.emit("start",{count:a.touches.length,touches:[this.touchAId,this.touchBId],distance:this._startDist,center:e.calculateCenter(this.posA,this.posB)})},c.prototype._moveUpdate=function(a){var b=this.options.scale,c=e.calculateDistance(this.posA,this.posB),d=e.calculateCenter(this.posA,this.posB),f=(c-this._startDist)/this._startDist,g=Math.max(1+b*f,0),h=(g-this._scaleFactor)/a;this._eventOutput.emit("update",{delta:f,scale:g,velocity:h,distance:c,center:d,touches:[this.touchAId,this.touchBId]}),this._scaleFactor=g},c.prototype.getOptions=function(){return this.options},c.prototype.setOptions=function(a){return this._optionsManager.setOptions(a)},b.exports=c},{"../core/OptionsManager":10,"./TwoFingerSync":35}],32:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),this._optionsManager=new h(this.options),a&&this.setOptions(a),this._payload={delta:null,position:null,velocity:null,slip:!0},this._eventInput=new f,this._eventOutput=new f,f.setInputHandler(this,this._eventInput),f.setOutputHandler(this,this._eventOutput),this._position=void 0===this.options.direction?[0,0]:0,this._prevTime=void 0,this._prevVel=void 0,this._eventInput.on("mousewheel",e.bind(this)),this._eventInput.on("wheel",e.bind(this)),this._inProgress=!1,this._loopBound=!1}function d(){if(this._inProgress&&j()-this._prevTime>this.options.stallTime){this._inProgress=!1;var a=Math.abs(this._prevVel)>=this.options.minimumEndSpeed?this._prevVel:0,b=this._payload;b.position=this._position,b.velocity=a,b.slip=!0,this._eventOutput.emit("end",b)}}function e(a){this.options.preventDefault&&a.preventDefault(),this._inProgress||(this._inProgress=!0,this._position=void 0===this.options.direction?[0,0]:0,q=this._payload,q.slip=!0,q.position=this._position,q.clientX=a.clientX,q.clientY=a.clientY,q.offsetX=a.offsetX,q.offsetY=a.offsetY,this._eventOutput.emit("start",q),this._loopBound||(g.on("prerender",d.bind(this)),this._loopBound=!0));var b=j(),e=this._prevTime||b,f=void 0!==a.wheelDeltaX?a.wheelDeltaX:-a.deltaX,h=void 0!==a.wheelDeltaY?a.wheelDeltaY:-a.deltaY;1===a.deltaMode&&(f*=this.options.lineHeight,h*=this.options.lineHeight),this.options.rails&&(Math.abs(f)>Math.abs(h)?h=0:f=0);var k,l,m=Math.max(b-e,i),n=f/m,o=h/m,p=this.options.scale;this.options.direction===c.DIRECTION_X?(l=p*f,k=p*n,this._position+=l):this.options.direction===c.DIRECTION_Y?(l=p*h,k=p*o,this._position+=l):(l=[p*f,p*h],k=[p*n,p*o],this._position[0]+=l[0],this._position[1]+=l[1]);var q=this._payload;q.delta=l,q.velocity=k,q.position=this._position,q.slip=!0,this._eventOutput.emit("update",q),this._prevTime=b,this._prevVel=k}var f=a("../core/EventHandler"),g=a("../core/Engine"),h=a("../core/OptionsManager");c.DEFAULT_OPTIONS={direction:void 0,minimumEndSpeed:1/0,rails:!1,scale:1,stallTime:50,lineHeight:40,preventDefault:!0},c.DIRECTION_X=0,c.DIRECTION_Y=1;var i=8,j=Date.now;c.prototype.getOptions=function(){return this.options},c.prototype.setOptions=function(a){return this._optionsManager.setOptions(a)},b.exports=c},{"../core/Engine":4,"../core/EventHandler":7,"../core/OptionsManager":10}],33:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),this._optionsManager=new i(this.options),a&&this.setOptions(a),this._eventOutput=new h,this._touchTracker=new g({touchLimit:this.options.touchLimit}),h.setOutputHandler(this,this._eventOutput),h.setInputHandler(this,this._touchTracker),this._touchTracker.on("trackstart",d.bind(this)),this._touchTracker.on("trackmove",e.bind(this)),this._touchTracker.on("trackend",f.bind(this)),this._payload={delta:null,position:null,velocity:null,clientX:void 0,clientY:void 0,count:0,touch:void 0},this._position=null}function d(a){var b,c;void 0!==this.options.direction?(this._position=0,b=0,c=0):(this._position=[0,0],b=[0,0],c=[0,0]);var d=this._payload;d.delta=c,d.position=this._position,d.velocity=b,d.clientX=a.x,d.clientY=a.y,d.count=a.count,d.touch=a.identifier,this._eventOutput.emit("start",d)}function e(a){var b=a.history,d=b[b.length-1],e=b[b.length-2],f=b[b.length-this.options.velocitySampleLength]?b[b.length-this.options.velocitySampleLength]:b[b.length-2],g=f.timestamp,h=d.timestamp,i=d.x-e.x,k=d.y-e.y,l=d.x-f.x,m=d.y-f.y;this.options.rails&&(Math.abs(i)>Math.abs(k)?k=0:i=0,Math.abs(l)>Math.abs(m)?m=0:l=0);var n,o,p=Math.max(h-g,j),q=l/p,r=m/p,s=this.options.scale;this.options.direction===c.DIRECTION_X?(o=s*i,n=s*q,this._position+=o):this.options.direction===c.DIRECTION_Y?(o=s*k,n=s*r,this._position+=o):(o=[s*i,s*k],n=[s*q,s*r],this._position[0]+=o[0],
this._position[1]+=o[1]);var t=this._payload;t.delta=o,t.velocity=n,t.position=this._position,t.clientX=a.x,t.clientY=a.y,t.count=a.count,t.touch=a.identifier,this._eventOutput.emit("update",t)}function f(a){this._payload.count=a.count,this._eventOutput.emit("end",this._payload)}var g=a("./TouchTracker"),h=a("../core/EventHandler"),i=a("../core/OptionsManager");c.DEFAULT_OPTIONS={direction:void 0,rails:!1,touchLimit:1,velocitySampleLength:10,scale:1},c.DIRECTION_X=0,c.DIRECTION_Y=1;var j=8;c.prototype.setOptions=function(a){return this._optionsManager.setOptions(a)},c.prototype.getOptions=function(){return this.options},b.exports=c},{"../core/EventHandler":7,"../core/OptionsManager":10,"./TouchTracker":34}],34:[function(a,b){function c(a,b,c){return{x:a.clientX,y:a.clientY,identifier:a.identifier,origin:b.origin,timestamp:j(),count:b.touches.length,history:c}}function d(a){if(!(a.touches.length>this.touchLimit)){this.isTouched=!0;for(var b=0;b<a.changedTouches.length;b++){var d=a.changedTouches[b],e=c(d,a,null);this.eventOutput.emit("trackstart",e),this.selective||this.touchHistory[d.identifier]||this.track(e)}}}function e(a){if(!(a.touches.length>this.touchLimit))for(var b=0;b<a.changedTouches.length;b++){var d=a.changedTouches[b],e=this.touchHistory[d.identifier];if(e){var f=c(d,a,e);this.touchHistory[d.identifier].push(f),this.eventOutput.emit("trackmove",f)}}}function f(a){if(this.isTouched){for(var b=0;b<a.changedTouches.length;b++){var d=a.changedTouches[b],e=this.touchHistory[d.identifier];if(e){var f=c(d,a,e);this.eventOutput.emit("trackend",f),delete this.touchHistory[d.identifier]}}this.isTouched=!1}}function g(){for(var a in this.touchHistory){var b=this.touchHistory[a];this.eventOutput.emit("trackend",{touch:b[b.length-1].touch,timestamp:Date.now(),count:0,history:b}),delete this.touchHistory[a]}}function h(a){this.selective=a.selective,this.touchLimit=a.touchLimit||1,this.touchHistory={},this.eventInput=new i,this.eventOutput=new i,i.setInputHandler(this,this.eventInput),i.setOutputHandler(this,this.eventOutput),this.eventInput.on("touchstart",d.bind(this)),this.eventInput.on("touchmove",e.bind(this)),this.eventInput.on("touchend",f.bind(this)),this.eventInput.on("touchcancel",f.bind(this)),this.eventInput.on("unpipe",g.bind(this)),this.isTouched=!1}var i=a("../core/EventHandler"),j=Date.now;h.prototype.track=function(a){this.touchHistory[a.identifier]=[a]},b.exports=h},{"../core/EventHandler":7}],35:[function(a,b){function c(){this._eventInput=new d,this._eventOutput=new d,d.setInputHandler(this,this._eventInput),d.setOutputHandler(this,this._eventOutput),this.touchAEnabled=!1,this.touchAId=0,this.posA=null,this.timestampA=0,this.touchBEnabled=!1,this.touchBId=0,this.posB=null,this.timestampB=0,this._eventInput.on("touchstart",this.handleStart.bind(this)),this._eventInput.on("touchmove",this.handleMove.bind(this)),this._eventInput.on("touchend",this.handleEnd.bind(this)),this._eventInput.on("touchcancel",this.handleEnd.bind(this))}var d=a("../core/EventHandler");c.calculateAngle=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.atan2(d,c)},c.calculateDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},c.calculateCenter=function(a,b){return[(a[0]+b[0])/2,(a[1]+b[1])/2]};var e=Date.now;c.prototype.handleStart=function(a){for(var b=0;b<a.changedTouches.length;b++){var c=a.changedTouches[b];this.touchAEnabled?this.touchBEnabled||(this.touchBId=c.identifier,this.touchBEnabled=!0,this.posB=[c.pageX,c.pageY],this.timestampB=e(),this._startUpdate(a)):(this.touchAId=c.identifier,this.touchAEnabled=!0,this.posA=[c.pageX,c.pageY],this.timestampA=e())}},c.prototype.handleMove=function(a){if(this.touchAEnabled&&this.touchBEnabled){for(var b,c=this.timestampA,d=this.timestampB,f=0;f<a.changedTouches.length;f++){var g=a.changedTouches[f];g.identifier===this.touchAId?(this.posA=[g.pageX,g.pageY],this.timestampA=e(),b=this.timestampA-c):g.identifier===this.touchBId&&(this.posB=[g.pageX,g.pageY],this.timestampB=e(),b=this.timestampB-d)}b&&this._moveUpdate(b)}},c.prototype.handleEnd=function(a){for(var b=0;b<a.changedTouches.length;b++){var c=a.changedTouches[b];(c.identifier===this.touchAId||c.identifier===this.touchBId)&&(this.touchAEnabled&&this.touchBEnabled&&this._eventOutput.emit("end",{touches:[this.touchAId,this.touchBId],angle:this._angle}),this.touchAEnabled=!1,this.touchAId=0,this.touchBEnabled=!1,this.touchBId=0)}},b.exports=c},{"../core/EventHandler":7}],36:[function(a,b){b.exports={Accumulator:a("./Accumulator"),DesktopEmulationMode:a("./DesktopEmulationMode"),FastClick:a("./FastClick"),GenericSync:a("./GenericSync"),MouseSync:a("./MouseSync"),PinchSync:a("./PinchSync"),RotateSync:a("./RotateSync"),ScaleSync:a("./ScaleSync"),ScrollSync:a("./ScrollSync"),TouchSync:a("./TouchSync"),TouchTracker:a("./TouchTracker"),TwoFingerSync:a("./TwoFingerSync")}},{"./Accumulator":24,"./DesktopEmulationMode":25,"./FastClick":26,"./GenericSync":27,"./MouseSync":28,"./PinchSync":29,"./RotateSync":30,"./ScaleSync":31,"./ScrollSync":32,"./TouchSync":33,"./TouchTracker":34,"./TwoFingerSync":35}],37:[function(a,b){function c(a){return this.values=a||[[1,0,0],[0,1,0],[0,0,1]],this}var d=a("./Vector"),e=new c,f=new d;c.prototype.get=function(){return this.values},c.prototype.set=function(a){this.values=a},c.prototype.vectorMultiply=function(a){var b=this.get(),c=a.x,d=a.y,e=a.z,g=b[0],h=b[1],i=b[2],j=g[0],k=g[1],l=g[2],m=h[0],n=h[1],o=h[2],p=i[0],q=i[1],r=i[2];return f.setXYZ(j*c+k*d+l*e,m*c+n*d+o*e,p*c+q*d+r*e)},c.prototype.multiply=function(a){for(var b=this.get(),c=[[]],d=0;3>d;d++){c[d]=[];for(var f=0;3>f;f++){for(var g=0,h=0;3>h;h++)g+=b[d][h]*a[h][f];c[d][f]=g}}return e.set(c)},c.prototype.transpose=function(){for(var a=[[],[],[]],b=this.get(),c=0;3>c;c++)for(var d=0;3>d;d++)a[c][d]=b[d][c];return e.set(a)},c.prototype.clone=function(){for(var a=this.get(),b=[],d=0;3>d;d++)b[d]=a[d].slice();return new c(b)},b.exports=c},{"./Vector":41}],38:[function(a,b){function c(a,b,c,d){return 1===arguments.length?this.set(a):(this.w=void 0!==a?a:1,this.x=void 0!==b?b:0,this.y=void 0!==c?c:0,this.z=void 0!==d?d:0),this}var d=a("./Matrix"),e=new c(1,0,0,0);c.prototype.add=function(a){return e.setWXYZ(this.w+a.w,this.x+a.x,this.y+a.y,this.z+a.z)},c.prototype.sub=function(a){return e.setWXYZ(this.w-a.w,this.x-a.x,this.y-a.y,this.z-a.z)},c.prototype.scalarDivide=function(a){return this.scalarMultiply(1/a)},c.prototype.scalarMultiply=function(a){return e.setWXYZ(this.w*a,this.x*a,this.y*a,this.z*a)},c.prototype.multiply=function(a){var b=this.x,c=this.y,d=this.z,f=this.w,g=a.x,h=a.y,i=a.z,j=a.w||0;return e.setWXYZ(f*j-b*g-c*h-d*i,b*j+g*f+h*d-c*i,c*j+h*f+b*i-g*d,d*j+i*f+g*c-b*h)};var f=new c(1,0,0,0);c.prototype.rotateVector=function(a){return f.set(this.conj()),e.set(this.multiply(a).multiply(f))},c.prototype.inverse=function(){return e.set(this.conj().scalarDivide(this.normSquared()))},c.prototype.negate=function(){return this.scalarMultiply(-1)},c.prototype.conj=function(){return e.setWXYZ(this.w,-this.x,-this.y,-this.z)},c.prototype.normalize=function(a){return a=void 0===a?1:a,this.scalarDivide(a*this.norm())},c.prototype.makeFromAngleAndAxis=function(a,b){var c=b.normalize(),d=.5*a,e=-Math.sin(d);return this.x=e*c.x,this.y=e*c.y,this.z=e*c.z,this.w=Math.cos(d),this},c.prototype.setWXYZ=function(a,b,c,d){return e.clear(),this.w=a,this.x=b,this.y=c,this.z=d,this},c.prototype.set=function(a){return a instanceof Array?(this.w=0,this.x=a[0],this.y=a[1],this.z=a[2]):(this.w=a.w,this.x=a.x,this.y=a.y,this.z=a.z),this!==e&&e.clear(),this},c.prototype.put=function(a){a.set(e)},c.prototype.clone=function(){return new c(this)},c.prototype.clear=function(){return this.w=1,this.x=0,this.y=0,this.z=0,this},c.prototype.isEqual=function(a){return a.w===this.w&&a.x===this.x&&a.y===this.y&&a.z===this.z},c.prototype.dot=function(a){return this.w*a.w+this.x*a.x+this.y*a.y+this.z*a.z},c.prototype.normSquared=function(){return this.dot(this)},c.prototype.norm=function(){return Math.sqrt(this.normSquared())},c.prototype.isZero=function(){return!(this.x||this.y||this.z)},c.prototype.getTransform=function(){var a=this.normalize(1),b=a.x,c=a.y,d=a.z,e=a.w;return[1-2*c*c-2*d*d,2*b*c-2*d*e,2*b*d+2*c*e,0,2*b*c+2*d*e,1-2*b*b-2*d*d,2*c*d-2*b*e,0,2*b*d-2*c*e,2*c*d+2*b*e,1-2*b*b-2*c*c,0,0,0,0,1]};var g=new d;c.prototype.getMatrix=function(){var a=this.normalize(1),b=a.x,c=a.y,d=a.z,e=a.w;return g.set([[1-2*c*c-2*d*d,2*b*c+2*d*e,2*b*d-2*c*e],[2*b*c-2*d*e,1-2*b*b-2*d*d,2*c*d+2*b*e],[2*b*d+2*c*e,2*c*d-2*b*e,1-2*b*b-2*c*c]])};var h=1e-5;c.prototype.slerp=function(a,b){var c,d,f,g,i;return d=this.dot(a),1-d>h?(c=Math.acos(d),f=Math.sin(c),g=Math.sin((1-b)*c)/f,i=Math.sin(b*c)/f):(g=1-b,i=b),e.set(this.scalarMultiply(g/i).add(a).scalarMultiply(i))},b.exports=c},{"./Matrix":37}],39:[function(a,b){function c(a,b){return a+f()*(b-a)}function d(a,b){return a+(f()*(b-a+1)>>0)}function e(a,b,c,d){if(b=void 0!==b?b:0,c=void 0!==c?c:1,void 0!==d){for(var e=[],f=0;d>f;f++)e.push(a(b,c));return e}return a(b,c)}var f=Math.random,g={};g.integer=function(a,b,c){return e(d,a,b,c)},g.range=function(a,b,d){return e(c,a,b,d)},g.sign=function(a){return g.bool(a)?1:-1},g.bool=function(a){return a=void 0!==a?a:.5,f()<a},b.exports=g},{}],40:[function(a,b){var c={};c.clamp=function(a,b){return Math.max(Math.min(a,b[1]),b[0])},c.length=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c]*a[c];return Math.sqrt(b)},b.exports=c},{}],41:[function(a,b){function c(a,b,c){return 1===arguments.length&&void 0!==a?this.set(a):(this.x=a||0,this.y=b||0,this.z=c||0),this}function d(a,b,c){return this.x=a,this.y=b,this.z=c,this}function e(a){return d.call(this,a[0],a[1],a[2]||0)}function f(a){return d.call(this,a.x,a.y,a.z)}function g(a){return d.call(this,a,0,0)}var h=new c(0,0,0);c.prototype.add=function(a){return d.call(h,this.x+a.x,this.y+a.y,this.z+a.z)},c.prototype.sub=function(a){return d.call(h,this.x-a.x,this.y-a.y,this.z-a.z)},c.prototype.mult=function(a){return d.call(h,a*this.x,a*this.y,a*this.z)},c.prototype.div=function(a){return this.mult(1/a)},c.prototype.cross=function(a){var b=this.x,c=this.y,e=this.z,f=a.x,g=a.y,i=a.z;return d.call(h,e*g-c*i,b*i-e*f,c*f-b*g)},c.prototype.equals=function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},c.prototype.rotateX=function(a){var b=this.x,c=this.y,e=this.z,f=Math.cos(a),g=Math.sin(a);return d.call(h,b,c*f-e*g,c*g+e*f)},c.prototype.rotateY=function(a){var b=this.x,c=this.y,e=this.z,f=Math.cos(a),g=Math.sin(a);return d.call(h,e*g+b*f,c,e*f-b*g)},c.prototype.rotateZ=function(a){var b=this.x,c=this.y,e=this.z,f=Math.cos(a),g=Math.sin(a);return d.call(h,b*f-c*g,b*g+c*f,e)},c.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z},c.prototype.normSquared=function(){return this.dot(this)},c.prototype.norm=function(){return Math.sqrt(this.normSquared())},c.prototype.normalize=function(a){0===arguments.length&&(a=1);var b=this.norm();return b>1e-7?f.call(h,this.mult(a/b)):d.call(h,a,0,0)},c.prototype.clone=function(){return new c(this)},c.prototype.isZero=function(){return!(this.x||this.y||this.z)},c.prototype.set=function(a){return a instanceof Array?e.call(this,a):"number"==typeof a?g.call(this,a):f.call(this,a)},c.prototype.setXYZ=function(){return d.apply(this,arguments)},c.prototype.set1D=function(a){return g.call(this,a)},c.prototype.put=function(a){this===h?f.call(a,h):f.call(a,this)},c.prototype.clear=function(){return d.call(this,0,0,0)},c.prototype.cap=function i(i){if(1/0===i)return f.call(h,this);var a=this.norm();return a>i?f.call(h,this.mult(i/a)):f.call(h,this)},c.prototype.project=function(a){return a.mult(this.dot(a))},c.prototype.reflectAcross=function(a){return a.normalize().put(a),f(h,this.sub(this.project(a).mult(2)))},c.prototype.get=function(){return[this.x,this.y,this.z]},c.prototype.get1D=function(){return this.x},b.exports=c},{}],42:[function(a,b){b.exports={Matrix:a("./Matrix"),Quaternion:a("./Quaternion"),Random:a("./Random"),Utilities:a("./Utilities"),Vector:a("./Vector")}},{"./Matrix":37,"./Quaternion":38,"./Random":39,"./Utilities":40,"./Vector":41}],43:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),a&&this.setOptions(a),this._positionState=new j([0,0]),this._differential=[0,0],this._active=!0,this.sync=new m(["mouse","touch"],{scale:this.options.scale}),this.eventOutput=new k,k.setInputHandler(this,this.sync),k.setOutputHandler(this,this.eventOutput),h.call(this)}function d(a){var b=this.options,c=b.projection,d=b.snapX,e=b.snapY,f=c&p.x?a[0]:0,g=c&p.y?a[1]:0;return d>0&&(f-=f%d),e>0&&(g-=g%e),[f,g]}function e(){this._active&&(this._positionState.isActive()&&this._positionState.halt(),this.eventOutput.emit("start",{position:this.getPosition()}))}function f(a){if(this._active){var b=this.options;this._differential=a.position;var c=d.call(this,this._differential);this._differential[0]-=c[0],this._differential[1]-=c[1];var e=this.getPosition();if(e[0]+=c[0],e[1]+=c[1],b.xRange){var f=[b.xRange[0]+.5*b.snapX,b.xRange[1]-.5*b.snapX];e[0]=q(e[0],f)}if(b.yRange){var g=[b.yRange[0]+.5*b.snapY,b.yRange[1]-.5*b.snapY];e[1]=q(e[1],g)}this.eventOutput.emit("update",{position:e})}}function g(){this._active&&this.eventOutput.emit("end",{position:this.getPosition()})}function h(){this.sync.on("start",e.bind(this)),this.sync.on("update",f.bind(this)),this.sync.on("end",g.bind(this))}var i=a("../core/Transform"),j=a("../transitions/Transitionable"),k=a("../core/EventHandler"),l=a("../math/Utilities"),m=a("../inputs/GenericSync"),n=a("../inputs/MouseSync"),o=a("../inputs/TouchSync");m.register({mouse:n,touch:o});var p={x:1,y:2};c.DIRECTION_X=p.x,c.DIRECTION_Y=p.y;var q=l.clamp;c.DEFAULT_OPTIONS={projection:p.x|p.y,scale:1,xRange:null,yRange:null,snapX:0,snapY:0,transition:{duration:0}},c.prototype.setOptions=function(a){var b=this.options;if(void 0!==a.projection){var c=a.projection;this.options.projection=0,["x","y"].forEach(function(a){-1!==c.indexOf(a)&&(b.projection|=p[a])})}void 0!==a.scale&&(b.scale=a.scale,this.sync.setOptions({scale:a.scale})),void 0!==a.xRange&&(b.xRange=a.xRange),void 0!==a.yRange&&(b.yRange=a.yRange),void 0!==a.snapX&&(b.snapX=a.snapX),void 0!==a.snapY&&(b.snapY=a.snapY)},c.prototype.getPosition=function(){return this._positionState.get()},c.prototype.setRelativePosition=function(a,b,c){var d=this.getPosition(),e=[d[0]+a[0],d[1]+a[1]];this.setPosition(e,b,c)},c.prototype.setPosition=function(a,b,c){this._positionState.isActive()&&this._positionState.halt(),this._positionState.set(a,b,c)},c.prototype.activate=function(){this._active=!0},c.prototype.deactivate=function(){this._active=!1},c.prototype.toggle=function(){this._active=!this._active},c.prototype.modify=function(a){var b=this.getPosition();return{transform:i.translate(b[0],b[1]),target:a}},b.exports=c},{"../core/EventHandler":7,"../core/Transform":15,"../inputs/GenericSync":27,"../inputs/MouseSync":28,"../inputs/TouchSync":33,"../math/Utilities":40,"../transitions/Transitionable":88}],44:[function(a,b){function c(a,b){this.options=Object.create(c.DEFAULT_OPTIONS),this._optionsManager=new e(this.options),a&&this.setOptions(a),b||(b=0),this.transitionHelper=new d(b)}var d=a("../transitions/Transitionable"),e=a("../core/OptionsManager");c.DEFAULT_OPTIONS={cull:!1,transition:!0,pulseInTransition:!0,pulseOutTransition:!0},c.prototype.setOptions=function(a){return this._optionsManager.setOptions(a)},c.prototype.show=function(a,b){a=a||this.options.transition,this.set(1,a,b)},c.prototype.hide=function(a,b){a=a||this.options.transition,this.set(0,a,b)},c.prototype.set=function(a,b,c){this.halt(),this.transitionHelper.set(a,b,c)},c.prototype.halt=function(){this.transitionHelper.halt()},c.prototype.isVisible=function(){return this.transitionHelper.get()>0},c.prototype.modify=function(a){var b=this.transitionHelper.get();return this.options.cull&&!b?void 0:{opacity:b,target:a}},b.exports=c},{"../core/OptionsManager":10,"../transitions/Transitionable":88}],45:[function(a,b){function c(){this._chain=[],arguments.length&&this.addModifier.apply(this,arguments)}c.prototype.addModifier=function(){Array.prototype.push.apply(this._chain,arguments)},c.prototype.removeModifier=function(a){var b=this._chain.indexOf(a);0>b||this._chain.splice(b,1)},c.prototype.modify=function(a){for(var b=this._chain,c=a,d=0;d<b.length;d++)c=b[d].modify(c);return c},b.exports=c},{}],46:[function(a,b){function c(a){this._transformState=new g(e.identity),this._opacityState=new f(1),this._originState=new f([0,0]),this._alignState=new f([0,0]),this._sizeState=new f([0,0]),this._proportionsState=new f([0,0]),this._modifier=new d({transform:this._transformState,opacity:this._opacityState,origin:null,align:null,size:null,proportions:null}),this._hasOrigin=!1,this._hasAlign=!1,this._hasSize=!1,this._hasProportions=!1,a&&(a.transform&&this.setTransform(a.transform),void 0!==a.opacity&&this.setOpacity(a.opacity),a.origin&&this.setOrigin(a.origin),a.align&&this.setAlign(a.align),a.size&&this.setSize(a.size),a.proportions&&this.setProportions(a.proportions))}var d=a("../core/Modifier"),e=a("../core/Transform"),f=a("../transitions/Transitionable"),g=a("../transitions/TransitionableTransform");c.prototype.setTransform=function(a,b,c){return this._transformState.set(a,b,c),this},c.prototype.setOpacity=function(a,b,c){return this._opacityState.set(a,b,c),this},c.prototype.setOrigin=function(a,b,c){return null===a?(this._hasOrigin&&(this._modifier.originFrom(null),this._hasOrigin=!1),this):(this._hasOrigin||(this._hasOrigin=!0,this._modifier.originFrom(this._originState)),this._originState.set(a,b,c),this)},c.prototype.setAlign=function(a,b,c){return null===a?(this._hasAlign&&(this._modifier.alignFrom(null),this._hasAlign=!1),this):(this._hasAlign||(this._hasAlign=!0,this._modifier.alignFrom(this._alignState)),this._alignState.set(a,b,c),this)},c.prototype.setSize=function(a,b,c){return null===a?(this._hasSize&&(this._modifier.sizeFrom(null),this._hasSize=!1),this):(this._hasSize||(this._hasSize=!0,this._modifier.sizeFrom(this._sizeState)),this._sizeState.set(a,b,c),this)},c.prototype.setProportions=function(a,b,c){return null===a?(this._hasProportions&&(this._modifier.proportionsFrom(null),this._hasProportions=!1),this):(this._hasProportions||(this._hasProportions=!0,this._modifier.proportionsFrom(this._proportionsState)),this._proportionsState.set(a,b,c),this)},c.prototype.halt=function(){this._transformState.halt(),this._opacityState.halt(),this._originState.halt(),this._alignState.halt(),this._sizeState.halt(),this._proportionsState.halt()},c.prototype.getTransform=function(){return this._transformState.get()},c.prototype.getFinalTransform=function(){return this._transformState.getFinal()},c.prototype.getOpacity=function(){return this._opacityState.get()},c.prototype.getOrigin=function(){return this._hasOrigin?this._originState.get():null},c.prototype.getAlign=function(){return this._hasAlign?this._alignState.get():null},c.prototype.getSize=function(){return this._hasSize?this._sizeState.get():null},c.prototype.getProportions=function(){return this._hasProportions?this._proportionsState.get():null},c.prototype.modify=function(a){return this._modifier.modify(a)},b.exports=c},{"../core/Modifier":9,"../core/Transform":15,"../transitions/Transitionable":88,"../transitions/TransitionableTransform":89}],47:[function(a,b){b.exports={Draggable:a("./Draggable"),Fader:a("./Fader"),ModifierChain:a("./ModifierChain"),StateModifier:a("./StateModifier")}},{"./Draggable":43,"./Fader":44,"./ModifierChain":45,"./StateModifier":46}],48:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),a&&this.setOptions(a),this._particles=[],this._bodies=[],this._agentData={},this._forces=[],this._constraints=[],this._buffer=0,this._prevTime=v(),this._isSleeping=!1,this._eventHandler=null,this._currAgentId=0,this._hasBodies=!1,this._eventHandler=null}function d(a){return a.applyForce?this._forces:a.applyConstraint?this._constraints:void 0}function e(a,b,c){return void 0===b&&(b=this.getParticlesAndBodies()),b instanceof Array||(b=[b]),a.on("change",this.wake.bind(this)),this._agentData[this._currAgentId]={agent:a,id:this._currAgentId,targets:b,source:c},d.call(this,a).push(this._currAgentId),this._currAgentId++}function f(a){return this._agentData[a]}function g(a){var b=f.call(this,this._forces[a]);b.agent.applyForce(b.targets,b.source)}function h(){for(var a=this._forces.length-1;a>-1;a--)g.call(this,a)}function i(a,b){var c=this._agentData[this._constraints[a]];return c.agent.applyConstraint(c.targets,c.source,b)}function j(a){for(var b=0;b<this.options.constraintSteps;){for(var c=this._constraints.length-1;c>-1;c--)i.call(this,c,a);b++}}function k(a,b){a.integrateVelocity(b),this.options.velocityCap&&a.velocity.cap(this.options.velocityCap).put(a.velocity)}function l(a,b){a.integrateAngularMomentum(b),a.updateAngularVelocity(),this.options.angularVelocityCap&&a.angularVelocity.cap(this.options.angularVelocityCap).put(a.angularVelocity)}function m(a,b){a.integrateOrientation(b)}function n(a,b){a.integratePosition(b),a.emit(w.update,a)}function o(a){h.call(this,a),this.forEach(k,a),this.forEachBody(l,a),j.call(this,a),this.forEachBody(m,a),this.forEach(n,a)}function p(){var a=0,b=0;return this.forEach(function(c){b=c.getEnergy(),a+=b}),a}function q(){var a=0;for(var b in this._agentData)a+=this.getAgentEnergy(b);return a}var r=a("../core/EventHandler"),s=17,t=1e3/120,u=17,v=Date.now,w={start:"start",update:"update",end:"end"};c.DEFAULT_OPTIONS={constraintSteps:1,sleepTolerance:1e-7,velocityCap:void 0,angularVelocityCap:void 0},c.prototype.setOptions=function(a){for(var b in a)this.options[b]&&(this.options[b]=a[b])},c.prototype.addBody=function(a){return a._engine=this,a.isBody?(this._bodies.push(a),this._hasBodies=!0):this._particles.push(a),a.on("start",this.wake.bind(this)),a},c.prototype.removeBody=function(a){var b=a.isBody?this._bodies:this._particles,c=b.indexOf(a);if(c>-1){for(var d in this._agentData)this._agentData.hasOwnProperty(d)&&this.detachFrom(this._agentData[d].id,a);b.splice(c,1)}0===this.getBodies().length&&(this._hasBodies=!1)},c.prototype.attach=function(a,b,c){if(this.wake(),a instanceof Array){for(var d=[],f=0;f<a.length;f++)d[f]=e.call(this,a[f],b,c);return d}return e.call(this,a,b,c)},c.prototype.attachTo=function(a,b){f.call(this,a).targets.push(b)},c.prototype.detach=function(a){var b=this.getAgent(a),c=d.call(this,b),e=c.indexOf(a);c.splice(e,1),delete this._agentData[a]},c.prototype.detachFrom=function(a,b){var c=f.call(this,a);if(c.source===b)this.detach(a);else{var d=c.targets,e=d.indexOf(b);e>-1&&d.splice(e,1)}},c.prototype.detachAll=function(){this._agentData={},this._forces=[],this._constraints=[],this._currAgentId=0},c.prototype.getAgent=function(a){return f.call(this,a).agent},c.prototype.getParticles=function(){return this._particles},c.prototype.getBodies=function(){return this._bodies},c.prototype.getParticlesAndBodies=function(){return this.getParticles().concat(this.getBodies())},c.prototype.forEachParticle=function(a,b){for(var c=this.getParticles(),d=0,e=c.length;e>d;d++)a.call(this,c[d],b)},c.prototype.forEachBody=function(a,b){if(this._hasBodies)for(var c=this.getBodies(),d=0,e=c.length;e>d;d++)a.call(this,c[d],b)},c.prototype.forEach=function(a,b){this.forEachParticle(a,b),this.forEachBody(a,b)},c.prototype.getAgentEnergy=function(a){var b=f.call(this,a);return b.agent.getEnergy(b.targets,b.source)},c.prototype.getEnergy=function(){return p.call(this)+q.call(this)},c.prototype.step=function(){if(!this.isSleeping()){var a=v(),b=a-this._prevTime;this._prevTime=a,t>b||(b>u&&(b=u),o.call(this,s),this.emit(w.update,this),this.getEnergy()<this.options.sleepTolerance&&this.sleep())}},c.prototype.isSleeping=function(){return this._isSleeping},c.prototype.isActive=function(){return!this._isSleeping},c.prototype.sleep=function(){this._isSleeping||(this.forEach(function(a){a.sleep()}),this.emit(w.end,this),this._isSleeping=!0)},c.prototype.wake=function(){this._isSleeping&&(this._prevTime=v(),this.emit(w.start,this),this._isSleeping=!1)},c.prototype.emit=function(a,b){null!==this._eventHandler&&this._eventHandler.emit(a,b)},c.prototype.on=function(a,b){null===this._eventHandler&&(this._eventHandler=new r),this._eventHandler.on(a,b)},b.exports=c},{"../core/EventHandler":7}],49:[function(a,b){function c(a){d.call(this,a),a=a||{},this.orientation=new g,this.angularVelocity=new f,this.angularMomentum=new f,this.torque=new f,a.orientation&&this.orientation.set(a.orientation),a.angularVelocity&&this.angularVelocity.set(a.angularVelocity),a.angularMomentum&&this.angularMomentum.set(a.angularMomentum),a.torque&&this.torque.set(a.torque),this.angularVelocity.w=0,this.setMomentsOfInertia(),this.pWorld=new f}var d=a("./Particle"),e=a("../../core/Transform"),f=a("../../math/Vector"),g=a("../../math/Quaternion"),h=a("../../math/Matrix"),i=a("../integrators/SymplecticEuler");c.DEFAULT_OPTIONS=d.DEFAULT_OPTIONS,c.DEFAULT_OPTIONS.orientation=[0,0,0,1],c.DEFAULT_OPTIONS.angularVelocity=[0,0,0],c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.isBody=!0,c.prototype.setMass=function(){d.prototype.setMass.apply(this,arguments),this.setMomentsOfInertia()},c.prototype.setMomentsOfInertia=function(){this.inertia=new h,this.inverseInertia=new h},c.prototype.updateAngularVelocity=function(){this.angularVelocity.set(this.inverseInertia.vectorMultiply(this.angularMomentum))},c.prototype.toWorldCoordinates=function(a){return this.pWorld.set(this.orientation.rotateVector(a))},c.prototype.getEnergy=function(){return d.prototype.getEnergy.call(this)+.5*this.inertia.vectorMultiply(this.angularVelocity).dot(this.angularVelocity)},c.prototype.reset=function(a,b,c,e){d.prototype.reset.call(this,a,b),this.angularVelocity.clear(),this.setOrientation(c||[1,0,0,0]),this.setAngularMomentum(e||[0,0,0])},c.prototype.setOrientation=function(a){this.orientation.set(a)},c.prototype.setAngularVelocity=function(a){this.wake(),this.angularVelocity.set(a)},c.prototype.setAngularMomentum=function(a){this.wake(),this.angularMomentum.set(a)},c.prototype.applyForce=function(a,b){d.prototype.applyForce.call(this,a),void 0!==b&&this.applyTorque(b.cross(a))},c.prototype.applyTorque=function(a){this.wake(),this.torque.set(this.torque.add(a))},c.prototype.getTransform=function(){return e.thenMove(this.orientation.getTransform(),e.getTranslate(d.prototype.getTransform.call(this)))},c.prototype._integrate=function(a){d.prototype._integrate.call(this,a),this.integrateAngularMomentum(a),this.updateAngularVelocity(a),this.integrateOrientation(a)},c.prototype.integrateAngularMomentum=function(a){i.integrateAngularMomentum(this,a)},c.prototype.integrateOrientation=function(a){i.integrateOrientation(this,a)},b.exports=c},{"../../core/Transform":15,"../../math/Matrix":37,"../../math/Quaternion":38,"../../math/Vector":41,"../integrators/SymplecticEuler":72,"./Particle":51}],50:[function(a,b){function c(a){a=a||{},this.setRadius(a.radius||0),d.call(this,a)}var d=a("./Body"),e=a("../../math/Matrix");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.setRadius=function(a){this.radius=a,this.size=[2*this.radius,2*this.radius],this.setMomentsOfInertia()},c.prototype.setMomentsOfInertia=function(){var a=this.mass,b=this.radius;this.inertia=new e([[.25*a*b*b,0,0],[0,.25*a*b*b,0],[0,0,.5*a*b*b]]),this.inverseInertia=new e([[4/(a*b*b),0,0],[0,4/(a*b*b),0],[0,0,2/(a*b*b)]])},b.exports=c},{"../../math/Matrix":37,"./Body":49}],51:[function(a,b){function c(a){a=a||{};var b=c.DEFAULT_OPTIONS;this.position=new e,this.velocity=new e,this.force=new e,this._engine=null,this._isSleeping=!0,this._eventOutput=null,this.mass=void 0!==a.mass?a.mass:b.mass,this.inverseMass=1/this.mass,this.setPosition(a.position||b.position),this.setVelocity(a.velocity||b.velocity),this.force.set(a.force||[0,0,0]),this.transform=f.identity.slice(),this._spec={size:[!0,!0],target:{transform:this.transform,origin:[.5,.5],target:null}}}function d(){this._eventOutput=new g,this._eventOutput.bindThis(this),g.setOutputHandler(this,this._eventOutput)}var e=a("../../math/Vector"),f=a("../../core/Transform"),g=a("../../core/EventHandler"),h=a("../integrators/SymplecticEuler");c.DEFAULT_OPTIONS={position:[0,0,0],velocity:[0,0,0],mass:1};var i={start:"start",update:"update",end:"end"},j=Date.now;c.prototype.isBody=!1,c.prototype.isActive=function(){return!this._isSleeping},c.prototype.sleep=function(){this._isSleeping||(this.emit(i.end,this),this._isSleeping=!0)},c.prototype.wake=function(){this._isSleeping&&(this.emit(i.start,this),this._isSleeping=!1,this._prevTime=j(),this._engine&&this._engine.wake())},c.prototype.setPosition=function(a){this.position.set(a)},c.prototype.setPosition1D=function(a){this.position.x=a},c.prototype.getPosition=function(){return this._engine.step(),this.position.get()},c.prototype.getPosition1D=function(){return this._engine.step(),this.position.x},c.prototype.setVelocity=function(a){this.velocity.set(a),(0!==a[0]||0!==a[1]||0!==a[2])&&this.wake()},c.prototype.setVelocity1D=function(a){this.velocity.x=a,0!==a&&this.wake()},c.prototype.getVelocity=function(){return this.velocity.get()},c.prototype.setForce=function(a){this.force.set(a),this.wake()},c.prototype.getVelocity1D=function(){return this.velocity.x},c.prototype.setMass=function(a){this.mass=a,this.inverseMass=1/a},c.prototype.getMass=function(){return this.mass},c.prototype.reset=function(a,b){this.setPosition(a||[0,0,0]),this.setVelocity(b||[0,0,0])},c.prototype.applyForce=function(a){a.isZero()||(this.force.add(a).put(this.force),this.wake())},c.prototype.applyImpulse=function(a){if(!a.isZero()){var b=this.velocity;b.add(a.mult(this.inverseMass)).put(b)}},c.prototype.integrateVelocity=function(a){h.integrateVelocity(this,a)},c.prototype.integratePosition=function(a){h.integratePosition(this,a)},c.prototype._integrate=function(a){this.integrateVelocity(a),this.integratePosition(a)},c.prototype.getEnergy=function(){return.5*this.mass*this.velocity.normSquared()},c.prototype.getTransform=function(){this._engine.step();var a=this.position,b=this.transform;return b[12]=a.x,b[13]=a.y,b[14]=a.z,b},c.prototype.modify=function(a){var b=this._spec.target;return b.transform=this.getTransform(),b.target=a,this._spec},c.prototype.emit=function(a,b){this._eventOutput&&this._eventOutput.emit(a,b)},c.prototype.on=function(){return d.call(this),this.on.apply(this,arguments)},c.prototype.removeListener=function(){return d.call(this),this.removeListener.apply(this,arguments)},c.prototype.pipe=function(){return d.call(this),this.pipe.apply(this,arguments)},c.prototype.unpipe=function(){return d.call(this),this.unpipe.apply(this,arguments)},b.exports=c},{"../../core/EventHandler":7,"../../core/Transform":15,"../../math/Vector":41,"../integrators/SymplecticEuler":72}],52:[function(a,b){function c(a){a=a||{},this.size=a.size||[0,0],d.call(this,a)}var d=a("./Body"),e=a("../../math/Matrix");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.setSize=function(a){this.size=a,this.setMomentsOfInertia()},c.prototype.setMomentsOfInertia=function(){var a=this.mass,b=this.size[0],c=this.size[1];this.inertia=new e([[a*c*c/12,0,0],[0,a*b*b/12,0],[0,0,a*(b*b+c*c)/12]]),this.inverseInertia=new e([[12/(a*c*c),0,0],[0,12/(a*b*b),0],[0,0,12/(a*(b*b+c*c))]])},b.exports=c},{"../../math/Matrix":37,"./Body":49}],53:[function(a,b){b.exports={Body:a("./Body"),Circle:a("./Circle"),Particle:a("./Particle"),Rectangle:a("./Rectangle")}},{"./Body":49,"./Circle":50,"./Particle":51,"./Rectangle":52}],54:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),a&&this.setOptions(a),this.normal=new e,this.pDiff=new e,this.vDiff=new e,this.impulse1=new e,this.impulse2=new e,d.call(this)}var d=a("./Constraint"),e=a("../../math/Vector");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.DEFAULT_OPTIONS={restitution:.5,drift:.5,slop:0},c.prototype.setOptions=function(a){
for(var b in a)this.options[b]=a[b]},c.prototype.applyConstraint=function(a,b,c){if(void 0!==b)for(var d=b.velocity,e=b.position,f=b.inverseMass,g=b.radius,h=this.options,i=h.drift,j=-h.slop,k=h.restitution,l=this.normal,m=this.pDiff,n=this.vDiff,o=this.impulse1,p=this.impulse2,q=0;q<a.length;q++){var r=a[q];if(r!==b){var s=r.velocity,t=r.position,u=r.inverseMass,v=r.radius;m.set(t.sub(e)),n.set(s.sub(d));var w=m.norm(),x=w-(g+v),y=1/(f+u),z=0;if(0>x){if(l.set(m.normalize()),this._eventOutput){var A={target:r,source:b,overlap:x,normal:l};this._eventOutput.emit("preCollision",A),this._eventOutput.emit("collision",A)}var B=j>=x?((1+k)*l.dot(n)+i/c*(x-j))/(z+c/y):(1+k)*l.dot(n)/(z+c/y);l.mult(c*B).put(o),o.mult(-1).put(p),b.applyImpulse(o),r.applyImpulse(p),this._eventOutput&&this._eventOutput.emit("postCollision",A)}}}},b.exports=c},{"../../math/Vector":41,"./Constraint":55}],55:[function(a,b){function c(){this.options=this.options||{},this._eventOutput=new d,d.setOutputHandler(this,this._eventOutput)}var d=a("../../core/EventHandler");c.prototype.setOptions=function(a){this._eventOutput.emit("change",a)},c.prototype.applyConstraint=function(){},c.prototype.getEnergy=function(){return 0},b.exports=c},{"../../core/EventHandler":7}],56:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),a&&this.setOptions(a),this.J=new e,this.impulse=new e,d.call(this)}var d=a("./Constraint"),e=a("../../math/Vector");c.prototype=Object.create(d.prototype),c.prototype.constructor=c;var f=1e-7,g=Math.PI;c.DEFAULT_OPTIONS={equation:function(){return 0},plane:function(a,b,c){return c},period:0,dampingRatio:0},c.prototype.setOptions=function(a){for(var b in a)this.options[b]=a[b]},c.prototype.applyConstraint=function(a,b,c){for(var d=this.options,e=this.impulse,h=this.J,i=d.equation,j=d.plane,k=d.dampingRatio,l=d.period,m=0;m<a.length;m++){var n,o,p=a[m],q=p.velocity,r=p.position,s=p.mass;if(0===l)n=0,o=1;else{var t=4*s*g*k/l,u=4*s*g*g/(l*l);n=1/(t+c*u),o=c*u/(t+c*u)}var v=r.x,w=r.y,x=r.z,y=i(v,w,x),z=(i(v+f,w,x)-y)/f,A=(i(v,w+f,x)-y)/f,B=(i(v,w,x+f)-y)/f,C=j(v,w,x),D=(j(v+f,w,x)-C)/f,E=(j(v,w+f,x)-C)/f,F=(j(v,w,x+f)-C)/f;h.setXYZ(z+D,A+E,B+F);var G=o/c*(y+C),H=-(h.dot(q)+G)/(n+c*h.normSquared()/s);e.set(h.mult(c*H)),p.applyImpulse(e)}},b.exports=c},{"../../math/Vector":41,"./Constraint":55}],57:[function(a,b){function c(a){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),a&&this.setOptions(a),this.impulse=new e,this.normal=new e,this.diffP=new e,this.diffV=new e,d.call(this)}var d=a("./Constraint"),e=a("../../math/Vector");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.DEFAULT_OPTIONS={anchor:null,length:0,minLength:0,period:0,dampingRatio:0};var f=Math.PI;c.prototype.setOptions=function(a){a.anchor&&(a.anchor.position instanceof e&&(this.options.anchor=a.anchor.position),a.anchor instanceof e&&(this.options.anchor=a.anchor),a.anchor instanceof Array&&(this.options.anchor=new e(a.anchor))),void 0!==a.length&&(this.options.length=a.length),void 0!==a.dampingRatio&&(this.options.dampingRatio=a.dampingRatio),void 0!==a.period&&(this.options.period=a.period),void 0!==a.minLength&&(this.options.minLength=a.minLength)},c.prototype.setAnchor=function(a){this.options.anchor||(this.options.anchor=new e),this.options.anchor.set(a)},c.prototype.applyConstraint=function(a,b,c){var d,e,g=this.normal,h=this.diffP,i=this.diffV,j=this.impulse,k=this.options,l=k.dampingRatio,m=k.period,n=k.minLength;if(b){var o=b.velocity;d=b.position,e=b.inverseMass}else d=this.options.anchor,e=0;for(var p=this.options.length,q=0;q<a.length;q++){var r=a[q],s=r.velocity,t=r.position,u=r.inverseMass;h.set(t.sub(d)),g.set(h.normalize());var v=h.norm()-p;if(Math.abs(v)<n)return;b?i.set(s.sub(o)):i.set(s);var w,x,y=1/(u+e);if(0===m)w=0,x=1;else{var z=4*y*f*l/m,A=4*y*f*f/(m*m);w=1/(z+c*A),x=c*A/(z+c*A)}var B=x/c*v,C=-(g.dot(i)+B)/(w+c/y);j.set(g.mult(c*C)),r.applyImpulse(j),b&&b.applyImpulse(j.mult(-1))}},b.exports=c},{"../../math/Vector":41,"./Constraint":55}],58:[function(a,b){function c(a){d.call(this),this.options=Object.create(this.constructor.DEFAULT_OPTIONS),a&&this.setOptions(a),this.pDiff=new e,this.vDiff=new e,this.impulse1=new e,this.impulse2=new e}var d=a("./Constraint"),e=a("../../math/Vector");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.DEFAULT_OPTIONS={period:300,dampingRatio:.1,length:0,anchor:void 0};var f=Math.PI;c.prototype.setOptions=function(a){void 0!==a.anchor&&(a.anchor instanceof e&&(this.options.anchor=a.anchor),a.anchor.position instanceof e&&(this.options.anchor=a.anchor.position),a.anchor instanceof Array&&(this.options.anchor=new e(a.anchor))),void 0!==a.length&&(this.options.length=a.length),void 0!==a.dampingRatio&&(this.options.dampingRatio=a.dampingRatio),void 0!==a.period&&(this.options.period=a.period),d.prototype.setOptions.call(this,a)},c.prototype.getEnergy=function(a,b){for(var c=this.options,d=c.length,e=c.anchor||b.position,g=Math.pow(2*f/c.period,2),h=0,i=0;i<a.length;i++){var j=a[i],k=e.sub(j.position).norm()-d;h+=.5*g*k*k}return h},c.prototype.applyConstraint=function(a,b,c){for(var d=this.options,e=this.pDiff,g=this.vDiff,h=this.impulse1,i=this.impulse2,j=d.length,k=d.anchor||b.position,l=d.period,m=d.dampingRatio,n=0;n<a.length;n++){var o=a[n],p=o.position,q=o.velocity,r=o.mass,s=o.inverseMass;e.set(p.sub(k));var t,u=e.norm()-j;if(b){var v=b.inverseMass,w=b.velocity;g.set(q.sub(w)),t=1/(s+v)}else g.set(q),t=r;var x,y;if(0===this.options.period)x=0,y=1;else{var z=4*t*f*f/(l*l),A=4*t*f*m/l;y=c*z/(A+c*z),x=1/(A+c*z)}var B=y/c*u;e.normalize(-B).sub(g).mult(c/(x+c/t)).put(h),o.applyImpulse(h),b&&(h.mult(-1).put(i),b.applyImpulse(i))}},b.exports=c},{"../../math/Vector":41,"./Constraint":55}],59:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),a&&this.setOptions(a),this.J=new e,this.impulse=new e,d.call(this)}var d=a("./Constraint"),e=a("../../math/Vector");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.DEFAULT_OPTIONS={equation:void 0,period:0,dampingRatio:0};var f=1e-7,g=Math.PI;c.prototype.setOptions=function(a){for(var b in a)this.options[b]=a[b]},c.prototype.applyConstraint=function(a,b,c){for(var d=this.impulse,e=this.J,h=this.options,i=h.equation,j=h.dampingRatio,k=h.period,l=0;l<a.length;l++){var m,n,o=a[l],p=o.velocity,q=o.position,r=o.mass;if(0===k)m=0,n=1;else{var s=4*r*g*j/k,t=4*r*g*g/(k*k);m=1/(s+c*t),n=c*t/(s+c*t)}var u=q.x,v=q.y,w=q.z,x=i(u,v,w),y=(i(u+f,q,q)-x)/f,z=(i(u,v+f,q)-x)/f,A=(i(u,v,q+f)-x)/f;e.setXYZ(y,z,A);var B=n/c*x,C=-(e.dot(p)+B)/(m+c*e.normSquared()/r);d.set(e.mult(c*C)),o.applyImpulse(d)}},b.exports=c},{"../../math/Vector":41,"./Constraint":55}],60:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),a&&this.setOptions(a),this.diff=new i,this.impulse=new i,h.call(this)}function d(a,b){return b.dot(a)}function e(a){var b=this.options.normal,c=this.options.distance;return a.dot(b)+c}function f(a,b,d){var e=a.position,f=a.velocity,g=a.mass,h=this.options.normal,i=this.options.onContact,j=this.options.restitution,k=this.impulse,l=this.options.drift,m=-this.options.slop,n=0;if(this._eventOutput){var o={particle:a,wall:this,overlap:b,normal:h};this._eventOutput.emit("preCollision",o),this._eventOutput.emit("collision",o)}switch(i){case c.ON_CONTACT.REFLECT:var p=m>b?-((1+j)*h.dot(f)+l/d*(b-m))/(g*d+n):-((1+j)*h.dot(f))/(g*d+n);k.set(h.mult(d*p)),a.applyImpulse(k),a.setPosition(e.add(h.mult(-b)))}this._eventOutput&&this._eventOutput.emit("postCollision",o)}function g(a,b){var d=this.options.onContact,e=a.position,f=this.options.normal;d===c.ON_CONTACT.REFLECT&&a.setPosition(e.add(f.mult(-b)))}var h=a("./Constraint"),i=a("../../math/Vector");c.prototype=Object.create(h.prototype),c.prototype.constructor=c,c.ON_CONTACT={REFLECT:0,SILENT:1},c.DEFAULT_OPTIONS={restitution:.5,drift:.5,slop:0,normal:[1,0,0],distance:0,onContact:c.ON_CONTACT.REFLECT},c.prototype.setOptions=function(a){void 0!==a.normal&&(a.normal instanceof i&&(this.options.normal=a.normal.clone()),a.normal instanceof Array&&(this.options.normal=new i(a.normal))),void 0!==a.restitution&&(this.options.restitution=a.restitution),void 0!==a.drift&&(this.options.drift=a.drift),void 0!==a.slop&&(this.options.slop=a.slop),void 0!==a.distance&&(this.options.distance=a.distance),void 0!==a.onContact&&(this.options.onContact=a.onContact)},c.prototype.applyConstraint=function(a,b,c){for(var h=this.options.normal,i=0;i<a.length;i++){var j=a[i],k=j.position,l=j.velocity,m=j.radius||0,n=e.call(this,k.add(h.mult(-m))),o=d.call(this,h,l);0>=n&&(0>o?f.call(this,j,n,c):g.call(this,j,n,c))}},b.exports=c},{"../../math/Vector":41,"./Constraint":55}],61:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),a&&this.setOptions(a),e.call(this,a.sides||this.options.sides),g.call(this)}function d(a,b,d){var e,f=c.SIDES;switch(parseInt(a)){case f.LEFT:e=b[0]*d[0];break;case f.TOP:e=b[1]*d[1];break;case f.FRONT:e=b[2]*d[2];break;case f.RIGHT:e=b[0]*(1-d[0]);break;case f.BOTTOM:e=b[1]*(1-d[1]);break;case f.BACK:e=b[2]*(1-d[2])}return e}function e(a){this.components={};for(var b=this.components,c=0;c<a.length;c++){var e=a[c];b[c]=new h({normal:j[e].clone(),distance:d(e,this.options.size,this.options.origin)})}}function f(a){this.forEach(function(b){b.setOptions(a)});for(var b in a)this.options[b]=a[b]}var g=a("./Constraint"),h=a("./Wall"),i=a("../../math/Vector");c.prototype=Object.create(g.prototype),c.prototype.constructor=c,c.ON_CONTACT=h.ON_CONTACT,c.SIDES={LEFT:0,RIGHT:1,TOP:2,BOTTOM:3,FRONT:4,BACK:5,TWO_DIMENSIONAL:[0,1,2,3],THREE_DIMENSIONAL:[0,1,2,3,4,5]},c.DEFAULT_OPTIONS={sides:c.SIDES.TWO_DIMENSIONAL,size:[window.innerWidth,window.innerHeight,0],origin:[.5,.5,.5],drift:.5,slop:0,restitution:.5,onContact:c.ON_CONTACT.REFLECT};var j={0:new i(1,0,0),1:new i(-1,0,0),2:new i(0,1,0),3:new i(0,-1,0),4:new i(0,0,1),5:new i(0,0,-1)};c.prototype.setOptions=function(a){var b=!1;void 0!==a.restitution&&f.call(this,{restitution:a.restitution}),void 0!==a.drift&&f.call(this,{drift:a.drift}),void 0!==a.slop&&f.call(this,{slop:a.slop}),void 0!==a.onContact&&f.call(this,{onContact:a.onContact}),void 0!==a.size&&(b=!0),void 0!==a.sides&&(this.options.sides=a.sides),void 0!==a.origin&&(b=!0),b&&this.setSize(a.size,a.origin)},c.prototype.setSize=function(a,b){b=b||this.options.origin,b.length<3&&(b[2]=.5),this.forEach(function(c,e){var f=d(e,a,b);c.setOptions({distance:f})}),this.options.size=a,this.options.origin=b},c.prototype.applyConstraint=function(a,b,c){this.forEach(function(d){d.applyConstraint(a,b,c)})},c.prototype.forEach=function(a){var b=this.options.sides;for(var c in this.sides)a(b[c],c)},c.prototype.rotateZ=function(a){this.forEach(function(b){var c=b.options.normal;c.rotateZ(a).put(c)})},c.prototype.rotateX=function(a){this.forEach(function(b){var c=b.options.normal;c.rotateX(a).put(c)})},c.prototype.rotateY=function(a){this.forEach(function(b){var c=b.options.normal;c.rotateY(a).put(c)})},c.prototype.reset=function(){var a=this.options.sides;for(var b in a){var c=this.components[b];c.options.normal.set(j[b])}},b.exports=c},{"../../math/Vector":41,"./Constraint":55,"./Wall":60}],62:[function(a,b){b.exports={Collision:a("./Collision"),Constraint:a("./Constraint"),Curve:a("./Curve"),Distance:a("./Distance"),Snap:a("./Snap"),Surface:a("./Surface"),Wall:a("./Wall"),Walls:a("./Walls")}},{"./Collision":54,"./Constraint":55,"./Curve":56,"./Distance":57,"./Snap":58,"./Surface":59,"./Wall":60,"./Walls":61}],63:[function(a,b){function c(a){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),a&&this.setOptions(a),d.call(this)}var d=a("./Force");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.FORCE_FUNCTIONS={LINEAR:function(a){return a},QUADRATIC:function(a){return a.mult(a.norm())}},c.DEFAULT_OPTIONS={strength:.01,forceFunction:c.FORCE_FUNCTIONS.LINEAR},c.prototype.applyForce=function(a){var b,c,d=this.options.strength,e=this.options.forceFunction,f=this.force;for(b=0;b<a.length;b++)c=a[b],e(c.velocity).mult(-d).put(f),c.applyForce(f)},c.prototype.setOptions=function(a){for(var b in a)this.options[b]=a[b]},b.exports=c},{"./Force":64}],64:[function(a,b){function c(a){this.force=new d(a),this._eventOutput=new e,e.setOutputHandler(this,this._eventOutput)}var d=a("../../math/Vector"),e=a("../../core/EventHandler");c.prototype.setOptions=function(a){this._eventOutput.emit("change",a)},c.prototype.applyForce=function(a){for(var b=a.length;b--;)a[b].applyForce(this.force)},c.prototype.getEnergy=function(){return 0},b.exports=c},{"../../core/EventHandler":7,"../../math/Vector":41}],65:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),a&&this.setOptions(a),this.disp=new e,d.call(this)}var d=a("./Force"),e=a("../../math/Vector");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.DECAY_FUNCTIONS={LINEAR:function(a,b){return Math.max(1-1/b*a,0)},MORSE:function(a,b){var c=0===b?100:b,d=a+c*(1-Math.log(2));return Math.max(1-Math.pow(1-Math.exp(d/c-1),2),0)},INVERSE:function(a,b){return 1/(1-b+a)},GRAVITY:function(a,b){return 1/(1-b+a*a)}},c.DEFAULT_OPTIONS={strength:1,anchor:void 0,range:[0,1/0],cutoff:0,cap:1/0,decayFunction:c.DECAY_FUNCTIONS.GRAVITY},c.prototype.setOptions=function(a){void 0!==a.anchor&&(a.anchor.position instanceof e&&(this.options.anchor=a.anchor.position),a.anchor instanceof Array&&(this.options.anchor=new e(a.anchor)),delete a.anchor);for(var b in a)this.options[b]=a[b]},c.prototype.applyForce=function(a,b){var c=this.options,d=this.force,e=this.disp,f=c.strength,g=c.anchor||b.position,h=c.cap,i=c.cutoff,j=c.range[0],k=c.range[1],l=c.decayFunction;if(0!==f)for(var m,n,o,p,q=a.length;q--;)m=a[q],m!==b&&(n=m.mass,o=m.position,e.set(o.sub(g)),p=e.norm(),k>p&&p>j&&(d.set(e.normalize(f*n*l(p,i)).cap(h)),m.applyForce(d)))},b.exports=c},{"../../math/Vector":41,"./Force":64}],66:[function(a,b){function c(a){d.call(this,a)}var d=a("./Drag");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.DEFAULT_OPTIONS=d.DEFAULT_OPTIONS,c.FORCE_FUNCTIONS=d.FORCE_FUNCTIONS,c.FORCE_FUNCTIONS={LINEAR:function(a){return a},QUADRATIC:function(a){return a.mult(a.norm())}},c.prototype.applyForce=function(a){var b,c,d=this.options.strength,e=this.options.forceFunction,f=this.force;for(b=0;b<a.length;b++)c=a[b],e(c.angularVelocity).mult(-100*d).put(f),c.applyTorque(f)},c.prototype.setOptions=function(a){for(var b in a)this.options[b]=a[b]},b.exports=c},{"./Drag":63}],67:[function(a,b){function c(a){h.call(this,a)}function d(){var a=this.options;a.stiffness=Math.pow(2*j/a.period,2)}function e(){var a=this.options;a.damping=4*j*a.dampingRatio/a.period}function f(){d.call(this),e.call(this)}var g=a("./Force"),h=a("./Spring"),i=a("../../math/Quaternion");c.prototype=Object.create(h.prototype),c.prototype.constructor=c,c.DEFAULT_OPTIONS=h.DEFAULT_OPTIONS,c.FORCE_FUNCTIONS=h.FORCE_FUNCTIONS;var j=Math.PI;c.prototype.setOptions=function(a){void 0!==a.anchor&&(a.anchor instanceof i&&(this.options.anchor=a.anchor),a.anchor instanceof Array&&(this.options.anchor=new i(a.anchor))),void 0!==a.period&&(this.options.period=a.period),void 0!==a.dampingRatio&&(this.options.dampingRatio=a.dampingRatio),void 0!==a.length&&(this.options.length=a.length),void 0!==a.forceFunction&&(this.options.forceFunction=a.forceFunction),void 0!==a.maxLength&&(this.options.maxLength=a.maxLength),f.call(this),g.prototype.setOptions.call(this,a)},c.prototype.applyForce=function(a){var b,c,d,e,f=this.force,g=this.options,h=this.disp,i=g.stiffness,j=g.damping,k=g.length,l=g.anchor,m=g.forceFunction,n=g.maxLength;for(b=0;b<a.length;b++){if(c=a[b],h.set(l.sub(c.orientation)),d=h.norm()-k,0===d)return;e=c.mass,i*=e,j*=e,f.set(h.normalize(i*m(d,n))),j&&f.add(c.angularVelocity.mult(-j)).put(f),c.applyTorque(f)}},c.prototype.getEnergy=function(a){for(var b=this.options,c=b.length,d=b.anchor,e=b.stiffness,f=0,g=0;g<a.length;g++){var h=a[g],i=d.sub(h.orientation).norm()-c;f+=.5*e*i*i}return f},b.exports=c},{"../../math/Quaternion":38,"./Force":64,"./Spring":68}],68:[function(a,b){function c(a){g.call(this),this.options=Object.create(this.constructor.DEFAULT_OPTIONS),a&&this.setOptions(a),this.disp=new h(0,0,0),f.call(this)}function d(){var a=this.options;a.stiffness=Math.pow(2*i/a.period,2)}function e(){var a=this.options;a.damping=4*i*a.dampingRatio/a.period}function f(){d.call(this),e.call(this)}var g=a("./Force"),h=a("../../math/Vector");c.prototype=Object.create(g.prototype),c.prototype.constructor=c;var i=Math.PI,j=150;c.FORCE_FUNCTIONS={FENE:function(a,b){var c=.99*b,d=Math.max(Math.min(a,c),-c);return d/(1-d*d/(b*b))},HOOK:function(a){return a}},c.DEFAULT_OPTIONS={period:300,dampingRatio:.1,length:0,maxLength:1/0,anchor:void 0,forceFunction:c.FORCE_FUNCTIONS.HOOK},c.prototype.setOptions=function(a){void 0!==a.anchor&&(a.anchor.position instanceof h&&(this.options.anchor=a.anchor.position),a.anchor instanceof h&&(this.options.anchor=a.anchor),a.anchor instanceof Array&&(this.options.anchor=new h(a.anchor))),void 0!==a.period&&(a.period<j&&(a.period=j,console.warn("The period of a SpringTransition is capped at "+j+" ms. Use a SnapTransition for faster transitions")),this.options.period=a.period),void 0!==a.dampingRatio&&(this.options.dampingRatio=a.dampingRatio),void 0!==a.length&&(this.options.length=a.length),void 0!==a.forceFunction&&(this.options.forceFunction=a.forceFunction),void 0!==a.maxLength&&(this.options.maxLength=a.maxLength),f.call(this),g.prototype.setOptions.call(this,a)},c.prototype.applyForce=function(a,b){var c,d,e,f,g,h,i=this.force,j=this.disp,k=this.options,l=k.stiffness,m=k.damping,n=k.length,o=k.maxLength,p=k.anchor||b.position,q=k.forceFunction;for(c=0;c<a.length;c++){if(d=a[c],e=d.position,f=d.velocity,p.sub(e).put(j),g=j.norm()-n,0===g)return;h=d.mass,l*=h,m*=h,j.normalize(l*q(g,o)).put(i),m&&(b?i.add(f.sub(b.velocity).mult(-m)).put(i):i.add(f.mult(-m)).put(i)),d.applyForce(i),b&&b.applyForce(i.mult(-1))}},c.prototype.getEnergy=function(a,b){for(var c=this.options,d=c.length,e=b?b.position:c.anchor,f=c.stiffness,g=0,h=0;h<a.length;h++){var i=a[h],j=e.sub(i.position).norm()-d;g+=.5*f*j*j}return g},b.exports=c},{"../../math/Vector":41,"./Force":64}],69:[function(a,b){function c(a){e.call(this),this.options=Object.create(c.DEFAULT_OPTIONS),a&&this.setOptions(a),this.evaluation=new f}function d(a){var b=c.FIELDS;switch(a){case b.CONSTANT:this.options.direction?this.options.direction instanceof Array&&(this.options.direction=new f(this.options.direction)):this.options.direction=new f(0,1,0);break;case b.POINT_ATTRACTOR:this.options.position?this.options.position instanceof Array&&(this.options.position=new f(this.options.position)):this.options.position=new f(0,0,0)}}var e=a("./Force"),f=a("../../math/Vector");c.prototype=Object.create(e.prototype),c.prototype.constructor=c,c.FIELDS={CONSTANT:function(a,b){b.direction.put(this.evaluation)},LINEAR:function(a){a.put(this.evaluation)},RADIAL:function(a){a.mult(-1).put(this.evaluation)},POINT_ATTRACTOR:function(a,b){b.position.sub(a).put(this.evaluation)}},c.DEFAULT_OPTIONS={strength:.01,field:c.FIELDS.CONSTANT},c.prototype.setOptions=function(a){void 0!==a.strength&&(this.options.strength=a.strength),void 0!==a.direction&&(this.options.direction=a.direction),void 0!==a.field&&(this.options.field=a.field,d.call(this,this.options.field))},c.prototype.applyForce=function(a){var b,c,d=this.force,e=this.options.strength,f=this.options.field;for(b=0;b<a.length;b++)c=a[b],f.call(this,c.position,this.options),this.evaluation.mult(c.mass*e).put(d),c.applyForce(d)},c.prototype.getEnergy=function(a){var b,d,e=this.options.field,f=c.FIELDS,g=0;switch(e){case f.CONSTANT:g=a.length*this.options.direction.norm();break;case f.RADIAL:for(b=0;b<a.length;b++)d=a[b],g+=d.position.norm();break;case f.POINT_ATTRACTOR:for(b=0;b<a.length;b++)d=a[b],g+=d.position.sub(this.options.position).norm()}return g*=this.options.strength},b.exports=c},{"../../math/Vector":41,"./Force":64}],70:[function(a,b){b.exports={Drag:a("./Drag"),Force:a("./Force"),Repulsion:a("./Repulsion"),RotationalDrag:a("./RotationalDrag"),RotationalSpring:a("./RotationalSpring"),Spring:a("./Spring"),VectorField:a("./VectorField")}},{"./Drag":63,"./Force":64,"./Repulsion":65,"./RotationalDrag":66,"./RotationalSpring":67,"./Spring":68,"./VectorField":69}],71:[function(a,b){b.exports={PhysicsEngine:a("./PhysicsEngine"),bodies:a("./bodies"),constraints:a("./constraints"),forces:a("./forces"),integrators:a("./integrators")}},{"./PhysicsEngine":48,"./bodies":53,"./constraints":62,"./forces":70,"./integrators":73}],72:[function(a,b){var c={};c.integrateVelocity=function(a,b){var c=a.velocity,d=a.inverseMass,e=a.force;e.isZero()||(c.add(e.mult(b*d)).put(c),e.clear())},c.integratePosition=function(a,b){var c=a.position,d=a.velocity;c.add(d.mult(b)).put(c)},c.integrateAngularMomentum=function(a,b){var c=a.angularMomentum,d=a.torque;d.isZero()||(c.add(d.mult(b)).put(c),d.clear())},c.integrateOrientation=function(a,b){var c=a.orientation,d=a.angularVelocity;d.isZero()||c.add(c.multiply(d).scalarMultiply(.5*b)).put(c)},b.exports=c},{}],73:[function(a,b){b.exports={SymplecticEuler:a("./SymplecticEuler")}},{"./SymplecticEuler":72}],74:[function(a,b){function c(a){a&&a.canvasSize&&(this._canvasSize=a.canvasSize),d.apply(this,arguments),this._canvasSize||(this._canvasSize=this.getSize()),this._backBuffer=document.createElement("canvas"),this._canvasSize&&(this._backBuffer.width=this._canvasSize[0],this._backBuffer.height=this._canvasSize[1]),this._contextId=void 0}var d=a("../core/Surface");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.elementType="canvas",c.prototype.elementClass="famous-surface",c.prototype.setContent=function(){},c.prototype.deploy=function(a){this._canvasSize&&(a.width=this._canvasSize[0],a.height=this._canvasSize[1]),"2d"===this._contextId&&(a.getContext(this._contextId).drawImage(this._backBuffer,0,0),this._backBuffer.width=0,this._backBuffer.height=0)},c.prototype.recall=function(a){this.getSize(),this._backBuffer.width=a.width,this._backBuffer.height=a.height,"2d"===this._contextId&&(this._backBuffer.getContext(this._contextId).drawImage(a,0,0),a.width=0,a.height=0)},c.prototype.getContext=function(a){return this._contextId=a,this._currentTarget?this._currentTarget.getContext(a):this._backBuffer.getContext(a)},c.prototype.setSize=function(a,b){d.prototype.setSize.apply(this,arguments),b&&(this._canvasSize=[b[0],b[1]]),this._currentTarget&&(this._currentTarget.width=this._canvasSize[0],this._currentTarget.height=this._canvasSize[1])},b.exports=c},{"../core/Surface":14}],75:[function(a,b){function c(a){d.call(this,a),this._container=document.createElement("div"),this._container.classList.add("famous-group"),this._container.classList.add("famous-container-group"),this._shouldRecalculateSize=!1,this.context=new e(this._container),this.setContent(this._container)}var d=a("../core/Surface"),e=a("../core/Context");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.elementType="div",c.prototype.elementClass="famous-surface",c.prototype.add=function(){return this.context.add.apply(this.context,arguments)},c.prototype.render=function(){return this._sizeDirty&&(this._shouldRecalculateSize=!0),d.prototype.render.apply(this,arguments)},c.prototype.deploy=function(){return this._shouldRecalculateSize=!0,d.prototype.deploy.apply(this,arguments)},c.prototype.commit=function(){var a=this._size?[this._size[0],this._size[1]]:null,b=d.prototype.commit.apply(this,arguments);return(this._shouldRecalculateSize||a&&(this._size[0]!==a[0]||this._size[1]!==a[1]))&&(this.context.setSize(),this._shouldRecalculateSize=!1),this.context.update(),b},b.exports=c},{"../core/Context":1,"../core/Surface":14}],76:[function(a,b){function c(a){a&&(this._method=a.method||""),d.apply(this,arguments)}var d=a("./ContainerSurface");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.elementType="form",c.prototype.deploy=function(a){return this._method&&(a.method=this._method),d.prototype.deploy.apply(this,arguments)},b.exports=c},{"./ContainerSurface":75}],77:[function(a,b){function c(){this._imageUrl=void 0,d.apply(this,arguments)}var d=a("../core/Surface"),e=[],f=[],g=[],h=!0;c.enableCache=function(){h=!0},c.disableCache=function(){h=!1},c.clearCache=function(){e=[],f=[],g=[]},c.getCache=function(){return{urlCache:e,countCache:f,nodeCache:g}},c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.elementType="img",c.prototype.elementClass="famous-surface",c.prototype.setContent=function(a){var b=e.indexOf(this._imageUrl);-1!==b&&(1===f[b]?(e.splice(b,1),f.splice(b,1),g.splice(b,1)):f[b]--),b=e.indexOf(a),-1===b?(e.push(a),f.push(1)):f[b]++,this._imageUrl=a,this._contentDirty=!0},c.prototype.deploy=function(a){var b=e.indexOf(this._imageUrl);if(void 0===g[b]&&h){var c=new Image;c.src=this._imageUrl||"",g[b]=c}a.src=this._imageUrl||""},c.prototype.recall=function(a){a.src=""},b.exports=c},{"../core/Surface":14}],78:[function(a,b){function c(a){this._placeholder=a.placeholder||"",this._value=a.value||"",this._type=a.type||"text",this._name=a.name||"",d.apply(this,arguments),this.on("click",this.focus.bind(this)),window.addEventListener("click",function(a){a.target!==this._currentTarget&&this.blur()}.bind(this))}var d=a("../core/Surface");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.elementType="input",c.prototype.elementClass="famous-surface",c.prototype.setPlaceholder=function(a){return this._placeholder=a,this._contentDirty=!0,this},c.prototype.focus=function(){return this._currentTarget&&this._currentTarget.focus(),this},c.prototype.blur=function(){return this._currentTarget&&this._currentTarget.blur(),this},c.prototype.setValue=function(a){return this._value=a,this._contentDirty=!0,this},c.prototype.setType=function(a){return this._type=a,this._contentDirty=!0,this},c.prototype.getValue=function(){return this._currentTarget?this._currentTarget.value:this._value},c.prototype.setName=function(a){return this._name=a,this._contentDirty=!0,this},c.prototype.getName=function(){return this._name},c.prototype.deploy=function(a){""!==this._placeholder&&(a.placeholder=this._placeholder),a.value=this._value,a.type=this._type,a.name=this._name},b.exports=c},{"../core/Surface":14}],79:[function(a,b){function c(a){d.apply(this,arguments),this._type="submit",a&&a.onClick&&this.setOnClick(a.onClick)}var d=a("./InputSurface");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.setOnClick=function(a){this.onClick=a},c.prototype.deploy=function(a){this.onclick&&(a.onClick=this.onClick),d.prototype.deploy.apply(this,arguments)},b.exports=c},{"./InputSurface":78}],80:[function(a,b){function c(a){this._placeholder=a.placeholder||"",this._value=a.value||"",this._name=a.name||"",this._wrap=a.wrap||"",this._cols=a.cols||"",this._rows=a.rows||"",d.apply(this,arguments),this.on("click",this.focus.bind(this))}var d=a("../core/Surface");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.elementType="textarea",c.prototype.elementClass="famous-surface",c.prototype.setPlaceholder=function(a){return this._placeholder=a,this._contentDirty=!0,this},c.prototype.focus=function(){return this._currentTarget&&this._currentTarget.focus(),this},c.prototype.blur=function(){return this._currentTarget&&this._currentTarget.blur(),this},c.prototype.setValue=function(a){return this._value=a,this._contentDirty=!0,this},c.prototype.getValue=function(){return this._currentTarget?this._currentTarget.value:this._value},c.prototype.setName=function(a){return this._name=a,this._contentDirty=!0,this},c.prototype.getName=function(){return this._name},c.prototype.setWrap=function(a){return this._wrap=a,this._contentDirty=!0,this},c.prototype.setColumns=function(a){return this._cols=a,this._contentDirty=!0,this},c.prototype.setRows=function(a){return this._rows=a,this._contentDirty=!0,this},c.prototype.deploy=function(a){""!==this._placeholder&&(a.placeholder=this._placeholder),""!==this._value&&(a.value=this._value),""!==this._name&&(a.name=this._name),""!==this._wrap&&(a.wrap=this._wrap),""!==this._cols&&(a.cols=this._cols),""!==this._rows&&(a.rows=this._rows)},b.exports=c},{"../core/Surface":14}],81:[function(a,b){function c(a){d.apply(this,arguments),this._videoUrl=void 0,this.options=Object.create(c.DEFAULT_OPTIONS),a&&this.setOptions(a)}var d=a("../core/Surface");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.DEFAULT_OPTIONS={autoplay:!1},c.prototype.elementType="video",c.prototype.elementClass="famous-surface",c.prototype.setOptions=function(a){a.size&&this.setSize(a.size),a.classes&&this.setClasses(a.classes),a.properties&&this.setProperties(a.properties),a.autoplay&&(this.options.autoplay=a.autoplay),a.src&&(this._videoUrl=a.src,this._contentDirty=!0)},c.prototype.setContent=function(a){this._videoUrl=a,this._contentDirty=!0},c.prototype.deploy=function(a){a.src=this._videoUrl,a.autoplay=this.options.autoplay},c.prototype.recall=function(a){a.src=""},b.exports=c},{"../core/Surface":14}],82:[function(a,b){b.exports={CanvasSurface:a("./CanvasSurface"),ContainerSurface:a("./ContainerSurface"),FormContainerSurface:a("./FormContainerSurface"),ImageSurface:a("./ImageSurface"),InputSurface:a("./InputSurface"),SubmitInputSurface:a("./SubmitInputSurface"),TextareaSurface:a("./TextareaSurface"),VideoSurface:a("./VideoSurface")}},{"./CanvasSurface":74,"./ContainerSurface":75,"./FormContainerSurface":76,"./ImageSurface":77,"./InputSurface":78,"./SubmitInputSurface":79,"./TextareaSurface":80,"./VideoSurface":81}],83:[function(a,b){function c(a){this._map=a||null,this._cachedOutput=null,this._cachedInput=Number.NaN}c.create=function(a){var b=new c(a);return b.get.bind(b)},c.prototype.get=function(a){return a!==this._cachedInput&&(this._cachedInput=a,this._cachedOutput=this._map(a)),this._cachedOutput},b.exports=c},{}],84:[function(a,b){var c={inQuad:function(a){return a*a},outQuad:function(a){return-(a-=1)*a+1},inOutQuad:function(a){return(a/=.5)<1?.5*a*a:-.5*(--a*(a-2)-1)},inCubic:function(a){return a*a*a},outCubic:function(a){return--a*a*a+1},inOutCubic:function(a){return(a/=.5)<1?.5*a*a*a:.5*((a-=2)*a*a+2)},inQuart:function(a){return a*a*a*a},outQuart:function(a){return-(--a*a*a*a-1)},inOutQuart:function(a){return(a/=.5)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)},inQuint:function(a){return a*a*a*a*a},outQuint:function(a){return--a*a*a*a*a+1},inOutQuint:function(a){return(a/=.5)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)},inSine:function(a){return-1*Math.cos(a*(Math.PI/2))+1},outSine:function(a){return Math.sin(a*(Math.PI/2))},inOutSine:function(a){return-.5*(Math.cos(Math.PI*a)-1)},inExpo:function(a){return 0===a?0:Math.pow(2,10*(a-1))},outExpo:function(a){return 1===a?1:-Math.pow(2,-10*a)+1},inOutExpo:function(a){return 0===a?0:1===a?1:(a/=.5)<1?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},inCirc:function(a){return-(Math.sqrt(1-a*a)-1)},outCirc:function(a){return Math.sqrt(1- --a*a)},inOutCirc:function(a){return(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},inElastic:function(a){var b=1.70158,c=0,d=1;return 0===a?0:1===a?1:(c||(c=.3),b=c/(2*Math.PI)*Math.asin(1/d),-(d*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/c)))},outElastic:function(a){var b=1.70158,c=0,d=1;return 0===a?0:1===a?1:(c||(c=.3),b=c/(2*Math.PI)*Math.asin(1/d),d*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/c)+1)},inOutElastic:function(a){var b=1.70158,c=0,d=1;return 0===a?0:2===(a/=.5)?1:(c||(c=.3*1.5),b=c/(2*Math.PI)*Math.asin(1/d),1>a?-.5*d*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/c):.5*d*Math.pow(2,-10*(a-=1))*Math.sin(2*(a-b)*Math.PI/c)+1)},inBack:function(a,b){return void 0===b&&(b=1.70158),a*a*((b+1)*a-b)},outBack:function(a,b){return void 0===b&&(b=1.70158),--a*a*((b+1)*a+b)+1},inOutBack:function(a,b){return void 0===b&&(b=1.70158),(a/=.5)<1?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2);
},inBounce:function(a){return 1-c.outBounce(1-a)},outBounce:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},inOutBounce:function(a){return.5>a?.5*c.inBounce(2*a):.5*c.outBounce(2*a-1)+.5}};b.exports=c},{}],85:[function(a,b){function c(a){this.method=a,this._instances=[],this.state=[]}var d=a("../utilities/Utility");c.SUPPORTS_MULTIPLE=!0,c.prototype.get=function(){for(var a=0;a<this._instances.length;a++)this.state[a]=this._instances[a].get();return this.state},c.prototype.set=function(a,b,c){for(var e=d.after(a.length,c),f=0;f<a.length;f++)this._instances[f]||(this._instances[f]=new this.method),this._instances[f].set(a[f],b,e)},c.prototype.reset=function(a){for(var b=0;b<a.length;b++)this._instances[b]||(this._instances[b]=new this.method),this._instances[b].reset(a[b])},b.exports=c},{"../utilities/Utility":95}],86:[function(a,b){function c(a){a=a||0,this.endState=new s(a),this.initState=new s,this._dimensions=1,this._restTolerance=1e-10,this._absRestTolerance=this._restTolerance,this._callback=void 0,this.PE=new p,this.particle=new q,this.spring=new r({anchor:this.endState}),this.PE.addBody(this.particle),this.PE.attach(this.spring,this.particle)}function d(){return this.particle.getEnergy()+this.spring.getEnergy([this.particle])}function e(){var a=this.endState.sub(this.initState).normSquared();this._absRestTolerance=0===a?this._restTolerance:this._restTolerance*a}function f(a){this.endState.set(a),e.call(this)}function g(){this.PE.wake()}function h(){this.PE.sleep()}function i(a){this.particle.position.set(a)}function j(a){this.particle.velocity.set(a)}function k(){return 0===this._dimensions?this.particle.getPosition1D():this.particle.getPosition()}function l(){return 0===this._dimensions?this.particle.getVelocity1D():this.particle.getVelocity()}function m(a){this._callback=a}function n(a){var b=c.DEFAULT_OPTIONS;void 0===a.period&&(a.period=b.period),void 0===a.dampingRatio&&(a.dampingRatio=b.dampingRatio),void 0===a.velocity&&(a.velocity=b.velocity),this.spring.setOptions({period:a.period,dampingRatio:a.dampingRatio}),j.call(this,a.velocity)}function o(){if(this.PE.isSleeping()){if(this._callback){var a=this._callback;this._callback=void 0,a()}}else d.call(this)<this._absRestTolerance&&(i.call(this,this.endState),j.call(this,[0,0,0]),h.call(this))}var p=a("../physics/PhysicsEngine"),q=a("../physics/bodies/Particle"),r=a("../physics/constraints/Snap"),s=a("../math/Vector");c.SUPPORTS_MULTIPLE=3,c.DEFAULT_OPTIONS={period:100,dampingRatio:.2,velocity:0},c.prototype.reset=function(a,b){this._dimensions=a instanceof Array?a.length:0,this.initState.set(a),i.call(this,a),f.call(this,a),b&&j.call(this,b),m.call(this,void 0)},c.prototype.getVelocity=function(){return l.call(this)},c.prototype.setVelocity=function(a){this.call(this,j(a))},c.prototype.isActive=function(){return!this.PE.isSleeping()},c.prototype.halt=function(){this.set(this.get())},c.prototype.get=function(){return o.call(this),k.call(this)},c.prototype.set=function(a,b,c){return b?(this._dimensions=a instanceof Array?a.length:0,g.call(this),n.call(this,b),f.call(this,a),void m.call(this,c)):(this.reset(a),void(c&&c()))},b.exports=c},{"../math/Vector":41,"../physics/PhysicsEngine":48,"../physics/bodies/Particle":51,"../physics/constraints/Snap":58}],87:[function(a,b){function c(a){a=a||0,this.endState=new s(a),this.initState=new s,this._dimensions=void 0,this._restTolerance=1e-10,this._absRestTolerance=this._restTolerance,this._callback=void 0,this.PE=new p,this.spring=new r({anchor:this.endState}),this.particle=new q,this.PE.addBody(this.particle),this.PE.attach(this.spring,this.particle)}function d(){return this.particle.getEnergy()+this.spring.getEnergy([this.particle])}function e(a){this.particle.setPosition(a)}function f(a){this.particle.setVelocity(a)}function g(){return 0===this._dimensions?this.particle.getPosition1D():this.particle.getPosition()}function h(){return 0===this._dimensions?this.particle.getVelocity1D():this.particle.getVelocity()}function i(a){this._callback=a}function j(){this.PE.wake()}function k(){this.PE.sleep()}function l(){if(this.PE.isSleeping()){if(this._callback){var a=this._callback;this._callback=void 0,a()}}else d.call(this)<this._absRestTolerance&&(e.call(this,this.endState),f.call(this,[0,0,0]),k.call(this))}function m(a){var b=c.DEFAULT_OPTIONS;void 0===a.period&&(a.period=b.period),void 0===a.dampingRatio&&(a.dampingRatio=b.dampingRatio),void 0===a.velocity&&(a.velocity=b.velocity),a.period<150&&(a.period=150,console.warn("The period of a SpringTransition is capped at 150 ms. Use a SnapTransition for faster transitions")),this.spring.setOptions({period:a.period,dampingRatio:a.dampingRatio}),f.call(this,a.velocity)}function n(){var a=this.endState.sub(this.initState).normSquared();this._absRestTolerance=0===a?this._restTolerance:this._restTolerance*a}function o(a){this.endState.set(a),n.call(this)}var p=a("../physics/PhysicsEngine"),q=a("../physics/bodies/Particle"),r=a("../physics/forces/Spring"),s=a("../math/Vector");c.SUPPORTS_MULTIPLE=3,c.DEFAULT_OPTIONS={period:300,dampingRatio:.5,velocity:0},c.prototype.reset=function(a,b){this._dimensions=a instanceof Array?a.length:0,this.initState.set(a),e.call(this,a),o.call(this,a),b&&f.call(this,b),i.call(this,void 0)},c.prototype.getVelocity=function(){return h.call(this)},c.prototype.setVelocity=function(a){this.call(this,f(a))},c.prototype.isActive=function(){return!this.PE.isSleeping()},c.prototype.halt=function(){this.set(this.get())},c.prototype.get=function(){return l.call(this),g.call(this)},c.prototype.set=function(a,b,c){return b?(this._dimensions=a instanceof Array?a.length:0,j.call(this),m.call(this,b),o.call(this,a),void i.call(this,c)):(this.reset(a),void(c&&c()))},b.exports=c},{"../math/Vector":41,"../physics/PhysicsEngine":48,"../physics/bodies/Particle":51,"../physics/forces/Spring":68}],88:[function(a,b){function c(a){this.currentAction=null,this.actionQueue=[],this.callbackQueue=[],this.state=0,this.velocity=void 0,this._callback=void 0,this._engineInstance=null,this._currentMethod=null,this.set(a)}function d(){if(this._callback){var a=this._callback;this._callback=void 0,a()}if(this.actionQueue.length<=0)return void this.set(this.get());this.currentAction=this.actionQueue.shift(),this._callback=this.callbackQueue.shift();var b=null,c=this.currentAction[0],h=this.currentAction[1];h instanceof Object&&h.method?(b=h.method,"string"==typeof b&&(b=g[b])):b=f,this._currentMethod!==b&&(this._engineInstance=!(c instanceof Object)||b.SUPPORTS_MULTIPLE===!0||c.length<=b.SUPPORTS_MULTIPLE?new b:new e(b),this._currentMethod=b),this._engineInstance.reset(this.state,this.velocity),void 0!==this.velocity&&(h.velocity=this.velocity),this._engineInstance.set(c,h,d.bind(this))}var e=a("./MultipleTransition"),f=a("./TweenTransition"),g={};c.register=function(a){var b=!0;for(var d in a)c.registerMethod(d,a[d])||(b=!1);return b},c.registerMethod=function(a,b){return a in g?!1:(g[a]=b,!0)},c.unregisterMethod=function(a){return a in g?(delete g[a],!0):!1},c.prototype.set=function(a,b,c){if(!b)return this.reset(a),c&&c(),this;var e=[a,b];return this.actionQueue.push(e),this.callbackQueue.push(c),this.currentAction||d.call(this),this},c.prototype.reset=function(a,b){this._currentMethod=null,this._engineInstance=null,this._callback=void 0,this.state=a,this.velocity=b,this.currentAction=null,this.actionQueue=[],this.callbackQueue=[]},c.prototype.delay=function(a,b){var c;return c=this.actionQueue.length?this.actionQueue[this.actionQueue.length-1][0]:this.currentAction?this.currentAction[0]:this.get(),this.set(c,{duration:a,curve:function(){return 0}},b)},c.prototype.get=function(a){return this._engineInstance&&(this._engineInstance.getVelocity&&(this.velocity=this._engineInstance.getVelocity()),this.state=this._engineInstance.get(a)),this.state},c.prototype.isActive=function(){return!!this.currentAction},c.prototype.halt=function(){return this.set(this.get())},b.exports=c},{"./MultipleTransition":85,"./TweenTransition":90}],89:[function(a,b){function c(a){this._final=g.identity.slice(),this._finalTranslate=[0,0,0],this._finalRotate=[0,0,0],this._finalSkew=[0,0,0],this._finalScale=[1,1,1],this.translate=new f(this._finalTranslate),this.rotate=new f(this._finalRotate),this.skew=new f(this._finalSkew),this.scale=new f(this._finalScale),a&&this.set(a)}function d(){return g.build({translate:this.translate.get(),rotate:this.rotate.get(),skew:this.skew.get(),scale:this.scale.get()})}function e(){return g.build({translate:this._finalTranslate,rotate:this._finalRotate,skew:this._finalSkew,scale:this._finalScale})}var f=a("./Transitionable"),g=a("../core/Transform"),h=a("../utilities/Utility");c.prototype.setTranslate=function(a,b,c){return this._finalTranslate=a,this._final=e.call(this),this.translate.set(a,b,c),this},c.prototype.setScale=function(a,b,c){return this._finalScale=a,this._final=e.call(this),this.scale.set(a,b,c),this},c.prototype.setRotate=function(a,b,c){return this._finalRotate=a,this._final=e.call(this),this.rotate.set(a,b,c),this},c.prototype.setSkew=function(a,b,c){return this._finalSkew=a,this._final=e.call(this),this.skew.set(a,b,c),this},c.prototype.set=function(a,b,c){var d=g.interpret(a);this._finalTranslate=d.translate,this._finalRotate=d.rotate,this._finalSkew=d.skew,this._finalScale=d.scale,this._final=a;var e=c?h.after(4,c):null;return this.translate.set(d.translate,b,e),this.rotate.set(d.rotate,b,e),this.skew.set(d.skew,b,e),this.scale.set(d.scale,b,e),this},c.prototype.setDefaultTransition=function(a){this.translate.setDefault(a),this.rotate.setDefault(a),this.skew.setDefault(a),this.scale.setDefault(a)},c.prototype.get=function(){return this.isActive()?d.call(this):this._final},c.prototype.getFinal=function(){return this._final},c.prototype.isActive=function(){return this.translate.isActive()||this.rotate.isActive()||this.scale.isActive()||this.skew.isActive()},c.prototype.halt=function(){return this.translate.halt(),this.rotate.halt(),this.skew.halt(),this.scale.halt(),this._final=this.get(),this._finalTranslate=this.translate.get(),this._finalRotate=this.rotate.get(),this._finalSkew=this.skew.get(),this._finalScale=this.scale.get(),this},b.exports=c},{"../core/Transform":15,"../utilities/Utility":95,"./Transitionable":88}],90:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),a&&this.setOptions(a),this._startTime=0,this._startValue=0,this._updateTime=0,this._endValue=0,this._curve=void 0,this._duration=0,this._active=!1,this._callback=void 0,this.state=0,this.velocity=void 0}function d(a,b,c){return(1-c)*a+c*b}function e(a){return a instanceof Object?a instanceof Array?a.slice(0):Object.create(a):a}function f(a,b){var d={curve:b.curve};return b.duration&&(d.duration=b.duration),b.speed&&(d.speed=b.speed),a instanceof Object&&(void 0!==a.duration&&(d.duration=a.duration),a.curve&&(d.curve=a.curve),a.speed&&(d.speed=a.speed)),"string"==typeof d.curve&&(d.curve=c.getCurve(d.curve)),d}function g(a,b,c,d,e){var f,g=1e-7,h=(c(e)-c(e-g))/g;if(a instanceof Array){f=[];for(var i=0;i<a.length;i++)f[i]="number"==typeof a[i]?h*(a[i]-b[i])/d:0}else f=h*(a-b)/d;return f}function h(a,b,c){var e;if(a instanceof Array){e=[];for(var f=0;f<a.length;f++)e[f]="number"==typeof a[f]?d(a[f],b[f],c):a[f]}else e=d(a,b,c);return e}c.Curves={linear:function(a){return a},easeIn:function(a){return a*a},easeOut:function(a){return a*(2-a)},easeInOut:function(a){return.5>=a?2*a*a:-2*a*a+4*a-1},easeOutBounce:function(a){return a*(3-2*a)},spring:function(a){return(1-a)*Math.sin(6*Math.PI*a)+a}},c.SUPPORTS_MULTIPLE=!0,c.DEFAULT_OPTIONS={curve:c.Curves.linear,duration:500,speed:0};var i={};c.registerCurve=function(a,b){return i[a]?!1:(i[a]=b,!0)},c.unregisterCurve=function(a){return i[a]?(delete i[a],!0):!1},c.getCurve=function(a){var b=i[a];if(void 0!==b)return b;throw new Error("curve not registered")},c.getCurves=function(){return i},c.prototype.setOptions=function(a){void 0!==a.curve&&(this.options.curve=a.curve),void 0!==a.duration&&(this.options.duration=a.duration),void 0!==a.speed&&(this.options.speed=a.speed)},c.prototype.set=function(a,b,c){if(!b)return this.reset(a),void(c&&c());if(this._startValue=e(this.get()),b=f(b,this.options),b.speed){var d=this._startValue;if(d instanceof Object){var g=0;for(var h in d)g+=(a[h]-d[h])*(a[h]-d[h]);b.duration=Math.sqrt(g)/b.speed}else b.duration=Math.abs(a-d)/b.speed}this._startTime=Date.now(),this._endValue=e(a),this._startVelocity=e(b.velocity),this._duration=b.duration,this._curve=b.curve,this._active=!0,this._callback=c},c.prototype.reset=function(a,b){if(this._callback){var c=this._callback;this._callback=void 0,c()}this.state=e(a),this.velocity=e(b),this._startTime=0,this._duration=0,this._updateTime=0,this._startValue=this.state,this._startVelocity=this.velocity,this._endValue=this.state,this._active=!1},c.prototype.getVelocity=function(){return this.velocity},c.prototype.get=function(a){return this.update(a),this.state},c.prototype.update=function(a){if(this._active){if(a||(a=Date.now()),!(this._updateTime>=a)){this._updateTime=a;var b=a-this._startTime;if(b>=this._duration)this.state=this._endValue,this.velocity=g(this.state,this._startValue,this._curve,this._duration,1),this._active=!1;else if(0>b)this.state=this._startValue,this.velocity=this._startVelocity;else{var c=b/this._duration;this.state=h(this._startValue,this._endValue,this._curve(c)),this.velocity=g(this.state,this._startValue,this._curve,this._duration,c)}}}else if(this._callback){var d=this._callback;this._callback=void 0,d()}},c.prototype.isActive=function(){return this._active},c.prototype.halt=function(){this.reset(this.get())},c.registerCurve("linear",c.Curves.linear),c.registerCurve("easeIn",c.Curves.easeIn),c.registerCurve("easeOut",c.Curves.easeOut),c.registerCurve("easeInOut",c.Curves.easeInOut),c.registerCurve("easeOutBounce",c.Curves.easeOutBounce),c.registerCurve("spring",c.Curves.spring),c.customCurve=function(a,b){return a=a||0,b=b||0,function(c){return a*c+(-2*a-b+3)*c*c+(a+b-2)*c*c*c}},b.exports=c},{}],91:[function(a,b){function c(a){a=a||0,this.endState=new t(a),this.initState=new t,this.spring=new r({anchor:this.endState}),this.wall=new s,this._restTolerance=1e-10,this._dimensions=1,this._absRestTolerance=this._restTolerance,this._callback=void 0,this.PE=new p,this.particle=new q,this.PE.addBody(this.particle),this.PE.attach([this.wall,this.spring],this.particle)}function d(){return this.particle.getEnergy()+this.spring.getEnergy([this.particle])}function e(){var a=this.endState.sub(this.initState).normSquared();this._absRestTolerance=0===a?this._restTolerance:this._restTolerance*a}function f(){this.PE.wake()}function g(){this.PE.sleep()}function h(a){this.endState.set(a);var b=this.endState.sub(this.initState).norm();this.wall.setOptions({distance:this.endState.norm(),normal:0===b?this.particle.velocity.normalize(-1):this.endState.sub(this.initState).normalize(-1)}),e.call(this)}function i(a){this.particle.position.set(a)}function j(a){this.particle.velocity.set(a)}function k(){return 0===this._dimensions?this.particle.getPosition1D():this.particle.getPosition()}function l(){return 0===this._dimensions?this.particle.getVelocity1D():this.particle.getVelocity()}function m(a){this._callback=a}function n(){if(this.PE.isSleeping()){if(this._callback){var a=this._callback;this._callback=void 0,a()}}else{var b=d.call(this);b<this._absRestTolerance&&(g.call(this),i.call(this,this.endState),j.call(this,[0,0,0]))}}function o(a){var b=c.DEFAULT_OPTIONS;void 0===a.period&&(a.period=b.period),void 0===a.dampingRatio&&(a.dampingRatio=b.dampingRatio),void 0===a.velocity&&(a.velocity=b.velocity),void 0===a.restitution&&(a.restitution=b.restitution),void 0===a.drift&&(a.drift=s.DEFAULT_OPTIONS.drift),void 0===a.slop&&(a.slop=s.DEFAULT_OPTIONS.slop),this.spring.setOptions({period:a.period,dampingRatio:a.dampingRatio}),this.wall.setOptions({restitution:a.restitution,drift:a.drift,slop:a.slop}),j.call(this,a.velocity)}var p=a("../physics/PhysicsEngine"),q=a("../physics/bodies/Particle"),r=a("../physics/forces/Spring"),s=a("../physics/constraints/Wall"),t=a("../math/Vector");c.SUPPORTS_MULTIPLE=3,c.DEFAULT_OPTIONS={period:300,dampingRatio:.5,velocity:0,restitution:.5},c.prototype.reset=function(a,b){this._dimensions=a instanceof Array?a.length:0,this.initState.set(a),i.call(this,a),b&&j.call(this,b),h.call(this,a),m.call(this,void 0)},c.prototype.getVelocity=function(){return l.call(this)},c.prototype.setVelocity=function(a){this.call(this,j(a))},c.prototype.isActive=function(){return!this.PE.isSleeping()},c.prototype.halt=function(){this.set(this.get())},c.prototype.get=function(){return n.call(this),k.call(this)},c.prototype.set=function(a,b,c){return b?(this._dimensions=a instanceof Array?a.length:0,f.call(this),o.call(this,b),h.call(this,a),void m.call(this,c)):(this.reset(a),void(c&&c()))},b.exports=c},{"../math/Vector":41,"../physics/PhysicsEngine":48,"../physics/bodies/Particle":51,"../physics/constraints/Wall":60,"../physics/forces/Spring":68}],92:[function(a,b){b.exports={CachedMap:a("./CachedMap"),Easing:a("./Easing"),MultipleTransition:a("./MultipleTransition"),SnapTransition:a("./SnapTransition"),SpringTransition:a("./SpringTransition"),Transitionable:a("./Transitionable"),TransitionableTransform:a("./TransitionableTransform"),TweenTransition:a("./TweenTransition"),WallTransition:a("./WallTransition")}},{"./CachedMap":83,"./Easing":84,"./MultipleTransition":85,"./SnapTransition":86,"./SpringTransition":87,"./Transitionable":88,"./TransitionableTransform":89,"./TweenTransition":90,"./WallTransition":91}],93:[function(a,b){var c={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,ENTER:13,LEFT_ARROW:37,RIGHT_ARROW:39,UP_ARROW:38,DOWN_ARROW:40,SPACE:32,SHIFT:16,TAB:9};b.exports=c},{}],94:[function(a,b){function c(a){return j.on(k,a),a}function d(a,b){var d=l(),e=function(){var c=l();c-d>=b&&(a.apply(this,arguments),j.removeListener(k,e))};return c(e)}function e(a,b){var d=l(),e=function(){var c=l();c-d>=b&&(a.apply(this,arguments),d=l())};return c(e)}function f(a,b){if(void 0===b)return void 0;var d=function(){b--,0>=b&&(a.apply(this,arguments),h(d))};return c(d)}function g(a,b){b=b||1;var d=b,e=function(){b--,0>=b&&(a.apply(this,arguments),b=d)};return c(e)}function h(a){j.removeListener(k,a)}function i(a,b){var c,e,f,g,i;return function(){e=this,i=arguments,f=l();var j=function(){var h=l-f;b>h?c=d(j,b-h):(c=null,g=a.apply(e,i))};return h(c),c=d(j,b),g}}var j=a("../core/Engine"),k="prerender",l=window.performance&&window.performance.now?function(){return window.performance.now()}:function(){return Date.now()};b.exports={setTimeout:d,setInterval:e,debounce:i,after:f,every:g,clear:h}},{"../core/Engine":4}],95:[function(a,b){var c={};c.Direction={X:0,Y:1,Z:2},c.after=function(a,b){var c=a;return function(){c--,0===c&&b.apply(this,arguments)}},c.loadURL=function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4===this.readyState&&b&&b(this.responseText)},c.open("GET",a),c.send()},c.createDocumentFragmentFromHTML=function(a){var b=document.createElement("div");b.innerHTML=a;for(var c=document.createDocumentFragment();b.hasChildNodes();)c.appendChild(b.firstChild);return c},c.clone=function(a){var b;if("object"==typeof a){b=a instanceof Array?[]:{};for(var d in a)if("object"==typeof a[d]&&null!==a[d])if(a[d]instanceof Array){b[d]=new Array(a[d].length);for(var e=0;e<a[d].length;e++)b[d][e]=c.clone(a[d][e])}else b[d]=c.clone(a[d]);else b[d]=a[d]}else b=a;return b},b.exports=c},{}],96:[function(a,b){b.exports={KeyCodes:a("./KeyCodes"),Timer:a("./Timer"),Utility:a("./Utility")}},{"./KeyCodes":93,"./Timer":94,"./Utility":95}],97:[function(a,b){function c(a){this.options=Object.create(this.constructor.DEFAULT_OPTIONS||c.DEFAULT_OPTIONS),this._optionsManager=new f(this.options),a&&this.setOptions(a),this._eventInput=new e,this._eventOutput=new e,e.setInputHandler(this,this._eventInput),e.setOutputHandler(this,this._eventOutput),this._id=d.register(this)}var d=a("../core/Entity");a("../core/Transform");var e=a("../core/EventHandler"),f=a("../core/OptionsManager");c.DEFAULT_OPTIONS={},c.prototype.setOptions=function(a){return this._optionsManager.setOptions(a)},c.prototype.getOptions=function(a){return this._optionsManager.getOptions(a)},c.prototype.render=function(){return this._id},c.prototype.commit=function(){},b.exports=c},{"../core/Entity":5,"../core/EventHandler":7,"../core/OptionsManager":10,"../core/Transform":15}],98:[function(a,b){function c(){j.apply(this,arguments),this.state=new h(0),this._isOpen=!1,this.setOutputFunction(function(a,b,c){var e=d.call(this),g=this.options.direction===i.Direction.X?f.translate(e*b,0,.001*(e-1)*b):f.translate(0,e*b,.001*(e-1)*b),h=a.render();if(this.options.stackRotation){var j=this.options.stackRotation*c*(1-e);h={transform:f.rotateZ(j),origin:[.5,.5],target:h}}return{transform:g,size:a.getSize(),target:h}})}function d(a){return a?this._isOpen?1:0:this.state.get()}function e(a,b,c){this.state.halt(),this.state.set(a,b,c)}var f=a("../core/Transform"),g=a("../core/OptionsManager"),h=a("../transitions/Transitionable"),i=a("../utilities/Utility"),j=a("./SequentialLayout");c.prototype=Object.create(j.prototype),c.prototype.constructor=c,c.DEFAULT_OPTIONS=g.patch(j.DEFAULT_OPTIONS,{transition:{curve:"easeOutBounce",duration:500},stackRotation:0}),c.prototype.getSize=function(){var a=j.prototype.getSize.apply(this,arguments),b=this._items?this._items.get().getSize():[0,0];b||(b=[0,0]);var c=d.call(this),e=1-c;return[b[0]*e+a[0]*c,b[1]*e+a[1]*c]},c.prototype.isOpen=function(){return this._isOpen},c.prototype.open=function(a){this._isOpen=!0,e.call(this,1,this.options.transition,a)},c.prototype.close=function(a){this._isOpen=!1,e.call(this,0,this.options.transition,a)},c.prototype.toggle=function(a){this._isOpen?this.close(a):this.open(a)},b.exports=c},{"../core/OptionsManager":10,"../core/Transform":15,"../transitions/Transitionable":88,"../utilities/Utility":95,"./SequentialLayout":110}],99:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),this._optionsManager=new k(this.options),a&&this.setOptions(a),this._position=new l(0),this._direction=d(this.options.side),this._orientation=e(this.options.side),this._isOpen=!1,this._cachedLength=0,this.drawer=new i,this.content=new i,this._eventInput=new m,this._eventOutput=new m,m.setInputHandler(this,this._eventInput),m.setOutputHandler(this,this._eventOutput),this._eventInput.on("update",g.bind(this)),this._eventInput.on("end",h.bind(this))}function d(a){var b=c.SIDES;return a===b.LEFT||a===b.RIGHT?n:o}function e(a){var b=c.SIDES;return a===b.LEFT||a===b.TOP?1:-1}function f(a){var b,c=this.options;if(c.drawerLength)b=c.drawerLength;else{var d=a.getSize();b=d?d[this._direction]:c.drawerLength}return this._orientation*b}function g(a){var b,c,d=this.getPosition()+a.delta;this._cachedLength=f.call(this,this.drawer),1===this._orientation?(b=0,c=this._cachedLength):(b=this._cachedLength,c=0),d>c?d=c:b>d&&(d=b),this.setPosition(d)}function h(a){var b=a.velocity,c=this._orientation*this.getPosition(),d=this.options,e=this._orientation*this._cachedLength,f=d.positionThreshold||e/2,g=d.velocityThreshold;if(d.transition instanceof Object&&(d.transition.velocity=a.velocity),0===c)return void(this._isOpen=!1);if(c===e)return void(this._isOpen=!0);var h=Math.abs(b)>g||!this._isOpen&&c>f||this._isOpen&&f>c;h?this.toggle():this.reset()}var i=a("../core/RenderNode"),j=a("../core/Transform"),k=a("../core/OptionsManager"),l=a("../transitions/Transitionable"),m=a("../core/EventHandler"),n=0,o=1;c.SIDES={LEFT:0,TOP:1,RIGHT:2,BOTTOM:3},c.DEFAULT_OPTIONS={side:c.SIDES.LEFT,drawerLength:0,velocityThreshold:0,positionThreshold:0,transition:!0},c.prototype.setOptions=function(a){this._optionsManager.setOptions(a),void 0!==a.side&&(this._direction=d(a.side),this._orientation=e(a.side))},c.prototype.open=function(a,b){a instanceof Function&&(b=a),void 0===a&&(a=this.options.transition),this._cachedLength=f.call(this,this.drawer),this.setPosition(this._cachedLength,a,b),this._isOpen||(this._isOpen=!0,this._eventOutput.emit("open"))},c.prototype.close=function(a,b){a instanceof Function&&(b=a),void 0===a&&(a=this.options.transition),this.setPosition(0,a,b),this._isOpen&&(this._isOpen=!1,this._eventOutput.emit("close"))},c.prototype.setPosition=function(a,b,c){this._position.isActive()&&this._position.halt(),this._position.set(a,b,c)},c.prototype.getPosition=function(){return this._position.get()},c.prototype.setProgress=function(a,b,c){return this._position.set(a*this._cachedLength,b,c)},c.prototype.getProgress=function(){return this._position.get()/this._cachedLength},c.prototype.toggle=function(a){this._isOpen?this.close(a):this.open(a)},c.prototype.reset=function(a){this._isOpen?this.open(a):this.close(a)},c.prototype.isOpen=function(){return this._isOpen},c.prototype.render=function(){var a=this.getPosition();(!this._isOpen&&0>a&&1===this._orientation||a>0&&-1===this._orientation)&&(a=0,this.setPosition(a));var b=this._direction===n?j.translate(a,0,0):j.translate(0,a,0);return[{transform:j.behind,target:this.drawer.render()},{transform:b,target:this.content.render()}]},b.exports=c},{"../core/EventHandler":7,"../core/OptionsManager":10,"../core/RenderNode":11,"../core/Transform":15,"../transitions/Transitionable":88}],100:[function(a,b){function c(a){this._currentTarget=null,this._size=[void 0,void 0],this._controller=new i(a),this._controller.inTransformFrom(e.create(d.bind(this,1e-4))),this._controller.outTransformFrom(e.create(d.bind(this,-1e-4))),this._eventInput=new g,g.setInputHandler(this,this._eventInput),this._entityId=f.register(this),a&&this.setOptions(a)}function d(a,b){return h.translate(this._size[0]*(1-b),0,a*(1-b))}var e=a("../transitions/CachedMap"),f=a("../core/Entity"),g=a("../core/EventHandler"),h=a("../core/Transform"),i=a("./RenderController");c.prototype.show=function(a){this._currentTarget&&this._eventInput.unpipe(this._currentTarget),this._currentTarget=a,this._currentTarget&&this._currentTarget.trigger&&this._eventInput.pipe(this._currentTarget),this._controller.show.apply(this._controller,arguments)},c.prototype.setOptions=function(a){this._controller.setOptions(a)},c.prototype.render=function(){return this._entityId},c.prototype.commit=function(a){return this._size[0]=a.size[0],this._size[1]=a.size[1],{transform:a.transform,opacity:a.opacity,origin:a.origin,size:a.size,target:this._controller.render()}},b.exports=c},{"../core/Entity":5,"../core/EventHandler":7,"../core/Transform":15,"../transitions/CachedMap":83,"./RenderController":106}],101:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),this.optionsManager=new h(this.options),a&&this.setOptions(a),this.id=f.register(this),this._ratios=new j(this.options.ratios),this._nodes=[],this._size=[0,0],this._cachedDirection=null,this._cachedLengths=[],this._cachedTransforms=null,this._ratiosDirty=!1,this._eventOutput=new i,i.setOutputHandler(this,this._eventOutput)}function d(a,b,d){var e,f,h,i,j=0,k=b,l=0;for(this._cachedLengths=[],this._cachedTransforms=[],i=0;i<a.length;i++)f=a[i],h=this._nodes[i],"number"!=typeof f?k-=h.getSize()[d]||0:l+=f;for(i=0;i<a.length;i++)h=this._nodes[i],f=a[i],b="number"==typeof f?k*f/l:h.getSize()[d],e=d===c.DIRECTION_X?g.translate(j,0,0):g.translate(0,j,0),this._cachedTransforms.push(e),this._cachedLengths.push(b),j+=b}function e(a,b){for(var c=0;c<a.length;c++)if("number"!=typeof a[c]&&this._nodes[c].getSize()[b]!==this._cachedLengths[c])return!0;return!1}var f=a("../core/Entity"),g=a("../core/Transform"),h=a("../core/OptionsManager"),i=a("../core/EventHandler"),j=a("../transitions/Transitionable");c.DIRECTION_X=0,c.DIRECTION_Y=1,c.DEFAULT_OPTIONS={direction:c.DIRECTION_X,transition:!1,ratios:[]},c.prototype.render=function(){return this.id},c.prototype.setOptions=function(a){this.optionsManager.setOptions(a)},c.prototype.sequenceFrom=function(a){if(this._nodes=a,0===this._ratios.get().length){for(var b=[],c=0;c<this._nodes.length;c++)b.push(1);this.setRatios(b)}},c.prototype.setRatios=function(a,b,c){void 0===b&&(b=this.options.transition);var d=this._ratios;0===d.get().length&&(b=void 0),d.isActive()&&d.halt(),d.set(a,b,c),this._ratiosDirty=!0},c.prototype.getSize=function(){return this._size},c.prototype.commit=function(a){var b,c=a.size,f=a.transform,h=a.origin,i=a.opacity,j=this._ratios.get(),k=this.options.direction,l=c[k];(l!==this._size[k]||this._ratiosDirty||this._ratios.isActive()||k!==this._cachedDirection||e.call(this,j,k))&&(d.call(this,j,l,k),l!==this._size[k]&&(this._size[0]=c[0],this._size[1]=c[1]),k!==this._cachedDirection&&(this._cachedDirection=k),this._ratiosDirty&&(this._ratiosDirty=!1));for(var m=[],n=0;n<j.length;n++)b=[void 0,void 0],l=this._cachedLengths[n],b[k]=l,m.push({transform:this._cachedTransforms[n],size:b,target:this._nodes[n].render()});return c&&0!==h[0]&&0!==h[1]&&(f=g.moveThen([-c[0]*h[0],-c[1]*h[1],0],f)),{transform:f,size:c,opacity:i,target:m}},b.exports=c},{"../core/Entity":5,"../core/EventHandler":7,"../core/OptionsManager":10,"../core/Transform":15,"../transitions/Transitionable":88}],102:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),this._optionsManager=new f(this.options),a&&this.setOptions(a),this.angle=new e(0),this.frontNode=void 0,this.backNode=void 0,this.flipped=!1}var d=a("../core/Transform"),e=a("../transitions/Transitionable");a("../core/RenderNode");var f=a("../core/OptionsManager");c.DIRECTION_X=0,c.DIRECTION_Y=1;var g=1;c.DEFAULT_OPTIONS={transition:!0,direction:c.DIRECTION_X},c.prototype.flip=function(a,b){var c=this.flipped?0:Math.PI;this.setAngle(c,a,b),this.flipped=!this.flipped},c.prototype.setAngle=function(a,b,c){void 0===b&&(b=this.options.transition),this.angle.isActive()&&this.angle.halt(),this.angle.set(a,b,c)},c.prototype.setOptions=function(a){return this._optionsManager.setOptions(a)},c.prototype.setFront=function(a){this.frontNode=a},c.prototype.setBack=function(a){this.backNode=a},c.prototype.render=function(){var a,b,e=this.angle.get();this.options.direction===c.DIRECTION_X?(a=d.rotateY(e),b=d.rotateY(e+Math.PI)):(a=d.rotateX(e),b=d.rotateX(e+Math.PI));var f=[];return this.frontNode&&f.push({transform:a,target:this.frontNode.render()}),this.backNode&&f.push({transform:d.moveThen([0,0,g],b),target:this.backNode.render()}),f},b.exports=c},{"../core/OptionsManager":10,"../core/RenderNode":11,"../core/Transform":15,"../transitions/Transitionable":88}],103:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),this.optionsManager=new l(this.options),a&&this.setOptions(a),this.id=g.register(this),this._modifiers=[],this._states=[],this._contextSizeCache=[0,0],this._dimensionsCache=[0,0],this._activeCount=0,this._eventOutput=new j,j.setOutputHandler(this,this._eventOutput)}function d(a,b,c){var d=[a[0],a[1]];d[0]-=this.options.gutterSize[0]*(b-1),d[1]-=this.options.gutterSize[1]*(c-1);for(var g,h=Math.round(d[1]/c),i=Math.round(d[0]/b),j=0,k=0,l=0;c>l;l++){g=0;for(var m=0;b>m;m++)void 0===this._modifiers[k]?e.call(this,k,[i,h],[g,j,0],1):f.call(this,k,[i,h],[g,j,0],1),k++,g+=i+this.options.gutterSize[0];j+=h+this.options.gutterSize[1]}for(this._dimensionsCache=[this.options.dimensions[0],this.options.dimensions[1]],this._contextSizeCache=[a[0],a[1]],this._activeCount=c*b,l=this._activeCount;l<this._modifiers.length;l++)f.call(this,l,[Math.round(i),Math.round(h)],[0,0],0);this._eventOutput.emit("reflow")}function e(a,b,c,d){var e={transform:new n(h.translate.apply(null,c)),opacity:new m(d),size:new m(b)},f=new k({
transform:e.transform,opacity:e.opacity,size:e.size});this._states[a]=e,this._modifiers[a]=f}function f(a,b,c,d){var e=this._states[a],f=e.size,g=e.opacity,h=e.transform,i=this.options.transition;h.halt(),g.halt(),f.halt(),h.setTranslate(c,i),f.set(b,i),g.set(d,i)}var g=a("../core/Entity");a("../core/RenderNode");var h=a("../core/Transform"),i=a("../core/ViewSequence"),j=a("../core/EventHandler"),k=a("../core/Modifier"),l=a("../core/OptionsManager"),m=a("../transitions/Transitionable"),n=a("../transitions/TransitionableTransform");c.DEFAULT_OPTIONS={dimensions:[1,1],transition:!1,gutterSize:[0,0]},c.prototype.render=function(){return this.id},c.prototype.setOptions=function(a){return this.optionsManager.setOptions(a)},c.prototype.sequenceFrom=function(a){a instanceof Array&&(a=new i(a)),this.sequence=a},c.prototype.getSize=function(){return this._contextSizeCache},c.prototype.commit=function(a){var b=a.transform,c=a.opacity,e=a.origin,f=a.size,g=this.options.dimensions[0],i=this.options.dimensions[1];(f[0]!==this._contextSizeCache[0]||f[1]!==this._contextSizeCache[1]||g!==this._dimensionsCache[0]||i!==this._dimensionsCache[1])&&d.call(this,f,g,i);for(var j=this.sequence,k=[],l=0;j&&l<this._modifiers.length;){var m=j.get(),n=this._modifiers[l];l>=this._activeCount&&this._states[l].opacity.isActive()&&(this._modifiers.splice(l,1),this._states.splice(l,1)),m&&k.push(n.modify({origin:e,target:m.render()})),j=j.getNext(),l++}return f&&(b=h.moveThen([-f[0]*e[0],-f[1]*e[1],0],b)),{transform:b,opacity:c,size:f,target:k}},b.exports=c},{"../core/Entity":5,"../core/EventHandler":7,"../core/Modifier":9,"../core/OptionsManager":10,"../core/RenderNode":11,"../core/Transform":15,"../core/ViewSequence":17,"../transitions/Transitionable":88,"../transitions/TransitionableTransform":89}],104:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),this._optionsManager=new j(this.options),a&&this.setOptions(a),this._entityId=g.register(this),this.header=new h,this.footer=new h,this.content=new h}function d(a,b){var c=a.getSize();return c?c[this.options.direction]:b}function e(a){return this.options.direction===c.DIRECTION_X?i.translate(a,0,0):i.translate(0,a,0)}function f(a,b){return this.options.direction===c.DIRECTION_X?[a,b[1]]:[b[0],a]}var g=a("../core/Entity"),h=a("../core/RenderNode"),i=a("../core/Transform"),j=a("../core/OptionsManager");c.DIRECTION_X=0,c.DIRECTION_Y=1,c.DEFAULT_OPTIONS={direction:c.DIRECTION_Y,headerSize:void 0,footerSize:void 0,defaultHeaderSize:0,defaultFooterSize:0},c.prototype.render=function(){return this._entityId},c.prototype.setOptions=function(a){return this._optionsManager.setOptions(a)},c.prototype.commit=function(a){var b=a.transform,c=a.origin,g=a.size,h=a.opacity,j=void 0!==this.options.headerSize?this.options.headerSize:d.call(this,this.header,this.options.defaultHeaderSize),k=void 0!==this.options.footerSize?this.options.footerSize:d.call(this,this.footer,this.options.defaultFooterSize),l=g[this.options.direction]-j-k;g&&(b=i.moveThen([-g[0]*c[0],-g[1]*c[1],0],b));var m=[{size:f.call(this,j,g),target:this.header.render()},{transform:e.call(this,j),size:f.call(this,l,g),target:this.content.render()},{transform:e.call(this,j+l),size:f.call(this,k,g),target:this.footer.render()}];return{transform:b,opacity:h,size:g,target:m}},b.exports=c},{"../core/Entity":5,"../core/OptionsManager":10,"../core/RenderNode":11,"../core/Transform":15}],105:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),this._optionsManager=new h(this.options),a&&this.setOptions(a),this._showing=!1,this.nodes=[],this.transforms=[],this.states=[]}var d=a("../core/Transform"),e=a("../core/Modifier"),f=a("../core/RenderNode"),g=a("../utilities/Utility"),h=a("../core/OptionsManager"),i=a("../transitions/Transitionable"),j=a("../transitions/TransitionableTransform");c.DEFAULT_OPTIONS={inTransform:d.scale(.001,.001,.001),inOpacity:0,inOrigin:[.5,.5],inAlign:[.5,.5],outTransform:d.scale(.001,.001,.001),outOpacity:0,outOrigin:[.5,.5],outAlign:[.5,.5],showTransform:d.identity,showOpacity:1,showOrigin:[.5,.5],showAlign:[.5,.5],inTransition:!0,outTransition:!0,overlap:!1},c.prototype.setOptions=function(a){return this._optionsManager.setOptions(a)},c.prototype.show=function(a,b,c){if(!a)return this.hide(c);if(b instanceof Function&&(c=b,b=void 0),this._showing){if(!this.options.overlap)return this.hide(this.show.bind(this,a,b,c));this.hide()}this._showing=!0;var d={transform:new j(this.options.inTransform),origin:new i(this.options.inOrigin),align:new i(this.options.inAlign),opacity:new i(this.options.inOpacity)},h=new e({transform:d.transform,opacity:d.opacity,origin:d.origin,align:d.align}),k=new f;k.add(h).add(a),this.nodes.push(k),this.states.push(d),this.transforms.push(h);var l=c?g.after(3,c):void 0;b||(b=this.options.inTransition),d.transform.set(this.options.showTransform,b,l),d.opacity.set(this.options.showOpacity,b,l),d.origin.set(this.options.showOrigin,b,l),d.align.set(this.options.showAlign,b,l)},c.prototype.hide=function(a,b){if(this._showing){this._showing=!1,a instanceof Function&&(b=a,a=void 0);var c=this.nodes[this.nodes.length-1],d=this.transforms[this.transforms.length-1],e=this.states[this.states.length-1],f=g.after(3,function(){this.nodes.splice(this.nodes.indexOf(c),1),this.states.splice(this.states.indexOf(e),1),this.transforms.splice(this.transforms.indexOf(d),1),b&&b.call(this)}.bind(this));a||(a=this.options.outTransition),e.transform.set(this.options.outTransform,a,f),e.opacity.set(this.options.outOpacity,a,f),e.origin.set(this.options.outOrigin,a,f),e.align.set(this.options.outAlign,a,f)}},c.prototype.render=function(){for(var a=[],b=0;b<this.nodes.length;b++)a.push(this.nodes[b].render());return a},b.exports=c},{"../core/Modifier":9,"../core/OptionsManager":10,"../core/RenderNode":11,"../core/Transform":15,"../transitions/Transitionable":88,"../transitions/TransitionableTransform":89,"../utilities/Utility":95}],106:[function(a,b){function c(){i.apply(this,arguments),this._showing=-1,this._outgoingRenderables=[],this._nextRenderable=null,this._renderables=[],this._nodes=[],this._modifiers=[],this._states=[],this.inTransformMap=c.DefaultMap.transform,this.inOpacityMap=c.DefaultMap.opacity,this.inOriginMap=c.DefaultMap.origin,this.inAlignMap=c.DefaultMap.align,this.outTransformMap=c.DefaultMap.transform,this.outOpacityMap=c.DefaultMap.opacity,this.outOriginMap=c.DefaultMap.origin,this.outAlignMap=c.DefaultMap.align,this._output=[]}function d(a,b){return a(b.get())}var e=a("../core/Modifier"),f=a("../core/RenderNode"),g=a("../core/Transform"),h=a("../transitions/Transitionable"),i=a("../core/View");c.prototype=Object.create(i.prototype),c.prototype.constructor=c,c.DEFAULT_OPTIONS={inTransition:!0,outTransition:!0,overlap:!0},c.DefaultMap={transform:function(){return g.identity},opacity:function(a){return a},origin:null,align:null},c.prototype.inTransformFrom=function(a){if(a instanceof Function)this.inTransformMap=a;else{if(!a||!a.get)throw new Error("inTransformFrom takes only function or getter object");this.inTransformMap=a.get.bind(a)}return this},c.prototype.inOpacityFrom=function(a){if(a instanceof Function)this.inOpacityMap=a;else{if(!a||!a.get)throw new Error("inOpacityFrom takes only function or getter object");this.inOpacityMap=a.get.bind(a)}return this},c.prototype.inOriginFrom=function(a){if(a instanceof Function)this.inOriginMap=a;else{if(!a||!a.get)throw new Error("inOriginFrom takes only function or getter object");this.inOriginMap=a.get.bind(a)}return this},c.prototype.inAlignFrom=function(a){if(a instanceof Function)this.inAlignMap=a;else{if(!a||!a.get)throw new Error("inAlignFrom takes only function or getter object");this.inAlignMap=a.get.bind(a)}return this},c.prototype.outTransformFrom=function(a){if(a instanceof Function)this.outTransformMap=a;else{if(!a||!a.get)throw new Error("outTransformFrom takes only function or getter object");this.outTransformMap=a.get.bind(a)}return this},c.prototype.outOpacityFrom=function(a){if(a instanceof Function)this.outOpacityMap=a;else{if(!a||!a.get)throw new Error("outOpacityFrom takes only function or getter object");this.outOpacityMap=a.get.bind(a)}return this},c.prototype.outOriginFrom=function(a){if(a instanceof Function)this.outOriginMap=a;else{if(!a||!a.get)throw new Error("outOriginFrom takes only function or getter object");this.outOriginMap=a.get.bind(a)}return this},c.prototype.outAlignFrom=function(a){if(a instanceof Function)this.outAlignMap=a;else{if(!a||!a.get)throw new Error("outAlignFrom takes only function or getter object");this.outAlignMap=a.get.bind(a)}return this},c.prototype.show=function(a,b,c){if(!a)return this.hide(c);if(b instanceof Function&&(c=b,b=null),this._showing>=0){if(!this.options.overlap)return void(this._nextRenderable?this._nextRenderable=a:(this._nextRenderable=a,this.hide(function(){this._nextRenderable===a&&this.show(this._nextRenderable,c),this._nextRenderable=null})));this.hide()}var g=null,i=this._renderables.indexOf(a);if(i>=0){this._showing=i,g=this._states[i],g.halt();var j=this._outgoingRenderables.indexOf(a);j>=0&&this._outgoingRenderables.splice(j,1)}else{g=new h(0);var k=new e({transform:this.inTransformMap?d.bind(this,this.inTransformMap,g):null,opacity:this.inOpacityMap?d.bind(this,this.inOpacityMap,g):null,origin:this.inOriginMap?d.bind(this,this.inOriginMap,g):null,align:this.inAlignMap?d.bind(this,this.inAlignMap,g):null}),l=new f;l.add(k).add(a),this._showing=this._nodes.length,this._nodes.push(l),this._modifiers.push(k),this._states.push(g),this._renderables.push(a)}b||(b=this.options.inTransition),g.set(1,b,c)},c.prototype.hide=function(a,b){if(!(this._showing<0)){var c=this._showing;this._showing=-1,a instanceof Function&&(b=a,a=void 0);var e=this._nodes[c],f=this._modifiers[c],g=this._states[c],h=this._renderables[c];f.transformFrom(this.outTransformMap?d.bind(this,this.outTransformMap,g):null),f.opacityFrom(this.outOpacityMap?d.bind(this,this.outOpacityMap,g):null),f.originFrom(this.outOriginMap?d.bind(this,this.outOriginMap,g):null),f.alignFrom(this.outAlignMap?d.bind(this,this.outAlignMap,g):null),this._outgoingRenderables.indexOf(h)<0&&this._outgoingRenderables.push(h),a||(a=this.options.outTransition),g.halt(),g.set(0,a,function(a,c,d,e){if(this._outgoingRenderables.indexOf(e)>=0){var f=this._nodes.indexOf(a);this._nodes.splice(f,1),this._modifiers.splice(f,1),this._states.splice(f,1),this._renderables.splice(f,1),this._outgoingRenderables.splice(this._outgoingRenderables.indexOf(e),1),this._showing>=f&&this._showing--}b&&b.call(this)}.bind(this,e,f,g,h))}},c.prototype.render=function(){var a=this._output;a.length>this._nodes.length&&a.splice(this._nodes.length);for(var b=0;b<this._nodes.length;b++)a[b]=this._nodes[b].render();return a},b.exports=c},{"../core/Modifier":9,"../core/RenderNode":11,"../core/Transform":15,"../core/View":16,"../transitions/Transitionable":88}],107:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),this._optionsManager=new g(this.options),a&&this.setOptions(a),this.container=new d(this.options.container),this.scrollview=new f(this.options.scrollview),this.container.add(this.scrollview),this._eventInput=new e,e.setInputHandler(this,this._eventInput),this._eventInput.pipe(this.scrollview),this._eventOutput=new e,e.setOutputHandler(this,this._eventOutput),this.container.pipe(this._eventOutput),this.scrollview.pipe(this._eventOutput)}var d=a("../surfaces/ContainerSurface"),e=a("../core/EventHandler"),f=a("./Scrollview");a("../utilities/Utility");var g=a("../core/OptionsManager");c.DEFAULT_OPTIONS={container:{properties:{overflow:"hidden"}},scrollview:{}},c.prototype.setOptions=function(a){return this._optionsManager.setOptions(a)},c.prototype.sequenceFrom=function(){return this.scrollview.sequenceFrom.apply(this.scrollview,arguments)},c.prototype.getSize=function(){return this.container.getSize.apply(this.container,arguments)},c.prototype.render=function(){return this.container.render()},b.exports=c},{"../core/EventHandler":7,"../core/OptionsManager":10,"../surfaces/ContainerSurface":75,"../utilities/Utility":95,"./Scrollview":109}],108:[function(a,b){function c(a){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),this._optionsManager=new j(this.options),a&&this._optionsManager.setOptions(a),this._node=null,this._position=0,this._positionOffset=0,this._positionGetter=null,this._outputFunction=null,this._masterOutputFunction=null,this.outputFrom(),this._onEdge=0,this.group=new i,this.group.add({render:g.bind(this)}),this._entityId=h.register(this),this._size=[void 0,void 0],this._contextSize=[void 0,void 0],this._eventInput=new n,this._eventOutput=new n,n.setInputHandler(this,this._eventInput),n.setOutputHandler(this,this._eventOutput)}function d(a){a||(a=this._contextSize);var b=this.options.direction;return void 0===a[b]?this._contextSize[b]:a[b]}function e(a,b,c){var e=a.getSize?a.getSize():this._contextSize,f=this._outputFunction(b);return c.push({transform:f,target:a.render()}),d.call(this,e)}function f(){return void 0!==this.options.clipSize?this.options.clipSize:this._contextSize[this.options.direction]>this.getCumulativeSize()[this.options.direction]?d.call(this,this.getCumulativeSize()):d.call(this,this._contextSize)}function g(){for(var a=null,b=this._position,c=[],g=-this._positionOffset,h=f.call(this),i=this._node;i&&g-b<h+this.options.margin;)g+=e.call(this,i,g,c),i=i.getNext?i.getNext():null;var j=this._node,k=d.call(this,j.getSize());if(h>g){for(;j&&h>k;)j=j.getPrevious(),j&&(k+=d.call(this,j.getSize()));for(j=this._node;j&&h>k;)j=j.getNext(),j&&(k+=d.call(this,j.getSize()))}for(!i&&h-o>g-b?1!==this._onEdge&&(this._onEdge=1,this._eventOutput.emit("onEdge",{position:g-h})):!this._node.getPrevious()&&-o>b?-1!==this._onEdge&&(this._onEdge=-1,this._eventOutput.emit("onEdge",{position:0})):0!==this._onEdge&&(this._onEdge=0,this._eventOutput.emit("offEdge")),i=this._node&&this._node.getPrevious?this._node.getPrevious():null,g=-this._positionOffset,i&&(a=i.getSize?i.getSize():this._contextSize,g-=d.call(this,a));i&&g-b>-(h+this.options.margin);)e.call(this,i,g,c),i=i.getPrevious?i.getPrevious():null,i&&(a=i.getSize?i.getSize():this._contextSize,g-=d.call(this,a));return c}var h=a("../core/Entity"),i=a("../core/Group"),j=a("../core/OptionsManager"),k=a("../core/Transform"),l=a("../utilities/Utility"),m=a("../core/ViewSequence"),n=a("../core/EventHandler");c.DEFAULT_OPTIONS={direction:l.Direction.Y,margin:0,clipSize:void 0,groupScroll:!1};var o=0;c.prototype.getCumulativeSize=function(a){return void 0===a&&(a=this._node._.cumulativeSizes.length-1),this._node._.getSize(a)},c.prototype.setOptions=function(a){a.groupScroll!==this.options.groupScroll&&(a.groupScroll?this.group.pipe(this._eventOutput):this.group.unpipe(this._eventOutput)),this._optionsManager.setOptions(a)},c.prototype.onEdge=function(){return this._onEdge},c.prototype.outputFrom=function(a,b){a||(a=function(a){return this.options.direction===l.Direction.X?k.translate(a,0):k.translate(0,a)}.bind(this),b||(b=a)),this._outputFunction=a,this._masterOutputFunction=b?b:function(b){return k.inverse(a(-b))}},c.prototype.positionFrom=function(a){a instanceof Function?this._positionGetter=a:a&&a.get?this._positionGetter=a.get.bind(a):(this._positionGetter=null,this._position=a),this._positionGetter&&(this._position=this._positionGetter.call(this))},c.prototype.sequenceFrom=function(a){a instanceof Array&&(a=new m({array:a})),this._node=a,this._positionOffset=0},c.prototype.getSize=function(a){return a?this._contextSize:this._size},c.prototype.render=function(){return this._node?(this._positionGetter&&(this._position=this._positionGetter.call(this)),this._entityId):null},c.prototype.commit=function(a){var b=a.transform,c=a.opacity,d=a.origin,e=a.size;this.options.clipSize||e[0]===this._contextSize[0]&&e[1]===this._contextSize[1]||(this._onEdge=0,this._contextSize[0]=e[0],this._contextSize[1]=e[1],this.options.direction===l.Direction.X?(this._size[0]=f.call(this),this._size[1]=void 0):(this._size[0]=void 0,this._size[1]=f.call(this)));var g=this._masterOutputFunction(-this._position);return{transform:k.multiply(b,g),size:e,opacity:c,origin:d,target:this.group.render()}},b.exports=c},{"../core/Entity":5,"../core/EventHandler":7,"../core/Group":8,"../core/OptionsManager":10,"../core/Transform":15,"../core/ViewSequence":17,"../utilities/Utility":95}],109:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),this._optionsManager=new u(this.options),this._scroller=new w(this.options),this.sync=new y(["scroll","touch"],{direction:this.options.direction,scale:this.options.syncScale,rails:this.options.rails,preventDefault:void 0!==this.options.preventDefault?this.options.preventDefault:this.options.direction!==x.Direction.Y}),this._physicsEngine=new p,this._particle=new q,this._physicsEngine.addBody(this._particle),this.spring=new s({anchor:[0,0,0],period:this.options.edgePeriod,dampingRatio:this.options.edgeDamp}),this.drag=new r({forceFunction:r.FORCE_FUNCTIONS.QUADRATIC,strength:this.options.drag}),this.friction=new r({forceFunction:r.FORCE_FUNCTIONS.LINEAR,strength:this.options.friction}),this._node=null,this._touchCount=0,this._springState=B.NONE,this._onEdge=C.NONE,this._pageSpringPosition=0,this._edgeSpringPosition=0,this._touchVelocity=0,this._earlyEnd=!1,this._needsPaginationCheck=!1,this._displacement=0,this._totalShift=0,this._cachedIndex=0,this._scroller.positionFrom(this.getPosition.bind(this)),this._eventInput=new t,this._eventOutput=new t,this._eventInput.pipe(this.sync),this.sync.pipe(this._eventInput),t.setInputHandler(this,this._eventInput),t.setOutputHandler(this,this._eventOutput),g.call(this),a&&this.setOptions(a)}function d(a){this._touchCount=a.count,void 0===a.count&&(this._touchCount=1),i.call(this),this.setVelocity(0),this._touchVelocity=0,this._earlyEnd=!1}function e(a){var b=-a.velocity,c=-a.delta;if(this._onEdge!==C.NONE&&a.slip&&(0>b&&this._onEdge===C.TOP||b>0&&this._onEdge===C.BOTTOM?this._earlyEnd||(f.call(this,a),this._earlyEnd=!0):this._earlyEnd&&Math.abs(b)>Math.abs(this.getVelocity())&&d.call(this,a)),!this._earlyEnd){if(this._touchVelocity=b,a.slip){var e=this.options.speedLimit;-e>b?b=-e:b>e&&(b=e),this.setVelocity(b);var g=16*e;c>g?c=g:-g>c&&(c=-g)}this.setPosition(this.getPosition()+c),this._displacement+=c,this._springState===B.NONE&&n.call(this)}}function f(a){if(this._touchCount=a.count||0,!this._touchCount){i.call(this),this._onEdge!==C.NONE&&m.call(this,this._edgeSpringPosition,B.EDGE),h.call(this);var b=-a.velocity,c=this.options.speedLimit;a.slip&&(c*=this.options.edgeGrip),-c>b?b=-c:b>c&&(b=c),this.setVelocity(b),this._touchVelocity=0,this._needsPaginationCheck=!0}}function g(){this._eventInput.bindThis(this),this._eventInput.on("start",d),this._eventInput.on("update",e),this._eventInput.on("end",f),this._eventInput.on("resize",function(){this._node._.calculateSize()}.bind(this)),this._scroller.on("onEdge",function(a){this._edgeSpringPosition=a.position,k.call(this,this._scroller.onEdge()),this._eventOutput.emit("onEdge")}.bind(this)),this._scroller.on("offEdge",function(){this.sync.setOptions({scale:this.options.syncScale}),this._onEdge=this._scroller.onEdge(),this._eventOutput.emit("offEdge")}.bind(this)),this._particle.on("update",function(a){this._springState===B.NONE&&n.call(this),this._displacement=a.position.x-this._totalShift}.bind(this)),this._particle.on("end",function(){(!this.options.paginated||this.options.paginated&&this._springState!==B.NONE)&&this._eventOutput.emit("settle")}.bind(this))}function h(){this._springState?this._physicsEngine.attach([this.spring],this._particle):this._physicsEngine.attach([this.drag,this.friction],this._particle)}function i(){this._springState=B.NONE,this._physicsEngine.detachAll()}function j(a){var b=this.options.direction,c=a.getSize();return c?c[b]:this._scroller.getSize()[b]}function k(a){this.sync.setOptions({scale:this.options.edgeGrip}),this._onEdge=a,this._touchCount||this._springState===B.EDGE||m.call(this,this._edgeSpringPosition,B.EDGE),this._springState&&Math.abs(this.getVelocity())<.001&&(i.call(this),h.call(this))}function l(){if(!this._touchCount&&this._springState!==B.EDGE){var a=this.getVelocity();if(!(Math.abs(a)>=this.options.pageStopSpeed)){var b=this.getPosition(),c=Math.abs(a)>this.options.pageSwitchSpeed,d=j.call(this,this._node),e=b>.5*d,f=a>0,g=0>a;this._needsPaginationCheck=!1,e&&!c||c&&f?this.goToNextPage():c&&g?this.goToPreviousPage():m.call(this,0,B.PAGE)}}}function m(a,b){var c;b===B.EDGE?(this._edgeSpringPosition=a,c={anchor:[this._edgeSpringPosition,0,0],period:this.options.edgePeriod,dampingRatio:this.options.edgeDamp}):b===B.PAGE&&(this._pageSpringPosition=a,c={anchor:[this._pageSpringPosition,0,0],period:this.options.pagePeriod,dampingRatio:this.options.pageDamp}),this.spring.setOptions(c),b&&!this._springState&&(i.call(this),this._springState=b,h.call(this)),this._springState=b}function n(){var a=0,b=this.getPosition();b+=(0>b?-.5:.5)>>0;for(var c=j.call(this,this._node),d=this._node.getNext();a+b>=c&&d;)a-=c,this._scroller.sequenceFrom(d),this._node=d,d=this._node.getNext(),c=j.call(this,this._node);for(var e,f=this._node.getPrevious();0>=a+b&&f;)e=j.call(this,f),this._scroller.sequenceFrom(f),this._node=f,a+=e,f=this._node.getPrevious();a&&o.call(this,a),this._node&&(this._node.index!==this._cachedIndex?this.getPosition()<.5*c&&(this._cachedIndex=this._node.index,this._eventOutput.emit("pageChange",{direction:-1,index:this._cachedIndex})):this.getPosition()>.5*c&&(this._cachedIndex=this._node.index+1,this._eventOutput.emit("pageChange",{direction:1,index:this._cachedIndex})))}function o(a){this._edgeSpringPosition+=a,this._pageSpringPosition+=a,this.setPosition(this.getPosition()+a),this._totalShift+=a,this._springState===B.EDGE?this.spring.setOptions({anchor:[this._edgeSpringPosition,0,0]}):this._springState===B.PAGE&&this.spring.setOptions({anchor:[this._pageSpringPosition,0,0]})}var p=a("../physics/PhysicsEngine"),q=a("../physics/bodies/Particle"),r=a("../physics/forces/Drag"),s=a("../physics/forces/Spring"),t=a("../core/EventHandler"),u=a("../core/OptionsManager"),v=a("../core/ViewSequence"),w=a("../views/Scroller"),x=a("../utilities/Utility"),y=a("../inputs/GenericSync"),z=a("../inputs/ScrollSync"),A=a("../inputs/TouchSync");y.register({scroll:z,touch:A});var B={NONE:0,EDGE:1,PAGE:2},C={TOP:-1,NONE:0,BOTTOM:1};c.DEFAULT_OPTIONS={direction:x.Direction.Y,rails:!0,friction:.005,drag:1e-4,edgeGrip:.2,edgePeriod:300,edgeDamp:1,margin:1e3,paginated:!1,pagePeriod:500,pageDamp:.8,pageStopSpeed:10,pageSwitchSpeed:.5,speedLimit:5,groupScroll:!1,syncScale:1},c.prototype.getCurrentIndex=function(){return this._node.index},c.prototype.goToPreviousPage=function(){if(!this._node||this._onEdge===C.TOP)return null;if(this.getPosition()>1&&this._springState===B.NONE)return m.call(this,0,B.PAGE),this._node;var a=this._node.getPrevious();if(a){var b=j.call(this,a);this._scroller.sequenceFrom(a),this._node=a,o.call(this,b),m.call(this,0,B.PAGE)}return a},c.prototype.goToNextPage=function(){if(!this._node||this._onEdge===C.BOTTOM)return null;var a=this._node.getNext();if(a){var b=j.call(this,this._node);this._scroller.sequenceFrom(a),this._node=a,o.call(this,-b),m.call(this,0,B.PAGE)}return a},c.prototype.goToPage=function(a){var b,c=this.getCurrentIndex();if(c>a)for(b=0;c-a>b;b++)this.goToPreviousPage();if(a>c)for(b=0;a-c>b;b++)this.goToNextPage()},c.prototype.outputFrom=function(){return this._scroller.outputFrom.apply(this._scroller,arguments)},c.prototype.getPosition=function(){return this._particle.getPosition1D()},c.prototype.getAbsolutePosition=function(){return this._scroller.getCumulativeSize(this.getCurrentIndex())[this.options.direction]+this.getPosition()},c.prototype.getOffset=c.prototype.getPosition,c.prototype.setPosition=function(a){this._particle.setPosition1D(a)},c.prototype.setOffset=c.prototype.setPosition,c.prototype.getVelocity=function(){return this._touchCount?this._touchVelocity:this._particle.getVelocity1D()},c.prototype.setVelocity=function(a){this._particle.setVelocity1D(a)},c.prototype.setOptions=function(a){void 0!==a.direction&&("x"===a.direction?a.direction=x.Direction.X:"y"===a.direction&&(a.direction=x.Direction.Y)),a.groupScroll!==this.options.groupScroll&&(a.groupScroll?this.subscribe(this._scroller):this.unsubscribe(this._scroller)),this._optionsManager.setOptions(a),this._scroller.setOptions(a),void 0!==a.drag&&this.drag.setOptions({strength:this.options.drag}),void 0!==a.friction&&this.friction.setOptions({strength:this.options.friction}),(void 0!==a.edgePeriod||void 0!==a.edgeDamp)&&this.spring.setOptions({period:this.options.edgePeriod,dampingRatio:this.options.edgeDamp}),(a.rails||void 0!==a.direction||void 0!==a.syncScale||a.preventDefault)&&this.sync.setOptions({rails:this.options.rails,direction:this.options.direction===x.Direction.X?y.DIRECTION_X:y.DIRECTION_Y,scale:this.options.syncScale,preventDefault:this.options.preventDefault})},c.prototype.sequenceFrom=function(a){return a instanceof Array&&(a=new v({array:a,trackSize:!0})),this._node=a,this._scroller.sequenceFrom(a)},c.prototype.getSize=function(){return this._scroller.getSize.apply(this._scroller,arguments)},c.prototype.render=function(){return this.options.paginated&&this._needsPaginationCheck&&l.call(this),this._scroller.render()},b.exports=c},{"../core/EventHandler":7,"../core/OptionsManager":10,"../core/ViewSequence":17,"../inputs/GenericSync":27,"../inputs/ScrollSync":32,"../inputs/TouchSync":33,"../physics/PhysicsEngine":48,"../physics/bodies/Particle":51,"../physics/forces/Drag":63,"../physics/forces/Spring":68,"../utilities/Utility":95,"../views/Scroller":108}],110:[function(a,b){function c(a){this._items=null,this._size=null,this._outputFunction=c.DEFAULT_OUTPUT_FUNCTION,this.options=h.clone(this.constructor.DEFAULT_OPTIONS||c.DEFAULT_OPTIONS),this.optionsManager=new d(this.options),this.id=e.register(this),this.cachedSize=[void 0,void 0],a&&this.setOptions(a)}var d=a("../core/OptionsManager"),e=a("../core/Entity"),f=a("../core/Transform"),g=a("../core/ViewSequence"),h=a("../utilities/Utility");c.DEFAULT_OPTIONS={direction:h.Direction.Y,itemSpacing:0},c.DEFAULT_OUTPUT_FUNCTION=function(a,b){var c=this.options.direction===h.Direction.X?f.translate(b,0):f.translate(0,b);return{size:this.cachedSize,transform:c,target:a.render()}},c.prototype.getSize=function(){return this._size||this.render(),this._size},c.prototype.sequenceFrom=function(a){return a instanceof Array&&(a=new g(a)),this._items=a,this},c.prototype.setOptions=function(){return this.optionsManager.setOptions.apply(this.optionsManager,arguments),this},c.prototype.setOutputFunction=function(a){return this._outputFunction=a,this},c.prototype.render=function(){return this.id},c.prototype.commit=function(a){var b=0,c=1^this.options.direction,d=this._items,e=null,f=[],g={},h=[],i=0;for(this._size=[0,0],this.cachedSize=a.size;d&&(e=d.get());)e.getSize&&(f=e.getSize()),g=this._outputFunction.call(this,e,b,i++),h.push(g),f&&(f[this.options.direction]&&(b+=f[this.options.direction]),f[c]>this._size[c]&&(this._size[c]=f[c]),0===f[c]&&(this._size[c]=void 0)),d=d.getNext(),this.options.itemSpacing&&d&&(b+=this.options.itemSpacing);return this._size[this.options.direction]=b,{transform:a.transform,origin:a.origin,opacity:a.opacity,size:this.getSize(),target:h}},b.exports=c},{"../core/Entity":5,"../core/OptionsManager":10,"../core/Transform":15,"../core/ViewSequence":17,"../utilities/Utility":95}],111:[function(a,b){function c(){d.apply(this,arguments),this._id=e.register(this),this._parentSize=[]}var d=a("../core/View"),e=a("../core/Entity"),f=a("../core/Transform");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.commit=function(a){var b=a.transform,c=a.opacity,d=a.origin;return this._parentSize&&this._parentSize[0]===a.size[0]&&this._parentSize[1]===a.size[1]||(this._parentSize[0]=a.size[0],this._parentSize[1]=a.size[1],this._eventInput.emit("parentResize",this._parentSize),this.onResize&&this.onResize(this._parentSize)),this._parentSize&&(b=f.moveThen([-this._parentSize[0]*d[0],-this._parentSize[1]*d[1],0],b)),{transform:b,opacity:c,size:this._parentSize,target:this._node.render()}},c.prototype.getParentSize=function(){return this._parentSize},c.prototype.render=function(){return this._id},b.exports=c},{"../core/Entity":5,"../core/Transform":15,"../core/View":16}],112:[function(a,b){b.exports={ContextualView:a("./ContextualView"),Deck:a("./Deck"),DrawerLayout:a("./DrawerLayout"),EdgeSwapper:a("./EdgeSwapper"),FlexibleLayout:a("./FlexibleLayout"),Flipper:a("./Flipper"),GridLayout:a("./GridLayout"),HeaderFooterLayout:a("./HeaderFooterLayout"),Lightbox:a("./Lightbox"),RenderController:a("./RenderController"),ScrollContainer:a("./ScrollContainer"),Scroller:a("./Scroller"),Scrollview:a("./Scrollview"),SequentialLayout:a("./SequentialLayout"),SizeAwareView:a("./SizeAwareView")}},{"./ContextualView":97,"./Deck":98,"./DrawerLayout":99,"./EdgeSwapper":100,"./FlexibleLayout":101,"./Flipper":102,"./GridLayout":103,"./HeaderFooterLayout":104,"./Lightbox":105,"./RenderController":106,"./ScrollContainer":107,"./Scroller":108,"./Scrollview":109,"./SequentialLayout":110,"./SizeAwareView":111}],113:[function(a,b){function c(){g.apply(this,arguments),this.title=new e({classes:this.options.classes,content:this.options.content}),this.back=new e({size:[this.options.size[1],this.options.size[1]],classes:this.options.classes,content:this.options.backContent}),this.back.on("click",function(){this._eventOutput.emit("back",{})}.bind(this)),this.more=new e({size:[this.options.size[1],this.options.size[1]],classes:this.options.classes,content:this.options.moreContent}),this.more.on("click",function(){this._eventOutput.emit("more",{})}.bind(this)),this.layout=new d({id:"master",size:this.options.size,target:[{transform:f.inFront,origin:[0,.5],align:[0,.5],target:this.back},{origin:[.5,.5],align:[.5,.5],target:this.title},{transform:f.inFront,origin:[1,.5],align:[1,.5],target:this.more}]}),this._add(this.layout),this._optionsManager.on("change",function(a){var b=a.id,c=a.value;"size"===b?(this.layout.id.master.setSize(c),this.title.setSize(c),this.back.setSize([c[1],c[1]]),this.more.setSize([c[1],c[1]])):"backClasses"===b?this.back.setOptions({classes:this.options.classes.concat(this.options.backClasses)}):"backContent"===b?this.back.setContent(this.options.backContent):"classes"===b?(this.title.setOptions({classes:this.options.classes}),this.back.setOptions({classes:this.options.classes.concat(this.options.backClasses)}),this.more.setOptions({classes:this.options.classes.concat(this.options.moreClasses)})):"content"===b?this.setContent(this.options.content):"moreClasses"===b?this.more.setOptions({classes:this.options.classes.concat(this.options.moreClasses)}):"moreContent"===b&&this.more.setContent(this.options.content)}.bind(this))}var d=a("../core/Scene"),e=a("../core/Surface"),f=a("../core/Transform"),g=a("../core/View");c.prototype=Object.create(g.prototype),c.prototype.constructor=c,c.DEFAULT_OPTIONS={size:[void 0,50],backClasses:["back"],backContent:"&#x25c0;",classes:["navigation"],content:"",moreClasses:["more"],moreContent:"&#x271a;"},c.prototype.setContent=function(a){return this.title.setContent(a)},b.exports=c},{"../core/Scene":12,"../core/Surface":14,"../core/Transform":15,"../core/View":16}],114:[function(a,b){function c(a){this.options=Object.create(c.DEFAULT_OPTIONS),this.optionsManager=new j(this.options),a&&this.setOptions(a),this.indicator=new f({size:this.options.indicatorSize,classes:["slider-back"]}),this.label=new e({size:this.options.labelSize,content:this.options.label,properties:{pointerEvents:"none"},classes:["slider-label"]}),this.eventOutput=new h,this.eventInput=new h,h.setInputHandler(this,this.eventInput),h.setOutputHandler(this,this.eventOutput);var b=(this.options.range[1]-this.options.range[0])/this.options.indicatorSize[0];
this.sync=new m(["mouse","touch"],{scale:b,direction:m.DIRECTION_X}),this.indicator.pipe(this.sync),this.sync.pipe(this),this.eventInput.on("update",function(a){this.set(a.position)}.bind(this)),this._drawPos=0,d.call(this)}function d(){this.label.setContent(this.options.label+'<span style="float: right">'+this.get().toFixed(this.options.precision)+"</span>")}var e=a("../core/Surface"),f=a("../surfaces/CanvasSurface"),g=a("../core/Transform"),h=a("../core/EventHandler"),i=a("../math/Utilities"),j=a("../core/OptionsManager"),k=a("../inputs/MouseSync"),l=a("../inputs/TouchSync"),m=a("../inputs/GenericSync");m.register({mouse:k,touch:l}),c.DEFAULT_OPTIONS={size:[200,60],indicatorSize:[200,30],labelSize:[200,30],range:[0,1],precision:2,value:0,label:"",fillColor:"rgba(170, 170, 170, 1)"},c.prototype.setOptions=function(a){return this.optionsManager.setOptions(a)},c.prototype.get=function(){return this.options.value},c.prototype.set=function(a){a!==this.options.value&&(this.options.value=i.clamp(a,this.options.range),d.call(this),this.eventOutput.emit("change",{value:a}))},c.prototype.getSize=function(){return this.options.size},c.prototype.render=function(){var a=this.options.range,b=Math.floor((this.get()-a[0])/(a[1]-a[0])*this.options.indicatorSize[0]);if(b<this._drawPos)this.indicator.getContext("2d").clearRect(b,0,this._drawPos-b+1,this.options.indicatorSize[1]);else if(b>this._drawPos){var c=this.indicator.getContext("2d");c.fillStyle=this.options.fillColor,c.fillRect(this._drawPos-1,0,b-this._drawPos+1,this.options.indicatorSize[1])}return this._drawPos=b,{size:this.options.size,target:[{origin:[0,0],target:this.indicator.render()},{transform:g.translate(0,0,1),origin:[0,0],target:this.label.render()}]}},b.exports=c},{"../core/EventHandler":7,"../core/OptionsManager":10,"../core/Surface":14,"../core/Transform":15,"../inputs/GenericSync":27,"../inputs/MouseSync":28,"../inputs/TouchSync":33,"../math/Utilities":40,"../surfaces/CanvasSurface":74}],115:[function(a,b){function c(){g.apply(this,arguments),this.layout=new h,this.buttons=[],this._buttonIds={},this._buttonCallbacks={},this.layout.sequenceFrom(this.buttons),this._add(this.layout),this._optionsManager.on("change",d.bind(this))}function d(a){var b=a.id,c=a.value;if("direction"===b)this.layout.setOptions({dimensions:e.call(this.buttons.length,this.options.direction)});else if("buttons"===b)for(var d in this.buttons)this.buttons[d].setOptions(c);else if("sections"===b)for(var f in this.options.sections)this.defineSection(f,this.options.sections[f])}function e(a,b){return b===f.Direction.X?[a,1]:[1,a]}var f=a("../utilities/Utility"),g=a("../core/View"),h=a("../views/GridLayout"),i=a("./ToggleButton");c.prototype=Object.create(g.prototype),c.prototype.constructor=c,c.DEFAULT_OPTIONS={sections:[],widget:i,size:[void 0,50],direction:f.Direction.X,buttons:{toggleMode:i.ON}},c.prototype.defineSection=function(a,b){var c,d=this._buttonIds[a];if(void 0===d){d=this.buttons.length,this._buttonIds[a]=d;var f=this.options.widget;c=new f,this.buttons[d]=c,this.layout.setOptions({dimensions:e(this.buttons.length,this.options.direction)})}else c=this.buttons[d],c.unbind("select",this._buttonCallbacks[a]);this.options.buttons&&c.setOptions(this.options.buttons),c.setOptions(b),this._buttonCallbacks[a]=this.select.bind(this,a),c.on("select",this._buttonCallbacks[a])},c.prototype.select=function(a){var b=this._buttonIds[a];this.buttons[b]&&this.buttons[b].isSelected()?this._eventOutput.emit("select",{id:a}):this.buttons[b]&&this.buttons[b].select();for(var c=0;c<this.buttons.length;c++)c!==b&&this.buttons[c].deselect()},b.exports=c},{"../core/View":16,"../utilities/Utility":95,"../views/GridLayout":103,"./ToggleButton":116}],116:[function(a,b){function c(a){this.options={content:["",""],offClasses:["off"],onClasses:["on"],size:void 0,outTransition:{curve:"easeInOut",duration:300},inTransition:{curve:"easeInOut",duration:300},toggleMode:c.TOGGLE,crossfade:!0},this._eventOutput=new e,e.setOutputHandler(this,this._eventOutput),this.offSurface=new d,this.offSurface.on("click",function(){this.options.toggleMode!==c.OFF&&this.select()}.bind(this)),this.offSurface.pipe(this._eventOutput),this.onSurface=new d,this.onSurface.on("click",function(){this.options.toggleMode!==c.ON&&this.deselect()}.bind(this)),this.onSurface.pipe(this._eventOutput),this.arbiter=new f({overlap:this.options.crossfade}),this.deselect(),a&&this.setOptions(a)}var d=a("../core/Surface"),e=a("../core/EventHandler"),f=a("../views/RenderController");c.OFF=0,c.ON=1,c.TOGGLE=2,c.prototype.select=function(a){this.selected=!0,this.arbiter.show(this.onSurface,this.options.inTransition),a||this._eventOutput.emit("select")},c.prototype.deselect=function(a){this.selected=!1,this.arbiter.show(this.offSurface,this.options.outTransition),a||this._eventOutput.emit("deselect")},c.prototype.isSelected=function(){return this.selected},c.prototype.setOptions=function(a){void 0!==a.content&&(a.content instanceof Array||(a.content=[a.content,a.content]),this.options.content=a.content,this.offSurface.setContent(this.options.content[0]),this.onSurface.setContent(this.options.content[1])),a.offClasses&&(this.options.offClasses=a.offClasses,this.offSurface.setClasses(this.options.offClasses)),a.onClasses&&(this.options.onClasses=a.onClasses,this.onSurface.setClasses(this.options.onClasses)),void 0!==a.size&&(this.options.size=a.size,this.onSurface.setSize(this.options.size),this.offSurface.setSize(this.options.size)),void 0!==a.toggleMode&&(this.options.toggleMode=a.toggleMode),void 0!==a.outTransition&&(this.options.outTransition=a.outTransition),void 0!==a.inTransition&&(this.options.inTransition=a.inTransition),void 0!==a.crossfade&&(this.options.crossfade=a.crossfade,this.arbiter.setOptions({overlap:this.options.crossfade}))},c.prototype.getSize=function(){return this.options.size},c.prototype.render=function(){return this.arbiter.render()},b.exports=c},{"../core/EventHandler":7,"../core/Surface":14,"../views/RenderController":106}],117:[function(a,b){b.exports={NavigationBar:a("./NavigationBar"),Slider:a("./Slider"),TabBar:a("./TabBar"),ToggleButton:a("./ToggleButton")}},{"./NavigationBar":113,"./Slider":114,"./TabBar":115,"./ToggleButton":116}]},{},[23])(23)}),function(a){if("function"==typeof bootstrap)bootstrap("simplewebrtc",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeSimpleWebRTC=a}else"undefined"!=typeof window?window.SimpleWebRTC=a():global.SimpleWebRTC=a()}(function(){var define,ses,bootstrap,module,exports;return function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a,b,c){function d(a){var b,c,d=this,k=a||{},l=this.config={url:"https://signaling.simplewebrtc.com:443/",socketio:{},connection:null,debug:!1,localVideoEl:"",remoteVideosEl:"",enableDataChannels:!0,autoRequestMedia:!1,autoRemoveVideos:!0,adjustPeerVolume:!0,peerVolumeWhenSpeaking:.25,media:{video:!0,audio:!0},receiveMedia:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},localVideo:{autoplay:!0,mirror:!0,muted:!0}};this.logger=function(){return a.debug?a.logger||console:a.logger||i}();for(b in k)this.config[b]=k[b];this.capabilities=g,f.call(this),c=null===this.config.connection?this.connection=new j(this.config):this.connection=this.config.connection,c.on("connect",function(){d.emit("connectionReady",c.getSessionid()),d.sessionReady=!0,d.testReadiness()}),c.on("message",function(a){var b,c=d.webrtc.getPeers(a.from,a.roomType);"offer"===a.type?(c.length&&c.forEach(function(c){c.sid==a.sid&&(b=c)}),b||(b=d.webrtc.createPeer({id:a.from,sid:a.sid,type:a.roomType,enableDataChannels:d.config.enableDataChannels&&"screen"!==a.roomType,sharemyscreen:"screen"===a.roomType&&!a.broadcaster,broadcaster:"screen"!==a.roomType||a.broadcaster?null:d.connection.getSessionid()}),d.emit("createdPeer",b)),b.handleMessage(a)):c.length&&c.forEach(function(b){a.sid?b.sid===a.sid&&b.handleMessage(a):b.handleMessage(a)})}),c.on("remove",function(a){a.id!==d.connection.getSessionid()&&d.webrtc.removePeers(a.id,a.type)}),a.logger=this.logger,a.debug=!1,this.webrtc=new e(a),["mute","unmute","pauseVideo","resumeVideo","pause","resume","sendToAll","sendDirectlyToAll","getPeers"].forEach(function(a){d[a]=d.webrtc[a].bind(d.webrtc)}),this.webrtc.on("*",function(){d.emit.apply(d,arguments)}),l.debug&&this.on("*",this.logger.log.bind(this.logger,"SimpleWebRTC event:")),this.webrtc.on("localStream",function(){d.testReadiness()}),this.webrtc.on("message",function(a){d.connection.emit("message",a)}),this.webrtc.on("peerStreamAdded",this.handlePeerStreamAdded.bind(this)),this.webrtc.on("peerStreamRemoved",this.handlePeerStreamRemoved.bind(this)),this.config.adjustPeerVolume&&(this.webrtc.on("speaking",this.setVolumeForAll.bind(this,this.config.peerVolumeWhenSpeaking)),this.webrtc.on("stoppedSpeaking",this.setVolumeForAll.bind(this,1))),c.on("stunservers",function(a){d.webrtc.config.peerConnectionConfig.iceServers=a,d.emit("stunservers",a)}),c.on("turnservers",function(a){d.webrtc.config.peerConnectionConfig.iceServers=d.webrtc.config.peerConnectionConfig.iceServers.concat(a),d.emit("turnservers",a)}),this.webrtc.on("iceFailed",function(a){}),this.webrtc.on("connectivityError",function(a){}),this.webrtc.on("audioOn",function(){d.webrtc.sendToAll("unmute",{name:"audio"})}),this.webrtc.on("audioOff",function(){d.webrtc.sendToAll("mute",{name:"audio"})}),this.webrtc.on("videoOn",function(){d.webrtc.sendToAll("unmute",{name:"video"})}),this.webrtc.on("videoOff",function(){d.webrtc.sendToAll("mute",{name:"video"})}),this.webrtc.on("localScreen",function(a){var b=document.createElement("video"),c=d.getRemoteVideoContainer();b.oncontextmenu=function(){return!1},b.id="localScreen",h(a,b),c&&c.appendChild(b),d.emit("localScreenAdded",b),d.connection.emit("shareScreen"),d.webrtc.peers.forEach(function(a){var b;"video"===a.type&&(b=d.webrtc.createPeer({id:a.id,type:"screen",sharemyscreen:!0,enableDataChannels:!1,receiveMedia:{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},broadcaster:d.connection.getSessionid()}),d.emit("createdPeer",b),b.start())})}),this.webrtc.on("localScreenStopped",function(a){d.stopScreenShare()}),this.webrtc.on("channelMessage",function(a,b,c){"volume"==c.type&&d.emit("remoteVolumeChange",a,c.volume)}),this.config.autoRequestMedia&&this.startLocalVideo()}var e=a("./webrtc"),f=a("wildemitter"),g=a("webrtcsupport"),h=a("attachmediastream"),i=a("mockconsole"),j=a("./socketioconnection");d.prototype=Object.create(f.prototype,{constructor:{value:d}}),d.prototype.leaveRoom=function(){this.roomName&&(this.connection.emit("leave"),this.webrtc.peers.forEach(function(a){a.end()}),this.getLocalScreen()&&this.stopScreenShare(),this.emit("leftRoom",this.roomName),this.roomName=void 0)},d.prototype.disconnect=function(){this.connection.disconnect(),delete this.connection},d.prototype.handlePeerStreamAdded=function(a){var b=this,c=this.getRemoteVideoContainer(),d=h(a.stream);a.videoEl=d,d.id=this.getDomId(a),c&&c.appendChild(d),this.emit("videoAdded",d,a),window.setTimeout(function(){b.webrtc.isAudioEnabled()||a.send("mute",{name:"audio"}),b.webrtc.isVideoEnabled()||a.send("mute",{name:"video"})},250)},d.prototype.handlePeerStreamRemoved=function(a){var b=this.getRemoteVideoContainer(),c=a.videoEl;this.config.autoRemoveVideos&&b&&c&&b.removeChild(c),c&&this.emit("videoRemoved",c,a)},d.prototype.getDomId=function(a){return[a.id,a.type,a.broadcaster?"broadcasting":"incoming"].join("_")},d.prototype.setVolumeForAll=function(a){this.webrtc.peers.forEach(function(b){b.videoEl&&(b.videoEl.volume=a)})},d.prototype.joinRoom=function(a,b){var c=this;this.roomName=a,this.connection.emit("join",a,function(d,e){if(d)c.emit("error",d);else{var f,g,h,i;for(f in e.clients){g=e.clients[f];for(h in g)g[h]&&(i=c.webrtc.createPeer({id:f,type:h,enableDataChannels:c.config.enableDataChannels&&"screen"!==h,receiveMedia:{mandatory:{OfferToReceiveAudio:"screen"!==h&&c.config.receiveMedia.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:c.config.receiveMedia.mandatory.OfferToReceiveVideo}}}),c.emit("createdPeer",i),i.start())}}b&&b(d,e),c.emit("joinedRoom",a)})},d.prototype.getEl=function(a){return"string"==typeof a?document.getElementById(a):a},d.prototype.startLocalVideo=function(){var a=this;this.webrtc.startLocalMedia(this.config.media,function(b,c){b?a.emit("localMediaError",b):h(c,a.getLocalVideoContainer(),a.config.localVideo)})},d.prototype.stopLocalVideo=function(){this.webrtc.stopLocalMedia()},d.prototype.getLocalVideoContainer=function(){var a=this.getEl(this.config.localVideoEl);if(a&&"VIDEO"===a.tagName)return a.oncontextmenu=function(){return!1},a;if(a){var b=document.createElement("video");return b.oncontextmenu=function(){return!1},a.appendChild(b),b}},d.prototype.getRemoteVideoContainer=function(){return this.getEl(this.config.remoteVideosEl)},d.prototype.shareScreen=function(a){this.webrtc.startScreenShare(a)},d.prototype.getLocalScreen=function(){return this.webrtc.localScreen},d.prototype.stopScreenShare=function(){this.connection.emit("unshareScreen");var a=document.getElementById("localScreen"),b=this.getRemoteVideoContainer(),c=this.getLocalScreen();this.config.autoRemoveVideos&&b&&a&&b.removeChild(a),a&&this.emit("videoRemoved",a),c&&c.stop(),this.webrtc.peers.forEach(function(a){a.broadcaster&&a.end()})},d.prototype.testReadiness=function(){var a=this;this.webrtc.localStream&&this.sessionReady&&a.emit("readyToCall",a.connection.getSessionid())},d.prototype.createRoom=function(a,b){2===arguments.length?this.connection.emit("create",a,b):this.connection.emit("create",a)},d.prototype.sendFile=function(){return g.dataChannel?void 0:this.emit("error",new Error("DataChannelNotSupported"))},b.exports=d},{"./socketioconnection":3,"./webrtc":2,attachmediastream:7,mockconsole:6,webrtcsupport:5,wildemitter:4}],5:[function(a,b,c){var d,e;window.mozRTCPeerConnection||navigator.mozGetUserMedia?(d="moz",e=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)):(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia)&&(d="webkit",e=navigator.userAgent.match(/Chrom(e|ium)/)&&parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10));var f=window.mozRTCPeerConnection||window.webkitRTCPeerConnection,g=window.mozRTCIceCandidate||window.RTCIceCandidate,h=window.mozRTCSessionDescription||window.RTCSessionDescription,i=window.webkitMediaStream||window.MediaStream,j="https:"===window.location.protocol&&("webkit"===d&&e>=26||"moz"===d&&e>=33),k=window.AudioContext||window.webkitAudioContext,l=document.createElement("video"),m=l&&l.canPlayType&&"probably"===l.canPlayType('video/webm; codecs="vp8", vorbis'),n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;b.exports={prefix:d,browserVersion:e,support:!!f&&m&&!!n,supportRTCPeerConnection:!!f,supportVp8:m,supportGetUserMedia:!!n,supportDataChannel:!!(f&&f.prototype&&f.prototype.createDataChannel),supportWebAudio:!(!k||!k.prototype.createMediaStreamSource),supportMediaStream:!(!i||!i.prototype.removeTrack),supportScreenSharing:!!j,dataChannel:!!(f&&f.prototype&&f.prototype.createDataChannel),webAudio:!(!k||!k.prototype.createMediaStreamSource),mediaStream:!(!i||!i.prototype.removeTrack),screenSharing:!!j,AudioContext:k,PeerConnection:f,SessionDescription:h,IceCandidate:g,MediaStream:i,getUserMedia:n}},{}],4:[function(a,b,c){function d(){this.isWildEmitter=!0,this.callbacks={}}b.exports=d,d.prototype.on=function(a,b,c){var d=3===arguments.length,e=d?arguments[1]:void 0,f=d?arguments[2]:arguments[1];return f._groupName=e,(this.callbacks[a]=this.callbacks[a]||[]).push(f),this},d.prototype.once=function(a,b,c){function d(){e.off(a,d),h.apply(this,arguments)}var e=this,f=3===arguments.length,g=f?arguments[1]:void 0,h=f?arguments[2]:arguments[1];return this.on(a,g,d),this},d.prototype.releaseGroup=function(a){var b,c,d,e;for(b in this.callbacks)for(e=this.callbacks[b],c=0,d=e.length;d>c;c++)e[c]._groupName===a&&(e.splice(c,1),c--,d--);return this},d.prototype.off=function(a,b){var c,d=this.callbacks[a];return d?1===arguments.length?(delete this.callbacks[a],this):(c=d.indexOf(b),d.splice(c,1),0===d.length&&delete this.callbacks[a],this):this},d.prototype.emit=function(a){var b,c,d,e=[].slice.call(arguments,1),f=this.callbacks[a],g=this.getWildcardCallbacks(a);if(f)for(d=f.slice(),b=0,c=d.length;c>b&&d[b];++b)d[b].apply(this,e);if(g)for(c=g.length,d=g.slice(),b=0,c=d.length;c>b&&d[b];++b)d[b].apply(this,[a].concat(e));return this},d.prototype.getWildcardCallbacks=function(a){var b,c,d=[];for(b in this.callbacks)c=b.split("*"),("*"===b||2===c.length&&a.slice(0,c[0].length)===c[0])&&(d=d.concat(this.callbacks[b]));return d}},{}],7:[function(a,b,c){b.exports=function(a,b,c){var d,e=window.URL,f={autoplay:!0,mirror:!1,muted:!1},g=b||document.createElement("video");if(c)for(d in c)f[d]=c[d];if(f.autoplay&&(g.autoplay="autoplay"),f.muted&&(g.muted=!0),f.mirror&&["","moz","webkit","o","ms"].forEach(function(a){var b=a?a+"Transform":"transform";g.style[b]="scaleX(-1)"}),e&&e.createObjectURL)g.src=e.createObjectURL(a);else if(g.srcObject)g.srcObject=a;else{if(!g.mozSrcObject)return!1;g.mozSrcObject=a}return g}},{}],6:[function(a,b,c){for(var d="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),e=d.length,f=function(){},g={};e--;)g[d[e]]=f;b.exports=g},{}],2:[function(a,b,c){function d(a){var b,c=this,d=a||{};this.config={debug:!1,peerConnectionConfig:{iceServers:[{url:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[{DtlsSrtpKeyAgreement:!0}]},receiveMedia:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},enableDataChannels:!0};this.screenSharingSupport=f.screenSharing,this.logger=function(){return a.debug?a.logger||console:a.logger||g}();for(b in d)this.config[b]=d[b];f.support||this.logger.error("Your browser doesn't seem to support WebRTC"),this.peers=[],h.call(this,this.config),this.on("speaking",function(){c.hardMuted||c.peers.forEach(function(a){if(a.enableDataChannels){var b=a.getDataChannel("hark");if("open"!=b.readyState)return;b.send(JSON.stringify({type:"speaking"}))}})}),this.on("stoppedSpeaking",function(){c.hardMuted||c.peers.forEach(function(a){if(a.enableDataChannels){var b=a.getDataChannel("hark");if("open"!=b.readyState)return;b.send(JSON.stringify({type:"stoppedSpeaking"}))}})}),this.on("volumeChange",function(a,b){c.hardMuted||c.peers.forEach(function(b){if(b.enableDataChannels){var c=b.getDataChannel("hark");if("open"!=c.readyState)return;c.send(JSON.stringify({type:"volume",volume:a}))}})}),this.config.debug&&this.on("*",function(a,b,d){var e;e=c.config.logger===g?console:c.logger,e.log("event:",a,b,d)})}var e=a("util"),f=a("webrtcsupport"),g=(a("wildemitter"),a("mockconsole")),h=a("localmedia"),i=a("./peer");e.inherits(d,h),d.prototype.createPeer=function(a){var b;return a.parent=this,b=new i(a),this.peers.push(b),b},d.prototype.removePeers=function(a,b){this.getPeers(a,b).forEach(function(a){a.end()})},d.prototype.getPeers=function(a,b){return this.peers.filter(function(c){return!(a&&c.id!==a||b&&c.type!==b)})},d.prototype.sendToAll=function(a,b){this.peers.forEach(function(c){c.send(a,b)})},d.prototype.sendDirectlyToAll=function(a,b,c){this.peers.forEach(function(d){d.enableDataChannels&&d.sendDirectly(a,b,c)})},b.exports=d},{"./peer":9,localmedia:10,mockconsole:6,util:8,webrtcsupport:5,wildemitter:4}],3:[function(a,b,c){function d(a){this.connection=e.connect(a.url,a.socketio)}var e=a("socket.io-client");d.prototype.on=function(a,b){this.connection.on(a,b)},d.prototype.emit=function(){this.connection.emit.apply(this.connection,arguments)},d.prototype.getSessionid=function(){return this.connection.socket.sessionid},d.prototype.disconnect=function(){return this.connection.disconnect()},b.exports=d},{"socket.io-client":11}],8:[function(a,b,c){function d(a){return Array.isArray(a)||"object"==typeof a&&"[object Array]"===Object.prototype.toString.call(a)}function e(a){"object"==typeof a&&"[object RegExp]"===Object.prototype.toString.call(a)}function f(a){return"object"==typeof a&&"[object Date]"===Object.prototype.toString.call(a)}a("events");c.isArray=d,c.isDate=function(a){return"[object Date]"===Object.prototype.toString.call(a)},c.isRegExp=function(a){return"[object RegExp]"===Object.prototype.toString.call(a)},c.print=function(){},c.puts=function(){},c.debug=function(){},c.inspect=function(a,b,i,j){function k(a,i){if(a&&"function"==typeof a.inspect&&a!==c&&(!a.constructor||a.constructor.prototype!==a))return a.inspect(i);switch(typeof a){case"undefined":return m("undefined","undefined");case"string":var j="'"+JSON.stringify(a).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return m(j,"string");case"number":return m(""+a,"number");case"boolean":return m(""+a,"boolean")}if(null===a)return m("null","null");var n=g(a),o=b?h(a):n;if("function"==typeof a&&0===o.length){if(e(a))return m(""+a,"regexp");var p=a.name?": "+a.name:"";return m("[Function"+p+"]","special")}if(f(a)&&0===o.length)return m(a.toUTCString(),"date");var q,r,s;if(d(a)?(r="Array",s=["[","]"]):(r="Object",s=["{","}"]),"function"==typeof a){var t=a.name?": "+a.name:"";q=e(a)?" "+a:" [Function"+t+"]"}else q="";if(f(a)&&(q=" "+a.toUTCString()),0===o.length)return s[0]+q+s[1];if(0>i)return e(a)?m(""+a,"regexp"):m("[Object]","special");l.push(a);var u=o.map(function(b){var c,e;if(a.__lookupGetter__&&(a.__lookupGetter__(b)?e=a.__lookupSetter__(b)?m("[Getter/Setter]","special"):m("[Getter]","special"):a.__lookupSetter__(b)&&(e=m("[Setter]","special"))),n.indexOf(b)<0&&(c="["+b+"]"),e||(l.indexOf(a[b])<0?(e=null===i?k(a[b]):k(a[b],i-1),e.indexOf("\n")>-1&&(e=d(a)?e.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+e.split("\n").map(function(a){return"   "+a}).join("\n"))):e=m("[Circular]","special")),"undefined"==typeof c){if("Array"===r&&b.match(/^\d+$/))return e;c=JSON.stringify(""+b),c.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(c=c.substr(1,c.length-2),c=m(c,"name")):(c=c.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),c=m(c,"string"))}return c+": "+e});l.pop();var v=0,w=u.reduce(function(a,b){return v++,b.indexOf("\n")>=0&&v++,a+b.length+1},0);return u=w>50?s[0]+(""===q?"":q+"\n ")+" "+u.join(",\n  ")+" "+s[1]:s[0]+q+" "+u.join(", ")+" "+s[1]}var l=[],m=function(a,b){var c={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},d={special:"cyan",number:"blue","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"}[b];return d?"["+c[d][0]+"m"+a+"["+c[d][1]+"m":a};return j||(m=function(a,b){return a}),k(a,"undefined"==typeof i?2:i)};c.log=function(a){},c.pump=null;var g=Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b},h=Object.getOwnPropertyNames||function(a){var b=[];for(var c in a)Object.hasOwnProperty.call(a,c)&&b.push(c);return b},i=Object.create||function(a,b){var c;if(null===a)c={__proto__:null};else{if("object"!=typeof a)throw new TypeError("typeof prototype["+typeof a+"] != 'object'");var d=function(){};d.prototype=a,c=new d,c.__proto__=a}return"undefined"!=typeof b&&Object.defineProperties&&Object.defineProperties(c,b),c};c.inherits=function(a,b){a.super_=b,a.prototype=i(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})};var j=/%[sdj%]/g;c.format=function(a){if("string"!=typeof a){for(var b=[],d=0;d<arguments.length;d++)b.push(c.inspect(arguments[d]));return b.join(" ")}for(var d=1,e=arguments,f=e.length,g=String(a).replace(j,function(a){if("%%"===a)return"%";if(d>=f)return a;switch(a){case"%s":return String(e[d++]);case"%d":return Number(e[d++]);case"%j":return JSON.stringify(e[d++]);default:return a}}),h=e[d];f>d;h=e[++d])g+=null===h||"object"!=typeof h?" "+h:" "+c.inspect(h);return g}},{events:12}],11:[function(require,module,exports){var io="undefined"==typeof module?{}:module.exports;!function(){if(function(a,b){var c=a;c.version="0.9.16",c.protocol=1,c.transports=[],c.j=[],c.sockets={},c.connect=function(a,d){var e,f,g=c.util.parseUri(a);b&&b.location&&(g.protocol=g.protocol||b.location.protocol.slice(0,-1),g.host=g.host||(b.document?b.document.domain:b.location.hostname),g.port=g.port||b.location.port),e=c.util.uniqueUri(g);var h={host:g.host,secure:"https"==g.protocol,port:g.port||("https"==g.protocol?443:80),query:g.query||""};return c.util.merge(h,d),(h["force new connection"]||!c.sockets[e])&&(f=new c.Socket(h)),!h["force new connection"]&&f&&(c.sockets[e]=f),f=f||c.sockets[e],f.of(g.path.length>1?g.path:"")}}("object"==typeof module?module.exports:this.io={},this),function(a,b){var c=a.util={},d=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];c.parseUri=function(a){for(var b=d.exec(a||""),c={},f=14;f--;)c[e[f]]=b[f]||"";return c},c.uniqueUri=function(a){var c=a.protocol,d=a.host,e=a.port;return"document"in b?(d=d||document.domain,e=e||("https"==c&&"https:"!==document.location.protocol?443:document.location.port)):(d=d||"localhost",e||"https"!=c||(e=443)),(c||"http")+"://"+d+":"+(e||80)},c.query=function(a,b){var d=c.chunkQuery(a||""),e=[];c.merge(d,c.chunkQuery(b||""));for(var f in d)d.hasOwnProperty(f)&&e.push(f+"="+d[f]);return e.length?"?"+e.join("&"):""},c.chunkQuery=function(a){for(var b,c={},d=a.split("&"),e=0,f=d.length;f>e;++e)b=d[e].split("="),b[0]&&(c[b[0]]=b[1]);return c};var f=!1;c.load=function(a){return"document"in b&&"complete"===document.readyState||f?a():void c.on(b,"load",a,!1)},c.on=function(a,b,c,d){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener&&a.addEventListener(b,c,d)},c.request=function(a){if(a&&"undefined"!=typeof XDomainRequest&&!c.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!a||c.ua.hasCORS))return new XMLHttpRequest;if(!a)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(b){}return null},"undefined"!=typeof window&&c.load(function(){f=!0}),c.defer=function(a){return c.ua.webkit&&"undefined"==typeof importScripts?void c.load(function(){setTimeout(a,100)}):a()},c.merge=function(a,b,d,e){var f,g=e||[],h="undefined"==typeof d?2:d;for(f in b)b.hasOwnProperty(f)&&c.indexOf(g,f)<0&&("object"==typeof a[f]&&h?c.merge(a[f],b[f],h-1,g):(a[f]=b[f],g.push(b[f])));return a},c.mixin=function(a,b){c.merge(a.prototype,b.prototype)},c.inherit=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c},c.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},c.intersect=function(a,b){for(var d=[],e=a.length>b.length?a:b,f=a.length>b.length?b:a,g=0,h=f.length;h>g;g++)~c.indexOf(e,f[g])&&d.push(f[g]);return d},c.indexOf=function(a,b,c){for(var d=a.length,c=0>c?0>c+d?0:c+d:c||0;d>c&&a[c]!==b;c++);return c>=d?-1:c},c.toArray=function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(a[c]);return b},c.ua={},c.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var a=new XMLHttpRequest}catch(b){return!1}return void 0!=a.withCredentials}(),c.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),c.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(a,b){function c(){}a.EventEmitter=c,c.prototype.on=function(a,c){return this.$events||(this.$events={}),this.$events[a]?b.util.isArray(this.$events[a])?this.$events[a].push(c):this.$events[a]=[this.$events[a],c]:this.$events[a]=c,this},c.prototype.addListener=c.prototype.on,c.prototype.once=function(a,b){function c(){d.removeListener(a,c),b.apply(this,arguments)}var d=this;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,c){if(this.$events&&this.$events[a]){var d=this.$events[a];if(b.util.isArray(d)){for(var e=-1,f=0,g=d.length;g>f;f++)if(d[f]===c||d[f].listener&&d[f].listener===c){e=f;break}if(0>e)return this;d.splice(e,1),d.length||delete this.$events[a]}else(d===c||d.listener&&d.listener===c)&&delete this.$events[a]}return this},c.prototype.removeAllListeners=function(a){return void 0===a?(this.$events={},this):(this.$events&&this.$events[a]&&(this.$events[a]=null),this)},c.prototype.listeners=function(a){return this.$events||(this.$events={}),this.$events[a]||(this.$events[a]=[]),b.util.isArray(this.$events[a])||(this.$events[a]=[this.$events[a]]),this.$events[a]},c.prototype.emit=function(a){if(!this.$events)return!1;var c=this.$events[a];if(!c)return!1;var d=Array.prototype.slice.call(arguments,1);if("function"==typeof c)c.apply(this,d);else{if(!b.util.isArray(c))return!1;for(var e=c.slice(),f=0,g=e.length;g>f;f++)e[f].apply(this,d)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){"use strict";function f(a){return 10>a?"0"+a:a}function date(a,b){return isFinite(a.valueOf())?a.getUTCFullYear()+"-"+f(a.getUTCMonth()+1)+"-"+f(a.getUTCDate())+"T"+f(a.getUTCHours())+":"+f(a.getUTCMinutes())+":"+f(a.getUTCSeconds())+"Z":null}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i instanceof Date&&(i=date(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})},JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){
return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(a,b){var c=a.parser={},d=c.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],e=c.reasons=["transport not supported","client not handshaken","unauthorized"],f=c.advice=["reconnect"],g=b.JSON,h=b.util.indexOf;c.encodePacket=function(a){var b=h(d,a.type),c=a.id||"",i=a.endpoint||"",j=a.ack,k=null;switch(a.type){case"error":var l=a.reason?h(e,a.reason):"",m=a.advice?h(f,a.advice):"";(""!==l||""!==m)&&(k=l+(""!==m?"+"+m:""));break;case"message":""!==a.data&&(k=a.data);break;case"event":var n={name:a.name};a.args&&a.args.length&&(n.args=a.args),k=g.stringify(n);break;case"json":k=g.stringify(a.data);break;case"connect":a.qs&&(k=a.qs);break;case"ack":k=a.ackId+(a.args&&a.args.length?"+"+g.stringify(a.args):"")}var o=[b,c+("data"==j?"+":""),i];return null!==k&&void 0!==k&&o.push(k),o.join(":")},c.encodePayload=function(a){var b="";if(1==a.length)return a[0];for(var c=0,d=a.length;d>c;c++){var e=a[c];b+="�"+e.length+"�"+a[c]}return b};var i=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;c.decodePacket=function(a){var b=a.match(i);if(!b)return{};var c=b[2]||"",a=b[5]||"",h={type:d[b[1]],endpoint:b[4]||""};switch(c&&(h.id=c,b[3]?h.ack="data":h.ack=!0),h.type){case"error":var b=a.split("+");h.reason=e[b[0]]||"",h.advice=f[b[1]]||"";break;case"message":h.data=a||"";break;case"event":try{var j=g.parse(a);h.name=j.name,h.args=j.args}catch(k){}h.args=h.args||[];break;case"json":try{h.data=g.parse(a)}catch(k){}break;case"connect":h.qs=a||"";break;case"ack":var b=a.match(/^([0-9]+)(\+)?(.*)/);if(b&&(h.ackId=b[1],h.args=[],b[3]))try{h.args=b[3]?g.parse(b[3]):[]}catch(k){}break;case"disconnect":case"heartbeat":}return h},c.decodePayload=function(a){if("�"==a.charAt(0)){for(var b=[],d=1,e="";d<a.length;d++)"�"==a.charAt(d)?(b.push(c.decodePacket(a.substr(d+1).substr(0,e))),d+=Number(e)+1,e=""):e+=a.charAt(d);return b}return[c.decodePacket(a)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b){function c(a,b){this.socket=a,this.sessid=b}a.Transport=c,b.util.mixin(c,b.EventEmitter),c.prototype.heartbeats=function(){return!0},c.prototype.onData=function(a){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==a){var c=b.parser.decodePayload(a);if(c&&c.length)for(var d=0,e=c.length;e>d;d++)this.onPacket(c[d])}return this},c.prototype.onPacket=function(a){return this.socket.setHeartbeatTimeout(),"heartbeat"==a.type?this.onHeartbeat():("connect"==a.type&&""==a.endpoint&&this.onConnect(),"error"==a.type&&"reconnect"==a.advice&&(this.isOpen=!1),this.socket.onPacket(a),this)},c.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var a=this;this.closeTimeout=setTimeout(function(){a.onDisconnect()},this.socket.closeTimeout)}},c.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},c.prototype.onConnect=function(){return this.socket.onConnect(),this},c.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},c.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},c.prototype.packet=function(a){this.send(b.parser.encodePacket(a))},c.prototype.onHeartbeat=function(a){this.packet({type:"heartbeat"})},c.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},c.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},c.prototype.prepareUrl=function(){var a=this.socket.options;return this.scheme()+"://"+a.host+":"+a.port+"/"+a.resource+"/"+b.protocol+"/"+this.name+"/"+this.sessid},c.prototype.ready=function(a,b){b.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b,c){function d(a){if(this.options={port:80,secure:!1,document:"document"in c?document:!1,resource:"socket.io",transports:b.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},b.util.merge(this.options,a),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||b.util.ua.hasCORS)){var d=this;b.util.on(c,"beforeunload",function(){d.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function e(){}a.Socket=d,b.util.mixin(d,b.EventEmitter),d.prototype.of=function(a){return this.namespaces[a]||(this.namespaces[a]=new b.SocketNamespace(this,a),""!==a&&this.namespaces[a].packet({type:"connect"})),this.namespaces[a]},d.prototype.publish=function(){this.emit.apply(this,arguments);var a;for(var b in this.namespaces)this.namespaces.hasOwnProperty(b)&&(a=this.of(b),a.$emit.apply(a,arguments))},d.prototype.handshake=function(a){function c(b){b instanceof Error?(d.connecting=!1,d.onError(b.message)):a.apply(null,b.split(":"))}var d=this,f=this.options,g=["http"+(f.secure?"s":"")+":/",f.host+":"+f.port,f.resource,b.protocol,b.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!b.util.ua.hasCORS){var h=document.getElementsByTagName("script")[0],i=document.createElement("script");i.src=g+"&jsonp="+b.j.length,h.parentNode.insertBefore(i,h),b.j.push(function(a){c(a),i.parentNode.removeChild(i)})}else{var j=b.util.request();j.open("GET",g,!0),this.isXDomain()&&(j.withCredentials=!0),j.onreadystatechange=function(){4==j.readyState&&(j.onreadystatechange=e,200==j.status?c(j.responseText):403==j.status?d.onError(j.responseText):(d.connecting=!1,!d.reconnecting&&d.onError(j.responseText)))},j.send(null)}},d.prototype.getTransport=function(a){for(var c,d=a||this.transports,e=0;c=d[e];e++)if(b.Transport[c]&&b.Transport[c].check(this)&&(!this.isXDomain()||b.Transport[c].xdomainCheck(this)))return new b.Transport[c](this,this.sessionid);return null},d.prototype.connect=function(a){if(this.connecting)return this;var c=this;return c.connecting=!0,this.handshake(function(d,e,f,g){function h(a){return c.transport&&c.transport.clearTimeouts(),c.transport=c.getTransport(a),c.transport?void c.transport.ready(c,function(){c.connecting=!0,c.publish("connecting",c.transport.name),c.transport.open(),c.options["connect timeout"]&&(c.connectTimeoutTimer=setTimeout(function(){if(!c.connected&&(c.connecting=!1,c.options["try multiple transports"])){for(var a=c.transports;a.length>0&&a.splice(0,1)[0]!=c.transport.name;);a.length?h(a):c.publish("connect_failed")}},c.options["connect timeout"]))}):c.publish("connect_failed")}c.sessionid=d,c.closeTimeout=1e3*f,c.heartbeatTimeout=1e3*e,c.transports||(c.transports=c.origTransports=g?b.util.intersect(g.split(","),c.options.transports):c.options.transports),c.setHeartbeatTimeout(),h(c.transports),c.once("connect",function(){clearTimeout(c.connectTimeoutTimer),a&&"function"==typeof a&&a()})}),this},d.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var a=this;this.heartbeatTimeoutTimer=setTimeout(function(){a.transport.onClose()},this.heartbeatTimeout)}},d.prototype.packet=function(a){return this.connected&&!this.doBuffer?this.transport.packet(a):this.buffer.push(a),this},d.prototype.setBuffer=function(a){this.doBuffer=a,!a&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},d.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},d.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},d.prototype.disconnectSync=function(){var a=b.util.request(),c=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,b.protocol,"",this.sessionid].join("/")+"/?disconnect=1";a.open("GET",c,!1),a.send(null),this.onDisconnect("booted")},d.prototype.isXDomain=function(){var a=c.location.port||("https:"==c.location.protocol?443:80);return this.options.host!==c.location.hostname||this.options.port!=a},d.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},d.prototype.onOpen=function(){this.open=!0},d.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},d.prototype.onPacket=function(a){this.of(a.endpoint).onPacket(a)},d.prototype.onError=function(a){a&&a.advice&&"reconnect"===a.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",a&&a.reason?a.reason:a)},d.prototype.onDisconnect=function(a){var b=this.connected,c=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(b||c)&&(this.transport.close(),this.transport.clearTimeouts(),b&&(this.publish("disconnect",a),"booted"!=a&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},d.prototype.reconnect=function(){function a(){if(c.connected){for(var a in c.namespaces)c.namespaces.hasOwnProperty(a)&&""!==a&&c.namespaces[a].packet({type:"connect"});c.publish("reconnect",c.transport.name,c.reconnectionAttempts)}clearTimeout(c.reconnectionTimer),c.removeListener("connect_failed",b),c.removeListener("connect",b),c.reconnecting=!1,delete c.reconnectionAttempts,delete c.reconnectionDelay,delete c.reconnectionTimer,delete c.redoTransports,c.options["try multiple transports"]=e}function b(){return c.reconnecting?c.connected?a():c.connecting&&c.reconnecting?c.reconnectionTimer=setTimeout(b,1e3):void(c.reconnectionAttempts++>=d?c.redoTransports?(c.publish("reconnect_failed"),a()):(c.on("connect_failed",b),c.options["try multiple transports"]=!0,c.transports=c.origTransports,c.transport=c.getTransport(),c.redoTransports=!0,c.connect()):(c.reconnectionDelay<f&&(c.reconnectionDelay*=2),c.connect(),c.publish("reconnecting",c.reconnectionDelay,c.reconnectionAttempts),c.reconnectionTimer=setTimeout(b,c.reconnectionDelay))):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var c=this,d=this.options["max reconnection attempts"],e=this.options["try multiple transports"],f=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(b,this.reconnectionDelay),this.on("connect",b)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b){function c(a,b){this.socket=a,this.name=b||"",this.flags={},this.json=new d(this,"json"),this.ackPackets=0,this.acks={}}function d(a,b){this.namespace=a,this.name=b}a.SocketNamespace=c,b.util.mixin(c,b.EventEmitter),c.prototype.$emit=b.EventEmitter.prototype.emit,c.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},c.prototype.packet=function(a){return a.endpoint=this.name,this.socket.packet(a),this.flags={},this},c.prototype.send=function(a,b){var c={type:this.flags.json?"json":"message",data:a};return"function"==typeof b&&(c.id=++this.ackPackets,c.ack=!0,this.acks[c.id]=b),this.packet(c)},c.prototype.emit=function(a){var b=Array.prototype.slice.call(arguments,1),c=b[b.length-1],d={type:"event",name:a};return"function"==typeof c&&(d.id=++this.ackPackets,d.ack="data",this.acks[d.id]=c,b=b.slice(0,b.length-1)),d.args=b,this.packet(d)},c.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},c.prototype.onPacket=function(a){function c(){d.packet({type:"ack",args:b.util.toArray(arguments),ackId:a.id})}var d=this;switch(a.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(a.reason||"booted"):this.$emit("disconnect",a.reason);break;case"message":case"json":var e=["message",a.data];"data"==a.ack?e.push(c):a.ack&&this.packet({type:"ack",ackId:a.id}),this.$emit.apply(this,e);break;case"event":var e=[a.name].concat(a.args);"data"==a.ack&&e.push(c),this.$emit.apply(this,e);break;case"ack":this.acks[a.ackId]&&(this.acks[a.ackId].apply(this,a.args),delete this.acks[a.ackId]);break;case"error":a.advice?this.socket.onError(a):"unauthorized"==a.reason?this.$emit("connect_failed",a.reason):this.$emit("error",a.reason)}},d.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},d.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b,c){function d(a){b.Transport.apply(this,arguments)}a.websocket=d,b.util.inherit(d,b.Transport),d.prototype.name="websocket",d.prototype.open=function(){var a,d=b.util.query(this.socket.options.query),e=this;return a||(a=c.MozWebSocket||c.WebSocket),this.websocket=new a(this.prepareUrl()+d),this.websocket.onopen=function(){e.onOpen(),e.socket.setBuffer(!1)},this.websocket.onmessage=function(a){e.onData(a.data)},this.websocket.onclose=function(){e.onClose(),e.socket.setBuffer(!0)},this.websocket.onerror=function(a){e.onError(a)},this},b.util.ua.iDevice?d.prototype.send=function(a){var b=this;return setTimeout(function(){b.websocket.send(a)},0),this}:d.prototype.send=function(a){return this.websocket.send(a),this},d.prototype.payload=function(a){for(var b=0,c=a.length;c>b;b++)this.packet(a[b]);return this},d.prototype.close=function(){return this.websocket.close(),this},d.prototype.onError=function(a){this.socket.onError(a)},d.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},d.check=function(){return"WebSocket"in c&&!("__addTask"in WebSocket)||"MozWebSocket"in c},d.xdomainCheck=function(){return!0},b.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b){function c(){b.Transport.websocket.apply(this,arguments)}a.flashsocket=c,b.util.inherit(c,b.Transport.websocket),c.prototype.name="flashsocket",c.prototype.open=function(){var a=this,c=arguments;return WebSocket.__addTask(function(){b.Transport.websocket.prototype.open.apply(a,c)}),this},c.prototype.send=function(){var a=this,c=arguments;return WebSocket.__addTask(function(){b.Transport.websocket.prototype.send.apply(a,c)}),this},c.prototype.close=function(){return WebSocket.__tasks.length=0,b.Transport.websocket.prototype.close.call(this),this},c.prototype.ready=function(a,d){function e(){var b=a.options,e=b["flash policy port"],g=["http"+(b.secure?"s":"")+":/",b.host+":"+b.port,b.resource,"static/flashsocket","WebSocketMain"+(a.isXDomain()?"Insecure":"")+".swf"];c.loaded||("undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=g.join("/")),843!==e&&WebSocket.loadFlashPolicyFile("xmlsocket://"+b.host+":"+e),WebSocket.__initialize(),c.loaded=!0),d.call(f)}var f=this;return document.body?e():void b.util.load(e)},c.check=function(){return"undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject?swfobject.getFlashPlayerVersion().major>=10:!1},c.xdomainCheck=function(){return!0},"undefined"!=typeof window&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0),b.transports.push("flashsocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),"undefined"!=typeof window)var swfobject=function(){function a(){if(!R){try{var a=K.getElementsByTagName("body")[0].appendChild(q("span"));a.parentNode.removeChild(a)}catch(b){return}R=!0;for(var c=N.length,d=0;c>d;d++)N[d]()}}function b(a){R?a():N[N.length]=a}function c(a){if(typeof J.addEventListener!=C)J.addEventListener("load",a,!1);else if(typeof K.addEventListener!=C)K.addEventListener("load",a,!1);else if(typeof J.attachEvent!=C)r(J,"onload",a);else if("function"==typeof J.onload){var b=J.onload;J.onload=function(){b(),a()}}else J.onload=a}function d(){M?e():f()}function e(){var a=K.getElementsByTagName("body")[0],b=q(D);b.setAttribute("type",G);var c=a.appendChild(b);if(c){var d=0;!function(){if(typeof c.GetVariable!=C){var e=c.GetVariable("$version");e&&(e=e.split(" ")[1].split(","),U.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)])}else if(10>d)return d++,void setTimeout(arguments.callee,10);a.removeChild(b),c=null,f()}()}else f()}function f(){var a=O.length;if(a>0)for(var b=0;a>b;b++){var c=O[b].id,d=O[b].callbackFn,e={success:!1,id:c};if(U.pv[0]>0){var f=p(c);if(f)if(!s(O[b].swfVersion)||U.wk&&U.wk<312)if(O[b].expressInstall&&h()){var k={};k.data=O[b].expressInstall,k.width=f.getAttribute("width")||"0",k.height=f.getAttribute("height")||"0",f.getAttribute("class")&&(k.styleclass=f.getAttribute("class")),f.getAttribute("align")&&(k.align=f.getAttribute("align"));for(var l={},m=f.getElementsByTagName("param"),n=m.length,o=0;n>o;o++)"movie"!=m[o].getAttribute("name").toLowerCase()&&(l[m[o].getAttribute("name")]=m[o].getAttribute("value"));i(k,l,c,d)}else j(f),d&&d(e);else u(c,!0),d&&(e.success=!0,e.ref=g(c),d(e))}else if(u(c,!0),d){var q=g(c);q&&typeof q.SetVariable!=C&&(e.success=!0,e.ref=q),d(e)}}}function g(a){var b=null,c=p(a);if(c&&"OBJECT"==c.nodeName)if(typeof c.SetVariable!=C)b=c;else{var d=c.getElementsByTagName(D)[0];d&&(b=d)}return b}function h(){return!S&&s("6.0.65")&&(U.win||U.mac)&&!(U.wk&&U.wk<312)}function i(a,b,c,d){S=!0,y=d||null,z={success:!1,id:c};var e=p(c);if(e){"OBJECT"==e.nodeName?(w=k(e),x=null):(w=e,x=c),a.id=H,(typeof a.width==C||!/%$/.test(a.width)&&parseInt(a.width,10)<310)&&(a.width="310"),(typeof a.height==C||!/%$/.test(a.height)&&parseInt(a.height,10)<137)&&(a.height="137"),K.title=K.title.slice(0,47)+" - Flash Player Installation";var f=U.ie&&U.win?["Active"].concat("").join("X"):"PlugIn",g="MMredirectURL="+J.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+K.title;if(typeof b.flashvars!=C?b.flashvars+="&"+g:b.flashvars=g,U.ie&&U.win&&4!=e.readyState){var h=q("div");c+="SWFObjectNew",h.setAttribute("id",c),e.parentNode.insertBefore(h,e),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}l(a,b,c)}}function j(a){if(U.ie&&U.win&&4!=a.readyState){var b=q("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(k(a),b),a.style.display="none",function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}else a.parentNode.replaceChild(k(a),a)}function k(a){var b=q("div");if(U.win&&U.ie)b.innerHTML=a.innerHTML;else{var c=a.getElementsByTagName(D)[0];if(c){var d=c.childNodes;if(d)for(var e=d.length,f=0;e>f;f++)1==d[f].nodeType&&"PARAM"==d[f].nodeName||8==d[f].nodeType||b.appendChild(d[f].cloneNode(!0))}}return b}function l(a,b,c){var d,e=p(c);if(U.wk&&U.wk<312)return d;if(e)if(typeof a.id==C&&(a.id=c),U.ie&&U.win){var f="";for(var g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?f+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(f+=" "+g+'="'+a[g]+'"'));var h="";for(var i in b)b[i]!=Object.prototype[i]&&(h+='<param name="'+i+'" value="'+b[i]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+h+"</object>",P[P.length]=a.id,d=p(a.id)}else{var j=q(D);j.setAttribute("type",G);for(var k in a)a[k]!=Object.prototype[k]&&("styleclass"==k.toLowerCase()?j.setAttribute("class",a[k]):"classid"!=k.toLowerCase()&&j.setAttribute(k,a[k]));for(var l in b)b[l]!=Object.prototype[l]&&"movie"!=l.toLowerCase()&&m(j,l,b[l]);e.parentNode.replaceChild(j,e),d=j}return d}function m(a,b,c){var d=q("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function n(a){var b=p(a);b&&"OBJECT"==b.nodeName&&(U.ie&&U.win?(b.style.display="none",function(){4==b.readyState?o(a):setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function o(a){var b=p(a);if(b){for(var c in b)"function"==typeof b[c]&&(b[c]=null);b.parentNode.removeChild(b)}}function p(a){var b=null;try{b=K.getElementById(a)}catch(c){}return b}function q(a){return K.createElement(a)}function r(a,b,c){a.attachEvent(b,c),Q[Q.length]=[a,b,c]}function s(a){var b=U.pv,c=a.split(".");return c[0]=parseInt(c[0],10),c[1]=parseInt(c[1],10)||0,c[2]=parseInt(c[2],10)||0,b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function t(a,b,c,d){if(!U.ie||!U.mac){var e=K.getElementsByTagName("head")[0];if(e){var f=c&&"string"==typeof c?c:"screen";if(d&&(A=null,B=null),!A||B!=f){var g=q("style");g.setAttribute("type","text/css"),g.setAttribute("media",f),A=e.appendChild(g),U.ie&&U.win&&typeof K.styleSheets!=C&&K.styleSheets.length>0&&(A=K.styleSheets[K.styleSheets.length-1]),B=f}U.ie&&U.win?A&&typeof A.addRule==D&&A.addRule(a,b):A&&typeof K.createTextNode!=C&&A.appendChild(K.createTextNode(a+" {"+b+"}"))}}}function u(a,b){if(T){var c=b?"visible":"hidden";R&&p(a)?p(a).style.visibility=c:t("#"+a,"visibility:"+c)}}function v(a){var b=/[\\\"<>\.;]/,c=null!=b.exec(a);return c&&typeof encodeURIComponent!=C?encodeURIComponent(a):a}var w,x,y,z,A,B,C="undefined",D="object",E="Shockwave Flash",F="ShockwaveFlash.ShockwaveFlash",G="application/x-shockwave-flash",H="SWFObjectExprInst",I="onreadystatechange",J=window,K=document,L=navigator,M=!1,N=[d],O=[],P=[],Q=[],R=!1,S=!1,T=!0,U=function(){var a=typeof K.getElementById!=C&&typeof K.getElementsByTagName!=C&&typeof K.createElement!=C,b=L.userAgent.toLowerCase(),c=L.platform.toLowerCase(),d=c?/win/.test(c):/win/.test(b),e=c?/mac/.test(c):/mac/.test(b),f=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,g=!1,h=[0,0,0],i=null;if(typeof L.plugins!=C&&typeof L.plugins[E]==D)i=L.plugins[E].description,!i||typeof L.mimeTypes!=C&&L.mimeTypes[G]&&!L.mimeTypes[G].enabledPlugin||(M=!0,g=!1,i=i.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),h[0]=parseInt(i.replace(/^(.*)\..*$/,"$1"),10),h[1]=parseInt(i.replace(/^.*\.(.*)\s.*$/,"$1"),10),h[2]=/[a-zA-Z]/.test(i)?parseInt(i.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof J[["Active"].concat("Object").join("X")]!=C)try{var j=new(window[["Active"].concat("Object").join("X")])(F);j&&(i=j.GetVariable("$version"),i&&(g=!0,i=i.split(" ")[1].split(","),h=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]))}catch(k){}return{w3:a,pv:h,wk:f,ie:g,win:d,mac:e}}();(function(){U.w3&&((typeof K.readyState!=C&&"complete"==K.readyState||typeof K.readyState==C&&(K.getElementsByTagName("body")[0]||K.body))&&a(),R||(typeof K.addEventListener!=C&&K.addEventListener("DOMContentLoaded",a,!1),U.ie&&U.win&&(K.attachEvent(I,function(){"complete"==K.readyState&&(K.detachEvent(I,arguments.callee),a())}),J==top&&!function(){if(!R){try{K.documentElement.doScroll("left")}catch(b){return void setTimeout(arguments.callee,0)}a()}}()),U.wk&&!function(){return R?void 0:/loaded|complete/.test(K.readyState)?void a():void setTimeout(arguments.callee,0)}(),c(a)))})(),function(){U.ie&&U.win&&window.attachEvent("onunload",function(){for(var a=Q.length,b=0;a>b;b++)Q[b][0].detachEvent(Q[b][1],Q[b][2]);for(var c=P.length,d=0;c>d;d++)n(P[d]);for(var e in U)U[e]=null;U=null;for(var f in swfobject)swfobject[f]=null;swfobject=null})}();return{registerObject:function(a,b,c,d){if(U.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,O[O.length]=e,u(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){return U.w3?g(a):void 0},embedSWF:function(a,c,d,e,f,g,j,k,m,n){var o={success:!1,id:c};U.w3&&!(U.wk&&U.wk<312)&&a&&c&&d&&e&&f?(u(c,!1),b(function(){d+="",e+="";var b={};if(m&&typeof m===D)for(var p in m)b[p]=m[p];b.data=a,b.width=d,b.height=e;var q={};if(k&&typeof k===D)for(var r in k)q[r]=k[r];if(j&&typeof j===D)for(var t in j)typeof q.flashvars!=C?q.flashvars+="&"+t+"="+j[t]:q.flashvars=t+"="+j[t];if(s(f)){var v=l(b,q,c);b.id==c&&u(c,!0),o.success=!0,o.ref=v}else{if(g&&h())return b.data=g,void i(b,q,c,n);u(c,!0)}n&&n(o)})):n&&n(o)},switchOffAutoHideShow:function(){T=!1},ua:U,getFlashPlayerVersion:function(){return{major:U.pv[0],minor:U.pv[1],release:U.pv[2]}},hasFlashPlayerVersion:s,createSWF:function(a,b,c){return U.w3?l(a,b,c):void 0},showExpressInstall:function(a,b,c,d){U.w3&&h()&&i(a,b,c,d)},removeSWF:function(a){U.w3&&n(a)},createCSS:function(a,b,c,d){U.w3&&t(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=K.location.search||K.location.hash;if(b){if(/\?/.test(b)&&(b=b.split("?")[1]),null==a)return v(b);for(var c=b.split("&"),d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return v(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(S){var a=p(H);a&&w&&(a.parentNode.replaceChild(w,a),x&&(u(x,!0),U.ie&&U.win&&(w.style.display="block")),y&&y(z)),S=!1}}}}();!function(){if("undefined"!=typeof window&&!window.WebSocket){var a=window.console;if(a&&a.log&&a.error||(a={log:function(){},error:function(){}}),!swfobject.hasFlashPlayerVersion("10.0.0"))return void a.error("Flash Player >= 10.0.0 is required.");"file:"==location.protocol&&a.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(a,b,c,d,e){var f=this;f.__id=WebSocket.__nextId++,WebSocket.__instances[f.__id]=f,f.readyState=WebSocket.CONNECTING,f.bufferedAmount=0,f.__events={},b?"string"==typeof b&&(b=[b]):b=[],setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(f.__id,a,b,c||null,d||0,e||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var b=WebSocket.__flash.send(this.__id,encodeURIComponent(a));return 0>b?!0:(this.bufferedAmount+=b,!1)},WebSocket.prototype.close=function(){this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(a,b,c){a in this.__events||(this.__events[a]=[]),this.__events[a].push(b)},WebSocket.prototype.removeEventListener=function(a,b,c){if(a in this.__events)for(var d=this.__events[a],e=d.length-1;e>=0;--e)if(d[e]===b){d.splice(e,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var b=this.__events[a.type]||[],c=0;c<b.length;++c)b[c](a);var d=this["on"+a.type];d&&d(a)},WebSocket.prototype.__handleEvent=function(a){"readyState"in a&&(this.readyState=a.readyState),"protocol"in a&&(this.protocol=a.protocol);var b;if("open"==a.type||"error"==a.type)b=this.__createSimpleEvent(a.type);else if("close"==a.type)b=this.__createSimpleEvent("close");else{if("message"!=a.type)throw"unknown event type: "+a.type;var c=decodeURIComponent(a.message);b=this.__createMessageEvent("message",c)}this.dispatchEvent(b)},WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&window.Event){var b=document.createEvent("Event");return b.initEvent(a,!1,!1),b}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(a,b){if(document.createEvent&&window.MessageEvent&&!window.opera){var c=document.createEvent("MessageEvent");return c.initMessageEvent("message",!1,!1,b,null,null,window,null),c}return{type:a,data:b,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},WebSocket.__initialize=function(){if(!WebSocket.__flash){if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),!window.WEB_SOCKET_SWF_LOCATION)return void a.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");var b=document.createElement("div");b.id="webSocketContainer",b.style.position="absolute",WebSocket.__isFlashLite()?(b.style.left="0px",b.style.top="0px"):(b.style.left="-100px",b.style.top="-100px");var c=document.createElement("div");c.id="webSocketFlash",b.appendChild(c),document.body.appendChild(b),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(b){b.success||a.error("[WebSocket] swfobject.embedSWF failed")})}},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{for(var b=WebSocket.__flash.receiveEvents(),c=0;c<b.length;++c)WebSocket.__instances[b[c].webSocketId].__handleEvent(b[c])}catch(d){a.error(d)}},0),!0},WebSocket.__log=function(b){a.log(decodeURIComponent(b))},WebSocket.__error=function(b){a.error(decodeURIComponent(b))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return a&&a.enabledPlugin&&a.enabledPlugin.filename&&a.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))}}(),function(a,b,c){function d(a){a&&(b.Transport.apply(this,arguments),this.sendBuffer=[])}function e(){}a.XHR=d,b.util.inherit(d,b.Transport),d.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},d.prototype.payload=function(a){for(var c=[],d=0,e=a.length;e>d;d++)c.push(b.parser.encodePacket(a[d]));this.send(b.parser.encodePayload(c))},d.prototype.send=function(a){return this.post(a),this},d.prototype.post=function(a){function b(){4==this.readyState&&(this.onreadystatechange=e,f.posting=!1,200==this.status?f.socket.setBuffer(!1):f.onClose())}function d(){this.onload=e,f.socket.setBuffer(!1)}var f=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),c.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=d:this.sendXHR.onreadystatechange=b,this.sendXHR.send(a)},d.prototype.close=function(){return this.onClose(),this},d.prototype.request=function(a){var c=b.util.request(this.socket.isXDomain()),d=b.util.query(this.socket.options.query,"t="+ +new Date);if(c.open(a||"GET",this.prepareUrl()+d,!0),"POST"==a)try{c.setRequestHeader?c.setRequestHeader("Content-type","text/plain;charset=UTF-8"):c.contentType="text/plain"}catch(e){}return c},d.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},d.check=function(a,d){try{var e=b.util.request(d),f=c.XDomainRequest&&e instanceof XDomainRequest,g=a&&a.options&&a.options.secure?"https:":"http:",h=c.location&&g!=c.location.protocol;if(e&&(!f||!h))return!0}catch(i){}return!1},d.xdomainCheck=function(a){return d.check(a,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b){function c(a){b.Transport.XHR.apply(this,arguments)}a.htmlfile=c,b.util.inherit(c,b.Transport.XHR),c.prototype.name="htmlfile",
c.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var a=this.doc.createElement("div");a.className="socketio",this.doc.body.appendChild(a),this.iframe=this.doc.createElement("iframe"),a.appendChild(this.iframe);var c=this,d=b.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+d,b.util.on(window,"unload",function(){c.destroy()})},c.prototype._=function(a,b){a=a.replace(/\\\//g,"/"),this.onData(a);try{var c=b.getElementsByTagName("script")[0];c.parentNode.removeChild(c)}catch(d){}},c.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(a){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},c.prototype.close=function(){return this.destroy(),b.Transport.XHR.prototype.close.call(this)},c.check=function(a){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{var c=new(window[["Active"].concat("Object").join("X")])("htmlfile");return c&&b.Transport.XHR.check(a)}catch(d){}return!1},c.xdomainCheck=function(){return!1},b.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b,c){function d(){b.Transport.XHR.apply(this,arguments)}function e(){}a["xhr-polling"]=d,b.util.inherit(d,b.Transport.XHR),b.util.merge(d,b.Transport.XHR),d.prototype.name="xhr-polling",d.prototype.heartbeats=function(){return!1},d.prototype.open=function(){var a=this;return b.Transport.XHR.prototype.open.call(a),!1},d.prototype.get=function(){function a(){4==this.readyState&&(this.onreadystatechange=e,200==this.status?(f.onData(this.responseText),f.get()):f.onClose())}function b(){this.onload=e,this.onerror=e,f.retryCounter=1,f.onData(this.responseText),f.get()}function d(){f.retryCounter++,!f.retryCounter||f.retryCounter>3?f.onClose():f.get()}if(this.isOpen){var f=this;this.xhr=this.request(),c.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=b,this.xhr.onerror=d):this.xhr.onreadystatechange=a,this.xhr.send(null)}},d.prototype.onClose=function(){if(b.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=e;try{this.xhr.abort()}catch(a){}this.xhr=null}},d.prototype.ready=function(a,c){var d=this;b.util.defer(function(){c.call(d)})},b.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b,c){function d(a){b.Transport["xhr-polling"].apply(this,arguments),this.index=b.j.length;var c=this;b.j.push(function(a){c._(a)})}var e=c.document&&"MozAppearance"in c.document.documentElement.style;a["jsonp-polling"]=d,b.util.inherit(d,b.Transport["xhr-polling"]),d.prototype.name="jsonp-polling",d.prototype.post=function(a){function c(){d(),e.socket.setBuffer(!1)}function d(){e.iframe&&e.form.removeChild(e.iframe);try{g=document.createElement('<iframe name="'+e.iframeId+'">')}catch(a){g=document.createElement("iframe"),g.name=e.iframeId}g.id=e.iframeId,e.form.appendChild(g),e.iframe=g}var e=this,f=b.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var g,h=document.createElement("form"),i=document.createElement("textarea"),j=this.iframeId="socketio_iframe_"+this.index;h.className="socketio",h.style.position="absolute",h.style.top="0px",h.style.left="0px",h.style.display="none",h.target=j,h.method="POST",h.setAttribute("accept-charset","utf-8"),i.name="d",h.appendChild(i),document.body.appendChild(h),this.form=h,this.area=i}this.form.action=this.prepareUrl()+f,d(),this.area.value=b.JSON.stringify(a);try{this.form.submit()}catch(k){}this.iframe.attachEvent?g.onreadystatechange=function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c,this.socket.setBuffer(!0)},d.prototype.get=function(){var a=this,c=document.createElement("script"),d=b.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),c.async=!0,c.src=this.prepareUrl()+d,c.onerror=function(){a.onClose()};var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(c,f),this.script=c,e&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a),document.body.removeChild(a)},100)},d.prototype._=function(a){return this.onData(a),this.isOpen&&this.get(),this},d.prototype.ready=function(a,c){var d=this;return e?void b.util.load(function(){c.call(d)}):c.call(this)},d.check=function(){return"document"in c},d.xdomainCheck=function(){return!0},b.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),"function"==typeof define&&define.amd&&define([],function(){return io})}()},{}],13:[function(a,b,c){var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.binding=function(a){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(a){throw new Error("process.chdir is not supported")}},{}],12:[function(a,b,c){function d(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c++)if(b===a[c])return c;return-1}var e=a("__browserify_process");e.EventEmitter||(e.EventEmitter=function(){});var f=c.EventEmitter=e.EventEmitter,g="function"==typeof Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},h=10;f.prototype.setMaxListeners=function(a){this._events||(this._events={}),this._events.maxListeners=a},f.prototype.emit=function(a){if("error"===a&&(!this._events||!this._events.error||g(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var b=this._events[a];if(!b)return!1;if("function"==typeof b){switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:var c=Array.prototype.slice.call(arguments,1);b.apply(this,c)}return!0}if(g(b)){for(var c=Array.prototype.slice.call(arguments,1),d=b.slice(),e=0,f=d.length;f>e;e++)d[e].apply(this,c);return!0}return!1},f.prototype.addListener=function(a,b){if("function"!=typeof b)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",a,b),this._events[a])if(g(this._events[a])){if(!this._events[a].warned){var c;c=void 0!==this._events.maxListeners?this._events.maxListeners:h,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}this._events[a].push(b)}else this._events[a]=[this._events[a],b];else this._events[a]=b;return this},f.prototype.on=f.prototype.addListener,f.prototype.once=function(a,b){var c=this;return c.on(a,function d(){c.removeListener(a,d),b.apply(this,arguments)}),this},f.prototype.removeListener=function(a,b){if("function"!=typeof b)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[a])return this;var c=this._events[a];if(g(c)){var e=d(c,b);if(0>e)return this;c.splice(e,1),0==c.length&&delete this._events[a]}else this._events[a]===b&&delete this._events[a];return this},f.prototype.removeAllListeners=function(a){return 0===arguments.length?(this._events={},this):(a&&this._events&&this._events[a]&&(this._events[a]=null),this)},f.prototype.listeners=function(a){return this._events||(this._events={}),this._events[a]||(this._events[a]=[]),g(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]},f.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?"function"==typeof a._events[b]?1:a._events[b].length:0}},{__browserify_process:13}],9:[function(a,b,c){function d(a){var b=this;this.id=a.id,this.parent=a.parent,this.type=a.type||"video",this.oneway=a.oneway||!1,this.sharemyscreen=a.sharemyscreen||!1,this.browserPrefix=a.prefix,this.stream=a.stream,this.enableDataChannels=void 0===a.enableDataChannels?this.parent.config.enableDataChannels:a.enableDataChannels,this.receiveMedia=a.receiveMedia||this.parent.config.receiveMedia,this.channels={},this.sid=a.sid||Date.now().toString(),this.pc=new g(this.parent.config.peerConnectionConfig,this.parent.config.peerConnectionConstraints),this.pc.on("ice",this.onIceCandidate.bind(this)),this.pc.on("offer",function(a){b.send("offer",a)}),this.pc.on("answer",function(a){b.send("answer",a)}),this.pc.on("addStream",this.handleRemoteStreamAdded.bind(this)),this.pc.on("addChannel",this.handleDataChannelAdded.bind(this)),this.pc.on("removeStream",this.handleStreamRemoved.bind(this)),this.pc.on("negotiationNeeded",this.emit.bind(this,"negotiationNeeded")),this.pc.on("iceConnectionStateChange",this.emit.bind(this,"iceConnectionStateChange")),this.pc.on("iceConnectionStateChange",function(){switch(b.pc.iceConnectionState){case"failed":"offer"===b.pc.pc.peerconnection.localDescription.type&&(b.parent.emit("iceFailed",b),b.send("connectivityError"))}}),this.pc.on("signalingStateChange",this.emit.bind(this,"signalingStateChange")),this.logger=this.parent.logger,"screen"===a.type?this.parent.localScreen&&this.sharemyscreen&&(this.logger.log("adding local screen stream to peer connection"),this.pc.addStream(this.parent.localScreen),this.broadcaster=a.broadcaster):this.parent.localStreams.forEach(function(a){b.pc.addStream(a)}),h.call(this),this.on("channelOpen",function(a){a.protocol===j&&(a.onmessage=function(c){var d=JSON.parse(c.data),e=new i.Receiver;e.receive(d,a),b.emit("fileTransfer",d,e),e.on("receivedFile",function(a,b){e.channel.close()})})}),this.on("*",function(){b.parent.emit.apply(b.parent,arguments)})}var e=a("util"),f=a("webrtcsupport"),g=a("rtcpeerconnection"),h=a("wildemitter"),i=a("filetransfer"),j="https://simplewebrtc.com/protocol/filetransfer#inband-v1";e.inherits(d,h),d.prototype.handleMessage=function(a){var b=this;this.logger.log("getting",a.type,a),a.prefix&&(this.browserPrefix=a.prefix),"offer"===a.type?(a.payload.sdp=a.payload.sdp.replace("a=fmtp:0 profile-level-id=0x42e00c;packetization-mode=1\r\n",""),this.pc.handleOffer(a.payload,function(a){a||b.pc.answer(b.receiveMedia,function(a,b){})})):"answer"===a.type?this.pc.handleAnswer(a.payload):"candidate"===a.type?this.pc.processIce(a.payload):"connectivityError"===a.type?this.parent.emit("connectivityError",b):"mute"===a.type?this.parent.emit("mute",{id:a.from,name:a.payload.name}):"unmute"===a.type&&this.parent.emit("unmute",{id:a.from,name:a.payload.name})},d.prototype.send=function(a,b){var c={to:this.id,sid:this.sid,broadcaster:this.broadcaster,roomType:this.type,type:a,payload:b,prefix:f.prefix};this.logger.log("sending",a,c),this.parent.emit("message",c)},d.prototype.sendDirectly=function(a,b,c){var d={type:b,payload:c};this.logger.log("sending via datachannel",a,b,d);var e=this.getDataChannel(a);return"open"!=e.readyState?!1:(e.send(JSON.stringify(d)),!0)},d.prototype._observeDataChannel=function(a){var b=this;a.onclose=this.emit.bind(this,"channelClose",a),a.onerror=this.emit.bind(this,"channelError",a),a.onmessage=function(c){b.emit("channelMessage",b,a.label,JSON.parse(c.data),a,c)},a.onopen=this.emit.bind(this,"channelOpen",a)},d.prototype.getDataChannel=function(a,b){if(!f.supportDataChannel)return this.emit("error",new Error("createDataChannel not supported"));var c=this.channels[a];return b||(b={}),c?c:(c=this.channels[a]=this.pc.createDataChannel(a,b),this._observeDataChannel(c),c)},d.prototype.onIceCandidate=function(a){if(!this.closed)if(a){var b=this.parent.config.peerConnectionConfig;"moz"===f.prefix&&b&&a.candidate&&a.candidate.candidate&&a.candidate.candidate.indexOf(b.iceTransports)<0?this.logger.log("Ignoring ice candidate not matching pcConfig iceTransports type: ",b.iceTransports):this.send("candidate",a)}else this.logger.log("End of candidates.")},d.prototype.start=function(){this.enableDataChannels&&this.getDataChannel("simplewebrtc"),this.pc.offer(this.receiveMedia,function(a,b){})},d.prototype.icerestart=function(){var a=this.receiveMedia;a.mandatory.IceRestart=!0,this.pc.offer(a,function(a,b){})},d.prototype.end=function(){this.closed||(this.pc.close(),this.handleStreamRemoved())},d.prototype.handleRemoteStreamAdded=function(a){var b=this;this.stream?this.logger.warn("Already have a remote stream"):(this.stream=a.stream,this.stream.onended=function(){b.end()},this.parent.emit("peerStreamAdded",this))},d.prototype.handleStreamRemoved=function(){this.parent.peers.splice(this.parent.peers.indexOf(this),1),this.closed=!0,this.parent.emit("peerStreamRemoved",this)},d.prototype.handleDataChannelAdded=function(a){this.channels[a.label]=a,this._observeDataChannel(a)},d.prototype.sendFile=function(a){var b=new i.Sender,c=this.getDataChannel("filetransfer"+(new Date).getTime(),{protocol:j});return c.onopen=function(){c.send(JSON.stringify({size:a.size,name:a.name})),b.send(a,c)},c.onclose=function(){console.log("sender received transfer"),b.emit("complete")},b},b.exports=d},{filetransfer:15,rtcpeerconnection:14,util:8,webrtcsupport:5,wildemitter:4}],16:[function(a,b,c){var d=window.navigator.getUserMedia||window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia||window.navigator.msGetUserMedia;b.exports=function(a,b){var c,e=2===arguments.length,f={video:!0,audio:!0},g="PermissionDeniedError",h="PERMISSION_DENIED",i="ConstraintNotSatisfiedError";return e||(b=a,a=f),d?a.audio||a.video?(localStorage&&"true"===localStorage.useFirefoxFakeDevice&&(a.fake=!0),void d.call(window.navigator,a,function(a){b(null,a)},function(a){var c;"string"==typeof a?(c=new Error("MediaStreamError"),a===g||a===h?c.name=g:c.name=i):(c=a,c.name||(c[g]?a.name=g:a.name=i)),b(c)})):(c=new Error("MediaStreamError"),c.name="NoMediaRequestedError",window.setTimeout(function(){b(c)},0)):(c=new Error("MediaStreamError"),c.name="NotSupportedError",window.setTimeout(function(){b(c)},0))}},{}],10:[function(a,b,c){function d(a){j.call(this);var b,c=this.config={autoAdjustMic:!1,detectSpeakingEvents:!0,media:{audio:!0,video:!0},logger:l};for(b in a)this.config[b]=a[b];this.logger=c.logger,this._log=this.logger.log.bind(this.logger,"LocalMedia:"),this._logerror=this.logger.error.bind(this.logger,"LocalMedia:"),this.screenSharingSupport=g.screenSharing,this.localStreams=[],this.localScreens=[],g.support||this._logerror("Your browser does not support local media capture.")}var e=a("util"),f=a("hark"),g=a("webrtcsupport"),h=a("getusermedia"),i=a("getscreenmedia"),j=a("wildemitter"),k=a("mediastream-gain"),l=a("mockconsole");e.inherits(d,j),d.prototype.start=function(a,b){var c=this,d=a||this.config.media;h(d,function(a,e){return a||(d.audio&&c.config.detectSpeakingEvents&&c.setupAudioMonitor(e,c.config.harkOptions),c.localStreams.push(e),c.config.autoAdjustMic&&(c.gainController=new k(e),c.setMicIfEnabled(.5)),e.onended=function(){},c.emit("localStream",e)),b?b(a,e):void 0})},d.prototype.stop=function(a){var b=this;if(a){a.stop(),b.emit("localStreamStopped",a);var c=b.localStreams.indexOf(a);c>-1&&(b.localStreams=b.localStreams.splice(c,1))}else this.audioMonitor&&(this.audioMonitor.stop(),delete this.audioMonitor),this.localStreams.forEach(function(a){a.stop(),b.emit("localStreamStopped",a)}),this.localStreams=[]},d.prototype.startScreenShare=function(a){var b=this;i(function(c,d){return c||(b.localScreens.push(d),d.onended=function(){var a=b.localScreens.indexOf(d);a>-1&&b.localScreens.splice(a,1),b.emit("localScreenStopped",d)},b.emit("localScreen",d)),a?a(c,d):void 0})},d.prototype.stopScreenShare=function(a){a?a.stop():(this.localScreens.forEach(function(a){a.stop()}),this.localScreens=[])},d.prototype.mute=function(){this._audioEnabled(!1),this.hardMuted=!0,this.emit("audioOff")},d.prototype.unmute=function(){this._audioEnabled(!0),this.hardMuted=!1,this.emit("audioOn")},d.prototype.setupAudioMonitor=function(a,b){this._log("Setup audio");var c,d=this.audioMonitor=f(a,b),e=this;d.on("speaking",function(){e.emit("speaking"),e.hardMuted||e.setMicIfEnabled(1)}),d.on("stopped_speaking",function(){c&&clearTimeout(c),c=setTimeout(function(){e.emit("stoppedSpeaking"),e.hardMuted||e.setMicIfEnabled(.5)},1e3)}),d.on("volume_change",function(a,b){e.emit("volumeChange",a,b)})},d.prototype.setMicIfEnabled=function(a){this.config.autoAdjustMic&&this.gainController.setGain(a)},d.prototype.pauseVideo=function(){this._videoEnabled(!1),this.emit("videoOff")},d.prototype.resumeVideo=function(){this._videoEnabled(!0),this.emit("videoOn")},d.prototype.pause=function(){this.mute(),this.pauseVideo()},d.prototype.resume=function(){this.unmute(),this.resumeVideo()},d.prototype._audioEnabled=function(a){this.setMicIfEnabled(a?1:0),this.localStreams.forEach(function(b){b.getAudioTracks().forEach(function(b){b.enabled=!!a})})},d.prototype._videoEnabled=function(a){this.localStreams.forEach(function(b){b.getVideoTracks().forEach(function(b){b.enabled=!!a})})},d.prototype.isAudioEnabled=function(){var a=!0;return this.localStreams.forEach(function(b){b.getAudioTracks().forEach(function(b){a=a&&b.enabled})}),a},d.prototype.isVideoEnabled=function(){var a=!0;return this.localStreams.forEach(function(b){b.getVideoTracks().forEach(function(b){a=a&&b.enabled})}),a},d.prototype.startLocalMedia=d.prototype.start,d.prototype.stopLocalMedia=d.prototype.stop,Object.defineProperty(d.prototype,"localStream",{get:function(){return this.localStreams.length>0?this.localStreams[0]:null}}),Object.defineProperty(d.prototype,"localScreen",{get:function(){return this.localScreens.length>0?this.localScreens[0]:null}}),b.exports=d},{getscreenmedia:18,getusermedia:16,hark:17,"mediastream-gain":19,mockconsole:6,util:8,webrtcsupport:5,wildemitter:4}],15:[function(a,b,c){function d(a){f.call(this);var b=a||{};this.config={chunksize:16384,pacing:0};var c;for(c in b)this.config[c]=b[c];this.file=null,this.channel=null}function e(){f.call(this),this.receiveBuffer=[],this.received=0,this.metadata={},this.channel=null}var f=a("wildemitter"),g=a("util");g.inherits(d,f),d.prototype.send=function(a,b){var c=this;this.file=a,this.channel=b;var d=function(b){var e=new window.FileReader;e.onload=function(){return function(e){c.channel.send(e.target.result),c.emit("progress",b,a.size,e.target.result),a.size>b+e.target.result.byteLength?window.setTimeout(d,c.config.pacing,b+c.config.chunksize):(c.emit("progress",a.size,a.size,null),c.emit("sentFile"))}}(a);var f=a.slice(b,b+c.config.chunksize);e.readAsArrayBuffer(f)};window.setTimeout(d,0,0)},g.inherits(e,f),e.prototype.receive=function(a,b){var c=this;a&&(this.metadata=a),this.channel=b,b.binaryType="arraybuffer",this.channel.onmessage=function(a){var b=a.data.byteLength;c.received+=b,c.receiveBuffer.push(a.data),c.emit("progress",c.received,c.metadata.size,a.data),c.received===c.metadata.size?(c.emit("receivedFile",new window.Blob(c.receiveBuffer),c.metadata),c.receiveBuffer=[]):c.received>c.metadata.size&&(console.error("received more than expected, discarding..."),c.receiveBuffer=[])}},b.exports={},b.exports.support=window&&window.File&&window.FileReader&&window.Blob,b.exports.Sender=d,b.exports.Receiver=e},{util:8,wildemitter:4}],14:[function(a,b,c){function d(a,b){var c,d=this;j.call(this),a=a||{},a.iceServers=a.iceServers||[],this.enableChromeNativeSimulcast=!1,b&&b.optional&&"webkit"===h.prefix&&null===navigator.appVersion.match(/Chromium\//)&&b.optional.forEach(function(a,b){a.enableChromeNativeSimulcast&&(d.enableChromeNativeSimulcast=!0)}),this.enableMultiStreamHacks=!1,b&&b.optional&&"webkit"===h.prefix&&b.optional.forEach(function(a,b){a.enableMultiStreamHacks&&(d.enableMultiStreamHacks=!0)}),this.restrictBandwidth=0,b&&b.optional&&b.optional.forEach(function(a,b){a.andyetRestrictBandwidth&&(d.restrictBandwidth=a.andyetRestrictBandwidth)}),this.batchIceCandidates=0,b&&b.optional&&b.optional.forEach(function(a,b){a.andyetBatchIce&&(d.batchIceCandidates=a.andyetBatchIce)}),this.batchedIceCandidates=[],b&&b.optional&&"webkit"===h.prefix&&b.optional.forEach(function(a,b){a.andyetFasterICE&&(d.eliminateDuplicateCandidates=a.andyetFasterICE)}),b&&b.optional&&b.optional.forEach(function(a,b){a.andyetDontSignalCandidates&&(d.dontSignalCandidates=a.andyetDontSignalCandidates)}),this.assumeSetLocalSuccess=!1,b&&b.optional&&b.optional.forEach(function(a,b){a.andyetAssumeSetLocalSuccess&&(d.assumeSetLocalSuccess=a.andyetAssumeSetLocalSuccess)}),"moz"===h.prefix&&b&&b.optional&&(this.wtFirefox=0,b.optional.forEach(function(a,b){a.andyetFirefoxMakesMeSad&&(d.wtFirefox=a.andyetFirefoxMakesMeSad,d.wtFirefox>0&&(d.firefoxcandidatebuffer=[]))})),this.pc=new k(a,b),this.getLocalStreams=this.pc.getLocalStreams.bind(this.pc),this.getRemoteStreams=this.pc.getRemoteStreams.bind(this.pc),this.addStream=this.pc.addStream.bind(this.pc),this.removeStream=this.pc.removeStream.bind(this.pc),this.pc.on("*",function(){d.emit.apply(d,arguments)}),this.pc.onremovestream=this.emit.bind(this,"removeStream"),this.pc.onaddstream=this.emit.bind(this,"addStream"),this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded"),this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange"),this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange"),this.pc.onicecandidate=this._onIce.bind(this),this.pc.ondatachannel=this._onDataChannel.bind(this),this.localDescription={contents:[]},this.remoteDescription={contents:[]},this.config={debug:!1,ice:{},sid:"",isInitiator:!0,sdpSessionID:Date.now(),useJingle:!1};for(c in a)this.config[c]=a[c];this.config.debug&&this.on("*",function(b,c){var d=a.logger||console;d.log("PeerConnection event:",arguments)}),this.hadLocalStunCandidate=!1,this.hadRemoteStunCandidate=!1,this.hadLocalRelayCandidate=!1,this.hadRemoteRelayCandidate=!1,this.hadLocalIPv6Candidate=!1,this.hadRemoteIPv6Candidate=!1,this._remoteDataChannels=[],this._localDataChannels=[],this._candidateBuffer=[]}var e=a("util"),f=a("lodash.foreach"),g=a("lodash.pluck"),h=a("webrtcsupport"),i=a("sdp-jingle-json"),j=a("wildemitter"),k=a("traceablepeerconnection");e.inherits(d,j),Object.defineProperty(d.prototype,"signalingState",{get:function(){return this.pc.signalingState}}),Object.defineProperty(d.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}}),d.prototype._role=function(){return this.isInitiator?"initiator":"responder"},d.prototype.addStream=function(a){this.localStream=a,this.pc.addStream(a)},d.prototype._checkLocalCandidate=function(a){var b=i.toCandidateJSON(a);"srflx"==b.type?this.hadLocalStunCandidate=!0:"relay"==b.type&&(this.hadLocalRelayCandidate=!0),-1!=b.ip.indexOf(":")&&(this.hadLocalIPv6Candidate=!0)},d.prototype._checkRemoteCandidate=function(a){var b=i.toCandidateJSON(a);"srflx"==b.type?this.hadRemoteStunCandidate=!0:"relay"==b.type&&(this.hadRemoteRelayCandidate=!0),-1!=b.ip.indexOf(":")&&(this.hadRemoteIPv6Candidate=!0)},d.prototype.processIce=function(a,b){b=b||function(){};var c=this;if("closed"===this.pc.signalingState)return b();if(a.contents||a.jingle&&a.jingle.contents){var d=g(this.remoteDescription.contents,"name"),e=a.contents||a.jingle.contents;e.forEach(function(a){var b=a.transport||{},e=b.candidates||[],f=d.indexOf(a.name),g=a.name;e.forEach(function(a){var b=i.toCandidateSDP(a)+"\r\n";c.pc.addIceCandidate(new h.IceCandidate({candidate:b,sdpMLineIndex:f,sdpMid:g}),function(){},function(a){c.emit("error",a)}),c._checkRemoteCandidate(b)})})}else{if(a.candidate&&0!==a.candidate.candidate.indexOf("a=")&&(a.candidate.candidate="a="+a.candidate.candidate),this.wtFirefox&&null!==this.firefoxcandidatebuffer&&this.pc.localDescription&&"offer"===this.pc.localDescription.type)return this.firefoxcandidatebuffer.push(a.candidate),b();c.pc.addIceCandidate(new h.IceCandidate(a.candidate),function(){},function(a){c.emit("error",a)}),c._checkRemoteCandidate(a.candidate.candidate)}b()},d.prototype.offer=function(a,b){var c=this,d=2===arguments.length,e=d&&a?a:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};return b=d?b:a,b=b||function(){},"closed"===this.pc.signalingState?b("Already closed"):void this.pc.createOffer(function(a){var d={type:"offer",sdp:a.sdp};c.assumeSetLocalSuccess&&(c.emit("offer",d),b(null,d)),c._candidateBuffer=[],c.pc.setLocalDescription(a,function(){var e;c.config.useJingle&&(e=i.toSessionJSON(a.sdp,{role:c._role(),direction:"outgoing"}),e.sid=c.config.sid,c.localDescription=e,f(e.contents,function(a){var b=a.transport||{};b.ufrag&&(c.config.ice[a.name]={ufrag:b.ufrag,pwd:b.pwd})}),d.jingle=e),d.sdp.split("\r\n").forEach(function(a){0===a.indexOf("a=candidate:")&&c._checkLocalCandidate(a)}),c.assumeSetLocalSuccess||(c.emit("offer",d),b(null,d))},function(a){c.emit("error",a),b(a)})},function(a){c.emit("error",a),b(a)},e)},d.prototype.handleOffer=function(a,b){b=b||function(){};var c=this;if(a.type="offer",a.jingle){if(this.enableChromeNativeSimulcast&&a.jingle.contents.forEach(function(a){"video"===a.name&&(a.description.googConferenceFlag=!0)}),this.enableMultiStreamHacks&&a.jingle.contents.forEach(function(a){if("video"===a.name){var b=a.description.sources||[];(0===b.length||"3735928559"!==b[0].ssrc)&&(b.unshift({ssrc:"3735928559",parameters:[{key:"cname",value:"deadbeef"},{key:"msid",value:"mixyourfecintothis please"}]}),a.description.sources=b)}}),c.restrictBandwidth>0&&a.jingle.contents.length>=2&&"video"===a.jingle.contents[1].name){var d=a.jingle.contents[1],e=d.description&&d.description.bandwidth;e||(a.jingle.contents[1].description.bandwidth={type:"AS",bandwidth:c.restrictBandwidth.toString()},a.sdp=i.toSessionSDP(a.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"outgoing"}))}a.sdp=i.toSessionSDP(a.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"incoming"}),c.remoteDescription=a.jingle}a.sdp.split("\r\n").forEach(function(a){0===a.indexOf("a=candidate:")&&c._checkRemoteCandidate(a)}),c.pc.setRemoteDescription(new h.SessionDescription(a),function(){b()},b)},d.prototype.answerAudioOnly=function(a){var b={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}};this._answer(b,a)},d.prototype.answerBroadcastOnly=function(a){var b={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}};this._answer(b,a)},d.prototype.answer=function(a,b){var c=2===arguments.length,d=c?b:a,e=c&&a?a:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};this._answer(e,d)},d.prototype.handleAnswer=function(a,b){b=b||function(){};var c=this;a.jingle&&(a.sdp=i.toSessionSDP(a.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"incoming"}),c.remoteDescription=a.jingle),a.sdp.split("\r\n").forEach(function(a){0===a.indexOf("a=candidate:")&&c._checkRemoteCandidate(a)}),c.pc.setRemoteDescription(new h.SessionDescription(a),function(){c.wtFirefox&&window.setTimeout(function(){c.firefoxcandidatebuffer.forEach(function(a){c.pc.addIceCandidate(new h.IceCandidate(a),function(){},function(a){c.emit("error",a)}),c._checkRemoteCandidate(a.candidate)}),c.firefoxcandidatebuffer=null},c.wtFirefox),b(null)},b)},d.prototype.close=function(){this.pc.close(),this._localDataChannels=[],this._remoteDataChannels=[],this.emit("close")},d.prototype._answer=function(a,b){b=b||function(){};var c=this;if(!this.pc.remoteDescription)throw new Error("remoteDescription not set");return"closed"===this.pc.signalingState?b("Already closed"):void c.pc.createAnswer(function(a){var d=[];if(c.enableChromeNativeSimulcast&&(a.jingle=i.toSessionJSON(a.sdp,{role:c._role(),direction:"outgoing"}),a.jingle.contents.length>=2&&"video"===a.jingle.contents[1].name)){var e=a.jingle.contents[1].description.sourceGroups||[],f=!1;if(e.forEach(function(a){"SIM"==a.semantics&&(f=!0)}),!f&&a.jingle.contents[1].description.sources.length){var g=JSON.parse(JSON.stringify(a.jingle.contents[1].description.sources[0]));g.ssrc=""+Math.floor(4294967295*Math.random()),a.jingle.contents[1].description.sources.push(g),d.push(a.jingle.contents[1].description.sources[0].ssrc),d.push(g.ssrc),e.push({semantics:"SIM",sources:d});var h=JSON.parse(JSON.stringify(g));h.ssrc=""+Math.floor(4294967295*Math.random()),a.jingle.contents[1].description.sources.push(h),e.push({semantics:"FID",sources:[g.ssrc,h.ssrc]}),a.jingle.contents[1].description.sourceGroups=e,a.sdp=i.toSessionSDP(a.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"outgoing"})}}var j={type:"answer",sdp:a.sdp};c.assumeSetLocalSuccess&&(c.emit("answer",j),b(null,j)),c._candidateBuffer=[],c.pc.setLocalDescription(a,function(){if(c.config.useJingle){var d=i.toSessionJSON(a.sdp,{role:c._role(),direction:"outgoing"});d.sid=c.config.sid,c.localDescription=d,j.jingle=d}if(c.enableChromeNativeSimulcast){j.jingle||(j.jingle=i.toSessionJSON(a.sdp,{role:c._role(),direction:"outgoing"}));j.jingle.contents[1].description.sourceGroups||[];j.jingle.contents[1].description.sources.forEach(function(a,b){a.parameters=a.parameters.map(function(a){return"msid"===a.key&&(a.value+="-"+Math.floor(b/2)),a})}),j.sdp=i.toSessionSDP(j.jingle,{sid:c.sdpSessionID,role:c._role(),direction:"outgoing"})}j.sdp.split("\r\n").forEach(function(a){0===a.indexOf("a=candidate:")&&c._checkLocalCandidate(a)}),c.assumeSetLocalSuccess||(c.emit("answer",j),b(null,j))},function(a){c.emit("error",a),b(a)})},function(a){c.emit("error",a),b(a)},a)},d.prototype._onIce=function(a){var b=this;if(a.candidate){if(this.dontSignalCandidates)return;var c=a.candidate,d={candidate:{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex}};this._checkLocalCandidate(c.candidate);var e,g,h=i.toCandidateJSON(c.candidate);if(this.eliminateDuplicateCandidates&&"relay"===h.type&&(e=this._candidateBuffer.filter(function(a){return"relay"===a.type}).map(function(a){return a.foundation+":"+a.component}),g=e.indexOf(h.foundation+":"+h.component),g>-1&&h.priority>>24>=e[g].priority>>24))return;if("max-bundle"===this.config.bundlePolicy&&(e=this._candidateBuffer.filter(function(a){return h.type===a.type}).map(function(a){return a.address+":"+a.port}),g=e.indexOf(h.address+":"+h.port),g>-1))return;if("require"===this.config.rtcpMuxPolicy&&"2"===h.component)return;if(this._candidateBuffer.push(h),b.config.useJingle){if(c.sdpMid||(b.pc.remoteDescription&&"offer"===b.pc.remoteDescription.type?c.sdpMid=b.remoteDescription.contents[c.sdpMLineIndex].name:c.sdpMid=b.localDescription.contents[c.sdpMLineIndex].name),!b.config.ice[c.sdpMid]){var j=i.toSessionJSON(b.pc.localDescription.sdp,{role:b._role(),direction:"outgoing"});f(j.contents,function(a){var c=a.transport||{};c.ufrag&&(b.config.ice[a.name]={ufrag:c.ufrag,pwd:c.pwd})})}if(d.jingle={contents:[{name:c.sdpMid,creator:b._role(),transport:{transType:"iceUdp",ufrag:b.config.ice[c.sdpMid].ufrag,pwd:b.config.ice[c.sdpMid].pwd,candidates:[h]}}]},b.batchIceCandidates>0)return 0===b.batchedIceCandidates.length&&window.setTimeout(function(){var a={};b.batchedIceCandidates.forEach(function(b){b=b.contents[0],a[b.name]||(a[b.name]=b),a[b.name].transport.candidates.push(b.transport.candidates[0])});var c={jingle:{contents:[]}};Object.keys(a).forEach(function(b){c.jingle.contents.push(a[b])}),b.batchedIceCandidates=[],b.emit("ice",c)},b.batchIceCandidates),void b.batchedIceCandidates.push(d.jingle)}this.emit("ice",d)}else this.emit("endOfCandidates")},
d.prototype._onDataChannel=function(a){var b=a.channel;this._remoteDataChannels.push(b),this.emit("addChannel",b)},d.prototype.createDataChannel=function(a,b){var c=this.pc.createDataChannel(a,b);return this._localDataChannels.push(c),c},d.prototype.getStats=function(a){"moz"===h.prefix?this.pc.getStats(function(b){var c=[];for(var d in b)"object"==typeof b[d]&&c.push(b[d]);a(null,c)},a):this.pc.getStats(function(b){var c=[];b.result().forEach(function(a){var b={};a.names().forEach(function(c){b[c]=a.stat(c)}),b.id=a.id,b.type=a.type,b.timestamp=a.timestamp,c.push(b)}),a(null,c)})},b.exports=d},{"lodash.foreach":22,"lodash.pluck":23,"sdp-jingle-json":20,traceablepeerconnection:21,util:8,webrtcsupport:5,wildemitter:4}],17:[function(a,b,c){function d(a,b){var c=-(1/0);a.getFloatFrequencyData(b);for(var d=4,e=b.length;e>d;d++)b[d]>c&&b[d]<0&&(c=b[d]);return c}var e=a("wildemitter"),f=window.AudioContext||window.webkitAudioContext,g=null;b.exports=function(a,b){var c=new e;if(!f)return c;var b=b||{},h=b.smoothing||.1,i=b.interval||50,j=b.threshold,k=b.play,l=b.history||10,m=!0;g||(g=new f);var n,o,p;p=g.createAnalyser(),p.fftSize=512,p.smoothingTimeConstant=h,o=new Float32Array(p.fftSize),a.jquery&&(a=a[0]),a instanceof HTMLAudioElement||a instanceof HTMLVideoElement?(n=g.createMediaElementSource(a),"undefined"==typeof k&&(k=!0),j=j||-50):(n=g.createMediaStreamSource(a),j=j||-50),n.connect(p),k&&p.connect(g.destination),c.speaking=!1,c.setThreshold=function(a){j=a},c.setInterval=function(a){i=a},c.stop=function(){m=!1,c.emit("volume_change",-100,j),c.speaking&&(c.speaking=!1,c.emit("stopped_speaking"))},c.speakingHistory=[];for(var q=0;l>q;q++)c.speakingHistory.push(0);var r=function(){setTimeout(function(){if(m){var a=d(p,o);c.emit("volume_change",a,j);var b=0;if(a>j&&!c.speaking){for(var e=c.speakingHistory.length-3;e<c.speakingHistory.length;e++)b+=c.speakingHistory[e];b>=2&&(c.speaking=!0,c.emit("speaking"))}else if(j>a&&c.speaking){for(var e=0;e<c.speakingHistory.length;e++)b+=c.speakingHistory[e];0==b&&(c.speaking=!1,c.emit("stopped_speaking"))}c.speakingHistory.shift(),c.speakingHistory.push(0+(a>j)),r()}},i)};return r(),c}},{wildemitter:24}],24:[function(a,b,c){function d(){this.callbacks={}}b.exports=d,d.prototype.on=function(a,b,c){var d=3===arguments.length,e=d?arguments[1]:void 0,f=d?arguments[2]:arguments[1];return f._groupName=e,(this.callbacks[a]=this.callbacks[a]||[]).push(f),this},d.prototype.once=function(a,b,c){function d(){e.off(a,d),h.apply(this,arguments)}var e=this,f=3===arguments.length,g=f?arguments[1]:void 0,h=f?arguments[2]:arguments[1];return this.on(a,g,d),this},d.prototype.releaseGroup=function(a){var b,c,d,e;for(b in this.callbacks)for(e=this.callbacks[b],c=0,d=e.length;d>c;c++)e[c]._groupName===a&&(e.splice(c,1),c--,d--);return this},d.prototype.off=function(a,b){var c,d=this.callbacks[a];return d?1===arguments.length?(delete this.callbacks[a],this):(c=d.indexOf(b),d.splice(c,1),0===d.length&&delete this.callbacks[a],this):this},d.prototype.emit=function(a){var b,c,d,e=[].slice.call(arguments,1),f=this.callbacks[a],g=this.getWildcardCallbacks(a);if(f)for(d=f.slice(),b=0,c=d.length;c>b&&d[b];++b)d[b].apply(this,e);if(g)for(c=g.length,d=g.slice(),b=0,c=d.length;c>b&&d[b];++b)d[b].apply(this,[a].concat(e));return this},d.prototype.getWildcardCallbacks=function(a){var b,c,d=[];for(b in this.callbacks)c=b.split("*"),("*"===b||2===c.length&&a.slice(0,c[0].length)===c[0])&&(d=d.concat(this.callbacks[b]));return d}},{}],20:[function(a,b,c){var d=a("./lib/tosdp"),e=a("./lib/tojson");c.toIncomingSDPOffer=function(a){return d.toSessionSDP(a,{role:"responder",direction:"incoming"})},c.toOutgoingSDPOffer=function(a){return d.toSessionSDP(a,{role:"initiator",direction:"outgoing"})},c.toIncomingSDPAnswer=function(a){return d.toSessionSDP(a,{role:"initiator",direction:"incoming"})},c.toOutgoingSDPAnswer=function(a){return d.toSessionSDP(a,{role:"responder",direction:"outgoing"})},c.toIncomingMediaSDPOffer=function(a){return d.toMediaSDP(a,{role:"responder",direction:"incoming"})},c.toOutgoingMediaSDPOffer=function(a){return d.toMediaSDP(a,{role:"initiator",direction:"outgoing"})},c.toIncomingMediaSDPAnswer=function(a){return d.toMediaSDP(a,{role:"initiator",direction:"incoming"})},c.toOutgoingMediaSDPAnswer=function(a){return d.toMediaSDP(a,{role:"responder",direction:"outgoing"})},c.toCandidateSDP=d.toCandidateSDP,c.toMediaSDP=d.toMediaSDP,c.toSessionSDP=d.toSessionSDP,c.toIncomingJSONOffer=function(a,b){return e.toSessionJSON(a,{role:"responder",direction:"incoming",creators:b})},c.toOutgoingJSONOffer=function(a,b){return e.toSessionJSON(a,{role:"initiator",direction:"outgoing",creators:b})},c.toIncomingJSONAnswer=function(a,b){return e.toSessionJSON(a,{role:"initiator",direction:"incoming",creators:b})},c.toOutgoingJSONAnswer=function(a,b){return e.toSessionJSON(a,{role:"responder",direction:"outgoing",creators:b})},c.toIncomingMediaJSONOffer=function(a,b){return e.toMediaJSON(a,{role:"responder",direction:"incoming",creator:b})},c.toOutgoingMediaJSONOffer=function(a,b){return e.toMediaJSON(a,{role:"initiator",direction:"outgoing",creator:b})},c.toIncomingMediaJSONAnswer=function(a,b){return e.toMediaJSON(a,{role:"initiator",direction:"incoming",creator:b})},c.toOutgoingMediaJSONAnswer=function(a,b){return e.toMediaJSON(a,{role:"responder",direction:"outgoing",creator:b})},c.toCandidateJSON=e.toCandidateJSON,c.toMediaJSON=e.toMediaJSON,c.toSessionJSON=e.toSessionJSON},{"./lib/tojson":26,"./lib/tosdp":25}],18:[function(a,b,c){var d=a("getusermedia"),e={};b.exports=function(a,b){var c,f=2===arguments.length,g=f?b:a;if("undefined"==typeof window||"http:"===window.location.protocol)return c=new Error("NavigatorUserMediaError"),c.name="HTTPS_REQUIRED",g(c);if(window.navigator.userAgent.match("Chrome")){var h=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),i=33,j=!window.chrome.webstore;if(window.navigator.userAgent.match("Linux")&&(i=35),sessionStorage.getScreenMediaJSExtensionId)chrome.runtime.sendMessage(sessionStorage.getScreenMediaJSExtensionId,{type:"getScreen",id:1},null,function(a){if(""===a.sourceId){var b=new Error("NavigatorUserMediaError");b.name="PERMISSION_DENIED",g(b)}else{var c=c||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}};c.video.mandatory.chromeMediaSourceId=a.sourceId,d(c,g)}});else if(j||h>=26&&i>=h)a=f&&a||{video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}}},d(a,g);else{var k=window.setTimeout(function(){return c=new Error("NavigatorUserMediaError"),c.name="EXTENSION_UNAVAILABLE",g(c)},1e3);e[k]=[g,f?constraint:null],window.postMessage({type:"getScreen",id:k},"*")}}else if(window.navigator.userAgent.match("Firefox")){var l=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);l>=33?(a=f&&a||{video:{mozMediaSource:"window",mediaSource:"window"}},d(a,function(a,b){if(g(a,b),!a)var c=b.currentTime,d=window.setInterval(function(){b||window.clearInterval(d),b.currentTime==c&&(window.clearInterval(d),b.onended&&b.onended()),c=b.currentTime},500)})):(c=new Error("NavigatorUserMediaError"),c.name="EXTENSION_UNAVAILABLE")}},window.addEventListener("message",function(a){if(a.origin==window.location.origin)if("gotScreen"==a.data.type&&e[a.data.id]){var b=e[a.data.id],c=b[1],f=b[0];if(delete e[a.data.id],""===a.data.sourceId){var g=new Error("NavigatorUserMediaError");g.name="PERMISSION_DENIED",f(g)}else c=c||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},c.video.mandatory.chromeMediaSourceId=a.data.sourceId,d(c,f)}else"getScreenPending"==a.data.type&&window.clearTimeout(a.data.id)})},{getusermedia:16}],19:[function(a,b,c){function d(a){if(this.support=e.webAudio&&e.mediaStream,this.gain=1,this.support){var b=this.context=new e.AudioContext;this.microphone=b.createMediaStreamSource(a),this.gainFilter=b.createGain(),this.destination=b.createMediaStreamDestination(),this.outputStream=this.destination.stream,this.microphone.connect(this.gainFilter),this.gainFilter.connect(this.destination),a.addTrack(this.outputStream.getAudioTracks()[0]),a.removeTrack(a.getAudioTracks()[0])}this.stream=a}var e=a("webrtcsupport");d.prototype.setGain=function(a){this.support&&(this.gainFilter.gain.value=a,this.gain=a)},d.prototype.getGain=function(){return this.gain},d.prototype.off=function(){return this.setGain(0)},d.prototype.on=function(){this.setGain(1)},b.exports=d},{webrtcsupport:5}],22:[function(a,b,c){function d(a,b){return function(c,d,e){return"function"==typeof d&&void 0===e&&h(c)?a(c,d):b(c,g(d,e,3))}}var e=a("lodash._arrayeach"),f=a("lodash._baseeach"),g=a("lodash._bindcallback"),h=a("lodash.isarray"),i=d(e,f);b.exports=i},{"lodash._arrayeach":27,"lodash._baseeach":29,"lodash._bindcallback":28,"lodash.isarray":30}],23:[function(a,b,c){function d(a){return function(b){return null==b?void 0:b[a]}}function e(a){var b=a+"";return a=l(a),function(c){return k(c,a,b)}}function f(a,b){var c=typeof a;if("string"==c&&p.test(a)||"number"==c)return!0;if(m(a))return!1;var d=!o.test(a);return d||null!=b&&a in g(b)}function g(a){return i(a)?a:Object(a)}function h(a,b){return n(a,j(b))}function i(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function j(a){return f(a)?d(a):e(a)}var k=a("lodash._baseget"),l=a("lodash._topath"),m=a("lodash.isarray"),n=a("lodash.map"),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,p=/^\w*$/;b.exports=h},{"lodash._baseget":31,"lodash._topath":34,"lodash.isarray":32,"lodash.map":33}],25:[function(a,b,c){var d=a("./senders");c.toSessionSDP=function(a,b){var d=(b.role||"initiator",b.direction||"outgoing",b.sid||a.sid||Date.now()),e=b.time||Date.now(),f=["v=0","o=- "+d+" "+e+" IN IP4 0.0.0.0","s=-","t=0 0"],g=a.groups||[];g.forEach(function(a){f.push("a=group:"+a.semantics+" "+a.contents.join(" "))});var h=a.contents||[];return h.forEach(function(a){f.push(c.toMediaSDP(a,b))}),f.join("\r\n")+"\r\n"},c.toMediaSDP=function(a,b){var e=[],f=b.role||"initiator",g=b.direction||"outgoing",h=a.description,i=a.transport,j=h.payloads||[],k=i&&i.fingerprints||[],l=[];if("datachannel"==h.descType?(l.push("application"),l.push("1"),l.push("DTLS/SCTP"),i.sctp&&i.sctp.forEach(function(a){l.push(a.number)})):(l.push(h.media),l.push("1"),h.encryption&&h.encryption.length>0||k.length>0?l.push("RTP/SAVPF"):l.push("RTP/AVPF"),j.forEach(function(a){l.push(a.id)})),e.push("m="+l.join(" ")),e.push("c=IN IP4 0.0.0.0"),h.bandwidth&&h.bandwidth.type&&h.bandwidth.bandwidth&&e.push("b="+h.bandwidth.type+":"+h.bandwidth.bandwidth),"rtp"==h.descType&&e.push("a=rtcp:1 IN IP4 0.0.0.0"),i){i.ufrag&&e.push("a=ice-ufrag:"+i.ufrag),i.pwd&&e.push("a=ice-pwd:"+i.pwd);var m=!1;k.forEach(function(a){e.push("a=fingerprint:"+a.hash+" "+a.value),a.setup&&!m&&e.push("a=setup:"+a.setup)}),i.sctp&&i.sctp.forEach(function(a){e.push("a=sctpmap:"+a.number+" "+a.protocol+" "+a.streams)})}"rtp"==h.descType&&e.push("a="+(d[f][g][a.senders]||"sendrecv")),e.push("a=mid:"+a.name),h.mux&&e.push("a=rtcp-mux");var n=h.encryption||[];n.forEach(function(a){e.push("a=crypto:"+a.tag+" "+a.cipherSuite+" "+a.keyParams+(a.sessionParams?" "+a.sessionParams:""))}),h.googConferenceFlag&&e.push("a=x-google-flag:conference"),j.forEach(function(a){var b="a=rtpmap:"+a.id+" "+a.name+"/"+a.clockrate;if(a.channels&&"1"!=a.channels&&(b+="/"+a.channels),e.push(b),a.parameters&&a.parameters.length){var c=["a=fmtp:"+a.id],d=[];a.parameters.forEach(function(a){d.push((a.key?a.key+"=":"")+a.value)}),c.push(d.join(";")),e.push(c.join(" "))}a.feedback&&a.feedback.forEach(function(b){"trr-int"===b.type?e.push("a=rtcp-fb:"+a.id+" trr-int "+(b.value?b.value:"0")):e.push("a=rtcp-fb:"+a.id+" "+b.type+(b.subtype?" "+b.subtype:""))})}),h.feedback&&h.feedback.forEach(function(a){"trr-int"===a.type?e.push("a=rtcp-fb:* trr-int "+(a.value?a.value:"0")):e.push("a=rtcp-fb:* "+a.type+(a.subtype?" "+a.subtype:""))});var o=h.headerExtensions||[];o.forEach(function(a){e.push("a=extmap:"+a.id+(a.senders?"/"+d[f][g][a.senders]:"")+" "+a.uri)});var p=h.sourceGroups||[];p.forEach(function(a){e.push("a=ssrc-group:"+a.semantics+" "+a.sources.join(" "))});var q=h.sources||[];q.forEach(function(a){for(var b=0;b<a.parameters.length;b++){var c=a.parameters[b];e.push("a=ssrc:"+(a.ssrc||h.ssrc)+" "+c.key+(c.value?":"+c.value:""))}});var r=i.candidates||[];return r.forEach(function(a){e.push(c.toCandidateSDP(a))}),e.join("\r\n")},c.toCandidateSDP=function(a){var b=[];b.push(a.foundation),b.push(a.component),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.ip),b.push(a.port);var c=a.type;return b.push("typ"),b.push(c),("srflx"===c||"prflx"===c||"relay"===c)&&a.relAddr&&a.relPort&&(b.push("raddr"),b.push(a.relAddr),b.push("rport"),b.push(a.relPort)),a.tcpType&&"TCP"==a.protocol.toUpperCase()&&(b.push("tcptype"),b.push(a.tcpType)),b.push("generation"),b.push(a.generation||"0"),"a=candidate:"+b.join(" ")}},{"./senders":35}],28:[function(a,b,c){function d(a,b,c){if("function"!=typeof a)return e;if(void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)};case 5:return function(c,d,e,f,g){return a.call(b,c,d,e,f,g)}}return function(){return a.apply(b,arguments)}}function e(a){return a}b.exports=d},{}],27:[function(a,b,c){function d(a,b){for(var c=-1,d=a.length;++c<d&&b(a[c],c,a)!==!1;);return a}b.exports=d},{}],26:[function(a,b,c){var d=a("./senders"),e=a("./parsers"),f=Math.random();c._setIdCounter=function(a){f=a},c.toSessionJSON=function(a,b){var d,f=b.creators||[],g=b.role||"initiator",h=b.direction||"outgoing",i=a.split("\r\nm=");for(d=1;d<i.length;d++)i[d]="m="+i[d],d!==i.length-1&&(i[d]+="\r\n");var j=i.shift()+"\r\n",k=e.lines(j),l={},m=[];for(d=0;d<i.length;d++)m.push(c.toMediaJSON(i[d],j,{role:g,direction:h,creator:f[d]||"initiator"}));l.contents=m;var n=e.findLines("a=group:",k);return n.length&&(l.groups=e.groups(n)),l},c.toMediaJSON=function(a,b,f){var g=f.creator||"initiator",h=f.role||"initiator",i=f.direction||"outgoing",j=e.lines(a),k=e.lines(b),l=e.mline(j[0]),m={creator:g,name:l.media,description:{descType:"rtp",media:l.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transType:"iceUdp",candidates:[],fingerprints:[]}};"application"==l.media&&(m.description={descType:"datachannel"},m.transport.sctp=[]);var n=m.description,o=m.transport,p=e.findLine("a=mid:",j);if(p&&(m.name=p.substr(6)),e.findLine("a=sendrecv",j,k)?m.senders="both":e.findLine("a=sendonly",j,k)?m.senders=d[h][i].sendonly:e.findLine("a=recvonly",j,k)?m.senders=d[h][i].recvonly:e.findLine("a=inactive",j,k)&&(m.senders="none"),"rtp"==n.descType){var q=e.findLine("b=",j);q&&(n.bandwidth=e.bandwidth(q));var r=e.findLine("a=ssrc:",j);r&&(n.ssrc=r.substr(7).split(" ")[0]);var s=e.findLines("a=rtpmap:",j);s.forEach(function(a){var b=e.rtpmap(a);b.parameters=[],b.feedback=[];var c=e.findLines("a=fmtp:"+b.id,j);c.forEach(function(a){b.parameters=e.fmtp(a)});var d=e.findLines("a=rtcp-fb:"+b.id,j);d.forEach(function(a){b.feedback.push(e.rtcpfb(a))}),n.payloads.push(b)});var t=e.findLines("a=crypto:",j,k);t.forEach(function(a){n.encryption.push(e.crypto(a))}),e.findLine("a=rtcp-mux",j)&&(n.mux=!0);var u=e.findLines("a=rtcp-fb:*",j);u.forEach(function(a){n.feedback.push(e.rtcpfb(a))});var v=e.findLines("a=extmap:",j);v.forEach(function(a){var b=e.extmap(a);b.senders=d[h][i][b.senders],n.headerExtensions.push(b)});var w=e.findLines("a=ssrc-group:",j);n.sourceGroups=e.sourceGroups(w||[]);var x=e.findLines("a=ssrc:",j);n.sources=e.sources(x||[]),e.findLine("a=x-google-flag:conference",j,k)&&(n.googConferenceFlag=!0)}var y=e.findLines("a=fingerprint:",j,k),z=e.findLine("a=setup:",j,k);y.forEach(function(a){var b=e.fingerprint(a);z&&(b.setup=z.substr(8)),o.fingerprints.push(b)});var A=e.findLine("a=ice-ufrag:",j,k),B=e.findLine("a=ice-pwd:",j,k);if(A&&B){o.ufrag=A.substr(12),o.pwd=B.substr(10),o.candidates=[];var C=e.findLines("a=candidate:",j,k);C.forEach(function(a){o.candidates.push(c.toCandidateJSON(a))})}if("datachannel"==n.descType){var D=e.findLines("a=sctpmap:",j);D.forEach(function(a){var b=e.sctpmap(a);o.sctp.push(b)})}return m},c.toCandidateJSON=function(a){var b=e.candidate(a.split("\r\n")[0]);return b.id=(f++).toString(36).substr(0,12),b}},{"./parsers":36,"./senders":35}],30:[function(a,b,c){function d(a){return"string"==typeof a?a:null==a?"":a+""}function e(a){return!!a&&"object"==typeof a}function f(a,b){var c=null==a?void 0:a[b];return h(c)?c:void 0}function g(a){return"number"==typeof a&&a>-1&&a%1==0&&u>=a}function h(a){return null==a?!1:r.call(a)==k?s.test(p.call(a)):e(a)&&n.test(a)}function i(a){return a=d(a),a&&m.test(a)?a.replace(l,"\\$&"):a}var j="[object Array]",k="[object Function]",l=/[.*+?^${}()|[\]\/\\]/g,m=RegExp(l.source),n=/^\[object .+?Constructor\]$/,o=Object.prototype,p=Function.prototype.toString,q=o.hasOwnProperty,r=o.toString,s=RegExp("^"+i(p.call(q)).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),t=f(Array,"isArray"),u=9007199254740991,v=t||function(a){return e(a)&&g(a.length)&&r.call(a)==j};b.exports=v},{}],31:[function(a,b,c){function d(a,b,c){if(null!=a){void 0!==c&&c in e(a)&&(b=[c]);for(var d=0,f=b.length;null!=a&&f>d;)a=a[b[d++]];return d&&d==f?a:void 0}}function e(a){return f(a)?a:Object(a)}function f(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}b.exports=d},{}],32:[function(a,b,c){function d(a){return"string"==typeof a?a:null==a?"":a+""}function e(a){return!!a&&"object"==typeof a}function f(a,b){var c=null==a?void 0:a[b];return h(c)?c:void 0}function g(a){return"number"==typeof a&&a>-1&&a%1==0&&u>=a}function h(a){return null==a?!1:r.call(a)==k?s.test(p.call(a)):e(a)&&n.test(a)}function i(a){return a=d(a),a&&m.test(a)?a.replace(l,"\\$&"):a}var j="[object Array]",k="[object Function]",l=/[.*+?^${}()|[\]\/\\]/g,m=RegExp(l.source),n=/^\[object .+?Constructor\]$/,o=Object.prototype,p=Function.prototype.toString,q=o.hasOwnProperty,r=o.toString,s=RegExp("^"+i(p.call(q)).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),t=f(Array,"isArray"),u=9007199254740991,v=t||function(a){return e(a)&&g(a.length)&&r.call(a)==j};b.exports=v},{}],21:[function(a,b,c){function d(a){return{type:a.type,sdp:a.sdp}}function e(a){var b={label:a.id};return a.getAudioTracks().length&&(b.audio=a.getAudioTracks().map(function(a){return a.id})),a.getVideoTracks().length&&(b.video=a.getVideoTracks().map(function(a){return a.id})),b}function f(a,b){var c=this;i.call(this),this.peerconnection=new h.PeerConnection(a,b),this.trace=function(a,b){c.emit("PeerConnectionTrace",{time:new Date,type:a,value:b||""})},this.onicecandidate=null,this.peerconnection.onicecandidate=function(a){c.trace("onicecandidate",a.candidate),null!==c.onicecandidate&&c.onicecandidate(a)},this.onaddstream=null,this.peerconnection.onaddstream=function(a){c.trace("onaddstream",e(a.stream)),null!==c.onaddstream&&c.onaddstream(a)},this.onremovestream=null,this.peerconnection.onremovestream=function(a){c.trace("onremovestream",e(a.stream)),null!==c.onremovestream&&c.onremovestream(a)},this.onsignalingstatechange=null,this.peerconnection.onsignalingstatechange=function(a){c.trace("onsignalingstatechange",c.signalingState),null!==c.onsignalingstatechange&&c.onsignalingstatechange(a)},this.oniceconnectionstatechange=null,this.peerconnection.oniceconnectionstatechange=function(a){c.trace("oniceconnectionstatechange",c.iceConnectionState),null!==c.oniceconnectionstatechange&&c.oniceconnectionstatechange(a)},this.onnegotiationneeded=null,this.peerconnection.onnegotiationneeded=function(a){c.trace("onnegotiationneeded"),null!==c.onnegotiationneeded&&c.onnegotiationneeded(a)},c.ondatachannel=null,this.peerconnection.ondatachannel=function(a){c.trace("ondatachannel",a),null!==c.ondatachannel&&c.ondatachannel(a)},this.getLocalStreams=this.peerconnection.getLocalStreams.bind(this.peerconnection),this.getRemoteStreams=this.peerconnection.getRemoteStreams.bind(this.peerconnection)}var g=a("util"),h=a("webrtcsupport"),i=a("wildemitter");g.inherits(f,i),Object.defineProperty(f.prototype,"signalingState",{get:function(){return this.peerconnection.signalingState}}),Object.defineProperty(f.prototype,"iceConnectionState",{get:function(){return this.peerconnection.iceConnectionState}}),Object.defineProperty(f.prototype,"localDescription",{get:function(){return this.peerconnection.localDescription}}),Object.defineProperty(f.prototype,"remoteDescription",{get:function(){return this.peerconnection.remoteDescription}}),f.prototype.addStream=function(a){this.trace("addStream",e(a)),this.peerconnection.addStream(a)},f.prototype.removeStream=function(a){this.trace("removeStream",e(a)),this.peerconnection.removeStream(a)},f.prototype.createDataChannel=function(a,b){return this.trace("createDataChannel",a,b),this.peerconnection.createDataChannel(a,b)},f.prototype.setLocalDescription=function(a,b,c){var e=this;this.trace("setLocalDescription",d(a)),this.peerconnection.setLocalDescription(a,function(){e.trace("setLocalDescriptionOnSuccess"),b()},function(a){e.trace("setLocalDescriptionOnFailure",a),c(a)})},f.prototype.setRemoteDescription=function(a,b,c){var e=this;this.trace("setRemoteDescription",d(a)),this.peerconnection.setRemoteDescription(a,function(){e.trace("setRemoteDescriptionOnSuccess"),b()},function(a){e.trace("setRemoteDescriptionOnFailure",a),c(a)})},f.prototype.close=function(){this.trace("stop"),null!==this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null),"closed"!=this.peerconnection.signalingState&&this.peerconnection.close()},f.prototype.createOffer=function(a,b,c){var e=this;this.trace("createOffer",c),this.peerconnection.createOffer(function(b){e.trace("createOfferOnSuccess",d(b)),a(b)},function(a){e.trace("createOfferOnFailure",a),b(a)},c)},f.prototype.createAnswer=function(a,b,c){var e=this;this.trace("createAnswer",c),this.peerconnection.createAnswer(function(b){e.trace("createAnswerOnSuccess",d(b)),a(b)},function(a){e.trace("createAnswerOnFailure",a),b(a)},c)},f.prototype.addIceCandidate=function(a,b,c){var d=this;this.trace("addIceCandidate",a),this.peerconnection.addIceCandidate(a,function(){b&&b()},function(a){d.trace("addIceCandidateOnFailure",a),c&&c(a)})},f.prototype.getStats=function(a,b){navigator.mozGetUserMedia?this.peerconnection.getStats(null,a,b):this.peerconnection.getStats(a)},b.exports=f},{util:8,webrtcsupport:5,wildemitter:4}],35:[function(a,b,c){b.exports={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}}},{}],36:[function(a,b,c){c.lines=function(a){return a.split("\r\n").filter(function(a){return a.length>0})},c.findLine=function(a,b,c){for(var d=a.length,e=0;e<b.length;e++)if(b[e].substr(0,d)===a)return b[e];if(!c)return!1;for(var f=0;f<c.length;f++)if(c[f].substr(0,d)===a)return c[f];return!1},c.findLines=function(a,b,c){for(var d=[],e=a.length,f=0;f<b.length;f++)b[f].substr(0,e)===a&&d.push(b[f]);if(d.length||!c)return d;for(var g=0;g<c.length;g++)c[g].substr(0,e)===a&&d.push(c[g]);return d},c.mline=function(a){for(var b=a.substr(2).split(" "),c={media:b[0],port:b[1],proto:b[2],formats:[]},d=3;d<b.length;d++)b[d]&&c.formats.push(b[d]);return c},c.rtpmap=function(a){var b=a.substr(9).split(" "),c={id:b.shift()};return b=b[0].split("/"),c.name=b[0],c.clockrate=b[1],c.channels=3==b.length?b[2]:"1",c},c.sctpmap=function(a){var b=a.substr(10).split(" "),c={number:b.shift(),protocol:b.shift(),streams:b.shift()};return c},c.fmtp=function(a){for(var b,c,d,e=a.substr(a.indexOf(" ")+1).split(";"),f=[],g=0;g<e.length;g++)b=e[g].split("="),c=b[0].trim(),d=b[1],c&&d?f.push({key:c,value:d}):c&&f.push({key:"",value:c});return f},c.crypto=function(a){var b=a.substr(9).split(" "),c={tag:b[0],cipherSuite:b[1],keyParams:b[2],sessionParams:b.slice(3).join(" ")};return c},c.fingerprint=function(a){var b=a.substr(14).split(" ");return{hash:b[0],value:b[1]}},c.extmap=function(a){var b=a.substr(9).split(" "),c={},d=b.shift(),e=d.indexOf("/");return e>=0?(c.id=d.substr(0,e),c.senders=d.substr(e+1)):(c.id=d,c.senders="sendrecv"),c.uri=b.shift()||"",c},c.rtcpfb=function(a){var b=a.substr(10).split(" "),c={};return c.id=b.shift(),c.type=b.shift(),"trr-int"===c.type?c.value=b.shift():c.subtype=b.shift()||"",c.parameters=b,c},c.candidate=function(a){var b;b=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var c={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:b[3],ip:b[4],port:b[5],type:b[7],generation:"0"},d=8;d<b.length;d+=2)"raddr"===b[d]?c.relAddr=b[d+1]:"rport"===b[d]?c.relPort=b[d+1]:"generation"===b[d]?c.generation=b[d+1]:"tcptype"===b[d]&&(c.tcpType=b[d+1]);return c.network="1",c},c.sourceGroups=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c].substr(13).split(" ");b.push({semantics:d.shift(),sources:d})}return b},c.sources=function(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d].substr(7).split(" "),f=e.shift();if(!c[f]){var g={ssrc:f,parameters:[]};b.push(g),c[f]=g}e=e.join(" ").split(":");var h=e.shift(),i=e.join(":")||null;c[f].parameters.push({key:h,value:i})}return b},c.groups=function(a){for(var b,c=[],d=0;d<a.length;d++)b=a[d].substr(8).split(" "),c.push({semantics:b.shift(),contents:b});return c},c.bandwidth=function(a){var b=a.substr(2).split(":"),c={};return c.type=b.shift(),c.bandwidth=b.shift(),c}},{}],29:[function(a,b,c){function d(a,b){return n(a,b,k)}function e(a){return function(b){return null==b?void 0:b[a]}}function f(a,b){return function(c,d){var e=c?o(c):0;if(!h(e))return a(c,d);for(var f=b?e:-1,g=i(c);(b?f--:++f<e)&&d(g[f],f,g)!==!1;);return c}}function g(a){return function(b,c,d){for(var e=i(b),f=d(b),g=f.length,h=a?g:-1;a?h--:++h<g;){var j=f[h];if(c(e[j],j,e)===!1)break}return b}}function h(a){return"number"==typeof a&&a>-1&&a%1==0&&l>=a}function i(a){return j(a)?a:Object(a)}function j(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}var k=a("lodash.keys"),l=9007199254740991,m=f(d),n=g(),o=e("length");b.exports=m},{"lodash.keys":37}],33:[function(a,b,c){function d(a,b){var c=-1,d=f(a)?Array(a.length):[];return k(a,function(a,e,f){d[++c]=b(a,e,f)}),d}function e(a){return function(b){return null==b?void 0:b[a]}}function f(a){return null!=a&&g(n(a))}function g(a){return"number"==typeof a&&a>-1&&a%1==0&&m>=a}function h(a,b,c){var e=l(a)?i:d;return b=j(b,c,3),e(a,b)}var i=a("lodash._arraymap"),j=a("lodash._basecallback"),k=a("lodash._baseeach"),l=a("lodash.isarray"),m=9007199254740991,n=e("length");b.exports=h},{"lodash._arraymap":40,"lodash._basecallback":38,"lodash._baseeach":39,"lodash.isarray":32}],34:[function(a,b,c){function d(a){return"string"==typeof a?a:null==a?"":a+""}function e(a){if(f(a))return a;var b=[];return d(a).replace(g,function(a,c,d,e){b.push(d?e.replace(h,"$1"):c||a)}),b}var f=a("lodash.isarray"),g=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,h=/\\(\\)?/g;b.exports=e},{"lodash.isarray":32}],40:[function(a,b,c){function d(a,b){for(var c=-1,d=a.length,e=Array(d);++c<d;)e[c]=b(a[c],c,a);return e}b.exports=d},{}],41:[function(a,b,c){function d(a){return"string"==typeof a?a:null==a?"":a+""}function e(a){return!!a&&"object"==typeof a}function f(a,b){var c=null==a?void 0:a[b];return g(c)?c:void 0}function g(a){return null==a?!1:p.call(a)==i?q.test(n.call(a)):e(a)&&l.test(a)}function h(a){return a=d(a),a&&k.test(a)?a.replace(j,"\\$&"):a}var i="[object Function]",j=/[.*+?^${}()|[\]\/\\]/g,k=RegExp(j.source),l=/^\[object .+?Constructor\]$/,m=Object.prototype,n=Function.prototype.toString,o=m.hasOwnProperty,p=m.toString,q=RegExp("^"+h(n.call(o)).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");b.exports=f},{}],42:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a){return function(b){return null==b?void 0:b[a]}}function f(a){return null!=a&&g(m(a))}function g(a){return"number"==typeof a&&a>-1&&a%1==0&&l>=a}function h(a){return d(a)&&f(a)&&k.call(a)==i}var i="[object Arguments]",j=Object.prototype,k=j.toString,l=9007199254740991,m=e("length");b.exports=h},{}],39:[function(a,b,c){function d(a,b){return n(a,b,k)}function e(a){return function(b){return null==b?void 0:b[a]}}function f(a,b){return function(c,d){var e=c?o(c):0;if(!h(e))return a(c,d);for(var f=b?e:-1,g=i(c);(b?f--:++f<e)&&d(g[f],f,g)!==!1;);return c}}function g(a){return function(b,c,d){for(var e=i(b),f=d(b),g=f.length,h=a?g:-1;a?h--:++h<g;){var j=f[h];if(c(e[j],j,e)===!1)break}return b}}function h(a){return"number"==typeof a&&a>-1&&a%1==0&&l>=a}function i(a){return j(a)?a:Object(a)}function j(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}var k=a("lodash.keys"),l=9007199254740991,m=f(d),n=g(),o=e("length");b.exports=m},{"lodash.keys":43}],44:[function(a,b,c){function d(a,b,c){if("function"!=typeof a)return e;if(void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)};case 5:return function(c,d,e,f,g){return a.call(b,c,d,e,f,g)}}return function(){return a.apply(b,arguments)}}function e(a){return a}b.exports=d},{}],37:[function(a,b,c){function d(a){return function(b){return null==b?void 0:b[a]}}function e(a){return null!=a&&g(s(a))}function f(a,b){return a="number"==typeof a||n.test(a)?+a:-1,b=null==b?r:b,a>-1&&a%1==0&&b>a}function g(a){return"number"==typeof a&&a>-1&&a%1==0&&r>=a}function h(a){for(var b=j(a),c=b.length,d=c&&a.length,e=!!d&&g(d)&&(m(a)||l(a)),h=-1,i=[];++h<c;){var k=b[h];(e&&f(k,d)||p.call(a,k))&&i.push(k)}return i}function i(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function j(a){if(null==a)return[];i(a)||(a=Object(a));var b=a.length;b=b&&g(b)&&(m(a)||l(a))&&b||0;for(var c=a.constructor,d=-1,e="function"==typeof c&&c.prototype===a,h=Array(b),j=b>0;++d<b;)h[d]=d+"";for(var k in a)j&&f(k,b)||"constructor"==k&&(e||!p.call(a,k))||h.push(k);return h}var k=a("lodash._getnative"),l=a("lodash.isarguments"),m=a("lodash.isarray"),n=/^\d+$/,o=Object.prototype,p=o.hasOwnProperty,q=k(Object,"keys"),r=9007199254740991,s=d("length"),t=q?function(a){var b=null==a?null:a.constructor;return"function"==typeof b&&b.prototype===a||"function"!=typeof a&&e(a)?h(a):i(a)?q(a):[]}:h;b.exports=t},{"lodash._getnative":41,"lodash.isarguments":42,"lodash.isarray":30}],38:[function(a,b,c){function d(a){return"string"==typeof a?a:null==a?"":a+""}function e(a,b,c){var d=typeof a;return"function"==d?void 0===b?a:w(a,b,c):null==a?t:"object"==d?h(a):void 0===b?u(a):i(a,b)}function f(a,b,c){if(null!=a){void 0!==c&&c in p(a)&&(b=[c]);for(var d=0,e=b.length;null!=a&&e>d;)a=a[b[d++]];return d&&d==e?a:void 0}}function g(a,b,c){var d=b.length,e=d,f=!c;if(null==a)return!e;for(a=p(a);d--;){var g=b[d];if(f&&g[2]?g[1]!==a[g[0]]:!(g[0]in a))return!1}for(;++d<e;){g=b[d];var h=g[0],i=a[h],j=g[1];if(f&&g[2]){if(void 0===i&&!(h in a))return!1}else{var k=c?c(i,j,h):void 0;if(!(void 0===k?v(j,i,c,!0):k))return!1}}return!0}function h(a){var b=m(a);if(1==b.length&&b[0][2]){
var c=b[0][0],d=b[0][1];return function(a){return null==a?!1:a[c]===d&&(void 0!==d||c in p(a))}}return function(a){return g(a,b)}}function i(a,b){var c=x(a),d=n(a)&&o(b),e=a+"";return a=q(a),function(g){if(null==g)return!1;var h=e;if(g=p(g),!(!c&&d||h in g)){if(g=1==a.length?g:f(g,l(a,0,-1)),null==g)return!1;h=r(a),g=p(g)}return g[h]===b?void 0!==b||h in g:v(b,g[h],void 0,!0)}}function j(a){return function(b){return null==b?void 0:b[a]}}function k(a){var b=a+"";return a=q(a),function(c){return f(c,a,b)}}function l(a,b,c){var d=-1,e=a.length;b=null==b?0:+b||0,0>b&&(b=-b>e?0:e+b),c=void 0===c||c>e?e:+c||0,0>c&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Array(e);++d<e;)f[d]=a[d+b];return f}function m(a){for(var b=y(a),c=b.length;c--;)b[c][2]=o(b[c][1]);return b}function n(a,b){var c=typeof a;if("string"==c&&A.test(a)||"number"==c)return!0;if(x(a))return!1;var d=!z.test(a);return d||null!=b&&a in p(b)}function o(a){return a===a&&!s(a)}function p(a){return s(a)?a:Object(a)}function q(a){if(x(a))return a;var b=[];return d(a).replace(B,function(a,c,d,e){b.push(d?e.replace(C,"$1"):c||a)}),b}function r(a){var b=a?a.length:0;return b?a[b-1]:void 0}function s(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function t(a){return a}function u(a){return n(a)?j(a):k(a)}var v=a("lodash._baseisequal"),w=a("lodash._bindcallback"),x=a("lodash.isarray"),y=a("lodash.pairs"),z=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,A=/^\w*$/,B=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,C=/\\(\\)?/g;b.exports=e},{"lodash._baseisequal":46,"lodash._bindcallback":44,"lodash.isarray":32,"lodash.pairs":45}],47:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a){return"number"==typeof a&&a>-1&&a%1==0&&G>=a}function f(a){return d(a)&&e(a.length)&&!!D[F.call(a)]}var g="[object Arguments]",h="[object Array]",i="[object Boolean]",j="[object Date]",k="[object Error]",l="[object Function]",m="[object Map]",n="[object Number]",o="[object Object]",p="[object RegExp]",q="[object Set]",r="[object String]",s="[object WeakMap]",t="[object ArrayBuffer]",u="[object Float32Array]",v="[object Float64Array]",w="[object Int8Array]",x="[object Int16Array]",y="[object Int32Array]",z="[object Uint8Array]",A="[object Uint8ClampedArray]",B="[object Uint16Array]",C="[object Uint32Array]",D={};D[u]=D[v]=D[w]=D[x]=D[y]=D[z]=D[A]=D[B]=D[C]=!0,D[g]=D[h]=D[t]=D[i]=D[j]=D[k]=D[l]=D[m]=D[n]=D[o]=D[p]=D[q]=D[r]=D[s]=!1;var E=Object.prototype,F=E.toString,G=9007199254740991;b.exports=f},{}],48:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a){return function(b){return null==b?void 0:b[a]}}function f(a){return null!=a&&g(m(a))}function g(a){return"number"==typeof a&&a>-1&&a%1==0&&l>=a}function h(a){return d(a)&&f(a)&&k.call(a)==i}var i="[object Arguments]",j=Object.prototype,k=j.toString,l=9007199254740991,m=e("length");b.exports=h},{}],45:[function(a,b,c){function d(a){return e(a)?a:Object(a)}function e(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function f(a){a=d(a);for(var b=-1,c=g(a),e=c.length,f=Array(e);++b<e;){var h=c[b];f[b]=[h,a[h]]}return f}var g=a("lodash.keys");b.exports=f},{"lodash.keys":43}],49:[function(a,b,c){function d(a){return"string"==typeof a?a:null==a?"":a+""}function e(a){return!!a&&"object"==typeof a}function f(a,b){var c=null==a?void 0:a[b];return g(c)?c:void 0}function g(a){return null==a?!1:p.call(a)==i?q.test(n.call(a)):e(a)&&l.test(a)}function h(a){return a=d(a),a&&k.test(a)?a.replace(j,"\\$&"):a}var i="[object Function]",j=/[.*+?^${}()|[\]\/\\]/g,k=RegExp(j.source),l=/^\[object .+?Constructor\]$/,m=Object.prototype,n=Function.prototype.toString,o=m.hasOwnProperty,p=m.toString,q=RegExp("^"+h(n.call(o)).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");b.exports=f},{}],43:[function(a,b,c){function d(a){return function(b){return null==b?void 0:b[a]}}function e(a){return null!=a&&g(s(a))}function f(a,b){return a="number"==typeof a||n.test(a)?+a:-1,b=null==b?r:b,a>-1&&a%1==0&&b>a}function g(a){return"number"==typeof a&&a>-1&&a%1==0&&r>=a}function h(a){for(var b=j(a),c=b.length,d=c&&a.length,e=!!d&&g(d)&&(m(a)||l(a)),h=-1,i=[];++h<c;){var k=b[h];(e&&f(k,d)||p.call(a,k))&&i.push(k)}return i}function i(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function j(a){if(null==a)return[];i(a)||(a=Object(a));var b=a.length;b=b&&g(b)&&(m(a)||l(a))&&b||0;for(var c=a.constructor,d=-1,e="function"==typeof c&&c.prototype===a,h=Array(b),j=b>0;++d<b;)h[d]=d+"";for(var k in a)j&&f(k,b)||"constructor"==k&&(e||!p.call(a,k))||h.push(k);return h}var k=a("lodash._getnative"),l=a("lodash.isarguments"),m=a("lodash.isarray"),n=/^\d+$/,o=Object.prototype,p=o.hasOwnProperty,q=k(Object,"keys"),r=9007199254740991,s=d("length"),t=q?function(a){var b=null==a?null:a.constructor;return"function"==typeof b&&b.prototype===a||"function"!=typeof a&&e(a)?h(a):i(a)?q(a):[]}:h;b.exports=t},{"lodash._getnative":49,"lodash.isarguments":48,"lodash.isarray":32}],46:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a,b){for(var c=-1,d=a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}function f(a,b,c,e,h,i){return a===b?!0:null==a||null==b||!k(a)&&!d(b)?a!==a&&b!==b:g(a,b,f,c,e,h,i)}function g(a,b,c,d,e,f,g){var k=l(a),n=l(b),q=p,r=p;k||(q=z.call(a),q==o?q=u:q!=u&&(k=m(a))),n||(r=z.call(b),r==o?r=u:r!=u&&(n=m(b)));var s=q==u,t=r==u,v=q==r;if(v&&!k&&!s)return i(a,b,q);if(!e){var w=s&&y.call(a,"__wrapped__"),x=t&&y.call(b,"__wrapped__");if(w||x)return c(w?a.value():a,x?b.value():b,d,e,f,g)}if(!v)return!1;f||(f=[]),g||(g=[]);for(var A=f.length;A--;)if(f[A]==a)return g[A]==b;f.push(a),g.push(b);var B=(k?h:j)(a,b,c,d,e,f,g);return f.pop(),g.pop(),B}function h(a,b,c,d,f,g,h){var i=-1,j=a.length,k=b.length;if(j!=k&&!(f&&k>j))return!1;for(;++i<j;){var l=a[i],m=b[i],n=d?d(f?m:l,f?l:m,i):void 0;if(void 0!==n){if(n)continue;return!1}if(f){if(!e(b,function(a){return l===a||c(l,a,d,f,g,h)}))return!1}else if(l!==m&&!c(l,m,d,f,g,h))return!1}return!0}function i(a,b,c){switch(c){case q:case r:return+a==+b;case s:return a.name==b.name&&a.message==b.message;case t:return a!=+a?b!=+b:a==+b;case v:case w:return a==b+""}return!1}function j(a,b,c,d,e,f,g){var h=n(a),i=h.length,j=n(b),k=j.length;if(i!=k&&!e)return!1;for(var l=i;l--;){var m=h[l];if(!(e?m in b:y.call(b,m)))return!1}for(var o=e;++l<i;){m=h[l];var p=a[m],q=b[m],r=d?d(e?q:p,e?p:q,m):void 0;if(!(void 0===r?c(p,q,d,e,f,g):r))return!1;o||(o="constructor"==m)}if(!o){var s=a.constructor,t=b.constructor;if(s!=t&&"constructor"in a&&"constructor"in b&&!("function"==typeof s&&s instanceof s&&"function"==typeof t&&t instanceof t))return!1}return!0}function k(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}var l=a("lodash.isarray"),m=a("lodash.istypedarray"),n=a("lodash.keys"),o="[object Arguments]",p="[object Array]",q="[object Boolean]",r="[object Date]",s="[object Error]",t="[object Number]",u="[object Object]",v="[object RegExp]",w="[object String]",x=Object.prototype,y=x.hasOwnProperty,z=x.toString;b.exports=f},{"lodash.isarray":32,"lodash.istypedarray":47,"lodash.keys":43}]},{},[1])(1)}),function(){function a(){var a=this.vertices,b=this.faces,c=function(b,c,d){a.push({x:b,y:c,z:d})},d=function(a,c,d,e){b.push({a:a,b:c,c:d,d:e})};c(1,1,-1),c(1,-1,-1),c(-1,-1,-1),c(-1,1,-1),c(1,1,1),c(1,-1,1),c(-1,-1,1),c(-1,1,1),d(0,1,2,3),d(4,7,6,5),d(0,4,5,1),d(1,5,6,2),d(2,6,7,3),d(4,0,3,7)}window.$jit=function(a){a=a||window;for(var b in $jit)$jit[b].$extend&&(a[b]=$jit[b])},$jit.version="2.0.1";var b=function(a){return document.getElementById(a)};b.empty=function(){},b.extend=function(a,b){for(var c in b||{})a[c]=b[c];return a},b.lambda=function(a){return"function"==typeof a?a:function(){return a}},b.time=Date.now||function(){return+new Date},b.splat=function(a){var c=b.type(a);return c?"array"!=c?[a]:a:[]},b.type=function(a){var c=b.type.s.call(a).match(/^\[object\s(.*)\]$/)[1].toLowerCase();return"object"!=c?c:a&&a.$$family?a.$$family:a&&a.nodeName&&1==a.nodeType?"element":c},b.type.s=Object.prototype.toString,b.each=function(a,c){var d=b.type(a);if("object"==d)for(var e in a)c(a[e],e);else for(var f=0,g=a.length;g>f;f++)c(a[f],f)},b.indexOf=function(a,b){if(Array.indexOf)return a.indexOf(b);for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},b.map=function(a,c){var d=[];return b.each(a,function(a,b){d.push(c(a,b))}),d},b.reduce=function(a,b,c){var d=a.length;if(0==d)return c;for(var e=3==arguments.length?c:a[--d];d--;)e=b(e,a[d]);return e},b.merge=function(){for(var a={},c=0,d=arguments.length;d>c;c++){var e=arguments[c];if("object"==b.type(e))for(var f in e){var g=e[f],h=a[f];a[f]=h&&"object"==b.type(g)&&"object"==b.type(h)?b.merge(h,g):b.unlink(g)}}return a},b.unlink=function(a){var c;switch(b.type(a)){case"object":c={};for(var d in a)c[d]=b.unlink(a[d]);break;case"array":c=[];for(var e=0,f=a.length;f>e;e++)c[e]=b.unlink(a[e]);break;default:return a}return c},b.zip=function(){if(0===arguments.length)return[];for(var a=0,b=[],c=arguments.length,d=arguments[0].length;d>a;a++){for(var e=0,f=[];c>e;e++)f.push(arguments[e][a]);b.push(f)}return b},b.rgbToHex=function(a,b){if(a.length<3)return null;if(4==a.length&&0==a[3]&&!b)return"transparent";for(var c=[],d=0;3>d;d++){var e=(a[d]-0).toString(16);c.push(1==e.length?"0"+e:e)}return b?c:"#"+c.join("")},b.hexToRgb=function(a){if(7!=a.length){if(a=a.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/),a.shift(),3!=a.length)return null;for(var b=[],c=0;3>c;c++){var d=a[c];1==d.length&&(d+=d),b.push(parseInt(d,16))}return b}return a=parseInt(a.slice(1),16),[a>>16,a>>8&255,255&a]},b.destroy=function(a){b.clean(a),a.parentNode&&a.parentNode.removeChild(a),a.clearAttributes&&a.clearAttributes()},b.clean=function(a){for(var c=a.childNodes,d=0,e=c.length;e>d;d++)b.destroy(c[d])},b.addEvent=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},b.addEvents=function(a,c){for(var d in c)b.addEvent(a,d,c[d])},b.hasClass=function(a,b){return(" "+a.className+" ").indexOf(" "+b+" ")>-1},b.addClass=function(a,c){b.hasClass(a,c)||(a.className=a.className+" "+c)},b.removeClass=function(a,b){a.className=a.className.replace(new RegExp("(^|\\s)"+b+"(?:\\s|$)"),"$1")},b.getPos=function(a){function b(a){for(var b={x:0,y:0};a&&!d(a);)b.x+=a.offsetLeft,b.y+=a.offsetTop,a=a.offsetParent;return b}function c(a){for(var b={x:0,y:0};a&&!d(a);)b.x+=a.scrollLeft,b.y+=a.scrollTop,a=a.parentNode;return b}function d(a){return/^(?:body|html)$/i.test(a.tagName)}var e=b(a),f=c(a);return{x:e.x-f.x,y:e.y-f.y}},b.event={get:function(a,b){return b=b||window,a||b.event},getWheel:function(a){return a.wheelDelta?a.wheelDelta/120:-(a.detail||0)/3},isRightClick:function(a){return 3==a.which||2==a.button},getPos:function(a,b){b=b||window,a=a||b.event;var c=b.document;c=c.documentElement||c.body,a.touches&&a.touches.length&&(a=a.touches[0]);var d={x:a.pageX||a.clientX+c.scrollLeft,y:a.pageY||a.clientY+c.scrollTop};return d},stop:function(a){a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.preventDefault?a.preventDefault():a.returnValue=!1}},$jit.util=$jit.id=b;var c=function(a){a=a||{};var d=function(){for(var a in this)"function"!=typeof this[a]&&(this[a]=b.unlink(this[a]));if(this.constructor=d,c.prototyping)return this;var e=this.initialize?this.initialize.apply(this,arguments):this;return this.$$family="class",e};for(var e in c.Mutators)a[e]&&(a=c.Mutators[e](a,a[e]),delete a[e]);return b.extend(d,this),d.constructor=c,d.prototype=a,d};c.Mutators={Implements:function(a,d){return b.each(b.splat(d),function(b){c.prototyping=b;var d="function"==typeof b?new b:b;for(var e in d)e in a||(a[e]=d[e]);delete c.prototyping}),a}},b.extend(c,{inherit:function(a,d){for(var e in d){var f=d[e],g=a[e],h=b.type(f);g&&"function"==h?f!=g&&c.override(a,e,f):"object"==h?a[e]=b.merge(g,f):a[e]=f}return a},override:function(a,b,d){var e=c.prototyping;e&&a[b]!=e[b]&&(e=null);var f=function(){var c=this.parent;this.parent=e?e[b]:a[b];var f=d.apply(this,arguments);return this.parent=c,f};a[b]=f}}),c.prototype.implement=function(){var a=this.prototype;return b.each(Array.prototype.slice.call(arguments||[]),function(b){c.inherit(a,b)}),this},$jit.Class=c,$jit.json={prune:function(a,b){this.each(a,function(a,c){c==b&&a.children&&(delete a.children,a.children=[])})},getParent:function(a,b){if(a.id==b)return!1;var c=a.children;if(c&&c.length>0)for(var d=0;d<c.length;d++){if(c[d].id==b)return a;var e=this.getParent(c[d],b);if(e)return e}return!1},getSubtree:function(a,b){if(a.id==b)return a;for(var c=0,d=a.children;d&&c<d.length;c++){var e=this.getSubtree(d[c],b);if(null!=e)return e}return null},eachLevel:function(a,b,c,d){if(c>=b){if(d(a,b),!a.children)return;for(var e=0,f=a.children;e<f.length;e++)this.eachLevel(f[e],b+1,c,d)}},each:function(a,b){this.eachLevel(a,0,Number.MAX_VALUE,b)}},$jit.Trans={$extend:!0,linear:function(a){return a}};var d=$jit.Trans;!function(){var a=function(a,c){return c=b.splat(c),b.extend(a,{easeIn:function(b){return a(b,c)},easeOut:function(b){return 1-a(1-b,c)},easeInOut:function(b){return.5>=b?a(2*b,c)/2:(2-a(2*(1-b),c))/2}})},c={Pow:function(a,b){return Math.pow(a,b[0]||6)},Expo:function(a){return Math.pow(2,8*(a-1))},Circ:function(a){return 1-Math.sin(Math.acos(a))},Sine:function(a){return 1-Math.sin((1-a)*Math.PI/2)},Back:function(a,b){return b=b[0]||1.618,Math.pow(a,2)*((b+1)*a-b)},Bounce:function(a){for(var b,c=0,d=1;1;c+=d,d/=2)if(a>=(7-4*c)/11){b=d*d-Math.pow((11-6*c-11*a)/4,2);break}return b},Elastic:function(a,b){return Math.pow(2,10*--a)*Math.cos(20*a*Math.PI*(b[0]||1)/3)}};b.each(c,function(b,c){d[c]=a(b)}),b.each(["Quad","Cubic","Quart","Quint"],function(b,c){d[b]=a(function(a){return Math.pow(a,[c+2])})})}();var e=new c({initialize:function(a){this.setOptions(a)},setOptions:function(a){var c={duration:2500,fps:40,transition:d.Quart.easeInOut,compute:b.empty,complete:b.empty,link:"ignore"};return this.opt=b.merge(c,a||{}),this},step:function(){var a=b.time(),c=this.opt;if(a<this.time+c.duration){var d=c.transition((a-this.time)/c.duration);c.compute(d)}else this.timer=clearInterval(this.timer),c.compute(1),c.complete()},start:function(){return this.check()?(this.time=0,this.startTimer(),this):this},startTimer:function(){var a=this,c=this.opt.fps;return this.timer?!1:(this.time=b.time()-this.time,this.timer=setInterval(function(){a.step()},Math.round(1e3/c)),!0)},pause:function(){return this.stopTimer(),this},resume:function(){return this.startTimer(),this},stopTimer:function(){return this.timer?(this.time=b.time()-this.time,this.timer=clearInterval(this.timer),!0):!1},check:function(){return this.timer?"cancel"==this.opt.link?(this.stopTimer(),!0):!1:!0}}),f=function(){for(var a=arguments,c=0,d=a.length,e={};d>c;c++){var g=f[a[c]];g.$extend?b.extend(e,g):e[a[c]]=g}return e};f.Canvas={$extend:!0,injectInto:"id",type:"2D",width:!1,height:!1,useCanvas:!1,withLabels:!0,background:!1,Scene:{Lighting:{enable:!1,ambient:[1,1,1],directional:{direction:{x:-100,y:-100,z:-100},color:[.5,.3,.1]}}}},f.Node={$extend:!1,overridable:!1,type:"circle",color:"#ccb",alpha:1,dim:3,height:20,width:90,autoHeight:!1,autoWidth:!1,lineWidth:1,transform:!0,align:"center",angularWidth:1,span:1,CanvasStyles:{}},f.Edge={$extend:!1,overridable:!1,type:"line",color:"#ccb",lineWidth:1,dim:15,alpha:1,epsilon:7,CanvasStyles:{}},f.Fx={$extend:!0,fps:40,duration:2500,transition:$jit.Trans.Quart.easeInOut,clearCanvas:!0},f.Label={$extend:!1,overridable:!1,type:"HTML",style:" ",size:10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:"#fff"},f.Tips={$extend:!1,enable:!1,type:"auto",offsetX:20,offsetY:20,force:!1,onShow:b.empty,onHide:b.empty},f.NodeStyles={$extend:!1,enable:!1,type:"auto",stylesHover:!1,stylesClick:!1},f.Events={$extend:!1,enable:!1,enableForEdges:!1,type:"auto",onClick:b.empty,onRightClick:b.empty,onMouseMove:b.empty,onMouseEnter:b.empty,onMouseLeave:b.empty,onDragStart:b.empty,onDragMove:b.empty,onDragCancel:b.empty,onDragEnd:b.empty,onTouchStart:b.empty,onTouchMove:b.empty,onTouchEnd:b.empty,onMouseWheel:b.empty},f.Navigation={$extend:!1,enable:!1,type:"auto",panning:!1,zooming:!1},f.Controller={$extend:!0,onBeforeCompute:b.empty,onAfterCompute:b.empty,onCreateLabel:b.empty,onPlaceLabel:b.empty,onComplete:b.empty,onBeforePlotLine:b.empty,onAfterPlotLine:b.empty,onBeforePlotNode:b.empty,onAfterPlotNode:b.empty,request:!1};var g={initialize:function(a,b){this.viz=b,this.canvas=b.canvas,this.config=b.config[a],this.nodeTypes=b.fx.nodeTypes;var c=this.config.type;this.dom="auto"==c?"Native"!=b.config.Label.type:"Native"!=c,this.labelContainer=this.dom&&b.labels.getLabelContainer(),this.isEnabled()&&this.initializePost()},initializePost:b.empty,setAsProperty:b.lambda(!1),isEnabled:function(){return this.config.enable},isLabel:function(a,c,d){a=b.event.get(a,c);var e=this.labelContainer,f=a.target||a.srcElement,g=a.relatedTarget;return d?g&&g==this.viz.canvas.getCtx().canvas&&!!f&&this.isDescendantOf(f,e):this.isDescendantOf(f,e)},isDescendantOf:function(a,b){for(;a&&a.parentNode;){if(a.parentNode==b)return a;a=a.parentNode}return!1}},h={onMouseUp:b.empty,onMouseDown:b.empty,onMouseMove:b.empty,onMouseOver:b.empty,onMouseOut:b.empty,onMouseWheel:b.empty,onTouchStart:b.empty,onTouchMove:b.empty,onTouchEnd:b.empty,onTouchCancel:b.empty},i=new c({initialize:function(a){this.viz=a,this.canvas=a.canvas,this.node=!1,this.edge=!1,this.registeredObjects=[],this.attachEvents()},attachEvents:function(){var a=this.canvas.getElement(),c=this;a.oncontextmenu=b.lambda(!1),b.addEvents(a,{mouseup:function(a,d){var e=b.event.get(a,d);c.handleEvent("MouseUp",a,d,c.makeEventObject(a,d),b.event.isRightClick(e))},mousedown:function(a,d){var e=b.event.get(a,d);c.handleEvent("MouseDown",a,d,c.makeEventObject(a,d),b.event.isRightClick(e))},mousemove:function(a,b){c.handleEvent("MouseMove",a,b,c.makeEventObject(a,b))},mouseover:function(a,b){c.handleEvent("MouseOver",a,b,c.makeEventObject(a,b))},mouseout:function(a,b){c.handleEvent("MouseOut",a,b,c.makeEventObject(a,b))},touchstart:function(a,b){c.handleEvent("TouchStart",a,b,c.makeEventObject(a,b))},touchmove:function(a,b){c.handleEvent("TouchMove",a,b,c.makeEventObject(a,b))},touchend:function(a,b){c.handleEvent("TouchEnd",a,b,c.makeEventObject(a,b))}});var d=function(a,d){var e=b.event.get(a,d),f=b.event.getWheel(e);c.handleEvent("MouseWheel",a,d,f)};document.getBoxObjectFor||null!=window.mozInnerScreenX?a.addEventListener("DOMMouseScroll",d,!1):b.addEvent(a,"mousewheel",d)},register:function(a){this.registeredObjects.push(a)},handleEvent:function(){for(var a=Array.prototype.slice.call(arguments),b=a.shift(),c=0,d=this.registeredObjects,e=d.length;e>c;c++)d[c]["on"+b].apply(d[c],a)},makeEventObject:function(a,c){var d=this,e=this.viz.graph,f=this.viz.fx,g=f.nodeTypes,h=f.edgeTypes;return{pos:!1,node:!1,edge:!1,contains:!1,getNodeCalled:!1,getEdgeCalled:!1,getPos:function(){var e=d.viz.canvas,f=e.getSize(),g=e.getPos(),h=e.translateOffsetX,i=e.translateOffsetY,j=e.scaleOffsetX,k=e.scaleOffsetY,l=b.event.getPos(a,c);return this.pos={x:1*(l.x-g.x-f.width/2-h)/j,y:1*(l.y-g.y-f.height/2-i)/k},this.pos},getNode:function(){if(this.getNodeCalled)return this.node;this.getNodeCalled=!0;for(var a in e.nodes){var b=e.nodes[a],c=b&&g[b.getData("type")],h=0!==b.getData("alpha")&&c&&c.contains&&c.contains.call(f,b,this.getPos());if(h)return this.contains=h,d.node=this.node=b}return d.node=this.node=!1},getEdge:function(){if(this.getEdgeCalled)return this.edge;this.getEdgeCalled=!0;var a={};for(var b in e.edges){var c=e.edges[b];a[b]=!0;for(var g in c)if(!(g in a)){var i=c[g],j=i&&h[i.getData("type")],k=0!==i.getData("alpha")&&j&&j.contains&&j.contains.call(f,i,this.getPos());if(k)return this.contains=k,d.edge=this.edge=i}}return d.edge=this.edge=!1},getContains:function(){return this.getNodeCalled?this.contains:(this.getNode(),this.contains)}}}}),j={initializeExtras:function(){var a=new i(this),c=this;b.each(["NodeStyles","Tips","Navigation","Events"],function(b){var d=new j.Classes[b](b,c);d.isEnabled()&&a.register(d),d.setAsProperty()&&(c[b.toLowerCase()]=d)})}};j.Classes={},j.Classes.Events=new c({Implements:[g,h],initializePost:function(){this.fx=this.viz.fx,this.ntypes=this.viz.fx.nodeTypes,this.etypes=this.viz.fx.edgeTypes,this.hovered=!1,this.pressed=!1,this.touched=!1,this.touchMoved=!1,this.moved=!1},setAsProperty:b.lambda(!0),onMouseUp:function(a,c,d,e){var f=b.event.get(a,c);this.moved||(e?this.config.onRightClick(this.hovered,d,f):this.config.onClick(this.pressed,d,f)),this.pressed&&(this.moved?this.config.onDragEnd(this.pressed,d,f):this.config.onDragCancel(this.pressed,d,f),this.pressed=this.moved=!1)},onMouseOut:function(a,c,d){var e,f=b.event.get(a,c);if(this.dom&&(e=this.isLabel(a,c,!0)))return this.config.onMouseLeave(this.viz.graph.getNode(e.id),d,f),void(this.hovered=!1);for(var g=f.relatedTarget,h=this.canvas.getElement();g&&g.parentNode;){if(h==g.parentNode)return;g=g.parentNode}this.hovered&&(this.config.onMouseLeave(this.hovered,d,f),this.hovered=!1)},onMouseOver:function(a,c,d){var e,f=b.event.get(a,c);this.dom&&(e=this.isLabel(a,c,!0))&&(this.hovered=this.viz.graph.getNode(e.id),this.config.onMouseEnter(this.hovered,d,f))},onMouseMove:function(a,c,d){var e=b.event.get(a,c);if(this.pressed)return this.moved=!0,void this.config.onDragMove(this.pressed,d,e);if(this.dom)this.config.onMouseMove(this.hovered,d,e);else{if(this.hovered){var f=this.hovered,g=f.nodeFrom?this.etypes[f.getData("type")]:this.ntypes[f.getData("type")],h=g&&g.contains&&g.contains.call(this.fx,f,d.getPos());if(h)return void this.config.onMouseMove(f,d,e);this.config.onMouseLeave(f,d,e),this.hovered=!1}(this.hovered=d.getNode()||this.config.enableForEdges&&d.getEdge())?this.config.onMouseEnter(this.hovered,d,e):this.config.onMouseMove(!1,d,e)}},onMouseWheel:function(a,c,d){this.config.onMouseWheel(d,b.event.get(a,c))},onMouseDown:function(a,c,d){var e=b.event.get(a,c);this.pressed=d.getNode()||this.config.enableForEdges&&d.getEdge(),this.pressed&&this.config.onDragStart(this.pressed,d,e)},onTouchStart:function(a,c,d){var e,f=b.event.get(a,c);this.dom&&(e=this.isLabel(a,c))?this.touched=this.viz.graph.getNode(e.id):this.touched=d.getNode()||this.config.enableForEdges&&d.getEdge(),this.touched&&this.config.onTouchStart(this.touched,d,f)},onTouchMove:function(a,c,d){var e=b.event.get(a,c);this.touched&&(this.touchMoved=!0,this.config.onTouchMove(this.touched,d,e))},onTouchEnd:function(a,c,d){var e=b.event.get(a,c);this.touched&&(this.touchMoved?this.config.onTouchEnd(this.touched,d,e):this.config.onTouchCancel(this.touched,d,e),this.touched=this.touchMoved=!1)}}),j.Classes.Tips=new c({Implements:[g,h],initializePost:function(){if(document.body){var a=b("_tooltip")||document.createElement("div");a.id="_tooltip",a.className="tip",b.extend(a.style,{position:"absolute",display:"none",zIndex:13e3}),document.body.appendChild(a),this.tip=a,this.node=!1}},setAsProperty:b.lambda(!0),onMouseOut:function(a,c){b.event.get(a,c);if(this.dom&&this.isLabel(a,c,!0))return void this.hide(!0);for(var d=a.relatedTarget,e=this.canvas.getElement();d&&d.parentNode;){if(e==d.parentNode)return;d=d.parentNode}this.hide(!1)},onMouseOver:function(a,b){var c;this.dom&&(c=this.isLabel(a,b,!1))&&(this.node=this.viz.graph.getNode(c.id),this.config.onShow(this.tip,this.node,c))},onMouseMove:function(a,c,d){if(this.dom&&this.isLabel(a,c)&&this.setTooltipPosition(b.event.getPos(a,c)),!this.dom){var e=d.getNode();if(!e)return void this.hide(!0);(this.config.force||!this.node||this.node.id!=e.id)&&(this.node=e,this.config.onShow(this.tip,e,d.getContains())),this.setTooltipPosition(b.event.getPos(a,c))}},setTooltipPosition:function(a){var b=this.tip,c=b.style,d=this.config;c.display="";var e={height:document.body.clientHeight,width:document.body.clientWidth},f={width:b.offsetWidth,height:b.offsetHeight},g=d.offsetX,h=d.offsetY;c.top=(a.y+h+f.height>e.height?a.y-f.height-h:a.y+h)+"px",c.left=(a.x+f.width+g>e.width?a.x-f.width-g:a.x+g)+"px"},hide:function(a){this.tip.style.display="none",a&&this.config.onHide()}}),j.Classes.NodeStyles=new c({Implements:[g,h],initializePost:function(){this.fx=this.viz.fx,this.types=this.viz.fx.nodeTypes,this.nStyles=this.config,this.nodeStylesOnHover=this.nStyles.stylesHover,this.nodeStylesOnClick=this.nStyles.stylesClick,this.hoveredNode=!1,this.fx.nodeFxAnimation=new e,this.down=!1,this.move=!1},onMouseOut:function(a,b){if(this.down=this.move=!1,this.hoveredNode){this.dom&&this.isLabel(a,b,!0)&&this.toggleStylesOnHover(this.hoveredNode,!1);for(var c=a.relatedTarget,d=this.canvas.getElement();c&&c.parentNode;){if(d==c.parentNode)return;c=c.parentNode}this.toggleStylesOnHover(this.hoveredNode,!1),this.hoveredNode=!1}},onMouseOver:function(a,b){var c;if(this.dom&&(c=this.isLabel(a,b,!0))){var d=this.viz.graph.getNode(c.id);if(d.selected)return;this.hoveredNode=d,this.toggleStylesOnHover(this.hoveredNode,!0)}},onMouseDown:function(a,b,c,d){if(!d){var e;this.dom&&(e=this.isLabel(a,b))?this.down=this.viz.graph.getNode(e.id):this.dom||(this.down=c.getNode()),this.move=!1}},onMouseUp:function(a,b,c,d){d||(this.move||this.onClick(c.getNode()),this.down=this.move=!1)},getRestoredStyles:function(a,b){var c={},d=this["nodeStylesOn"+b];for(var e in d)c[e]=a.styles["$"+e];return c},toggleStylesOnHover:function(a,b){this.nodeStylesOnHover&&this.toggleStylesOn("Hover",a,b)},toggleStylesOnClick:function(a,b){this.nodeStylesOnClick&&this.toggleStylesOn("Click",a,b)},toggleStylesOn:function(a,c,e){var f=this.viz;this.nStyles;if(e){var g=this;c.styles||(c.styles=b.merge(c.data,{}));for(var h in this["nodeStylesOn"+a]){var i="$"+h;i in c.styles||(c.styles[i]=c.getData(h))}f.fx.nodeFx(b.extend({elements:{id:c.id,properties:g["nodeStylesOn"+a]},transition:d.Quart.easeOut,duration:300,fps:40},this.config))}else{var j=this.getRestoredStyles(c,a);f.fx.nodeFx(b.extend({elements:{id:c.id,properties:j},transition:d.Quart.easeOut,duration:300,fps:40},this.config))}},onClick:function(a){if(a){var b=this.nodeStylesOnClick;b&&(a.selected?(this.toggleStylesOnClick(a,!1),delete a.selected):(this.viz.graph.eachNode(function(a){if(a.selected){for(var c in b)a.setData(c,a.styles["$"+c],"end");delete a.selected}}),this.toggleStylesOnClick(a,!0),a.selected=!0,delete a.hovered,this.hoveredNode=!1))}},onMouseMove:function(a,b,c){if(this.down&&(this.move=!0),!this.dom||!this.isLabel(a,b)){var d=this.nodeStylesOnHover;if(d&&!this.dom){if(this.hoveredNode){var e=this.types[this.hoveredNode.getData("type")],f=e&&e.contains&&e.contains.call(this.fx,this.hoveredNode,c.getPos());if(f)return}var g=c.getNode();if(!this.hoveredNode&&!g)return;if(g.hovered)return;g&&!g.selected?(this.fx.nodeFxAnimation.stopTimer(),this.viz.graph.eachNode(function(a){if(a.hovered&&!a.selected){for(var b in d)a.setData(b,a.styles["$"+b],"end");delete a.hovered}}),g.hovered=!0,this.hoveredNode=g,this.toggleStylesOnHover(g,!0)):this.hoveredNode&&!this.hoveredNode.selected&&(this.fx.nodeFxAnimation.stopTimer(),this.toggleStylesOnHover(this.hoveredNode,!1),delete this.hoveredNode.hovered,this.hoveredNode=!1)}}}}),j.Classes.Navigation=new c({Implements:[g,h],initializePost:function(){this.pos=!1,this.pressed=!1},onMouseWheel:function(a,b,c){if(this.config.zooming&&"infovis-canvas"==a.target.id&&!Mapmaker.Create.newTopic.beingCreated){var d=this.config.zooming/1e3,e=1+c*d;e>1?5>=this.canvas.scaleOffsetX&&this.canvas.scale(e,e):1>e&&this.canvas.scaleOffsetX>=.2&&this.canvas.scale(e,e),jQuery(document).trigger(Mapmaker.JIT.events.zoom,[a])}},onMouseDown:function(a,b,c){if(this.config.panning&&(Mapmaker.Mouse.changeInX=0,Mapmaker.Mouse.changeInY=0,!("avoid nodes"==this.config.panning&&c.getNode()||c.getEdge()))){this.pressed=!0;var d=2==a.button||-1!=navigator.platform.indexOf("Mac")&&a.ctrlKey;!Mapmaker.Mouse.boxStartCoordinates&&(0==a.button&&a.shiftKey||0==a.button&&a.ctrlKey||d)&&(Mapmaker.Mouse.boxStartCoordinates=c.getPos()),Mapmaker.Mouse.didPan=!1,this.pos=c.getPos();var e=this.canvas,f=e.translateOffsetX,g=e.translateOffsetY,h=e.scaleOffsetX,i=e.scaleOffsetY;this.pos.x*=h,this.pos.x+=f,this.pos.y*=i,this.pos.y+=g}},onMouseMove:function(a,b,c){if(this.config.panning&&this.pressed&&("avoid nodes"!=this.config.panning||(this.dom?!this.isLabel(a,b):!c.getNode()))){var d=2==a.button||-1!=navigator.platform.indexOf("Mac")&&a.ctrlKey;if(!Mapmaker.Mouse.boxStartCoordinates&&(0==a.button&&a.shiftKey||0==a.button&&a.ctrlKey||d))return Mapmaker.Visualize.mGraph.busy=!0,void(Mapmaker.boxStartCoordinates=c.getPos());if(Mapmaker.Mouse.boxStartCoordinates&&(0==a.button&&a.shiftKey||0==a.button&&a.ctrlKey||d))return Mapmaker.Visualize.mGraph.busy=!0,void Mapmaker.JIT.drawSelectBox(c,a);if(!d){if("infovis-canvas"!=a.target.id)return void(this.pressed=!1);Mapmaker.Mouse.didPan=!0;var e=this.pos,f=c.getPos(),g=this.canvas,h=g.translateOffsetX,i=g.translateOffsetY,j=g.scaleOffsetX,k=g.scaleOffsetY;f.x*=j,f.y*=k,f.x+=h,f.y+=i;var l=f.x-e.x,m=f.y-e.y;Mapmaker.Mouse.changeInX=l,Mapmaker.Mouse.changeInY=m,this.pos=f,this.canvas.translate(1*l/j,1*m/k),jQuery(document).trigger(Mapmaker.JIT.events.pan)}}},onMouseUp:function(a,b,c,d){this.config.panning&&(this.pressed=!1,Mapmaker.Mouse.didPan&&Mapmaker.JIT.SmoothPanning())}});var k;!function(){function a(a,c){var d=document.createElement(a);for(var f in c)"object"==typeof c[f]?b.extend(d[f],c[f]):d[f]=c[f];return"canvas"==a&&!e&&G_vmlCanvasManager&&(d=G_vmlCanvasManager.initElement(document.body.appendChild(d))),d}var d=typeof HTMLCanvasElement,e="object"==d||"function"==d;$jit.Canvas=k=new c({canvases:[],pos:!1,element:!1,labelContainer:!1,translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(c,d){this.viz=c,this.opt=this.config=d;var e="string"==b.type(d.injectInto)?d.injectInto:d.injectInto.id,f=d.type,g=e+"-label",h=d.width,i=d.height;this.id=e;var j={injectInto:e,width:h,height:i};this.element=a("div",{id:e+"-canvaswidget",style:{position:"relative",width:h+"px",height:i+"px"}}),this.labelContainer=this.createLabelContainer(d.Label.type,g,j),this.canvases.push(new k.Base[f]({config:b.extend({idSuffix:"-canvas"},j),plot:function(a){c.fx.plot()},resize:function(){c.refresh()}}));var l=d.background;if(l){var m=new k.Background[l.type](c,b.extend(l,j));this.canvases.push(new k.Base[f](m))}for(var n=this.canvases.length;n--;)this.element.appendChild(this.canvases[n].canvas),n>0&&this.canvases[n].plot();this.element.appendChild(this.labelContainer);var o=Mapmaker.Famous.viz.surf;o.setContent(this.element),o.deploy(o._currTarget);var p=null,q=this;b.addEvent(window,"scroll",function(){clearTimeout(p),p=setTimeout(function(){q.getPos(!0)},500)})},getCtx:function(a){return this.canvases[a||0].getCtx()},getConfig:function(){return this.opt},getElement:function(){return this.element},getSize:function(a){return this.canvases[a||0].getSize()},resize:function(a,b){this.getPos(!0),this.translateOffsetX=this.translateOffsetY=0,this.scaleOffsetX=this.scaleOffsetY=1;for(var c=0,d=this.canvases.length;d>c;c++)this.canvases[c].resize(a,b);var e=this.element.style;e.width=a+"px",e.height=b+"px",this.labelContainer&&(this.labelContainer.style.width=a+"px")},translate:function(a,b,c){this.translateOffsetX+=a*this.scaleOffsetX,this.translateOffsetY+=b*this.scaleOffsetY;for(var d=0,e=this.canvases.length;e>d;d++)this.canvases[d].translate(a,b,c)},scale:function(a,b,c){var d=this.scaleOffsetX*a,e=this.scaleOffsetY*b,f=this.translateOffsetX*(a-1)/d,g=this.translateOffsetY*(b-1)/e;this.scaleOffsetX=d,this.scaleOffsetY=e;for(var h=0,i=this.canvases.length;i>h;h++)this.canvases[h].scale(a,b,!0);this.translate(f,g,!1)},getPos:function(a){return a||!this.pos?this.pos=b.getPos(this.getElement()):this.pos},clear:function(a){this.canvases[a||0].clear()},path:function(a,b){var c=this.canvases[0].getCtx();c.beginPath(),b(c),c[a](),c.closePath()},createLabelContainer:function(b,c,d){var e="http://www.w3.org/2000/svg";if("HTML"==b||"Native"==b)return a("div",{id:c,style:{overflow:"visible",
position:"absolute",top:0,left:0,width:d.width+"px",height:0}});if("SVG"==b){var f=document.createElementNS(e,"svg:svg");f.setAttribute("width",d.width),f.setAttribute("height",d.height);var g=f.style;g.position="absolute",g.left=g.top="0px";var h=document.createElementNS(e,"svg:g");return h.setAttribute("width",d.width),h.setAttribute("height",d.height),h.setAttribute("x",0),h.setAttribute("y",0),h.setAttribute("id",c),f.appendChild(h),f}}}),k.Base={},k.Base["2D"]=new c({translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(a){this.viz=a,this.opt=a.config,this.size=!1,this.createCanvas(),this.translateToCenter()},createCanvas:function(){var b=this.opt,c=b.width,d=b.height;this.canvas=a("canvas",{id:b.injectInto+b.idSuffix,width:c,height:d,style:{position:"absolute",top:0,left:0,width:c+"px",height:d+"px"}})},getCtx:function(){return this.ctx?this.ctx:this.ctx=this.canvas.getContext("2d")},getSize:function(){if(this.size)return this.size;var a=this.canvas;return this.size={width:a.width,height:a.height}},translateToCenter:function(a){var b=this.getSize(),c=a?b.width-a.width-2*this.translateOffsetX:b.width;height=a?b.height-a.height-2*this.translateOffsetY:b.height;var d=this.getCtx();a&&d.scale(1/this.scaleOffsetX,1/this.scaleOffsetY),d.translate(c/2,height/2)},resize:function(a,b){var c=this.getSize(),d=this.canvas,f=d.style;this.size=!1,d.width=a,d.height=b,f.width=a+"px",f.height=b+"px",e?this.translateToCenter():this.translateToCenter(c),this.translateOffsetX=this.translateOffsetY=0,this.scaleOffsetX=this.scaleOffsetY=1,this.clear(),this.viz.resize(a,b,this)},translate:function(a,b,c){var d=this.scaleOffsetX,e=this.scaleOffsetY;this.translateOffsetX+=a*d,this.translateOffsetY+=b*e,this.getCtx().translate(a,b),!c&&this.plot()},scale:function(a,b,c){this.scaleOffsetX*=a,this.scaleOffsetY*=b,this.getCtx().scale(a,b),!c&&this.plot()},clear:function(){var a=this.getSize(),b=this.translateOffsetX,c=this.translateOffsetY,d=this.scaleOffsetX,e=this.scaleOffsetY;this.getCtx().clearRect(1*(-a.width/2-b)/d,1*(-a.height/2-c)/e,1*a.width/d,1*a.height/e)},plot:function(){this.clear(),this.viz.plot(this)}}),k.Background={},k.Background.Circles=new c({initialize:function(a,c){this.viz=a,this.config=b.merge({idSuffix:"-bkcanvas",levelDistance:100,numberOfCircles:6,CanvasStyles:{},offset:0},c)},resize:function(a,b,c){this.plot(c)},plot:function(a){var b=(a.canvas,a.getCtx()),c=this.config,d=c.CanvasStyles;for(var e in d)b[e]=d[e];for(var f=c.numberOfCircles,g=c.levelDistance,h=1;f>=h;h++)b.beginPath(),b.arc(0,0,g*h,0,2*Math.PI,!1),b.stroke(),b.closePath()}}),k.Background.Mapmaker=new c({initialize:function(a,b){this.viz=a,this.config=b},resize:function(a,b,c){this.plot(c)},plot:function(a){var b=a.canvas,c=a.getCtx(),d=a.scaleOffsetX;c.fillStyle=Mapmaker.Settings.colors.background;-(b.width/d)/2-a.translateOffsetX/d,-(b.height/d)/2-a.translateOffsetY/d}})}();var l=function(a,b){this.theta=a||0,this.rho=b||0};$jit.Polar=l,l.prototype={getc:function(a){return this.toComplex(a)},getp:function(){return this},set:function(a){a=a.getp(),this.theta=a.theta,this.rho=a.rho},setc:function(a,b){this.rho=Math.sqrt(a*a+b*b),this.theta=Math.atan2(b,a),this.theta<0&&(this.theta+=2*Math.PI)},setp:function(a,b){this.theta=a,this.rho=b},clone:function(){return new l(this.theta,this.rho)},toComplex:function(a){var b=Math.cos(this.theta)*this.rho,c=Math.sin(this.theta)*this.rho;return a?{x:b,y:c}:new n(b,c)},add:function(a){return new l(this.theta+a.theta,this.rho+a.rho)},scale:function(a){return new l(this.theta,this.rho*a)},equals:function(a){return this.theta==a.theta&&this.rho==a.rho},$add:function(a){return this.theta=this.theta+a.theta,this.rho+=a.rho,this},$madd:function(a){return this.theta=(this.theta+a.theta)%(2*Math.PI),this.rho+=a.rho,this},$scale:function(a){return this.rho*=a,this},isZero:function(){var a=1e-4,b=Math.abs;return b(this.theta)<a&&b(this.rho)<a},interpolate:function(a,b){var c,d=Math.PI,e=2*d,f=function(a){var b=0>a?a%e+e:a%e;return b},g=this.theta,h=a.theta,i=Math.abs(g-h);c=f(i==d?g>h?h+(g-e-h)*b:h-e+(g-h)*b:i>=d?g>h?h+(g-e-h)*b:h-e+(g-(h-e))*b:h+(g-h)*b);var j=(this.rho-a.rho)*b+a.rho;return{theta:c,rho:j}}};var m=function(a,b){return new l(a,b)};l.KER=m(0,0);var n=function(a,b){this.x=a||0,this.y=b||0};$jit.Complex=n,n.prototype={getc:function(){return this},getp:function(a){return this.toPolar(a)},set:function(a){a=a.getc(!0),this.x=a.x,this.y=a.y},setc:function(a,b){this.x=a,this.y=b},setp:function(a,b){this.x=Math.cos(a)*b,this.y=Math.sin(a)*b},clone:function(){return new n(this.x,this.y)},toPolar:function(a){var b=this.norm(),c=Math.atan2(this.y,this.x);return 0>c&&(c+=2*Math.PI),a?{theta:c,rho:b}:new l(c,b)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(a){return new n(this.x+a.x,this.y+a.y)},prod:function(a){return new n(this.x*a.x-this.y*a.y,this.y*a.x+this.x*a.y)},conjugate:function(){return new n(this.x,-this.y)},scale:function(a){return new n(this.x*a,this.y*a)},equals:function(a){return this.x==a.x&&this.y==a.y},$add:function(a){return this.x+=a.x,this.y+=a.y,this},$prod:function(a){var b=this.x,c=this.y;return this.x=b*a.x-c*a.y,this.y=c*a.x+b*a.y,this},$conjugate:function(){return this.y=-this.y,this},$scale:function(a){return this.x*=a,this.y*=a,this},$div:function(a){var b=this.x,c=this.y,d=a.squaredNorm();return this.x=b*a.x+c*a.y,this.y=c*a.x-b*a.y,this.$scale(1/d)},isZero:function(){var a=1e-4,b=Math.abs;return b(this.x)<a&&b(this.y)<a}};var o=function(a,b){return new n(a,b)};n.KER=o(0,0),$jit.Graph=new c({initialize:function(a,c,d,e){var f={klass:n,Node:{}};this.Node=c,this.Edge=d,this.Label=e,this.opt=b.merge(f,a||{}),this.nodes={},this.edges={};var g=this;this.nodeList={};for(var h in p)g.nodeList[h]=function(a){return function(){var b=Array.prototype.slice.call(arguments);g.eachNode(function(c){c[a].apply(c,b)})}}(h)},getNode:function(a){return this.hasNode(a)?this.nodes[a]:!1},get:function(a){return this.getNode(a)},getByName:function(a){for(var b in this.nodes){var c=this.nodes[b];if(c.name==a)return c}return!1},getAdjacence:function(a,b){return a in this.edges?this.edges[a][b]:!1},addNode:function(a){if(!this.nodes[a.id]){var c=this.edges[a.id]={};this.nodes[a.id]=new q.Node(b.extend({id:a.id,name:a.name,data:b.merge(a.data||{},{}),adjacencies:c},this.opt.Node),this.opt.klass,this.Node,this.Edge,this.Label)}return this.nodes[a.id]},addAdjacence:function(a,b,c){if(this.hasNode(a.id)||this.addNode(a),this.hasNode(b.id)||this.addNode(b),a=this.nodes[a.id],b=this.nodes[b.id],!a.adjacentTo(b)){var d=this.edges[a.id]=this.edges[a.id]||{},e=this.edges[b.id]=this.edges[b.id]||{};return d[b.id]=e[a.id]=new q.Adjacence(a,b,c,this.Edge,this.Label),d[b.id]}return this.edges[a.id][b.id]},removeNode:function(a){if(this.hasNode(a)){delete this.nodes[a];var b=this.edges[a];for(var c in b)delete this.edges[c][a];delete this.edges[a]}},removeAdjacence:function(a,b){delete this.edges[a][b],delete this.edges[b][a]},hasNode:function(a){return a in this.nodes},empty:function(){this.nodes={},this.edges={}}});var p,q=$jit.Graph;!function(){var a=function(a,b,c,d,e){var f;c=c||"current",a="$"+(a?a+"-":""),"current"==c?f=this.data:"start"==c?f=this.startData:"end"==c&&(f=this.endData);var g=a+b;return d?f[g]:this.Config.overridable?g in f?f[g]:g in this.data?this.data[g]:e[b]||0:e[b]||0},c=function(a,b,c,d){d=d||"current",a="$"+(a?a+"-":"");var e;"current"==d?e=this.data:"start"==d?e=this.startData:"end"==d&&(e=this.endData),e[a+b]=c},d=function(a,c){a="$"+(a?a+"-":"");var d=this;b.each(c,function(b){var c=a+b;delete d.data[c],delete d.endData[c],delete d.startData[c]})};p={getData:function(b,c,d){return a.call(this,"",b,c,d,this.Config)},setData:function(a,b,d){c.call(this,"",a,b,d)},setDataset:function(a,c){a=b.splat(a);for(var d in c)for(var e=0,f=b.splat(c[d]),g=a.length;g>e;e++)this.setData(d,f[e],a[e])},removeData:function(){d.call(this,"",Array.prototype.slice.call(arguments))},getCanvasStyle:function(b,c,d){return a.call(this,"canvas",b,c,d,this.Config.CanvasStyles)},setCanvasStyle:function(a,b,d){c.call(this,"canvas",a,b,d)},setCanvasStyles:function(a,c){a=b.splat(a);for(var d in c)for(var e=0,f=b.splat(c[d]),g=a.length;g>e;e++)this.setCanvasStyle(d,f[e],a[e])},removeCanvasStyle:function(){d.call(this,"canvas",Array.prototype.slice.call(arguments))},getLabelData:function(b,c,d){return a.call(this,"label",b,c,d,this.Label)},setLabelData:function(a,b,d){c.call(this,"label",a,b,d)},setLabelDataset:function(a,c){a=b.splat(a);for(var d in c)for(var e=0,f=b.splat(c[d]),g=a.length;g>e;e++)this.setLabelData(d,f[e],a[e])},removeLabelData:function(){d.call(this,"label",Array.prototype.slice.call(arguments))}}}(),q.Node=new c({initialize:function(a,c,d,e,f){var g={id:"",name:"",data:{},startData:{},endData:{},adjacencies:{},selected:!1,drawn:!1,exist:!1,angleSpan:{begin:0,end:0},pos:new c,startPos:new c,endPos:new c};b.extend(this,b.extend(g,a)),this.Config=this.Node=d,this.Edge=e,this.Label=f},adjacentTo:function(a){return a.id in this.adjacencies},getAdjacency:function(a){return this.adjacencies[a]},getPos:function(a){return a=a||"current","current"==a?this.pos:"end"==a?this.endPos:"start"==a?this.startPos:void 0},setPos:function(a,b){b=b||"current";var c;"current"==b?c=this.pos:"end"==b?c=this.endPos:"start"==b&&(c=this.startPos),c.set(a)}}),q.Node.implement(p),q.Adjacence=new c({initialize:function(a,b,c,d,e){this.nodeFrom=a,this.nodeTo=b,this.data=c||{},this.startData={},this.endData={},this.Config=this.Edge=d,this.Label=e}}),q.Adjacence.implement(p),q.Util={filter:function(a){if(!a||"string"!=b.type(a))return function(){return!0};var c=a.split(" ");return function(a){for(var b=0;b<c.length;b++)if(a[c[b]])return!1;return!0}},getNode:function(a,b){return a.nodes[b]},eachNode:function(a,b,c){var d=this.filter(c);for(var e in a.nodes)d(a.nodes[e])&&b(a.nodes[e])},each:function(a,b,c){this.eachNode(a,b,c)},eachAdjacency:function(a,b,c){var d=a.adjacencies,e=this.filter(c);for(var f in d){var g=d[f];if(e(g)){if(g.nodeFrom!=a){var h=g.nodeFrom;g.nodeFrom=g.nodeTo,g.nodeTo=h}b(g,f)}}},computeLevels:function(a,b,c,d){c=c||0;var e=this.filter(d);this.eachNode(a,function(a){a._flag=!1,a._depth=-1},d);var f=a.getNode(b);f._depth=c;for(var g=[f];0!=g.length;){var h=g.pop();h._flag=!0,this.eachAdjacency(h,function(a){var b=a.nodeTo;0==b._flag&&e(b)&&(b._depth<0&&(b._depth=h._depth+1+c),g.unshift(b))},d)}},eachBFS:function(a,b,c,d){var e=this.filter(d);this.clean(a);for(var f=[a.getNode(b)];0!=f.length;){var g=f.pop();g._flag=!0,c(g,g._depth),this.eachAdjacency(g,function(a){var b=a.nodeTo;0==b._flag&&e(b)&&(b._flag=!0,f.unshift(b))},d)}},eachLevel:function(a,b,c,d,e){var f=a._depth,g=this.filter(e),h=this;c=c===!1?Number.MAX_VALUE-f:c,function i(a,b,c){var e=a._depth;e>=b&&c>=e&&g(a)&&d(a,e),c>e&&h.eachAdjacency(a,function(a){var d=a.nodeTo;d._depth>e&&i(d,b,c)})}(a,b+f,c+f)},eachSubgraph:function(a,b,c){this.eachLevel(a,0,!1,b,c)},eachSubnode:function(a,b,c){this.eachLevel(a,1,1,b,c)},anySubnode:function(a,c,d){var e=!1;c=c||b.lambda(!0);var f="string"==b.type(c)?function(a){return a[c]}:c;return this.eachSubnode(a,function(a){f(a)&&(e=!0)},d),e},getSubnodes:function(a,c,d){var e=[];c=c||0;var f,g;return"array"==b.type(c)?(f=c[0],g=c[1]):(f=c,g=Number.MAX_VALUE-a._depth),this.eachLevel(a,f,g,function(a){e.push(a)},d),e},getParents:function(a){var b=[];return this.eachAdjacency(a,function(c){var d=c.nodeTo;d._depth<a._depth&&b.push(d)}),b},isDescendantOf:function(a,b){if(a.id==b)return!0;for(var c=this.getParents(a),d=!1,e=0;!d&&e<c.length;e++)d=d||this.isDescendantOf(c[e],b);return d},clean:function(a){this.eachNode(a,function(a){a._flag=!1})},getClosestNodeToOrigin:function(a,b,c){return this.getClosestNodeToPos(a,l.KER,b,c)},getClosestNodeToPos:function(a,b,c,d){var e=null;c=c||"current",b=b&&b.getc(!0)||n.KER;var f=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d};return this.eachNode(a,function(a){e=null==e||f(a.getPos(c).getc(!0),b)<f(e.getPos(c).getc(!0),b)?a:e},d),e}},b.each(["get","getNode","each","eachNode","computeLevels","eachBFS","clean","getClosestNodeToPos","getClosestNodeToOrigin"],function(a){q.prototype[a]=function(){return q.Util[a].apply(q.Util,[this].concat(Array.prototype.slice.call(arguments)))}}),b.each(["eachAdjacency","eachLevel","eachSubgraph","eachSubnode","anySubnode","getSubnodes","getParents","isDescendantOf"],function(a){q.Node.prototype[a]=function(){return q.Util[a].apply(q.Util,[this].concat(Array.prototype.slice.call(arguments)))}}),q.Op={options:{type:"nothing",duration:2e3,hideLabels:!0,fps:30},initialize:function(a){this.viz=a},removeNode:function(a,c){var d,e,f,g=this.viz,h=b.merge(this.options,g.controller,c),i=b.splat(a);switch(h.type){case"nothing":for(d=0;d<i.length;d++)g.graph.removeNode(i[d]);break;case"replot":this.removeNode(i,{type:"nothing"}),g.labels.clearLabels(),g.refresh(!0);break;case"fade:seq":case"fade":for(e=this,d=0;d<i.length;d++)f=g.graph.getNode(i[d]),f.setData("alpha",0,"end");g.fx.animate(b.merge(h,{modes:["node-property:alpha"],onComplete:function(){e.removeNode(i,{type:"nothing"}),g.labels.clearLabels(),g.reposition(),g.fx.animate(b.merge(h,{modes:["linear"]}))}}));break;case"fade:con":for(e=this,d=0;d<i.length;d++)f=g.graph.getNode(i[d]),f.setData("alpha",0,"end"),f.ignore=!0;g.reposition(),g.fx.animate(b.merge(h,{modes:["node-property:alpha","linear"],onComplete:function(){e.removeNode(i,{type:"nothing"}),h.onComplete&&h.onComplete()}}));break;case"iter":e=this,g.fx.sequence({condition:function(){return 0!=i.length},step:function(){e.removeNode(i.shift(),{type:"nothing"}),g.labels.clearLabels()},onComplete:function(){h.onComplete&&h.onComplete()},duration:Math.ceil(h.duration/i.length)});break;default:this.doError()}},removeEdge:function(a,c){var d,e,f,g=this.viz,h=b.merge(this.options,g.controller,c),i="string"==b.type(a[0])?[a]:a;switch(h.type){case"nothing":for(d=0;d<i.length;d++)g.graph.removeAdjacence(i[d][0],i[d][1]);break;case"replot":this.removeEdge(i,{type:"nothing"}),g.refresh(!0);break;case"fade:seq":case"fade":for(e=this,d=0;d<i.length;d++)f=g.graph.getAdjacence(i[d][0],i[d][1]),f&&f.setData("alpha",0,"end");g.fx.animate(b.merge(h,{modes:["edge-property:alpha"],onComplete:function(){e.removeEdge(i,{type:"nothing"}),g.reposition(),g.fx.animate(b.merge(h,{modes:["linear"]}))}}));break;case"fade:con":for(e=this,d=0;d<i.length;d++)f=g.graph.getAdjacence(i[d][0],i[d][1]),f&&(f.setData("alpha",0,"end"),f.ignore=!0);g.reposition(),g.fx.animate(b.merge(h,{modes:["edge-property:alpha","linear"],onComplete:function(){e.removeEdge(i,{type:"nothing"}),h.onComplete&&h.onComplete()}}));break;case"iter":e=this,g.fx.sequence({condition:function(){return 0!=i.length},step:function(){e.removeEdge(i.shift(),{type:"nothing"}),g.labels.clearLabels()},onComplete:function(){h.onComplete()},duration:Math.ceil(h.duration/i.length)});break;default:this.doError()}},sum:function(a,c){var d,e=this.viz,f=b.merge(this.options,e.controller,c),g=e.root;switch(e.root=c.id||e.root,f.type){case"nothing":d=e.construct(a),d.eachNode(function(a){a.eachAdjacency(function(a){e.graph.addAdjacence(a.nodeFrom,a.nodeTo,a.data)})});break;case"replot":e.refresh(!0),this.sum(a,{type:"nothing"}),e.refresh(!0);break;case"fade:seq":case"fade":case"fade:con":that=this,d=e.construct(a);var h=this.preprocessSum(d),i=h?["node-property:alpha","edge-property:alpha"]:["node-property:alpha"];e.reposition(),"fade:con"!=f.type?e.fx.animate(b.merge(f,{modes:["linear"],onComplete:function(){e.fx.animate(b.merge(f,{modes:i,onComplete:function(){f.onComplete()}}))}})):(e.graph.eachNode(function(a){a.id!=g&&a.pos.isZero()&&(a.pos.set(a.endPos),a.startPos.set(a.endPos))}),e.fx.animate(b.merge(f,{modes:["linear"].concat(i)})));break;default:this.doError()}},morph:function(a,c,d){d=d||{};var e,f=this.viz,g=b.merge(this.options,f.controller,c),h=f.root;switch(f.root=c.id||f.root,g.type){case"nothing":e=f.construct(a),e.eachNode(function(a){var b=f.graph.hasNode(a.id);if(a.eachAdjacency(function(a){var b=!!f.graph.getAdjacence(a.nodeFrom.id,a.nodeTo.id);if(f.graph.addAdjacence(a.nodeFrom,a.nodeTo,a.data),b){var c=f.graph.getAdjacence(a.nodeFrom.id,a.nodeTo.id);for(var d in a.data||{})c.data[d]=a.data[d]}}),b){var c=f.graph.getNode(a.id);for(var d in a.data||{})c.data[d]=a.data[d]}}),f.graph.eachNode(function(a){a.eachAdjacency(function(a){e.getAdjacence(a.nodeFrom.id,a.nodeTo.id)||f.graph.removeAdjacence(a.nodeFrom.id,a.nodeTo.id)}),e.hasNode(a.id)||f.graph.removeNode(a.id)});break;case"replot":f.labels.clearLabels(!0),this.morph(a,{type:"nothing"}),f.refresh(!0),f.refresh(!0);break;case"fade:seq":case"fade":case"fade:con":that=this,e=f.construct(a);var i="node-property"in d&&b.map(b.splat(d["node-property"]),function(a){return"$"+a});f.graph.eachNode(function(a){var c=e.getNode(a.id);if(c){var d=c.data;for(var f in d)i&&b.indexOf(i,f)>-1?a.endData[f]=d[f]:a.data[f]=d[f]}else a.setData("alpha",1),a.setData("alpha",1,"start"),a.setData("alpha",0,"end"),a.ignore=!0}),f.graph.eachNode(function(a){a.ignore||a.eachAdjacency(function(a){if(!a.nodeFrom.ignore&&!a.nodeTo.ignore){var b=e.getNode(a.nodeFrom.id),c=e.getNode(a.nodeTo.id);if(!b.adjacentTo(c)){var a=f.graph.getAdjacence(b.id,c.id);j=!0,a.setData("alpha",1),a.setData("alpha",1,"start"),a.setData("alpha",0,"end")}}})});var j=this.preprocessSum(e),k=j?["node-property:alpha","edge-property:alpha"]:["node-property:alpha"];k[0]=k[0]+("node-property"in d?":"+b.splat(d["node-property"]).join(":"):""),k[1]=(k[1]||"edge-property:alpha")+("edge-property"in d?":"+b.splat(d["edge-property"]).join(":"):""),"label-property"in d&&k.push("label-property:"+b.splat(d["label-property"]).join(":")),f.reposition?f.reposition():f.compute("end"),f.graph.eachNode(function(a){a.id!=h&&a.pos.getp().equals(l.KER)&&(a.pos.set(a.endPos),a.startPos.set(a.endPos))}),f.fx.animate(b.merge(g,{modes:[d.position||"polar"].concat(k),onComplete:function(){f.graph.eachNode(function(a){a.ignore&&f.graph.removeNode(a.id)}),f.graph.eachNode(function(a){a.eachAdjacency(function(a){a.ignore&&f.graph.removeAdjacence(a.nodeFrom.id,a.nodeTo.id)})}),g.onComplete()}}))}},contract:function(a,c){var d=this.viz;!a.collapsed&&a.anySubnode(b.lambda(!0))&&(c=b.merge(this.options,d.config,c||{},{modes:["node-property:alpha:span","linear"]}),a.collapsed=!0,function e(a){a.eachSubnode(function(a){a.ignore=!0,a.setData("alpha",0,"animate"==c.type?"end":"current"),e(a)})}(a),"animate"==c.type?(d.compute("end"),d.rotated&&d.rotate(d.rotated,"none",{property:"end"}),function f(b){b.eachSubnode(function(b){b.setPos(a.getPos("end"),"end"),f(b)})}(a),d.fx.animate(c)):"replot"==c.type&&d.refresh())},expand:function(a,c){if("collapsed"in a){var d=this.viz;c=b.merge(this.options,d.config,c||{},{modes:["node-property:alpha:span","linear"]}),delete a.collapsed,function e(a){a.eachSubnode(function(a){delete a.ignore,a.setData("alpha",1,"animate"==c.type?"end":"current"),e(a)})}(a),"animate"==c.type?(d.compute("end"),d.rotated&&d.rotate(d.rotated,"none",{property:"end"}),d.fx.animate(c)):"replot"==c.type&&d.refresh()}},preprocessSum:function(a){var b=this.viz;a.eachNode(function(a){if(!b.graph.hasNode(a.id)){b.graph.addNode(a);var c=b.graph.getNode(a.id);c.setData("alpha",0),c.setData("alpha",0,"start"),c.setData("alpha",1,"end")}});var c=!1;return a.eachNode(function(a){a.eachAdjacency(function(a){var d=b.graph.getNode(a.nodeFrom.id),e=b.graph.getNode(a.nodeTo.id);if(!d.adjacentTo(e)){var a=b.graph.addAdjacence(d,e,a.data);d.startAlpha==d.endAlpha&&e.startAlpha==e.endAlpha&&(c=!0,a.setData("alpha",0),a.setData("alpha",0,"start"),a.setData("alpha",1,"end"))}})}),c}};var r={none:{render:b.empty,contains:b.lambda(!1)},circle:{render:function(a,b,c,d){var e=d.getCtx();e.beginPath(),e.arc(b.x,b.y,c,0,2*Math.PI,!0),e.closePath(),e[a]()},contains:function(a,b,c){var d=a.x-b.x,e=a.y-b.y,f=d*d+e*e;return c*c>=f}},ellipse:{render:function(a,b,c,d,e){var f=e.getCtx(),g=1,h=1,i=1,j=1,k=0;c>d?(k=c/2,h=d/c,j=c/d):(k=d/2,g=c/d,i=d/c),f.save(),f.scale(g,h),f.beginPath(),f.arc(b.x*i,b.y*j,k,0,2*Math.PI,!0),f.closePath(),f[a](),f.restore()},contains:function(a,b,c,d){var e=0,f=1,g=1,h=0,i=0,j=0;return c>d?(e=c/2,g=d/c):(e=d/2,f=c/d),h=(a.x-b.x)*(1/f),i=(a.y-b.y)*(1/g),j=h*h+i*i,e*e>=j}},square:{render:function(a,b,c,d){d.getCtx()[a+"Rect"](b.x-c,b.y-c,2*c,2*c)},contains:function(a,b,c){return Math.abs(b.x-a.x)<=c&&Math.abs(b.y-a.y)<=c}},rectangle:{render:function(a,b,c,d,e){e.getCtx()[a+"Rect"](b.x-c/2,b.y-d/2,c,d)},contains:function(a,b,c,d){return Math.abs(b.x-a.x)<=c/2&&Math.abs(b.y-a.y)<=d/2}},triangle:{render:function(a,b,c,d){var e=d.getCtx(),f=b.x,g=b.y-c,h=f-c,i=b.y+c,j=f+c,k=i;e.beginPath(),e.moveTo(f,g),e.lineTo(h,i),e.lineTo(j,k),e.closePath(),e[a]()},contains:function(a,b,c){return r.circle.contains(a,b,c)}},star:{render:function(a,b,c,d){var e=d.getCtx(),f=Math.PI/5;e.save(),e.translate(b.x,b.y),e.beginPath(),e.moveTo(c,0);for(var g=0;9>g;g++)e.rotate(f),g%2==0?e.lineTo(c/.525731*.200811,0):e.lineTo(c,0);e.closePath(),e[a](),e.restore()},contains:function(a,b,c){return r.circle.contains(a,b,c)}}},s={line:{render:function(a,b,c){var d=c.getCtx();d.beginPath(),d.moveTo(a.x,a.y),d.lineTo(b.x,b.y),d.stroke()},contains:function(a,b,c,d){var e=Math.min,f=Math.max,g=e(a.x,b.x),h=f(a.x,b.x),i=e(a.y,b.y),j=f(a.y,b.y);if(c.x>=g&&c.x<=h&&c.y>=i&&c.y<=j){if(Math.abs(b.x-a.x)<=d)return!0;var k=(b.y-a.y)/(b.x-a.x)*(c.x-a.x)+a.y;return Math.abs(k-c.y)<=d}return!1}},arrow:{render:function(a,b,c,d,e){var f=e.getCtx();if(d){var g=a;a=b,b=g}var h=new n(b.x-a.x,b.y-a.y);h.$scale(c/h.norm());var i=new n(b.x-h.x,b.y-h.y),j=new n(-h.y/2,h.x/2),k=i.add(j),l=i.$add(j.$scale(-1));f.beginPath(),f.moveTo(a.x,a.y),f.lineTo(b.x,b.y),f.stroke(),f.beginPath(),f.moveTo(k.x,k.y),f.lineTo(l.x,l.y),f.lineTo(b.x,b.y),f.closePath(),f.fill()},contains:function(a,b,c,d){return s.line.contains(a,b,c,d)}},hyperline:{render:function(a,b,c,d){function e(a,b){var c=a.x*b.y-a.y*b.x,d=c,e=a.squaredNorm(),f=b.squaredNorm();if(0==c)return{x:0,y:0,ratio:-1};var g=(a.y*f-b.y*e+a.y-b.y)/c,h=(b.x*e-a.x*f+b.x-a.x)/d,i=-g/2,j=-h/2,k=(g*g+h*h)/4-1;if(0>k)return{x:0,y:0,ratio:-1};var l=Math.sqrt(k),m={x:i,y:j,ratio:l>1e3?-1:l,a:g,b:h};return m}function f(a,b){return b>a?a+Math.PI>b?!1:!0:b+Math.PI>a?!0:!1}var g=d.getCtx(),h=e(a,b);if(h.a>1e3||h.b>1e3||h.ratio<0)g.beginPath(),g.moveTo(a.x*c,a.y*c),g.lineTo(b.x*c,b.y*c),g.stroke();else{var i=Math.atan2(b.y-h.y,b.x-h.x),j=Math.atan2(a.y-h.y,a.x-h.x),f=f(i,j);g.beginPath(),g.arc(h.x*c,h.y*c,h.ratio*c,i,j,f),g.stroke()}},contains:b.lambda(!1)}};q.Plot={initialize:function(a,b){this.viz=a,this.config=a.config,this.node=a.config.Node,this.edge=a.config.Edge,this.animation=new e,this.nodeTypes=new b.Plot.NodeTypes,this.edgeTypes=new b.Plot.EdgeTypes,this.labels=a.labels},nodeHelper:r,edgeHelper:s,Interpolator:{map:{border:"color",color:"color",width:"number",height:"number",dim:"number",alpha:"number",lineWidth:"number",angularWidth:"number",span:"number",valueArray:"array-number",dimArray:"array-number"},canvas:{globalAlpha:"number",fillStyle:"color",strokeStyle:"color",lineWidth:"number",shadowBlur:"number",shadowColor:"color",shadowOffsetX:"number",shadowOffsetY:"number",miterLimit:"number"},label:{size:"number",color:"color"},compute:function(a,b,c){return a+(b-a)*c},moebius:function(a,b,c,d){var e=d.scale(-c);if(e.norm()<1){var f=e.x,g=e.y,h=a.startPos.getc().moebiusTransformation(e);a.pos.setc(h.x,h.y),e.x=f,e.y=g}},linear:function(a,b,c){var d=a.startPos.getc(!0),e=a.endPos.getc(!0);a.pos.setc(this.compute(d.x,e.x,c),this.compute(d.y,e.y,c))},polar:function(a,b,c){var d=a.startPos.getp(!0),e=a.endPos.getp(),f=e.interpolate(d,c);a.pos.setp(f.theta,f.rho)},number:function(a,b,c,d,e){var f=a[d](b,"start"),g=a[d](b,"end");a[e](b,this.compute(f,g,c))},color:function(a,c,d,e,f){var g=b.hexToRgb(a[e](c,"start")),h=b.hexToRgb(a[e](c,"end")),i=this.compute,j=b.rgbToHex([parseInt(i(g[0],h[0],d)),parseInt(i(g[1],h[1],d)),parseInt(i(g[2],h[2],d))]);a[f](c,j)},"array-number":function(a,b,c,d,e){for(var f=a[d](b,"start"),g=a[d](b,"end"),h=[],i=0,j=f.length;j>i;i++){var k=f[i],l=g[i];if(k.length){for(var m=0,n=k.length,o=[];n>m;m++)o.push(this.compute(k[m],l[m],c));h.push(o)}else h.push(this.compute(k,l,c))}a[e](b,h)},node:function(a,b,c,d,e,f){if(d=this[d],b)for(var g=b.length,h=0;g>h;h++){var i=b[h];this[d[i]](a,i,c,e,f)}else for(var i in d)this[d[i]](a,i,c,e,f)},edge:function(a,b,c,d,e,f){var g=a.adjacencies;for(var h in g)this.node(g[h],b,c,d,e,f)},"node-property":function(a,b,c){this.node(a,b,c,"map","getData","setData")},"edge-property":function(a,b,c){this.edge(a,b,c,"map","getData","setData")},"label-property":function(a,b,c){this.node(a,b,c,"label","getLabelData","setLabelData")},"node-style":function(a,b,c){this.node(a,b,c,"canvas","getCanvasStyle","setCanvasStyle")},"edge-style":function(a,b,c){this.edge(a,b,c,"canvas","getCanvasStyle","setCanvasStyle")}},sequence:function(a){var c=this;a=b.merge({condition:b.lambda(!1),step:b.empty,onComplete:b.empty,duration:200},a||{});var d=setInterval(function(){a.condition()?a.step():(clearInterval(d),a.onComplete()),c.viz.refresh(!0)},a.duration)},prepare:function(a){var c=this.viz.graph,d={"node-property":{getter:"getData",setter:"setData"},"edge-property":{getter:"getData",setter:"setData"},"node-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"},"edge-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"}},e={};if("array"==b.type(a))for(var f=0,g=a.length;g>f;f++){var h=a[f].split(":");e[h.shift()]=h}else for(var i in a)"position"==i?e[a.position]=[]:e[i]=b.splat(a[i]);return c.eachNode(function(a){a.startPos.set(a.pos),b.each(["node-property","node-style"],function(b){if(b in e)for(var c=e[b],f=0,g=c.length;g>f;f++)a[d[b].setter](c[f],a[d[b].getter](c[f]),"start")}),b.each(["edge-property","edge-style"],function(b){if(b in e){var c=e[b];a.eachAdjacency(function(a){for(var e=0,f=c.length;f>e;e++)a[d[b].setter](c[e],a[d[b].getter](c[e]),"start")})}})}),e},animate:function(a,c){a=b.merge(this.viz.config,a||{});var d=this,e=this.viz,f=e.graph,g=this.Interpolator,h="nodefx"===a.type?this.nodeFxAnimation:this.animation,i=this.prepare(a.modes);a.hideLabels&&this.labels.hideLabels(!0),h.setOptions(b.extend(a,{$animating:!1,compute:function(b){f.eachNode(function(a){for(var d in i)g[d](a,i[d],b,c)}),d.plot(a,this.$animating,b),this.$animating=!0},complete:function(){a.hideLabels&&d.labels.hideLabels(!1),d.plot(a),a.onComplete()}})).start()},nodeFx:function(a){var c=this.viz,d=c.graph,e=this.nodeFxAnimation,f=b.merge(this.viz.config,{elements:{id:!1,properties:{}},reposition:!1});a=b.merge(f,a||{},{onBeforeCompute:b.empty,onAfterCompute:b.empty}),e.stopTimer();var g=a.elements.properties;if(a.elements.id){var h=b.splat(a.elements.id);b.each(h,function(a){var b=d.getNode(a);if(b)for(var c in g)b.setData(c,g[c],"end")})}else d.eachNode(function(a){for(var b in g)a.setData(b,g[b],"end")});var i=[];for(var j in g)i.push(j);var k=["node-property:"+i.join(":")];a.reposition&&(k.push("linear"),c.compute("end")),this.animate(b.merge(a,{modes:k,type:"nodefx"}))},plot:function(a,b){var c=this.viz,d=c.graph,e=c.canvas,f=c.root,g=this,h=e.getCtx(),a=(Math.min,a||this.viz.controller);a.clearCanvas&&e.clear();var i=d.getNode(f);if(i){var j=!!i.visited;if(Mapmaker.Mouse.synapseStartCoordinates.length>0){h.save();for(var k,l=Mapmaker.Mouse.synapseEndCoordinates,m=Mapmaker.Mouse.synapseStartCoordinates.length,n=m-1;n>=0;n-=1)k=Mapmaker.Mouse.synapseStartCoordinates[n],Mapmaker.JIT.renderMidArrow(k,l,13,!1,e,.3,!0),Mapmaker.JIT.renderMidArrow(k,l,13,!1,e,.7,!0);h.restore()}d.eachNode(function(c){var d=c.getData("alpha");c.eachAdjacency(function(d){var f=d.nodeTo;!!f.visited===j&&c.drawn&&f.drawn&&(!b&&a.onBeforePlotLine(d),g.plotLine(d,e,b),!b&&a.onAfterPlotLine(d))}),c.drawn&&(!b&&a.onBeforePlotNode(c),g.plotNode(c,e,b),!b&&a.onAfterPlotNode(c)),!g.labelsHidden&&a.withLabels&&(c.drawn&&d>=.95?g.labels.plotLabel(e,c,a):g.labels.hideLabel(c,!1)),c.visited=!j})}},plotTree:function(a,b,c){var d=this,e=this.viz,f=e.canvas,g=(this.config,f.getCtx(),a.getData("alpha"));a.eachSubnode(function(e){if(b.plotSubtree(a,e)&&e.exist&&e.drawn){var g=a.getAdjacency(e.id);!c&&b.onBeforePlotLine(g),d.plotLine(g,f,c),!c&&b.onAfterPlotLine(g),d.plotTree(e,b,c)}}),a.drawn?(!c&&b.onBeforePlotNode(a),this.plotNode(a,f,c),!c&&b.onAfterPlotNode(a),!b.hideLabels&&b.withLabels&&g>=.95?this.labels.plotLabel(f,a,b):this.labels.hideLabel(a,!1)):this.labels.hideLabel(a,!0)},plotNode:function(a,b,c){var d=a.getData("type"),e=this.node.CanvasStyles;if("none"!=d){var f=a.getData("lineWidth"),g=a.getData("color"),h=a.getData("alpha"),i=b.getCtx();i.save(),i.lineWidth=f,i.fillStyle=i.strokeStyle=g,i.globalAlpha=h;for(var j in e)i[j]=a.getCanvasStyle(j);this.nodeTypes[d].render.call(this,a,b,c),i.restore()}},plotLine:function(a,b,c){var d=a.getData("type"),e=this.edge.CanvasStyles;if("none"!=d){var f=a.getData("lineWidth"),g=a.getData("color"),h=b.getCtx(),i=a.nodeFrom,j=a.nodeTo;h.save(),h.lineWidth=f,h.fillStyle=h.strokeStyle=g,h.globalAlpha=Math.min(i.getData("alpha"),j.getData("alpha"),a.getData("alpha"));for(var k in e)h[k]=a.getCanvasStyle(k);this.edgeTypes[d].render.call(this,a,b,c),h.restore()}}},q.Plot3D=b.merge(q.Plot,{Interpolator:{linear:function(a,b,c){var d=a.startPos.getc(!0),e=a.endPos.getc(!0);a.pos.setc(this.compute(d.x,e.x,c),this.compute(d.y,e.y,c),this.compute(d.z,e.z,c))}},plotNode:function(a,b){"none"!=a.getData("type")&&this.plotElement(a,b,{getAlpha:function(){return a.getData("alpha")}})},plotLine:function(a,b){"none"!=a.getData("type")&&this.plotElement(a,b,{getAlpha:function(){return Math.min(a.nodeFrom.getData("alpha"),a.nodeTo.getData("alpha"),a.getData("alpha"))}})},plotElement:function(a,c,d){var e=c.getCtx(),f=new y,g=c.config.Scene.Lighting,h=c.canvases[0],i=h.program,j=h.camera;if(a.geometry||(a.geometry=new(A[a.getData("type")])),a.geometry.update(a),!a.webGLVertexBuffer){for(var k=[],l=[],m=[],n=0,o=a.geometry,p=0,q=o.vertices,r=o.faces,s=r.length;s>p;p++){var t=r[p],u=q[t.a],v=q[t.b],x=q[t.c],z=t.d?q[t.d]:!1,B=t.normal;k.push(u.x,u.y,u.z),k.push(v.x,v.y,v.z),k.push(x.x,x.y,x.z),z&&k.push(z.x,z.y,z.z),m.push(B.x,B.y,B.z),m.push(B.x,B.y,B.z),m.push(B.x,B.y,B.z),z&&m.push(B.x,B.y,B.z),l.push(n,n+1,n+2),z?(l.push(n,n+2,n+3),n+=4):n+=3}a.webGLVertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a.webGLVertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(k),e.STATIC_DRAW),a.webGLFaceBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a.webGLFaceBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(l),e.STATIC_DRAW),a.webGLFaceCount=l.length,a.webGLNormalBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a.webGLNormalBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(m),e.STATIC_DRAW)}f.multiply(j.matrix,a.geometry.matrix),e.uniformMatrix4fv(i.viewMatrix,!1,f.flatten()),e.uniformMatrix4fv(i.projectionMatrix,!1,j.projectionMatrix.flatten());var C=y.makeInvert(f);C.$transpose(),e.uniformMatrix4fv(i.normalMatrix,!1,C.flatten());var D=b.hexToRgb(a.getData("color"));if(D.push(d.getAlpha()),e.uniform4f(i.color,D[0]/255,D[1]/255,D[2]/255,D[3]),e.uniform1i(i.enableLighting,g.enable),g.enable){if(g.ambient){var E=g.ambient;e.uniform3f(i.ambientColor,E[0],E[1],E[2])}if(g.directional){var F=g.directional,D=F.color,G=F.direction,H=new w(G.x,G.y,G.z).normalize().$scale(-1);e.uniform3f(i.lightingDirection,H.x,H.y,H.z),e.uniform3f(i.directionalColor,D[0],D[1],D[2])}}e.bindBuffer(e.ARRAY_BUFFER,a.webGLVertexBuffer),e.vertexAttribPointer(i.position,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,a.webGLNormalBuffer),e.vertexAttribPointer(i.normal,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a.webGLFaceBuffer),e.drawElements(e.TRIANGLES,a.webGLFaceCount,e.UNSIGNED_SHORT,0)}}),q.Label={},q.Label.Native=new c({initialize:function(a){this.viz=a},plotLabel:function(a,b,c){
var d=a.getCtx(),e=b.pos.getc(!0);d.font=b.getLabelData("style")+" "+b.getLabelData("size")+"px "+b.getLabelData("family"),d.textAlign=b.getLabelData("textAlign"),d.textBaseline=b.getLabelData("textBaseline");var f=Mapmaker.Utility.splitLine(b.name,30).split("\n");d.fillStyle=d.strokeStyle=Mapmaker.Settings.colors.labels.background,d.lineWidth=2;var g,h=25*f.length,i=[];for(g=0;g<f.length;++g)i.push(d.measureText(f[g]).width);var j=Math.max.apply(null,i)+8,k=e.x-j/2,l=e.y+b.getData("height")+5,m=5;d.beginPath(),d.moveTo(k+m,l),d.lineTo(k+j-m,l),d.quadraticCurveTo(k+j,l,k+j,l+m),d.lineTo(k+j,l+h-m),d.quadraticCurveTo(k+j,l+h,k+j-m,l+h),d.lineTo(k+m,l+h),d.quadraticCurveTo(k,l+h,k,l+h-m),d.lineTo(k,l+m),d.quadraticCurveTo(k,l,k+m,l),d.closePath(),d.fill(),d.fillStyle=d.strokeStyle=b.getLabelData("color"),this.renderLabel(f,a,b,c)},renderLabel:function(a,b,c,d){var e,f=b.getCtx(),g=c.pos.getc(!0);for(e=0;e<a.length;++e)f.fillText(a[e],g.x,g.y+c.getData("height")+23+25*e)},hideLabel:b.empty,hideLabels:b.empty}),q.Label.DOM=new c({labelsHidden:!1,labelContainer:!1,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(a){return a in this.labels&&null!=this.labels[a]?this.labels[a]:this.labels[a]=document.getElementById(a)},hideLabels:function(a){var b=this.getLabelContainer();a?b.style.display="none":b.style.display="",this.labelsHidden=a},clearLabels:function(a){for(var b in this.labels)(a||!this.viz.graph.hasNode(b))&&(this.disposeLabel(b),delete this.labels[b])},disposeLabel:function(a){var b=this.getLabel(a);b&&b.parentNode&&b.parentNode.removeChild(b)},hideLabel:function(a,c){a=b.splat(a);var d=c?"":"none",e=this;b.each(a,function(a){var b=e.getLabel(a.id);b&&(b.style.display=d)})},fitsInCanvas:function(a,b){var c=b.getSize();return a.x>=c.width||a.x<0||a.y>=c.height||a.y<0?!1:!0}}),q.Label.HTML=new c({Implements:q.Label.DOM,plotLabel:function(a,b,c){var d=b.id,e=this.getLabel(d);if(!e&&!(e=document.getElementById(d))){e=document.createElement("div");var f=this.getLabelContainer();e.id=d,e.className="node",e.style.position="absolute",c.onCreateLabel(e,b),f.appendChild(e),this.labels[b.id]=e}this.placeLabel(e,b,c)}}),q.Label.SVG=new c({Implements:q.Label.DOM,plotLabel:function(a,b,c){var d=b.id,e=this.getLabel(d);if(!e&&!(e=document.getElementById(d))){var f="http://www.w3.org/2000/svg";e=document.createElementNS(f,"svg:text");var g=document.createElementNS(f,"svg:tspan");e.appendChild(g);var h=this.getLabelContainer();e.setAttribute("id",d),e.setAttribute("class","node"),h.appendChild(e),c.onCreateLabel(e,b),this.labels[b.id]=e}this.placeLabel(e,b,c)}});var t={construct:function(a){var c="array"==b.type(a),d=new q(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);return c?function(a,c){for(var d=function(b){for(var d=0,e=c.length;e>d;d++)if(c[d].id==b)return c[d];var f={id:b,name:b};return a.addNode(f)},e=0,f=c.length;f>e;e++){a.addNode(c[e]);var g=c[e].adjacencies;if(g)for(var h=0,i=g.length;i>h;h++){var j=g[h],k={};"string"!=typeof g[h]&&(k=b.merge(j.data,{}),j=j.nodeTo),a.addAdjacence(c[e],d(j),k)}}}(d,a):function(a,b){if(a.addNode(b),b.children)for(var c=0,d=b.children;c<d.length;c++)a.addAdjacence(b,d[c]),arguments.callee(a,d[c])}(d,a),d},loadJSON:function(a,c){this.json=a,this.labels&&this.labels.clearLabels&&this.labels.clearLabels(!0),this.graph=this.construct(a),"array"!=b.type(a)?this.root=a.id:this.root=a[c?c:0].id},toJSON:function(a){if(a=a||"tree","tree"==a){var b={},c=this.graph.getNode(this.root),b=function e(a){var b={};b.id=a.id,b.name=a.name,b.data=a.data;var c=[];return a.eachSubnode(function(a){c.push(e(a))}),b.children=c,b}(c);return b}var b=[],d=!!this.graph.getNode(this.root).visited;return this.graph.eachNode(function(a){var c={};c.id=a.id,c.name=a.name,c.data=a.data;var e=[];a.eachAdjacency(function(a){var b=a.nodeTo;if(!!b.visited===d){var c={};c.nodeTo=b.id,c.data=a.data,e.push(c)}}),c.adjacencies=e,b.push(c),a.visited=!d}),b}},u=$jit.Layouts={},v={label:null,compute:function(a,c,d){this.initializeLabel(d);var e=this.label,f=e.style;a.eachNode(function(a){var c=a.getData("autoWidth"),d=a.getData("autoHeight");if(c||d){delete a.data.$width,delete a.data.$height,delete a.data.$dim;var g=a.getData("width"),h=a.getData("height");f.width=c?"auto":g+"px",f.height=d?"auto":h+"px",e.innerHTML=a.name;var i=e.offsetWidth,j=e.offsetHeight,k=a.getData("type");if(-1===b.indexOf(["circle","square","triangle","star"],k))a.setData("width",i),a.setData("height",j);else{var l=i>j?i:j;a.setData("width",l),a.setData("height",l),a.setData("dim",l)}}})},initializeLabel:function(a){this.label||(this.label=document.createElement("div"),document.body.appendChild(this.label)),this.setLabelStyles(a)},setLabelStyles:function(a){b.extend(this.label.style,{visibility:"hidden",position:"absolute",width:"auto",height:"auto"}),this.label.className="jit-autoadjust-label"}};u.Radial=new c({compute:function(a){var c=b.splat(a||["current","start","end"]);v.compute(this.graph,c,this.config),this.graph.computeLevels(this.root,0,"ignore");var d=this.createLevelDistanceFunc();this.computeAngularWidths(c),this.computePositions(c,d)},computePositions:function(a,b){for(var c=a,d=this.graph,e=d.getNode(this.root),f=this.parent,g=(this.config,0),h=c.length;h>g;g++){var i=c[g];e.setPos(m(0,0),i),e.setData("span",2*Math.PI,i)}e.angleSpan={begin:0,end:2*Math.PI},d.eachBFS(this.root,function(a){var d=a.angleSpan.end-a.angleSpan.begin,e=a.angleSpan.begin,g=b(a),h=0,i=[],j={};a.eachSubnode(function(a){h+=a._treeAngularWidth;for(var b=0,d=c.length;d>b;b++){var e=c[b],f=a.getData("dim",e);j[e]=e in j?f>j[e]?f:j[e]:f}i.push(a)},"ignore"),f&&f.id==a.id&&i.length>0&&i[0].dist&&i.sort(function(a,b){return(a.dist>=b.dist)-(a.dist<=b.dist)});for(var k=0,l=i.length;l>k;k++){var n=i[k];if(!n._flag){for(var o=n._treeAngularWidth/h*d,p=e+o/2,q=0,r=c.length;r>q;q++){var s=c[q];n.setPos(m(p,g),s),n.setData("span",o,s),n.setData("dim-quotient",n.getData("dim",s)/j[s],s)}n.angleSpan={begin:e,end:e+o},e+=o}}},"ignore")},setAngularWidthForNodes:function(a){this.graph.eachBFS(this.root,function(b,c){var d=b.getData("angularWidth",a[0])||5;b._angularWidth=d/c},"ignore")},setSubtreesAngularWidth:function(){var a=this;this.graph.eachNode(function(b){a.setSubtreeAngularWidth(b)},"ignore")},setSubtreeAngularWidth:function(a){var b=this,c=a._angularWidth,d=0;a.eachSubnode(function(a){b.setSubtreeAngularWidth(a),d+=a._treeAngularWidth},"ignore"),a._treeAngularWidth=Math.max(c,d)},computeAngularWidths:function(a){this.setAngularWidthForNodes(a),this.setSubtreesAngularWidth()}}),$jit.RGraph=new c({Implements:[t,j,u.Radial],initialize:function(a){var c=$jit.RGraph,d={interpolation:"linear",levelDistance:100};this.controller=this.config=b.merge(f("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),d,a);var e=this.config;e.useCanvas?(this.canvas=e.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(e.background&&(e.background=b.merge({type:"Circles"},e.background)),this.canvas=new k(this,e),this.config.labelContainer=("string"==typeof e.injectInto?e.injectInto:e.injectInto.id)+"-label"),this.graphOptions={klass:l,Node:{selected:!1,exist:!0,drawn:!0}},this.graph=new q(this.graphOptions,this.config.Node,this.config.Edge),this.labels=new c.Label[e.Label.type](this),this.fx=new c.Plot(this,c),this.op=new c.Op(this),this.json=null,this.root=null,this.busy=!1,this.parent=!1,this.initializeExtras()},createLevelDistanceFunc:function(){var a=this.config.levelDistance;return function(b){return(b._depth+1)*a}},refresh:function(){this.plot()},reposition:function(){this.compute("end")},plot:function(){this.fx.plot()},getNodeAndParentAngle:function(a){var b=!1,c=this.graph.getNode(a),d=c.getParents(),e=d.length>0?d[0]:!1;if(e){var f=e.pos.getc(),g=c.pos.getc(),h=f.add(g.scale(-1));b=Math.atan2(h.y,h.x),0>b&&(b+=2*Math.PI)}return{parent:e,theta:b}},tagChildren:function(a,b){if(a.angleSpan){var c=[];a.eachAdjacency(function(a){c.push(a.nodeTo)},"ignore");for(var d=c.length,e=0;d>e&&b!=c[e].id;e++);for(var f=(e+1)%d,g=0;b!=c[f].id;f=(f+1)%d)c[f].dist=g++}},onClick:function(a,c){if(this.root!=a&&!this.busy){this.busy=!0,this.root=a;var d=this;this.controller.onBeforeCompute(this.graph.getNode(a));var e=this.getNodeAndParentAngle(a);this.tagChildren(e.parent,a),this.parent=e.parent,this.compute("end");var f=e.theta-e.parent.endPos.theta;this.graph.eachNode(function(a){a.endPos.set(a.endPos.getp().add(m(f,0)))});var g=this.config.interpolation;c=b.merge({onComplete:b.empty},c||{}),this.fx.animate(b.merge({hideLabels:!0,modes:[g]},c,{onComplete:function(){d.busy=!1,c.onComplete()}}))}}}),$jit.RGraph.$extend=!0,function(a){a.Op=new c({Implements:q.Op}),a.Plot=new c({Implements:q.Plot}),a.Label={},a.Label.Native=new c({Implements:q.Label.Native}),a.Label.SVG=new c({Implements:q.Label.SVG,initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas,f=e.translateOffsetX,g=e.translateOffsetY,h=e.scaleOffsetX,i=e.scaleOffsetY,j=e.getSize(),k={x:Math.round(d.x*h+f+j.width/2),y:Math.round(d.y*i+g+j.height/2)};a.setAttribute("x",k.x),a.setAttribute("y",k.y),c.onPlaceLabel(a,b)}}),a.Label.HTML=new c({Implements:q.Label.HTML,initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas,f=e.translateOffsetX,g=e.translateOffsetY,h=e.scaleOffsetX,i=e.scaleOffsetY,j=e.getSize(),k={x:Math.round(d.x*h+f+j.width/2),y:Math.round(d.y*i+g+j.height/2)},l=a.style;l.left=k.x+"px",l.top=k.y+"px",l.display=this.fitsInCanvas(k,e)?"":"none",c.onPlaceLabel(a,b)}}),a.Plot.NodeTypes=new c({none:{render:b.empty,contains:b.lambda(!1)},circle:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.circle.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.circle.contains(c,b,d)}},ellipse:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");this.nodeHelper.ellipse.render("fill",c,d,e,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");return this.nodeHelper.ellipse.contains(c,b,d,e)}},square:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.square.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.square.contains(c,b,d)}},rectangle:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");this.nodeHelper.rectangle.render("fill",c,d,e,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");return this.nodeHelper.rectangle.contains(c,b,d,e)}},triangle:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.triangle.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.triangle.contains(c,b,d)}},star:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.star.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.star.contains(c,b,d)}}}),a.Plot.EdgeTypes=new c({none:b.empty,line:{render:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);this.edgeHelper.line.render(c,d,b)},contains:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);return this.edgeHelper.line.contains(c,d,b,this.edge.epsilon)}},arrow:{render:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0),e=a.getData("dim"),f=a.data.$direction,g=f&&f.length>1&&f[0]!=a.nodeFrom.id;this.edgeHelper.arrow.render(c,d,e,g,b)},contains:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);return this.edgeHelper.arrow.contains(c,d,b,this.edge.epsilon)}}})}($jit.RGraph),u.ForceDirected=new c({getOptions:function(a){var b=this.canvas.getSize(),c=b.width,d=b.height,e=0;this.graph.eachNode(function(a){e++});var f=c*d/e,g=Math.sqrt(f),h=this.config.levelDistance;return{width:c,height:d,tstart:.1*c,nodef:function(a){return f/(a||1)},edgef:function(a){return g*(a-h)}}},compute:function(a,c){var d=b.splat(a||["current","start","end"]),e=this.getOptions();v.compute(this.graph,d,this.config),this.graph.computeLevels(this.root,0,"ignore"),this.graph.eachNode(function(a){b.each(d,function(c){var f=a.getPos(c);f.equals(n.KER)&&(f.x=e.width/5*(Math.random()-.5),f.y=e.height/5*(Math.random()-.5)),a.disp={},b.each(d,function(b){a.disp[b]=o(0,0)})})}),this.computePositions(d,e,c)},computePositions:function(a,b,c){var d=this.config.iterations,e=0,f=this;if(c)!function g(){for(var h=c.iter,i=0;h>i;i++)if(b.t=b.tstart,d&&(b.t*=1-e++/(d-1)),f.computePositionStep(a,b),d&&e>=d)return void c.onComplete();c.onStep(Math.round(e/(d-1)*100)),setTimeout(g,1)}();else for(;d>e;e++)b.t=b.tstart*(1-e/(d-1)),this.computePositionStep(a,b)},computePositionStep:function(a,c){var d=this.graph,e=Math.min,f=Math.max,g=o(0,0);d.eachNode(function(e){b.each(a,function(a){e.disp[a].x=0,e.disp[a].y=0}),d.eachNode(function(d){d.id!=e.id&&b.each(a,function(a){var b=e.getPos(a),f=d.getPos(a);g.x=b.x-f.x,g.y=b.y-f.y;var h=g.norm()||1;e.disp[a].$add(g.$scale(c.nodef(h)/h))})})});var h=!!d.getNode(this.root).visited;d.eachNode(function(d){d.eachAdjacency(function(e){var f=e.nodeTo;!!f.visited===h&&b.each(a,function(a){var b=d.getPos(a),e=f.getPos(a);g.x=b.x-e.x,g.y=b.y-e.y;var h=g.norm()||1;d.disp[a].$add(g.$scale(-c.edgef(h)/h)),f.disp[a].$add(g.$scale(-1))})}),d.visited=!h});var i=c.t,j=c.width/2,k=c.height/2;d.eachNode(function(c){b.each(a,function(a){var b=c.disp[a],d=b.norm()||1,a=c.getPos(a);a.$add(o(b.x*e(Math.abs(b.x),i)/d,b.y*e(Math.abs(b.y),i)/d)),a.x=e(j,f(-j,a.x)),a.y=e(k,f(-k,a.y))})})}}),$jit.ForceDirected=new c({Implements:[t,j,u.ForceDirected],initialize:function(a){var c=$jit.ForceDirected,d={iterations:50,levelDistance:50};this.controller=this.config=b.merge(f("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),d,a);var e=this.config;e.useCanvas?(this.canvas=e.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(e.background&&(e.background=b.merge({type:"Circles"},e.background)),this.canvas=new k(this,e),this.config.labelContainer=("string"==typeof e.injectInto?e.injectInto:e.injectInto.id)+"-label"),this.graphOptions={klass:n,Node:{selected:!1,exist:!0,drawn:!0}},this.graph=new q(this.graphOptions,this.config.Node,this.config.Edge),this.labels=new c.Label[e.Label.type](this),this.fx=new c.Plot(this,c),this.op=new c.Op(this),this.json=null,this.busy=!1,this.initializeExtras()},refresh:function(){this.plot()},reposition:function(){this.compute("end")},computeIncremental:function(a){a=b.merge({iter:20,property:"end",onStep:b.empty,onComplete:b.empty},a||{}),this.config.onBeforeCompute(this.graph.getNode(this.root)),this.compute(a.property,a)},plot:function(){this.fx.plot()},animate:function(a){this.fx.animate(b.merge({modes:["linear"]},a||{}))}}),$jit.ForceDirected.$extend=!0,function(a){a.Op=new c({Implements:q.Op}),a.Plot=new c({Implements:q.Plot}),a.Label={},a.Label.Native=new c({Implements:q.Label.Native}),a.Label.SVG=new c({Implements:q.Label.SVG,initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas,f=e.translateOffsetX,g=e.translateOffsetY,h=e.scaleOffsetX,i=e.scaleOffsetY,j=e.getSize(),k={x:Math.round(d.x*h+f+j.width/2),y:Math.round(d.y*i+g+j.height/2)};a.setAttribute("x",k.x),a.setAttribute("y",k.y),c.onPlaceLabel(a,b)}}),a.Label.HTML=new c({Implements:q.Label.HTML,initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas,f=e.translateOffsetX,g=e.translateOffsetY,h=e.scaleOffsetX,i=e.scaleOffsetY,j=e.getSize(),k={x:Math.round(d.x*h+f+j.width/2),y:Math.round(d.y*i+g+j.height/2)},l=a.style;l.left=k.x+"px",l.top=k.y+"px",l.display=this.fitsInCanvas(k,e)?"":"none",c.onPlaceLabel(a,b)}}),a.Plot.NodeTypes=new c({none:{render:b.empty,contains:b.lambda(!1)},circle:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.circle.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.circle.contains(c,b,d)}},ellipse:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");this.nodeHelper.ellipse.render("fill",c,d,e,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");return this.nodeHelper.ellipse.contains(c,b,d,e)}},square:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.square.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.square.contains(c,b,d)}},rectangle:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");this.nodeHelper.rectangle.render("fill",c,d,e,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");return this.nodeHelper.rectangle.contains(c,b,d,e)}},triangle:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.triangle.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.triangle.contains(c,b,d)}},star:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.star.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.star.contains(c,b,d)}}}),a.Plot.EdgeTypes=new c({none:b.empty,line:{render:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);this.edgeHelper.line.render(c,d,b)},contains:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);return this.edgeHelper.line.contains(c,d,b,this.edge.epsilon)}},arrow:{render:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0),e=a.getData("dim"),f=a.data.$direction,g=f&&f.length>1&&f[0]!=a.nodeFrom.id;this.edgeHelper.arrow.render(c,d,e,g,b)},contains:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);return this.edgeHelper.arrow.contains(c,d,b,this.edge.epsilon)}}})}($jit.ForceDirected);var w=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0};$jit.Vector3=w,w.prototype={set:function(a){this.x=a.x,this.y=a.y,this.z=a.z},setc:function(a,b,c){this.x=a,this.y=b,this.z=c},getc:function(){return this},add:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},$add:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},sub:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},$sub:function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},cross:function(a,b){return this.x=a.y*b.z-a.z*b.y,this.y=a.z*b.x-a.x*b.z,this.z=a.x*b.y-a.y*b.x,this},$cross:function(a){var b=this.x,c=this.y,d=this.z;return this.x=c*a.z-d*a.y,this.y=d*a.x-b*a.z,this.z=b*a.y-c*a.x,this},$multiply:function(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this},$scale:function(a){return this.x*=a,this.y*=a,this.z*=a,this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d},norm:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},normalize:function(){var a=this.norm();return a>0&&this.$scale(1/a),this},isZero:function(){var a=1e-4,b=Math.abs;return b(this.x)<a&&b(this.y)<a&&b(this.z)<a},clone:function(){return new w(this.x,this.y,this.z)}};var x=function(a,b,c){return new w(a,b,c)},y=function(){this._x=new w,this._y=new w,this._z=new w};$jit.Matrix4=y,y.prototype={n11:1,n12:0,n13:0,n14:0,n21:0,n22:1,n23:0,n24:0,n31:0,n32:0,n33:1,n34:0,n41:0,n42:0,n43:0,n44:1,identity:function(){this.n11=1,this.n12=0,this.n13=0,this.n14=0,this.n21=0,this.n22=1,this.n23=0,this.n24=0,this.n31=0,this.n32=0,this.n33=1,this.n34=0,this.n41=0,this.n42=0,this.n43=0,this.n44=1},lookAt:function(a,b,c){var d=this._x,e=this._y,f=this._z;f.sub(a,b),f.normalize(),d.cross(c,f),d.normalize(),e.cross(f,d),e.normalize(),this.n11=d.x,this.n12=d.y,this.n13=d.z,this.n14=-d.dot(a),this.n21=e.x,this.n22=e.y,this.n23=e.z,this.n24=-e.dot(a),this.n31=f.x,this.n32=f.y,this.n33=f.z,this.n34=-f.dot(a)},transform:function(a){var b=a.x,c=a.y,d=a.z,e=a.w?a.w:1;a.x=this.n11*b+this.n12*c+this.n13*d+this.n14*e,a.y=this.n21*b+this.n22*c+this.n23*d+this.n24*e,a.z=this.n31*b+this.n32*c+this.n33*d+this.n34*e,e=this.n41*b+this.n42*c+this.n43*d+this.n44*e,a.w?a.w=e:(a.x=a.x/e,a.y=a.y/e,a.z=a.z/e)},multiply:function(a,b){this.n11=a.n11*b.n11+a.n12*b.n21+a.n13*b.n31+a.n14*b.n41,this.n12=a.n11*b.n12+a.n12*b.n22+a.n13*b.n32+a.n14*b.n42,this.n13=a.n11*b.n13+a.n12*b.n23+a.n13*b.n33+a.n14*b.n43,this.n14=a.n11*b.n14+a.n12*b.n24+a.n13*b.n34+a.n14*b.n44,this.n21=a.n21*b.n11+a.n22*b.n21+a.n23*b.n31+a.n24*b.n41,this.n22=a.n21*b.n12+a.n22*b.n22+a.n23*b.n32+a.n24*b.n42,this.n23=a.n21*b.n13+a.n22*b.n23+a.n23*b.n33+a.n24*b.n43,this.n24=a.n21*b.n14+a.n22*b.n24+a.n23*b.n34+a.n24*b.n44,this.n31=a.n31*b.n11+a.n32*b.n21+a.n33*b.n31+a.n34*b.n41,this.n32=a.n31*b.n12+a.n32*b.n22+a.n33*b.n32+a.n34*b.n42,this.n33=a.n31*b.n13+a.n32*b.n23+a.n33*b.n33+a.n34*b.n43,this.n34=a.n31*b.n14+a.n32*b.n24+a.n33*b.n34+a.n34*b.n44,this.n41=a.n41*b.n11+a.n42*b.n21+a.n43*b.n31+a.n44*b.n41,this.n42=a.n41*b.n12+a.n42*b.n22+a.n43*b.n32+a.n44*b.n42,this.n43=a.n41*b.n13+a.n42*b.n23+a.n43*b.n33+a.n44*b.n43,this.n44=a.n41*b.n14+a.n42*b.n24+a.n43*b.n34+a.n44*b.n44},$multiply:function(a){var b=this.n11,c=this.n12,d=this.n13,e=this.n14,f=this.n21,g=this.n22,h=this.n23,i=this.n24,j=this.n31,k=this.n32,l=this.n33,m=this.n34,n=this.n41,o=this.n42,p=this.n43,q=this.n44;this.n11=b*a.n11+c*a.n21+d*a.n31+e*a.n41,this.n12=b*a.n12+c*a.n22+d*a.n32+e*a.n42,this.n13=b*a.n13+c*a.n23+d*a.n33+e*a.n43,this.n14=b*a.n14+c*a.n24+d*a.n34+e*a.n44,this.n21=f*a.n11+g*a.n21+h*a.n31+i*a.n41,this.n22=f*a.n12+g*a.n22+h*a.n32+i*a.n42,this.n23=f*a.n13+g*a.n23+h*a.n33+i*a.n43,this.n24=f*a.n14+g*a.n24+h*a.n34+i*a.n44,this.n31=j*a.n11+k*a.n21+l*a.n31+m*a.n41,this.n32=j*a.n12+k*a.n22+l*a.n32+m*a.n42,this.n33=j*a.n13+k*a.n23+l*a.n33+m*a.n43,this.n34=j*a.n14+k*a.n24+l*a.n34+m*a.n44,this.n41=n*a.n11+o*a.n21+p*a.n31+q*a.n41,this.n42=n*a.n12+o*a.n22+p*a.n32+q*a.n42,this.n43=n*a.n13+o*a.n23+p*a.n33+q*a.n43,this.n44=n*a.n14+o*a.n24+p*a.n34+q*a.n44},$scale:function(a){return this.n11*=a,this.n12*=a,this.n13*=a,this.n14*=a,this.n21*=a,this.n22*=a,this.n23*=a,this.n24*=a,this.n31*=a,this.n32*=a,this.n33*=a,this.n34*=a,this.n41*=a,this.n42*=a,this.n43*=a,this.n44*=a,this},$add:function(a){return this.n11+=a.n11,this.n12+=a.n12,this.n13+=a.n13,this.n14+=a.n14,this.n21+=a.n21,this.n22+=a.n22,this.n23+=a.n23,this.n24+=a.n24,this.n31+=a.n31,this.n32+=a.n32,this.n33+=a.n33,this.n34+=a.n34,this.n41+=a.n41,this.n42+=a.n42,this.n43+=a.n43,this.n44+=a.n44,this},determinant:function(){return this.n14*this.n23*this.n32*this.n41-this.n13*this.n24*this.n32*this.n41-this.n14*this.n22*this.n33*this.n41+this.n12*this.n24*this.n33*this.n41+this.n13*this.n22*this.n34*this.n41-this.n12*this.n23*this.n34*this.n41-this.n14*this.n23*this.n31*this.n42+this.n13*this.n24*this.n31*this.n42+this.n14*this.n21*this.n33*this.n42-this.n11*this.n24*this.n33*this.n42-this.n13*this.n21*this.n34*this.n42+this.n11*this.n23*this.n34*this.n42+this.n14*this.n22*this.n31*this.n43-this.n12*this.n24*this.n31*this.n43-this.n14*this.n21*this.n32*this.n43+this.n11*this.n24*this.n32*this.n43+this.n12*this.n21*this.n34*this.n43-this.n11*this.n22*this.n34*this.n43-this.n13*this.n22*this.n31*this.n44+this.n12*this.n23*this.n31*this.n44+this.n13*this.n21*this.n32*this.n44-this.n11*this.n23*this.n32*this.n44-this.n12*this.n21*this.n33*this.n44+this.n11*this.n22*this.n33*this.n44},$transpose:function(){function a(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}return a(this,"n21","n12"),a(this,"n31","n13"),a(this,"n32","n23"),a(this,"n41","n14"),a(this,"n42","n24"),a(this,"n43","n34"),this},clone:function(){var a=new y;return a.n11=this.n11,a.n12=this.n12,a.n13=this.n13,a.n14=this.n14,a.n21=this.n21,a.n22=this.n22,a.n23=this.n23,a.n24=this.n24,a.n31=this.n31,a.n32=this.n32,a.n33=this.n33,a.n34=this.n34,a.n41=this.n41,a.n42=this.n42,a.n43=this.n43,a.n44=this.n44,a},flatten:function(){return[this.n11,this.n21,this.n31,this.n41,this.n12,this.n22,this.n32,this.n42,this.n13,this.n23,this.n33,this.n43,this.n14,this.n24,this.n34,this.n44]}},y.translationMatrix=function(a,b,c){var d=new y;return d.n14=a,d.n24=b,d.n34=c,d},y.scaleMatrix=function(a,b,c){var d=new y;return d.n11=a,d.n22=b,d.n33=c,d},y.rotationXMatrix=function(a){var b=new y;return b.n22=b.n33=Math.cos(a),b.n32=Math.sin(a),b.n23=-b.n32,b},y.rotationYMatrix=function(a){var b=new y;return b.n11=b.n33=Math.cos(a),b.n13=Math.sin(a),b.n31=-b.n13,b},y.rotationZMatrix=function(a){var b=new y;return b.n11=b.n22=Math.cos(a),b.n21=Math.sin(a),b.n12=-b.n21,b},y.makeInvert=function(a){var b=new y;return b.n11=a.n23*a.n34*a.n42-a.n24*a.n33*a.n42+a.n24*a.n32*a.n43-a.n22*a.n34*a.n43-a.n23*a.n32*a.n44+a.n22*a.n33*a.n44,b.n12=a.n14*a.n33*a.n42-a.n13*a.n34*a.n42-a.n14*a.n32*a.n43+a.n12*a.n34*a.n43+a.n13*a.n32*a.n44-a.n12*a.n33*a.n44,b.n13=a.n13*a.n24*a.n42-a.n14*a.n23*a.n42+a.n14*a.n22*a.n43-a.n12*a.n24*a.n43-a.n13*a.n22*a.n44+a.n12*a.n23*a.n44,b.n14=a.n14*a.n23*a.n32-a.n13*a.n24*a.n32-a.n14*a.n22*a.n33+a.n12*a.n24*a.n33+a.n13*a.n22*a.n34-a.n12*a.n23*a.n34,b.n21=a.n24*a.n33*a.n41-a.n23*a.n34*a.n41-a.n24*a.n31*a.n43+a.n21*a.n34*a.n43+a.n23*a.n31*a.n44-a.n21*a.n33*a.n44,b.n22=a.n13*a.n34*a.n41-a.n14*a.n33*a.n41+a.n14*a.n31*a.n43-a.n11*a.n34*a.n43-a.n13*a.n31*a.n44+a.n11*a.n33*a.n44,b.n23=a.n14*a.n23*a.n41-a.n13*a.n24*a.n41-a.n14*a.n21*a.n43+a.n11*a.n24*a.n43+a.n13*a.n21*a.n44-a.n11*a.n23*a.n44,b.n24=a.n13*a.n24*a.n31-a.n14*a.n23*a.n31+a.n14*a.n21*a.n33-a.n11*a.n24*a.n33-a.n13*a.n21*a.n34+a.n11*a.n23*a.n34,b.n31=a.n22*a.n34*a.n41-a.n24*a.n32*a.n41+a.n24*a.n31*a.n42-a.n21*a.n34*a.n42-a.n22*a.n31*a.n44+a.n21*a.n32*a.n44,b.n32=a.n14*a.n32*a.n41-a.n12*a.n34*a.n41-a.n14*a.n31*a.n42+a.n11*a.n34*a.n42+a.n12*a.n31*a.n44-a.n11*a.n32*a.n44,b.n33=a.n13*a.n24*a.n41-a.n14*a.n22*a.n41+a.n14*a.n21*a.n42-a.n11*a.n24*a.n42-a.n12*a.n21*a.n44+a.n11*a.n22*a.n44,b.n34=a.n14*a.n22*a.n31-a.n12*a.n24*a.n31-a.n14*a.n21*a.n32+a.n11*a.n24*a.n32+a.n12*a.n21*a.n34-a.n11*a.n22*a.n34,b.n41=a.n23*a.n32*a.n41-a.n22*a.n33*a.n41-a.n23*a.n31*a.n42+a.n21*a.n33*a.n42+a.n22*a.n31*a.n43-a.n21*a.n32*a.n43,b.n42=a.n12*a.n33*a.n41-a.n13*a.n32*a.n41+a.n13*a.n31*a.n42-a.n11*a.n33*a.n42-a.n12*a.n31*a.n43+a.n11*a.n32*a.n43,b.n43=a.n13*a.n22*a.n41-a.n12*a.n23*a.n41-a.n13*a.n21*a.n42+a.n11*a.n23*a.n42+a.n12*a.n21*a.n43-a.n11*a.n22*a.n43,b.n44=a.n12*a.n23*a.n31-a.n13*a.n22*a.n31+a.n13*a.n21*a.n32-a.n11*a.n23*a.n32-a.n12*a.n21*a.n33+a.n11*a.n22*a.n33,b.$scale(1/a.determinant()),b},y.makeFrustum=function(a,b,c,d,e,f){var g,h,i,j,k,l,m;return g=new y,h=2*e/(b-a),i=2*e/(d-c),j=(b+a)/(b-a),k=(d+c)/(d-c),l=-(f+e)/(f-e),m=-2*f*e/(f-e),g.n11=h,g.n12=0,g.n13=j,g.n14=0,g.n21=0,g.n22=i,g.n23=k,g.n24=0,g.n31=0,g.n32=0,g.n33=l,g.n34=m,g.n41=0,g.n42=0,g.n43=-1,g.n44=0,g},y.makePerspective=function(a,b,c,d){var e,f,g,h;return e=c*Math.tan(a*Math.PI/360),f=-e,g=f*b,h=e*b,y.makeFrustum(g,h,f,e,c,d)},y.makeOrtho=function(a,b,c,d,e,f){var g,h,i,j,k,l,m;return g=new y,k=b-a,l=d-c,m=f-e,h=(b+a)/k,i=(d+c)/l,j=(f+e)/m,g.n11=2/k,g.n12=0,g.n13=0,g.n14=-h,g.n21=0,g.n22=2/l,g.n23=0,g.n24=-i,g.n31=0,g.n32=0,g.n33=-2/m,g.n34=-j,g.n41=0,g.n42=0,g.n43=0,g.n44=1,g};var z=function(a,b,c,d){this.projectionMatrix=y.makePerspective(a,b,c,d)};z.prototype={position:new w,target:{position:new w},up:new w(0,1,0),matrix:new y,updateMatrix:function(){this.matrix.lookAt(this.position,this.target.position,this.up)}},k.Base["3D"]=new c({Implements:k.Base["2D"],program:null,camera:null,initialize:function(a){this.viz=a,this.opt=a.config,this.size=!1,this.createCanvas(),this.initWebGL(),this.initCamera()},initWebGL:function(){var a=this.getCtx(),c=this.getSize(),d=this.getShader(k.Base["3D"].FragmentShader,a.FRAGMENT_SHADER),e=this.getShader(k.Base["3D"].VertexShader,a.VERTEX_SHADER),f=a.createProgram();if(a.attachShader(f,e),a.attachShader(f,d),a.linkProgram(f),!a.getProgramParameter(f,a.LINK_STATUS))throw"Could not link shaders";a.useProgram(f),b.extend(f,{viewMatrix:a.getUniformLocation(f,"viewMatrix"),projectionMatrix:a.getUniformLocation(f,"projectionMatrix"),normalMatrix:a.getUniformLocation(f,"normalMatrix"),color:a.getUniformLocation(f,"color"),enableLighting:a.getUniformLocation(f,"enableLighting"),ambientColor:a.getUniformLocation(f,"ambientColor"),directionalColor:a.getUniformLocation(f,"directionalColor"),lightingDirection:a.getUniformLocation(f,"lightingDirection"),position:a.getAttribLocation(f,"position"),normal:a.getAttribLocation(f,"normal")}),a.enableVertexAttribArray(f.position),a.enableVertexAttribArray(f.normal),this.program=f,a.clearColor(0,0,0,0),a.clearDepth(1),a.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.viewport(0,0,c.width,c.height)},initCamera:function(){var a=this.getSize(),b=new z(75,a.width/a.height,1,1e3);b.position.z=500,this.camera=b},getShader:function(a,b){var c=this.ctx,d=c.createShader(b);if(c.shaderSource(d,a),c.compileShader(d),!c.getShaderParameter(d,c.COMPILE_STATUS)){var e=c.getShaderInfoLog(d);throw"Could not compile shader src: "+e}return d},getCtx:function(){return this.ctx?this.ctx:this.ctx=this.canvas.getContext("experimental-webgl")},resize:function(a,b){var c=(this.getSize(),this.canvas),d=c.style,e=this.getCtx();this.size=!1,c.width=a,c.height=b,d.width=a+"px",d.height=b+"px",e.viewport(0,0,a,b),this.translateOffsetX=this.translateOffsetY=0,this.scaleOffsetX=this.scaleOffsetY=1,this.clear(),this.viz.resize(a,b,this)},translateToCenter:b.empty,scale:b.empty,translate:function(a,b,c,d){var e=this.scaleOffsetX,f=this.scaleOffsetY;this.translateOffsetX+=a*e,this.translateOffsetY+=b*f;var g=this.camera.position;g.x+=a,g.y+=b,g.z+=c,!d&&this.plot()},clear:function(){var a=this.getCtx();a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.camera.updateMatrix()},plot:function(){this.clear(),this.viz.plot(this)}}),k.Base["3D"].FragmentShader=["#ifdef GL_ES","precision highp float;","#endif","varying vec4 vcolor;","varying vec3 lightWeighting;","void main(){","gl_FragColor = vec4(vcolor.rgb * lightWeighting, vcolor.a);","}"].join("\n"),k.Base["3D"].VertexShader=["attribute vec3 position;","attribute vec3 normal;","uniform vec4 color;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 normalMatrix;","uniform bool enableLighting;","uniform vec3 ambientColor;","uniform vec3 directionalColor;","uniform vec3 lightingDirection;","varying vec4 vcolor;","varying vec3 lightWeighting;","void main(void) {","if(!enableLighting) {","lightWeighting = vec3(1.0, 1.0, 1.0);","} else {","vec4 transformedNormal = normalMatrix * vec4(normal, 1.0);","float directionalLightWeighting = max(dot(transformedNormal.xyz, lightingDirection), 0.0);","lightWeighting = ambientColor + directionalColor * directionalLightWeighting;","}","vcolor = color;","gl_Position = projectionMatrix * viewMatrix * vec4( position, 1.0 );","}"].join("\n");var A={};$jit.O3D=A,A.base=new c({vertices:[],faces:[],position:new w,rotation:new w,scale:new w(1,1,1),matrix:new y,update:function(a){a.nodeFrom&&a.nodeTo?this.updateEdge(a):this.updateNode(a)},updateNode:b.empty,updateEdge:function(a){this.updateNode(a)},updateMatrix:function(){var a=this.position,b=this.rotation,c=this.scale,d=this.matrix;d.identity(),d.$multiply(y.translationMatrix(a.x,a.y,a.z)),d.$multiply(y.rotationXMatrix(b.x)),d.$multiply(y.rotationYMatrix(b.y)),d.$multiply(y.rotationZMatrix(b.z)),d.$multiply(y.scaleMatrix(c.x,c.y,c.z))},computeNormals:function(){
for(var a=0,b=this.vertices,c=this.faces,d=c.length;d>a;a++){var e=b[c[a].a],f=b[c[a].b],g=b[c[a].c],h=new w,i=new w;h.sub(g,f),i.sub(e,f),h.$cross(i),h.isZero()||h.normalize(),c[a].normal=h}}}),A.cube=new c({Implements:A.base,initialize:function(){a.call(this),this.computeNormals()},updateNode:function(a){var b=a.getData("dim"),c=a.pos;this.position.setc(c.x,c.y,c.z),this.scale.setc(b,b,b),this.updateMatrix()}}),A.sphere=new c({Implements:A.base,radius:1,segments_width:10,segments_height:10,initialize:function(){for(var a=this.radius,b=this.segments_width,c=this.segments_height,d=b||8,e=c||6,f=Math.cos,g=Math.sin,h=Math.max,i=Math.PI,j=h(3,d),k=h(2,e),l=[],m=0;k+1>m;m++){for(var n=m/k,o=a*f(n*i),p=a*g(n*i),q=[],r=0,s=0;j>s;s++){var t=2*s/j,u=p*Math.sin(t*i),v=p*Math.cos(t*i);(0==m||m==k)&&s>0||(r=this.vertices.push({x:v,y:o,z:u})-1),q.push(r)}l.push(q)}for(var w=l.length,m=0;w>m;m++){var x=l[m].length;if(m>0)for(var s=0;x>s;s++){var y=s==x-1,z=l[m][y?0:s+1],A=l[m][y?x-1:s],B=l[m-1][y?x-1:s],C=l[m-1][y?0:s+1];m<l.length-1&&this.faces.push({a:z,b:A,c:B}),m>1&&this.faces.push({a:z,b:B,c:C})}}this.computeNormals()},updateNode:function(a){var b=a.getData("dim"),c=a.pos;this.position.setc(c.x,c.y,c.z),this.scale.setc(b,b,b),this.updateMatrix()}}),A.tube=new c({Implements:A.base,numSegs:10,dim:1,initialize:function(){for(var a=this.vertices,b=this.faces,c=function(b,c,d){a.push({x:b,y:c,z:d})},d=function(a,c,d,e){b.push({a:a,b:c,c:d,d:e})},e=Math.sin,f=Math.cos,g=Math.PI,h=2*g,i=this.numSegs,j=this.dim,k=this.dim,l=0;i>l;l++)c(e(h*l/i)*j,f(h*l/i)*j,-.5);for(var l=0;i>l;l++)c(e(h*l/i)*k,f(h*l/i)*k,.5);for(var l=0;i>l;l++)d(l,(l+1)%i,i+(l+1)%i,l+i);this.computeNormals()},updateEdge:function(a){var b=a.getData("lineWidth"),c=a.nodeFrom,d=a.nodeTo,e=c.pos,f=d.pos,g=e.distanceTo(f),h=new w,i=new w(0,0,1),j=new w;h.add(e,f).$scale(.5),j.sub(f,e).normalize();var k=j.dot(i),l=(j.dot(new w(1,0,0)),j.dot(new w(0,1,0)),1-k),m=Math.acos(k),n=Math.sin(m),o=i.$cross(j).normalize(),p=o.x,q=o.y,r=o.z,s=new y;s.n11=l*p*p+k,s.n12=l*p*q-n*r,s.n13=l*p*r+n*q,s.n21=l*p*q+n*r,s.n22=l*q*q+k,s.n23=l*q*r-n*p,s.n31=l*p*r-n*q,s.n32=l*q*r+n*p,s.n33=l*r*r+k,this.rotationMatrix=s,this.scale.setc(b,b,g),this.position.setc(h.x,h.y,h.z),this.updateMatrix()},updateMatrix:function(){var a=this.position,b=this.scale,c=this.matrix;c.identity(),c.$multiply(y.translationMatrix(a.x,a.y,a.z)),c.$multiply(this.rotationMatrix),c.$multiply(y.scaleMatrix(b.x,b.y,b.z))}}),u.ForceDirected3D=new c({getOptions:function(){var a=this.canvas.getSize(),b=a.width,c=a.height,d=0;this.graph.eachNode(function(a){d++});var e=b*c/d,f=Math.sqrt(e),g=this.config.levelDistance;return{width:b,height:c,tstart:.1*b,nodef:function(a){return e/(a||1)},edgef:function(a){return f*(a-g)}}},compute:function(a,c){var d=b.splat(a||["current","start","end"]),e=this.getOptions();v.compute(this.graph,d,this.config),this.graph.computeLevels(this.root,0,"ignore"),this.graph.eachNode(function(a){b.each(d,function(c){var f=a.getPos(c);f.isZero()&&(f.x=e.width/5*(Math.random()-.5),f.y=e.height/5*(Math.random()-.5),f.z=200*(Math.random()-.5)),a.disp={},b.each(d,function(b){a.disp[b]=x(0,0,0)})})}),this.computePositions(d,e,c)},computePositions:function(a,b,c){var d=this.config.iterations,e=0,f=this;if(c)!function g(){for(var h=c.iter,i=0;h>i;i++)if(b.t=b.tstart*(1-e++/(d-1)),f.computePositionStep(a,b),e>=d)return void c.onComplete();c.onStep(Math.round(e/(d-1)*100)),setTimeout(g,1)}();else for(;d>e;e++)b.t=b.tstart*(1-e/(d-1)),this.computePositionStep(a,b)},computePositionStep:function(a,c){var d=this.graph,e=Math.min,f=Math.max,g=x(0,0,0);d.eachNode(function(e){b.each(a,function(a){e.disp[a].x=0,e.disp[a].y=0,e.disp[a].z=0}),d.eachNode(function(d){d.id!=e.id&&b.each(a,function(a){var b=e.getPos(a),f=d.getPos(a);g.x=b.x-f.x,g.y=b.y-f.y,g.z=b.z-f.z;var h=g.norm()||1;e.disp[a].$add(g.$scale(c.nodef(h)/h))})})});var h=!!d.getNode(this.root).visited;d.eachNode(function(d){d.eachAdjacency(function(e){var f=e.nodeTo;!!f.visited===h&&b.each(a,function(a){var b=d.getPos(a),e=f.getPos(a);g.x=b.x-e.x,g.y=b.y-e.y,g.z=b.z-e.z;var h=g.norm()||1;d.disp[a].$add(g.$scale(-c.edgef(h)/h)),f.disp[a].$add(g.$scale(-1))})}),d.visited=!h});var i=c.t,j=c.width/2,k=c.height/2;d.eachNode(function(c){b.each(a,function(a){var b=c.disp[a],d=b.norm()||1,a=c.getPos(a);a.$add(x(b.x*e(Math.abs(b.x),i)/d,b.y*e(Math.abs(b.y),i)/d,b.z*e(Math.abs(b.z),i)/d)),a.x=e(j,f(-j,a.x)),a.y=e(k,f(-k,a.y)),a.z=e(k,f(-k,a.z))})})}}),$jit.ForceDirected3D=new c({Implements:[t,j,u.ForceDirected3D],initialize:function(a){var c=$jit.ForceDirected3D,d={iterations:50,levelDistance:50};this.controller=this.config=b.merge(f("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),d,a);var e=this.config;e.useCanvas?(this.canvas=e.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(e.background&&(e.background=b.merge({type:"Circles"},e.background)),this.canvas=new k(this,e),this.config.labelContainer=("string"==typeof e.injectInto?e.injectInto:e.injectInto.id)+"-label"),this.graphOptions={klass:w,Node:{selected:!1,exist:!0,drawn:!0}},this.graph=new q(this.graphOptions,this.config.Node,this.config.Edge),this.labels=new c.Label[e.Label.type](this),this.fx=new c.Plot(this,c),this.op=new c.Op(this),this.json=null,this.busy=!1,this.initializeExtras()},refresh:function(){this.compute(),this.plot()},reposition:function(){this.compute("end")},computeIncremental:function(a){a=b.merge({iter:20,property:"end",onStep:b.empty,onComplete:b.empty},a||{}),this.config.onBeforeCompute(this.graph.getNode(this.root)),this.compute(a.property,a)},plot:function(){this.fx.plot()},animate:function(a){this.fx.animate(b.merge({modes:["linear"]},a||{}))}}),$jit.ForceDirected3D.$extend=!0,function(a){a.Op=new c({Implements:q.Op}),a.Plot=new c({Implements:q.Plot3D}),a.Label={},a.Label.Native=new c({Implements:q.Label.Native}),a.Label.SVG=new c({Implements:q.Label.SVG,initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas,f=e.translateOffsetX,g=e.translateOffsetY,h=e.scaleOffsetX,i=e.scaleOffsetY,j=e.getSize(),k={x:Math.round(d.x*h+f+j.width/2),y:Math.round(d.y*i+g+j.height/2)};a.setAttribute("x",k.x),a.setAttribute("y",k.y),c.onPlaceLabel(a,b)}}),a.Label.HTML=new c({Implements:q.Label.HTML,initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas,f=e.translateOffsetX,g=e.translateOffsetY,h=e.scaleOffsetX,i=e.scaleOffsetY,j=e.getSize(),k={x:Math.round(d.x*h+f+j.width/2),y:Math.round(d.y*i+g+j.height/2)},l=a.style;l.left=k.x+"px",l.top=k.y+"px",l.display=this.fitsInCanvas(k,e)?"":"none",c.onPlaceLabel(a,b)}}),a.Plot.NodeTypes=new c({none:{render:b.empty,contains:b.lambda(!1)},circle:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.circle.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.circle.contains(c,b,d)}},ellipse:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");this.nodeHelper.ellipse.render("fill",c,d,e,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");return this.nodeHelper.ellipse.contains(c,b,d,e)}},square:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.square.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.square.contains(c,b,d)}},rectangle:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");this.nodeHelper.rectangle.render("fill",c,d,e,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");return this.nodeHelper.rectangle.contains(c,b,d,e)}},triangle:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.triangle.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.triangle.contains(c,b,d)}},star:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.star.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.star.contains(c,b,d)}}}),a.Plot.EdgeTypes=new c({none:b.empty,line:{render:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);this.edgeHelper.line.render(c,d,b)},contains:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);return this.edgeHelper.line.contains(c,d,b,this.edge.epsilon)}},arrow:{render:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0),e=a.getData("dim"),f=a.data.$direction,g=f&&f.length>1&&f[0]!=a.nodeFrom.id;this.edgeHelper.arrow.render(c,d,e,g,b)},contains:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);return this.edgeHelper.arrow.contains(c,d,b,this.edge.epsilon)}}})}($jit.ForceDirected3D)}(),"undefined"==typeof Mapmaker&&(Mapmaker={}),Mapmaker.Utility=function(){var a=function(a,b){for(var c="",d=a?a:"";d.length>b;){var e=d.substring(0,b),f=e.lastIndexOf(" "),g=e.lastIndexOf("\n");-1!=g&&(f=g),-1==f&&(f=b),c+=e.substring(0,f)+"\n",d=d.substring(f+1)}return c+d},b=function(){var a=new Date(Date.now()),b=a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,c=a.getDate()<10?"0"+a.getDate():a.getDate(),d=a.getFullYear();return b+"/"+c+"/"+d},c=function(a){var b,c=document.createElement("p");return c.innerHTML=a,b=c.textContent||c.innerText,c=null,b},d=function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))},e=function(a,b){return{x:a.x+b.$parent.width()/2+b.translateX,y:a.y+b.$parent.height()/2+b.translateY}},f=function(a,b){return{x:a.x-b.$parent.width()/2-b.translateX,y:a.y-b.$parent.height()/2-b.translateY}},g=function(){var a=(Math.round(127*Math.random())+127).toString(16),b=(Math.round(127*Math.random())+127).toString(16),c=(Math.round(127*Math.random())+127).toString(16);return Mapmaker.Utility.colorLuminance("#"+a+b+c,-.4)},h=function(a,b){a=String(a).replace(/[^0-9a-f]/gi,""),a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=b||0;var c,d,e="#";for(d=0;3>d;d++)c=parseInt(a.substr(2*d,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),e+=("00"+c).substr(c.length);return e},i=function(a){for(var b="",c=0;c<a.length;c++)b=b+'<option value="'+a[c].id+'">'+a[c][1][1]+"</option>";return b},j=function(a){return null!=a.match(/\.(jpeg|jpg|gif|png)$/)},k=function(a){return null!=a.match(/^http:\/\/(?:www\.)?youtube.com\/watch\?(?=[^?]*v=\w+)(?:[^\s?]+)?$/)},l=function(a){return JSON.parse(JSON.stringify(a))},m=function(a,b){var c;for(c=0;c<b.length;c+=1)Mapmaker.Utility.isObject(b[c])?(void 0===a[c]&&(a[c]={}),n(a[c],b[c])):Mapmaker.Utility.isArray(b[c])?(void 0===a[c]&&(a[c]=[]),m(a[c],b[c])):void 0===a[c]&&(a[c]=b[c])},n=function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(Mapmaker.Utility.isObject(b[c])?(void 0===a[c]&&(a[c]={}),Mapmaker.Utility.extendIf(a[c],b[c])):Mapmaker.Utility.isArray(b[c])?(void 0===a[c]&&(a[c]=[]),Mapmaker.Utility.isArray(a[c])&&m(a[c],b[c])):void 0===a[c]&&(a[c]=b[c]))},o=function(a){return"isArray"in Array?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)},p=function(a){return"object"==typeof a&&null!==a&&!Mapmaker.Utility.isArray(a)};return{clone:l,extendIf:n,extendArrayIf:m,isArray:o,isObject:p,splitLine:a,nowDateFormatted:b,decodeEntities:c,getDistance:d,coordsToPixels:e,pixelsToCoords:f,getPastelColor:g,colorLuminance:h,generateOptionsList:i,checkURLisImage:j,checkURLisYoutubeVideo:k}}(),Mapmaker.Mixins=function(){var a={};return a.Visibility={toggle:function(){this.isOpen?this.hide():this.show()},show:function(){this.$el.fadeIn("fast"),this.isOpen=!0},hide:function(){this.$el.fadeOut("fast"),this.isOpen=!1},isOpen:!0},a}(),"undefined"==typeof Mapmaker&&(Mapmaker={}),Mapmaker.MapInfoBoxView=function(a){var b=function(){this.events={dblclick:"open","click .icon.doc":"select","contextmenu .icon.doc":"showMenu","click .mapCountIcon":"toggle","click .title":"hide","mouseover .title .date":"showTooltip"},this.className="mapInfoBoxView";var a=document.getElementById("mapInfoBoxTemplate").innerHTML;this.template=Hogan.compile(a)};return _.extend(b.prototype,Mapmaker.Mixins.Visibility),b.prototype.initialize=function(a){_.extend(this,_.pick(a,"mapView")),this.mapView.$parent.append(this.render().el)},b.prototype.render=function(){return this.$el.html(this.template.render(this.model.attributes)),this},Backbone.View.extend(new b)}(jQuery),Mapmaker.MapInfoBoxView.events={},Mapmaker.InfoBox={isOpen:!1,changing:!1,selectingPermission:!1,changePermissionText:"<div class='tooltips'>As the creator, you can change the permission of this map, but the permissions of the topics and synapses on it must be changed independently.</div>",nameHTML:'<span class="best_in_place best_in_place_name" id="best_in_place_map_{{id}}_name" data-url="/maps/{{id}}" data-object="map" data-attribute="name" data-type="textarea" data-activator="#mapInfoName">{{name}}</span>',descHTML:'<span class="best_in_place best_in_place_desc" id="best_in_place_map_{{id}}_desc" data-url="/maps/{{id}}" data-object="map" data-attribute="desc" data-nil="Click to add description..." data-type="textarea" data-activator="#mapInfoDesc">{{desc}}</span>',init:function(){var a=Mapmaker.Map.InfoBox;$(".mapInfoIcon").click(a.toggleBox),$(".mapInfoBox").click(function(a){a.stopPropagation()}),$("body").click(a.close),a.attachEventListeners(),a.generateBoxHTML=Hogan.compile($("#mapInfoBoxTemplate").html())},toggleBox:function(a){var b=Mapmaker.Map.InfoBox;b.isOpen?b.close():b.open(),a.stopPropagation()},open:function(){var a=Mapmaker.Map.InfoBox;$(".mapInfoIcon div").addClass("hide"),a.isOpen||a.changing||(a.changing=!0,$(".mapInfoBox").fadeIn(200,function(){a.changing=!1,a.isOpen=!0}))},close:function(){var a=Mapmaker.Map.InfoBox;$(".mapInfoIcon div").removeClass("hide"),a.changing||(a.changing=!0,$(".mapInfoBox").fadeOut(200,function(){a.changing=!1,a.isOpen=!1,a.hidePermissionSelect(),$(".mapContributors .tip").hide()}))},load:function(){var a=Mapmaker.Map.InfoBox,b=Mapmaker.Active.Map,c=b.pick("permission","contributor_count","topic_count","synapse_count","created_at","updated_at"),d=b.authorizePermissionChange(Mapmaker.Active.Mapper),e=b.authorizeToEdit(Mapmaker.Active.Mapper),f="private"!==b.get("permission");c.name=e?Hogan.compile(a.nameHTML).render({id:b.id,name:b.get("name")}):b.get("name"),c.desc=e?Hogan.compile(a.descHTML).render({id:b.id,desc:b.get("desc")}):b.get("desc"),c.map_creator_tip=d?a.changePermissionText:"",c.contributors_class=Mapmaker.Mappers.length>1?"multiple":"",c.contributors_class+=2===Mapmaker.Mappers.length?" mTwo":"",c.contributor_image=Mapmaker.Mappers.length>0?Mapmaker.Mappers.models[0].get("image"):"/assets/user.png",c.contributor_list=a.createContributorList(),c.user_name=d?"You":b.get("user_name");var g=d?"yourMap":"";g+=e?" canEdit":"",g+=f?" shareable":"",$(".mapInfoBox").removeClass("shareable yourMap canEdit").addClass(g).html(a.generateBoxHTML.render(c)),a.attachEventListeners()},attachEventListeners:function(){var a=Mapmaker.Map.InfoBox;$(".mapInfoBox.canEdit .best_in_place").best_in_place();var b=$(".mapInfoBox .best_in_place_name");b.unbind("best_in_place:activate").bind("best_in_place:activate",function(){var a=b.find("textarea"),c=a[0];a.attr("maxlength","140"),$(".mapInfoName").append('<div class="nameCounter forMap"></div>');var d=function(a){$(".nameCounter.forMap").html(a.all+"/140")};Countable.live(c,d)}),b.unbind("best_in_place:deactivate").bind("best_in_place:deactivate",function(){$(".nameCounter.forMap").remove()}),$(".mapInfoName .best_in_place_name").unbind("ajax:success").bind("ajax:success",function(){var a=$(this).html();Mapmaker.Active.Map.set("name",a),Mapmaker.Active.Map.trigger("saved")}),$(".mapInfoDesc .best_in_place_desc").unbind("ajax:success").bind("ajax:success",function(){var a=$(this).html();Mapmaker.Active.Map.set("desc",a),Mapmaker.Active.Map.trigger("saved")}),$(".yourMap .mapPermission").unbind().click(a.onPermissionClick),$(".mapInfoBox.yourMap").unbind(".yourMap").bind("click.yourMap",a.hidePermissionSelect),$(".yourMap .mapInfoDelete").unbind().click(a.deleteActiveMap),$(".mapContributors span, #mapContribs").unbind().click(function(a){$(".mapContributors .tip").toggle(),a.stopPropagation()}),$(".mapContributors .tip").unbind().click(function(a){a.stopPropagation()}),$(".mapContributors .tip li a").click(Mapmaker.Router.intercept),$(".mapInfoBox").unbind(".hideTip").bind("click.hideTip",function(){$(".mapContributors .tip").hide()})},updateNameDescPerm:function(a,b,c){$(".mapInfoName .best_in_place_name").html(a),$(".mapInfoDesc .best_in_place_desc").html(b),$(".mapInfoBox .mapPermission").removeClass("commons public private").addClass(c)},createContributorList:function(){var a=(Mapmaker.Map.InfoBox,"");return console.log("hello!!"),a+="<ul>",Mapmaker.Mappers.each(function(b){a+='<li><a href="/explore/mapper/'+b.get("id")+'"><img class="rtUserImage" width="25" height="25" src="'+b.get("image")+'" />'+b.get("name")+"</a></li>"}),a+="</ul>",console.log(a),a},updateNumbers:function(){var a=Mapmaker.Map.InfoBox,b=(Mapmaker.Active.Mapper,"");2===Mapmaker.Mappers.length?b="multiple mTwo":Mapmaker.Mappers.length>2&&(b="multiple");var c="/assets/user.png";Mapmaker.Mappers.length>0&&(c=Mapmaker.Mappers.models[0].get("image")),$(".mapContributors img").attr("src",c).removeClass("multiple mTwo").addClass(b),$(".mapContributors span").text(Mapmaker.Mappers.length),$(".mapContributors .tip").html(a.createContributorList()),$(".mapTopics").text(Mapmaker.Topics.length),$(".mapSynapses").text(Mapmaker.Synapses.length),$(".mapEditedAt").html("<span>Last edited: </span>"+Mapmaker.Util.nowDateFormatted())},onPermissionClick:function(a){var b=Mapmaker.Map.InfoBox;b.selectingPermission||(b.selectingPermission=!0,$(this).addClass("minimize"),$(this).hasClass("commons")?$(this).append('<ul class="permissionSelect"><li class="public"></li><li class="private"></li></ul>'):$(this).hasClass("public")?$(this).append('<ul class="permissionSelect"><li class="commons"></li><li class="private"></li></ul>'):$(this).hasClass("private")&&$(this).append('<ul class="permissionSelect"><li class="commons"></li><li class="public"></li></ul>'),$(".mapPermission .permissionSelect li").click(b.selectPermission),a.stopPropagation())},hidePermissionSelect:function(){var a=Mapmaker.Map.InfoBox;a.selectingPermission=!1,$(".mapPermission").removeClass("minimize"),$(".mapPermission .permissionSelect").remove()},selectPermission:function(a){var b=Mapmaker.Map.InfoBox;b.selectingPermission=!1;var c=$(this).attr("class"),d=Mapmaker.Active.Map.get("permission");Mapmaker.Active.Map.save({permission:c}),Mapmaker.Active.Map.updateMapWrapper(),"commons"!==d&&"commons"===c?(Mapmaker.Realtime.setupSocket(),Mapmaker.Realtime.turnOn()):"commons"===d&&"public"===c&&Mapmaker.Realtime.turnOff(!0),shareable="private"===c?"":"shareable",$(".mapPermission").removeClass("commons public private minimize").addClass(c),$(".mapPermission .permissionSelect").remove(),$(".mapInfoBox").removeClass("shareable").addClass(shareable),a.stopPropagation()},deleteActiveMap:function(){var a="Are you sure you want to delete this map? ";a+="This action is irreversible. It will not delete the topics and synapses on the map.";var b=confirm(a),c=Mapmaker.Active.Map,d=Mapmaker.Active.Mapper,e=c.authorizePermissionChange(d);b&&e?(Mapmaker.Map.InfoBox.close(),Mapmaker.Maps.Active.remove(c),Mapmaker.Maps.Featured.remove(c),Mapmaker.Maps.Mine.remove(c),c.destroy(),Mapmaker.Router.home(),Mapmaker.GlobalUI.notifyUser("Map eliminated!")):e||alert("Hey now. We can't just go around willy nilly deleting other people's maps now can we? Run off and find something constructive to do, eh?")}},Mapmaker.MetacodeSetSwitchView=function(a){var b=function(){this.events={dblclick:"open","click .icon.doc":"select","contextmenu .icon.doc":"showMenu","click .mapCountIcon":"toggle","click .title":"hide","mouseover .title .date":"showTooltip"},this.className="metacodeSetSwitchView";var a=document.getElementById("metacodeSetSwitchTemplate").innerHTML;this.template=Hogan.compile(a)};return _.extend(b.prototype,Mapmaker.Mixins.Visibility),b.prototype.initialize=function(a){_.extend(this,_.pick(a,"mapView")),this.mapView.$parent.append(this.render().el)},b.prototype.render=function(){return this.$el.html(),this},Backbone.View.extend(new b)}(jQuery),Mapmaker.MetacodeSetSwitchView.events={"switch":"Mapmaker:MetacodeSetSwitchView:switch"},Mapmaker.FilterView=function(a){var b=function(){this.events={dblclick:"open","click .icon.doc":"select","contextmenu .icon.doc":"showMenu","click .mapCountIcon":"toggle","click .title":"hide","mouseover .title .date":"showTooltip"},this.className="filterView";var a=document.getElementById("filterTemplate").innerHTML;this.template=Hogan.compile(a)};return _.extend(b.prototype,Mapmaker.Mixins.Visibility),b.prototype.initialize=function(a){_.extend(this,_.pick(a,"mapView")),this.mapView.$parent.append(this.render().el)},b.prototype.render=function(){return this.$el.html(),this},Backbone.View.extend(new b)}(jQuery),Mapmaker.FilterView.events={change:"Mapmaker:FilterView:change"},Mapmaker.Filter={filters:{name:"",metacodes:[],mappers:[],synapses:[]},visible:{metacodes:[],mappers:[],synapses:[]},isOpen:!1,changing:!1,init:function(){var a=Mapmaker.Filter;$(".sidebarFilterIcon").click(a.toggleBox),$(".sidebarFilterBox .showAllMetacodes").click(a.filterNoMetacodes),$(".sidebarFilterBox .showAllSynapses").click(a.filterNoSynapses),$(".sidebarFilterBox .showAllMappers").click(a.filterNoMappers),$(".sidebarFilterBox .hideAllMetacodes").click(a.filterAllMetacodes),$(".sidebarFilterBox .hideAllSynapses").click(a.filterAllSynapses),$(".sidebarFilterBox .hideAllMappers").click(a.filterAllMappers),a.bindLiClicks(),a.getFilterData()},toggleBox:function(a){var b=Mapmaker.Filter;b.isOpen?b.close():b.open(),a.stopPropagation()},open:function(){var a=Mapmaker.Filter;if(Mapmaker.GlobalUI.Account.close(),Mapmaker.Realtime.close(),$(".sidebarFilterIcon div").addClass("hide"),!a.isOpen&&!a.changing){a.changing=!0;var b=$(document).height()-108;$(".sidebarFilterBox").css("max-height",b+"px").fadeIn(200,function(){a.changing=!1,a.isOpen=!0})}},close:function(){var a=Mapmaker.Filter;$(".sidebarFilterIcon div").removeClass("hide"),a.changing||(a.changing=!0,$(".sidebarFilterBox").fadeOut(200,function(){a.changing=!1,a.isOpen=!1}))},reset:function(){var a=Mapmaker.Filter;a.filters.metacodes=[],a.filters.mappers=[],a.filters.synapses=[],a.visible.metacodes=[],a.visible.mappers=[],a.visible.synapses=[],$("#filter_by_metacode ul").empty(),$("#filter_by_mapper ul").empty(),$("#filter_by_synapse ul").empty(),$(".filterBox .showAll").addClass("active")},getFilterData:function(){var a,b,c,d=Mapmaker.Filter;$("#filter_by_metacode li").each(function(){a=$(this).attr("data-id"),d.filters.metacodes.push(a),d.visible.metacodes.push(a)}),$("#filter_by_mapper li").each(function(){b=$(this).attr("data-id"),d.filters.mappers.push(b),d.visible.mappers.push(b)}),$("#filter_by_synapse li").each(function(){c=$(this).attr("data-id"),d.filters.synapses.push(c),d.visible.synapses.push(c)})},bindLiClicks:function(){var a=Mapmaker.Filter;$("#filter_by_metacode ul li").unbind().click(a.toggleMetacode),$("#filter_by_mapper ul li").unbind().click(a.toggleMapper),$("#filter_by_synapse ul li").unbind().click(a.toggleSynapse)},updateFilters:function(a,b,c,d,e){function f(a,b){return a.childNodes[1].innerHTML.toLowerCase()>b.childNodes[1].innerHTML.toLowerCase()?1:-1}var g=Mapmaker.Filter,h=[],i=[],j=[];"object"==typeof a?(Mapmaker[a[0]].each(function(a){var c=a.get(b)?a.get(b).toString():!1;c&&-1===h.indexOf(c)&&h.push(c)}),Mapmaker[a[1]].each(function(a){var c=a.get(b)?a.get(b).toString():!1;c&&-1===h.indexOf(c)&&h.push(c)})):"string"==typeof a&&Mapmaker[a].each(function(a){var c=a.get(b)?a.get(b).toString():!1;c&&-1===h.indexOf(c)&&h.push(c)}),i=_.difference(g.filters[d],h),j=_.difference(h,g.filters[d]),_.each(i,function(a){$("#filter_by_"+e+' li[data-id="'+a+'"]').fadeOut("fast",function(){$(this).remove()}),index=g.visible[d].indexOf(a),g.visible[d].splice(index,1)});var k,l,m;_.each(j,function(a){k=Mapmaker[c].get(a)||Mapmaker[c].find(function(c){return c.get(b)===a}),l=k.prepareLiForFilter(),m=$(l).hide(),$("li","#filter_by_"+e+" ul").add(m.fadeIn("fast")).sort(f).appendTo("#filter_by_"+e+" ul"),g.visible[d].push(a)}),g.filters[d]=h,g.bindLiClicks()},checkMetacodes:function(){var a=Mapmaker.Filter;a.updateFilters("Topics","metacode_id","Metacodes","metacodes","metacode")},checkMappers:function(){var a=Mapmaker.Filter,b=Mapmaker.Active.Map?!0:!1;b?a.updateFilters("Mappings","user_id","Mappers","mappers","mapper"):a.updateFilters(["Topics","Synapses"],"user_id","Creators","mappers","mapper")},checkSynapses:function(){var a=Mapmaker.Filter;a.updateFilters("Synapses","desc","Synapses","synapses","synapse")},filterAllMetacodes:function(a){var b=Mapmaker.Filter;$("#filter_by_metacode ul li").addClass("toggledOff"),$(".showAllMetacodes").removeClass("active"),$(".hideAllMetacodes").addClass("active"),b.visible.metacodes=[],b.passFilters()},filterNoMetacodes:function(a){var b=Mapmaker.Filter;$("#filter_by_metacode ul li").removeClass("toggledOff"),$(".showAllMetacodes").addClass("active"),$(".hideAllMetacodes").removeClass("active"),b.visible.metacodes=b.filters.metacodes.slice(),b.passFilters()},filterAllMappers:function(a){var b=Mapmaker.Filter;$("#filter_by_mapper ul li").addClass("toggledOff"),$(".showAllMappers").removeClass("active"),$(".hideAllMappers").addClass("active"),b.visible.mappers=[],b.passFilters()},filterNoMappers:function(a){var b=Mapmaker.Filter;$("#filter_by_mapper ul li").removeClass("toggledOff"),$(".showAllMappers").addClass("active"),$(".hideAllMappers").removeClass("active"),b.visible.mappers=b.filters.mappers.slice(),b.passFilters()},filterAllSynapses:function(a){var b=Mapmaker.Filter;$("#filter_by_synapse ul li").addClass("toggledOff"),$(".showAllSynapses").removeClass("active"),$(".hideAllSynapses").addClass("active"),b.visible.synapses=[],b.passFilters()},filterNoSynapses:function(a){var b=Mapmaker.Filter;$("#filter_by_synapse ul li").removeClass("toggledOff"),$(".showAllSynapses").addClass("active"),$(".hideAllSynapses").removeClass("active"),b.visible.synapses=b.filters.synapses.slice(),b.passFilters()},toggleLi:function(a){var b,c=Mapmaker.Filter,d=$(this).attr("data-id");-1==c.visible[a].indexOf(d)?(c.visible[a].push(d),$(this).removeClass("toggledOff")):(b=c.visible[a].indexOf(d),c.visible[a].splice(b,1),$(this).addClass("toggledOff")),c.passFilters()},toggleMetacode:function(){var a=Mapmaker.Filter;a.toggleLi.call(this,"metacodes"),a.visible.metacodes.length===a.filters.metacodes.length?($(".showAllMetacodes").addClass("active"),$(".hideAllMetacodes").removeClass("active")):0===a.visible.metacodes.length?($(".showAllMetacodes").removeClass("active"),$(".hideAllMetacodes").addClass("active")):($(".showAllMetacodes").removeClass("active"),$(".hideAllMetacodes").removeClass("active"))},toggleMapper:function(){var a=Mapmaker.Filter;a.toggleLi.call(this,"mappers"),a.visible.mappers.length===a.filters.mappers.length?($(".showAllMappers").addClass("active"),$(".hideAllMappers").removeClass("active")):0===a.visible.mappers.length?($(".showAllMappers").removeClass("active"),$(".hideAllMappers").addClass("active")):($(".showAllMappers").removeClass("active"),$(".hideAllMappers").removeClass("active"))},toggleSynapse:function(){var a=Mapmaker.Filter;a.toggleLi.call(this,"synapses"),a.visible.synapses.length===a.filters.synapses.length?($(".showAllSynapses").addClass("active"),$(".hideAllSynapses").removeClass("active")):0===a.visible.synapses.length?($(".showAllSynapses").removeClass("active"),$(".hideAllSynapses").addClass("active")):($(".showAllSynapses").removeClass("active"),$(".hideAllSynapses").removeClass("active"))},passFilters:function(){var a,b,c,d,e=Mapmaker.Filter,f=e.visible;Mapmaker.Active.Map?d=!0:Mapmaker.Active.Topic&&(d=!1);var g=d?0:.4;Mapmaker.Topics.each(function(c){var e=c.get("node"),h=c.get("metacode_id").toString();if(a=-1==f.metacodes.indexOf(h)?!1:!0,d){var i=c.getMapping().get("user_id").toString();b=-1==f.mappers.indexOf(i)?!1:!0}else{var i=c.get("user_id").toString();b=-1==f.mappers.indexOf(i)?!1:!0}a&&b?e?e.setData("alpha",1,"end"):console.log(c):e?(Mapmaker.Control.deselectNode(e,!0),e.setData("alpha",g,"end"),e.eachAdjacency(function(a){Mapmaker.Control.deselectEdge(a,!0)})):console.log(c)}),Mapmaker.Synapses.each(function(a){var b=a.get("edge");b.setData("touched",!1)}),Mapmaker.Synapses.each(function(a){var e,h=a.get("edge"),i=a.get("user_id").toString();if(h&&!h.getData("touched")){var j=h.getData("synapses");c=!1;for(var k=0;k<j.length;k++)e=j[k].get("desc"),f.synapses.indexOf(e)>-1&&(c=!0);var l=h.getData("displayIndex")?h.getData("displayIndex"):0,m=j[l];if(e=m.get("desc"),c&&-1==f.synapses.indexOf(e))for(var k=0;k<j.length;k++)if(e=j[k].get("desc"),f.synapses.indexOf(e)>-1){h.setData("displayIndex",k);break}d&&(i=a.getMapping().get("user_id").toString()),b=-1==f.mappers.indexOf(i)?!1:!0;var n=Mapmaker.Settings.colors.synapses.normal;c&&b?(h.setData("alpha",1,"end"),h.setData("color",n,"end")):(Mapmaker.Control.deselectEdge(h,!0),h.setData("alpha",g,"end")),h.setData("touched",!0)}else h||console.log(a)}),Mapmaker.Visualize.mGraph.fx.animate({modes:["node-property:alpha","edge-property:alpha"],duration:200})}},Mapmaker.JuntoView=function(a){var b=function(){this.events={dblclick:"open","click .icon.doc":"select","contextmenu .icon.doc":"showMenu","click .mapCountIcon":"toggle","click .title":"hide","mouseover .title .date":"showTooltip"},this.className="juntoView";var a=document.getElementById("juntoTemplate").innerHTML;this.template=Hogan.compile(a)};return _.extend(b.prototype,Mapmaker.Mixins.Visibility),b.prototype.initialize=function(a){_.extend(this,_.pick(a,"mapView")),this.mapView.$parent.append(this.render().el)},b.prototype.render=function(){return this.$el.html(),this},Backbone.View.extend(new b)}(jQuery),Mapmaker.JuntoView.events={turnOn:"Mapmaker:JuntoView:turnOn",turnOff:"Mapmaker:JuntoView:turnOff"},Mapmaker.NewTopicView=function(a){var b=function(){this.events={"keyup [data-mm-topic-name]":"setName"},this.className="newTopicView";var a=document.getElementById("newTopicTemplate").innerHTML;this.template=Hogan.compile(a)};return _.extend(b.prototype,Mapmaker.Mixins.Visibility),b.prototype.initialize=function(a){_.extend(this,_.pick(a,"mapView")),this.name="",this.newId=1,this.metacode=null,this.x=null,this.y=null},b.prototype.render=function(){return this.$el.html(this.template.render()),this},b.prototype.setName=function(a){this.name=this.$("[data-mm-topic-name]").val()},b.prototype.initializeCarousel=function(a){var b=this,c="";this.$("[data-mm-metacode-title]").empty(),a.each(function(a){c+='<img class="cloudcarousel" width="40" height="40" src="'+a.get("icon")+'" data-id="'+a.id+'" title="'+a.get("name")+'" alt="'+a.get("name")+'"/>'}),this.$("[data-mm-topic-metacode-image]").empty().append(c).CloudCarousel({titleBox:this.$("[data-mm-metacode-title]"),yRadius:40,xRadius:190,xPos:170,yPos:40,speed:.3,mouseWheel:!0,bringToFront:!0,tabbingEl:this.$el,callback:function(a){b.metacode=a}})},Backbone.View.extend(new b)}(jQuery),Mapmaker.NewTopicView.events={switchSet:"Mapmaker:NewTopicView:switchSet",create:"Mapmaker:NewTopicView:create"},Mapmaker.NewSynapseView=function(a){var b=function(){this.events={dblclick:"open","click .icon.doc":"select","contextmenu .icon.doc":"showMenu","click .mapCountIcon":"toggle","click .title":"hide","mouseover .title .date":"showTooltip"},this.className="newSynapseView";var a=document.getElementById("newSynapseTemplate").innerHTML;this.template=Hogan.compile(a)};return _.extend(b.prototype,Mapmaker.Mixins.Visibility),b.prototype.initialize=function(a){_.extend(this,_.pick(a,"mapView")),this.mapView.$parent.append(this.render().el);
},b.prototype.render=function(){return this.$el.html(),this},Backbone.View.extend(new b)}(jQuery),Mapmaker.NewSynapseView.events={create:"Mapmaker:NewSynapseView:create"},Mapmaker.Metacode=function(){return Backbone.Model.extend({initialize:function(){var a=new Image;a.crossOrigin="Anonymous",a.src=this.get("icon"),this.set("image",a)},prepareLiForFilter:function(){var a="";return a+='<li data-id="'+this.id.toString()+'">',a+='<img src="'+this.get("icon")+'" data-id="'+this.id.toString()+'"',a+=' alt="'+this.get("name")+'" />',a+="<p>"+this.get("name").toLowerCase()+"</p></li>"}})}(),Mapmaker.Mapping=function(){return Backbone.Model.extend({urlRoot:"/mappings",blacklist:["created_at","updated_at","map","topic"],toJSON:function(a){return _.omit(this.attributes,this.blacklist)},initialize:function(){},getMap:function(){return Mapmaker.Map.get(this.get("map_id"))},getTopic:function(){var a=this.get("topic_id"),b=map.get("topics");return b.get(a)},getSynapse:function(){var a=this.get("synapse_id"),b=map.get("synapses");return b.get(a)}})}(),Mapmaker.MappingView=function(a){var b=function(a,b){this.view=a,this.mapping=b};return b.prototype.show=function(){},b.prototype.hide=function(){},b.prototype.destroy=function(){},b}(jQuery),Mapmaker.Topic=function(){return Backbone.Model.extend({urlRoot:"/topics",blacklist:["node","created_at","updated_at","user_name","user_image","map_count","synapse_count"],toJSON:function(a){return _.omit(this.attributes,this.blacklist)},save:function(a,b,c){var d;null===a||"object"==typeof a?(d=a,c=b):(d={})[a]=b;var e=c||{},f=e.success,g=this.get("permission");return e.success=function(a,b,c){f&&f(a,b,c),a.trigger("saved"),"private"===g&&"private"!==a.get("permission")?a.trigger("noLongerPrivate"):"private"!==g&&"private"===a.get("permission")&&a.trigger("nowPrivate")},Backbone.Model.prototype.save.call(this,d,e)},initialize:function(){this.isNew()&&this.set({user_id:null,desc:"",link:"",permission:"commons"}),this.on("nowPrivate",function(){var a={topicid:this.id};$(document).trigger(Mapmaker.JIT.events.removeTopic,[a])}),this.on("noLongerPrivate",function(){var a={mappingid:this.getMapping().id,topicid:this.id};$(document).trigger(Mapmaker.JIT.events.newTopic,[a])})},authorizeToEdit:function(a){return!a||"commons"!==this.get("permission")&&this.get("user_id")!==a.get("id")?!1:!0},authorizePermissionChange:function(a){return a&&this.get("user_id")===a.get("id")?!0:!1},getDate:function(){},getMetacode:function(){return Mapmaker.Metacodes.get(this.get("metacode_id"))},getMapping:function(){return Mapmaker.Active.Map?Mapmaker.Mappings.findWhere({map_id:Mapmaker.Active.Map.id,topic_id:this.isNew()?this.cid:this.id}):!1}})}(),"undefined"==typeof Mapmaker&&(Mapmaker={}),Mapmaker.TopicMappingView=function(a,b){var c=b.core.Engine,d=b.core.Surface,e=b.surfaces.ImageSurface,f=b.core.Modifier,g=(b.modifiers.StateModifier,b.core.Transform,b.physics.bodies.Particle),h=(b.physics.forces.Repulsion,{mousedown:function(b){this.mouseIsDown=!0,this.hasMoved=!1,this.topicParticle.sleep(),a(document).trigger(Mapmaker.TopicMappingView.events.mousedown)},mouseup:function(b){this.topicParticle.wake(),i.cancelClick.call(this),a(document).trigger(Mapmaker.TopicMappingView.events.mouseup,[this]);var c=this.lastClick,d=Date.now();this.lastClick=d,d-c<this.view.config.DOUBLE_CLICK_TOLERANCE&&a(document).trigger(Mapmaker.TopicMappingView.events.doubleClick,[this])},mousemove:function(a){var b,c,d=this.mapping;this.mouseIsDown&&(this.hasMoved||(this.hasMoved=!0),b=this.topicParticle.getTransform()[12]+a.movementX,c=this.topicParticle.getTransform()[13]+a.movementY,d.set("xloc",b),d.set("yloc",c),this.topicParticle.setPosition([b,c,0]),this.topicParticle.setVelocity([0,0,0]))}}),i={cancelClick:function(){this.mouseIsDown=!1,this.hasMoved,a(document).trigger(Mapmaker.TopicMappingView.events.dragEnd)},createImageSurface:function(){var a=this,b=this.mapping.getTopic(),c=function(){var c=a.view.metacodes.get(b.get("metacode_id")),d=c.get("icon");a.imageSurface.setContent(d)};b.on("change:metacode_id",c),this.imageSurface=new e({classes:["noselect"],size:[50,50]}),c(),this.modNode.add(this.imageSurface);var d=function(b){b.preventDefault(),h.mousedown.call(a,b)};this.imageSurface.on("mousedown",d);var f=function(b){h.mouseup.call(a,b)};this.imageSurface.on("mouseup",f)},createNameSurface:function(){var a=this,b=this.mapping.getTopic(),c=function(){a.nameSurface.setContent(b.get("name"))};b.on("change:name",c),this.nameSurface=new d({content:b.get("name"),classes:["noselect"],size:[!0,!0],properties:{marginTop:"35px",borderRadius:"5px",backgroundColor:"#FFF"}}),this.modNode.add(this.nameSurface);var e=function(b){h.mousedown.call(a,b)};this.nameSurface.on("mousedown",e);var f=function(b){h.mouseup.call(a,b)};this.nameSurface.on("mouseup",f)},attachPhysics:function(){var a=this,b=this.mapping,c=[b.get("xloc"),b.get("yloc"),0];this.anchorParticle=new g({position:c}),this.view.pe.addBody(this.anchorParticle),this.topicParticle=new g({position:c}),this.view.pe.addBody(this.topicParticle),this.mod=new f({transform:function(){return a.topicParticle.getTransform()}}),this.modNode=this.view.originModNode.add(this.mod)}},j=function(a,b){var d=this;Mapmaker.MappingView.call(this,a,b),this.topic=b.getTopic(),i.attachPhysics.call(this),i.createImageSurface.call(this),i.createNameSurface.call(this);var e=function(a){i.cancelClick.call(d,a)};c.on("mouseup",e);var f=function(a){h.mousemove.call(d,a)};c.on("mousemove",f),this.mouseIsDown=!1,this.lastClick=null,this.hasMoved=!1};return j.prototype=new Mapmaker.MappingView,j.prototype.constructor=j,j}(jQuery,famous),Mapmaker.TopicMappingView.events={mousedown:"Mapmaker:TopicMappingView:mousedown",mouseup:"Mapmaker:TopicMappingView:mouseup",doubleClick:"Mapmaker:TopicMappingView:doubleClick",dragEnd:"Mapmaker:TopicMappingView:dragEnd"},Mapmaker.TopicCardView=function(a){var b={buildObjectForTemplate:function(b){var c,d={},e=!0,f="Click to add description...",g=b.get("inmaps"),h=b.get("inmapsLinks");if(d.attachmentsHidden="",b.get("link")&&""!==b.get("link")?(d.embeds='<a href="'+b.get("link")+'" class="embedlyLink" target="_blank" data-card-chrome="0" data-card-description="0">',d.embeds+=b.get("link"),d.embeds+='</a><div class="embedlyLinkLoader"></div>',d.attachmentsHidden="hidden",d.hasAttachment="hasAttachment"):(d.embeds="",d.hasAttachment=""),e?(d.attachments='<div class="addLink"><div class="addLinkIcon"></div>',d.attachments+='<div class="addLinkInput"><input placeholder="Enter or paste a link"></input>',d.attachments+='<div class="addLinkReset"></div></div></div>'):(d.attachmentsHidden="hidden",d.attachments=""),d.inmaps="",g.length<6)for(i=0;i<g.length;i++)c="/maps/"+h[i],d.inmaps+='<li><a href="'+c+'">'+g[i]+"</a></li>";else{for(i=0;i<5;i++){var c="/maps/"+h[i];d.inmaps+='<li><a href="'+c+'">'+g[i]+"</a></li>"}for(extra=g.length-5,d.inmaps+='<li><span class="showMore">See '+extra+" more...</span></li>",i=5;i<g.length;i++)c="/maps/"+h[i],d.inmaps+='<li class="hideExtra extraText"><a href="'+c+'">'+g[i]+"</a></li>"}return d.permission=b.get("permission"),d.mk_permission=b.get("permission").substring(0,2),d.map_count=b.get("map_count").toString(),d.synapse_count=b.get("synapse_count").toString(),d.id=b.isNew()?b.cid:b.id,d.metacode="Action",d.metacode_class="mbg"+b.get("metacode_id"),d.imgsrc="/img/bp_action.png",d.name=b.get("name"),d.userid=b.get("user_id"),d.username=b.get("user_name"),d.date=b.getDate(),d.metacode_select=a("#metacodeOptions").html(),d.desc_nil=f,d.desc=""==b.get("desc")&&e?f:b.get("desc"),d},validateLink:function(a){return!0}},c={metacodeLiClick:function(){},onLinkKeyup:function(a){var b="";13===a.which&&(b=this.$(".addLinkInput input").val(),"http"!==b.slice(0,4)&&(b="http://"+b),this.model.set("link",b))},linkChange:function(){var a=this.model.get("link");b.validateLink(a)?""!==a&&a?c.addLink.call(this):c.removeLink.call(this):c.invalidLink.call(this)},invalidLink:function(){a(document).trigger(Mapmaker.TopicCardView.events.invalidLink),c.removeLink.call(this)},removeLink:function(){this.$(".embeds").empty().removeClass("nonEmbedlyLink"),this.$(".addLinkInput input").val(""),this.$(".attachments").show(),this.$(".CardOnGraph").removeClass("hasAttachment")},addLink:function(){var b=this.$(".addLinkInput input").val(),d=a("<a/>",{"class":"embedlyLink","data-card-chrome":"0","data-card-description":"0",href:b}).html(b);this.$(".attachments").hide(),this.$(".embeds").append(d),c.embedify.call(this)},embedify:function(){embedly("card",this.$(".embedlyLink")[0])},embedlyCardRendered:function(a){this.$(".embedlyLink")[0]&&(this.$(".embedlyLink").css("display","block").fadeIn("fast"),this.$(".embeds").addClass("nonEmbedlyLink")),this.$(".CardOnGraph").addClass("hasAttachment"),this.$(".embeds").append('<div class="linkremove"></div>')}},d=function(){this.events={"mouseenter .metacodeImage":"showMetacodeTitle","mouseleave .linkItem.icon":"hideMetacodeTitle","keyup .addLinkInput input":c.onLinkKeyup,"click .addLinkReset":"resetLinkInput","click .linkremove":"removeLink"},this.className="topicCardView";var a=document.getElementById("topicCardTemplate").innerHTML;this.template=Hogan.compile(a)};return _.extend(d.prototype,Mapmaker.Mixins.Visibility),d.prototype.initialize=function(a){_.extend(this,_.pick(a,"mapView")),this.selectingMetacode=!1,this.mapView.$parent.append(this.render().el)},d.prototype.render=function(){var a=b.buildObjectForTemplate(this.model),d=this.model.get("link");return this.$el.html(this.template.render(a)),embedly("on","card.rendered",c.embedlyCardRendered.bind(this)),d&&""!==d&&c.embedify.call(this),this.model.on("change:link",c.linkChange.bind(this)),this},d.prototype.removeLink=function(){this.model.set("link",null)},d.prototype.showMetacodeTitle=function(){this.$(".icon").css("z-index","4"),this.$(".metacodeTitle").show()},d.prototype.hideMetacodeTitle=function(){this.selectingMetacode||(this.$(".metacodeTitle").hide(),this.$(".icon").css("z-index","1"))},d.prototype.resetLinkInput=function(){this.$(".addLinkInput input").val(""),this.$(".addLinkInput input").focus()},Backbone.View.extend(new d)}(jQuery),Mapmaker.TopicCardView.events={invalidLink:"Mapmaker:TopicCardView:invalidLink"},Mapmaker.TopicCard={bindShowCardListeners:function(a){var b=Mapmaker.TopicCard,c=document.getElementById("showcard"),d=b.authorizedToEdit,e=function(a){$(".contributorIcon").attr("src",a.get("image"))};Mapmaker.Mapper.get(a.get("user_id"),e);var f=function(a){var b,c,d,e,f,g,h,i=300,j=404,k=270;selectingMetacode||(selectingMetacode=!0,b=$(window).width(),c=parseInt($(".showcard").css("left")),d=b-(c+i),j>d&&$(".metacodeSelect").addClass("onRightEdge"),e=$(window).height(),f=parseInt($(".showcard").css("top")),g=$(".showcard .title").height()+parseInt($(".showcard .title").css("padding-top"))+parseInt($(".showcard .title").css("padding-bottom")),heightOfSetList=$(".showcard .metacodeSelect").height(),h=e-(f+g),k>h&&$(".metacodeSelect").addClass("onBottomEdge"),$(".metacodeSelect").show(),a.stopPropagation())},g=function(){selectingMetacode=!1,$(".metacodeSelect").hide().removeClass("onRightEdge onBottomEdge"),$(".metacodeTitle").hide(),$(".showcard .icon").css("z-index","1")};if(d){$(".showcard .metacodeTitle").click(f),$(".showcard").click(g),$(".metacodeSelect > ul > li").click(function(a){a.stopPropagation()}),$(".metacodeSelect li li").click(metacodeLiClick);var h=$(c).find(".best_in_place_name");h.bind("best_in_place:activate",function(){var a=h.find("textarea"),b=a[0];a.attr("maxlength","140"),$(".showcard .title").append('<div class="nameCounter forTopic"></div>');var c=function(a){$(".nameCounter.forTopic").html(a.all+"/140")};Countable.live(b,c)}),h.bind("best_in_place:deactivate",function(){$(".nameCounter.forTopic").remove()}),h.bind("ajax:success",function(){var b=Mapmaker.Util.decodeEntities($(this).html());a.set("name",b),a.trigger("saved")}),$(c).find(".best_in_place_desc").bind("ajax:success",function(){this.innerHTML=this.innerHTML.replace(/\r/g,"");var b=$(this).html()===$(this).data("nil")?"":$(this).html();a.set("desc",b),a.trigger("saved")})}var i=function(b){l=!1;var c=$(this).attr("class");a.save({permission:c}),$(".showcard .mapPerm").removeClass("co pu pr minimize").addClass(c.substring(0,2)),$(".showcard .permissionSelect").remove(),b.stopPropagation()},j=function(a){l||(l=!0,$(this).addClass("minimize"),$(this).hasClass("co")?$(this).append('<ul class="permissionSelect"><li class="public"></li><li class="private"></li></ul>'):$(this).hasClass("pu")?$(this).append('<ul class="permissionSelect"><li class="commons"></li><li class="private"></li></ul>'):$(this).hasClass("pr")&&$(this).append('<ul class="permissionSelect"><li class="commons"></li><li class="public"></li></ul>'),$(".showcard .permissionSelect li").click(i),a.stopPropagation())},k=function(){l=!1,$(".showcard .yourTopic .mapPerm").removeClass("minimize"),$(".showcard .permissionSelect").remove()},l=!1;a.authorizePermissionChange(Mapmaker.Active.Mapper)&&($(".showcard .yourTopic .mapPerm").click(j),$(".showcard").click(k)),$(".links .mapCount").unbind().click(function(a){$(".mapCount .tip").toggle(),$(".showcard .hoverTip").toggleClass("hide"),a.stopPropagation()}),$(".mapCount .tip").unbind().click(function(a){a.stopPropagation()}),$(".showcard").unbind(".hideTip").bind("click.hideTip",function(){$(".mapCount .tip").hide(),$(".showcard .hoverTip").removeClass("hide")}),$(".mapCount .tip li a").click(Mapmaker.Router.intercept);var m=$(".showMore").html();$(".mapCount .tip .showMore").unbind().toggle(function(a){$(".extraText").toggleClass("hideExtra"),$(".showMore").html("Show less...")},function(a){$(".extraText").toggleClass("hideExtra"),$(".showMore").html(m)}),$(".mapCount .tip showMore").unbind().click(function(a){a.stopPropagation()})},populateShowCard:function(a){var b=Mapmaker.TopicCard,c=document.getElementById("showcard");$(c).find(".permission").remove();var d=b.buildObject(a),e=b.generateShowcardHTML.render(d);if(a.authorizeToEdit(Mapmaker.Active.Mapper)){var f=document.createElement("div"),g="permission canEdit";a.authorizePermissionChange(Mapmaker.Active.Mapper)&&(g+=" yourTopic"),f.className=g,f.innerHTML=e,c.appendChild(f)}else{var f=document.createElement("div");f.className="permission cannotEdit",f.innerHTML=e,c.appendChild(f)}Mapmaker.TopicCard.bindShowCardListeners(a)}},Mapmaker.Synapse=function(){return Backbone.Model.extend({urlRoot:"/synapses",blacklist:["edge","created_at","updated_at"],toJSON:function(a){return _.omit(this.attributes,this.blacklist)},save:function(a,b,c){var d;null===a||"object"==typeof a?(d=a,c=b):(d={})[a]=b;var e=c||{},f=e.success,g=this.get("permission");return e.success=function(a,b,c){f&&f(a,b,c),a.trigger("saved"),"private"===g&&"private"!==a.get("permission")?a.trigger("noLongerPrivate"):"private"!==g&&"private"===a.get("permission")&&a.trigger("nowPrivate")},Backbone.Model.prototype.save.call(this,d,e)},initialize:function(){this.isNew()&&this.set({user_id:null,permission:"commons",category:"from-to"}),this.on("noLongerPrivate",function(){var a={mappingid:this.getMapping().id,synapseid:this.id};$(document).trigger(Mapmaker.JIT.events.newSynapse,[a])}),this.on("nowPrivate",function(){$(document).trigger(Mapmaker.JIT.events.removeSynapse,[{synapseid:this.id}])})},prepareLiForFilter:function(){var a="";return a+='<li data-id="'+this.get("desc")+'">',a+='<img src="/assets/synapse16.png"',a+=' alt="synapse icon" />',a+="<p>"+this.get("desc")+"</p></li>"},authorizeToEdit:function(a){return!a||"commons"!==this.get("permission")&&this.get("user_id")!==a.get("id")?!1:!0},authorizePermissionChange:function(a){return a&&this.get("user_id")===a.get("id")?!0:!1},getTopicMapping1:function(){var a=this.get("node1_id"),b=map.get("topicMappings");return b.findWhere({topic_id:a})},getTopicMapping2:function(){var a=this.get("node2_id"),b=map.get("topicMappings");return b.findWhere({topic_id:a})},getTopic1:function(){var a=this.get("node1_id"),b=map.get("topics");return b.get(a)},getTopic2:function(){var a=this.get("node2_id"),b=map.get("topics");return b.get(a)},getDirection:function(){return[this.getTopic1().get("node").id,this.getTopic2().get("node").id]},getMapping:function(){return Mapmaker.Active.Map?Mapmaker.Mappings.findWhere({map_id:Mapmaker.Active.Map.id,synapse_id:this.isNew()?this.cid:this.id}):!1}})}(),Mapmaker.SynapseMappingView=function(a,b){var c=b.core.Engine,d=b.core.Surface,e=(b.core.Modifier,b.modifiers.StateModifier),f=b.core.Transform,g=b.physics.forces.Spring,h={mousedown:function(b){this.mouseIsDown=!0,a(document).trigger(Mapmaker.SynapseMappingView.events.mousedown)},mouseup:function(b){this.mouseIsDown=!1,a(document).trigger(Mapmaker.SynapseMappingView.events.mouseup)}},i={calculateLength:function(a,b){var c=Math.pow(a[0]-b[0],2),d=Math.pow(a[1]-b[1],2);this.length=Math.sqrt(c+d)},cancelClick:function(){this.mouseIsDown=!1,a(document).trigger(Mapmaker.SynapseMappingView.events.mouseup)},createLineSurface:function(){var a=this;this.lineSurface=new d({content:"",classes:["noselect"],size:[1,1],properties:{backgroundColor:"#000"}}),this.modNode.add(this.lineSurface);var b=function(b){h.mousedown.call(a,b)};this.lineSurface.on("mousedown",b);var c=function(b){h.mouseup.call(a,b)};this.lineSurface.on("mouseup",c)},addSpring:function(){new g({period:5e3,dampingRatio:.9,length:5}),this.view.topics[this.topicMapping1.cid],this.view.topics[this.topicMapping2.cid]}},j=function(a,b){var d=this;Mapmaker.MappingView.call(this,a,b),this.synapse=b.getSynapse(),this.topicMapping1=this.synapse.getTopicMapping1(),this.topicMapping2=this.synapse.getTopicMapping2(),this.topicMapping1.on("change:xloc, change:yloc",function(){d.updateDisplay.call(d)}),this.topicMapping2.on("change:xloc, change:yloc",function(){d.updateDisplay.call(d)}),this.length=0,this.mod=new e({transform:f.translate(0,0,0)}),this.modNode=a.originModNode.add(this.mod),i.createLineSurface.call(this),i.addSpring.call(this);var g=function(a){i.cancelClick.call(d)};c.on("mouseup",g),this.mouseIsDown=!1,d.updateDisplay.call(this)};return j.prototype=new Mapmaker.MappingView,j.prototype.constructor=j,j.prototype.updateDisplay=function(){var a=this.view.topics[this.topicMapping1.cid],b=this.view.topics[this.topicMapping2.cid];if(a||b){var c=a.topicParticle.getTransform(),d=b.topicParticle.getTransform(),e=[c[12],c[13]],g=[d[12],d[13]];i.calculateLength.call(this,e,g),this.lineSurface.setSize([this.length,1]);var h=e[0]-g[0],j=e[1]-g[1],k=Math.atan2(j,h),l=f.rotateZ(k),m=e[0]+(g[0]-e[0])/2,n=e[1]+(g[1]-e[1])/2,o=f.translate(m,n,0),p=f.multiply(o,l);this.mod.setTransform(p)}},j}(jQuery,famous),Mapmaker.SynapseMappingView.events={mousedown:"Mapmaker:SynapseMappingView:mousedown",mouseup:"Mapmaker:SynapseMappingView:mouseup"},Mapmaker.SynapseCardView=function(a){var b=function(){this.events={dblclick:"open","click .icon.doc":"select","contextmenu .icon.doc":"showMenu","click .mapCountIcon":"toggle","click .title":"hide","mouseover .title .date":"showTooltip"},this.className="synapseCardView";var a=document.getElementById("synapseCardTemplate").innerHTML;this.template=Hogan.compile(a)};return _.extend(b.prototype,Mapmaker.Mixins.Visibility),b.prototype.initialize=function(a){_.extend(this,_.pick(a,"mapView")),this.mapView.$parent.append(this.render().el)},b.prototype.render=function(){return this.$el.html(this.template.render(this.model.attributes)),this},Backbone.View.extend(new b)}(jQuery),Mapmaker.SynapseCardView.events={},Mapmaker.SynapseCard={openSynapseCard:null,showCard:function(a,b){var c=Mapmaker.SynapseCard,d=$("#edit_synapse").css("left"),e=$("#edit_synapse").css("top");$("#edit_synapse").remove(),Mapmaker.Control.deselectEdge(a);var f=a.getData("displayIndex")?a.getData("displayIndex"):0,g=a.getData("synapses")[f],h=document.createElement("div");h.innerHTML='<div id="editSynUpperBar"></div><div id="editSynLowerBar"></div>',h.setAttribute("id","edit_synapse"),g.authorizeToEdit(Mapmaker.Active.Mapper)?(h.className="permission canEdit",h.className+=g.authorizePermissionChange(Mapmaker.Active.Mapper)?" yourEdge":""):h.className="permission cannotEdit",$("#wrapper").append(h),c.populateShowCard(a,g),$("#edit_synapse").css("position","absolute"),b?($("#edit_synapse").css("left",b.clientX),$("#edit_synapse").css("top",b.clientY)):($("#edit_synapse").css("left",d),$("#edit_synapse").css("top",e)),$("#edit_synapse").show(),c.openSynapseCard=a},hideCard:function(){$("#edit_synapse").remove(),Mapmaker.SynapseCard.openSynapseCard=null},populateShowCard:function(a,b){var c=Mapmaker.SynapseCard;c.add_synapse_count(a),c.add_desc_form(b),c.add_drop_down(a,b),c.add_user_info(b),c.add_perms_form(b),c.add_direction_form(b)},add_synapse_count:function(a){var b=a.getData("synapses").length;$("#editSynUpperBar").append('<div id="synapseCardCount">'+b+"</div>")},add_desc_form:function(a){var b="Click to add description.";$("#editSynUpperBar").append('<div id="edit_synapse_desc"></div>'),$("#edit_synapse_desc").attr("class","best_in_place best_in_place_desc"),$("#edit_synapse_desc").attr("data-object","synapse"),$("#edit_synapse_desc").attr("data-attribute","desc"),$("#edit_synapse_desc").attr("data-type","textarea"),$("#edit_synapse_desc").attr("data-nil",b),$("#edit_synapse_desc").attr("data-url","/synapses/"+a.id),$("#edit_synapse_desc").html(a.get("desc")),""==$("#edit_synapse_desc").html().trim()&&(a.authorizeToEdit(Mapmaker.Active.Mapper)?$("#edit_synapse_desc").html(b):$("#edit_synapse_desc").html("(no description)")),$("#edit_synapse_desc").bind("ajax:success",function(){var c=$(this).html();c==b?a.set("desc",""):a.set("desc",c),a.trigger("saved"),Mapmaker.Control.selectEdge(a.get("edge")),Mapmaker.Visualize.mGraph.plot()})},add_drop_down:function(a,b){var c,d,e,f,g;if(e=a.getData("synapses"),f=e.length,f>1){for($("#editSynUpperBar").append('<div id="dropdownSynapses"></div>'),$("#dropdownSynapses").click(function(a){a.preventDefault(),a.stopPropagation(),$("#switchSynapseList").toggle()}),$("#edit_synapse").click(function(){$("#switchSynapseList").hide()}),c='<ul id="switchSynapseList">',d=0;f>d;d++)e[d]!==b&&(g=e[d].get("desc"),g=""===g||null===g?"(no description)":g,c+='<li data-synapse-index="'+d+'">'+g+"</li>");c+="</ul>",$("#editSynLowerBar").append(c),$("#switchSynapseList li").click(function(b){b.stopPropagation();var c=parseInt($(this).attr("data-synapse-index"));a.setData("displayIndex",c),Mapmaker.Visualize.mGraph.plot(),Mapmaker.SynapseCard.showCard(a,!1)})}},add_user_info:function(a){var b='<div id="edgeUser" class="hoverForTip">';b+='<a href="/explore/mapper/'+a.get("user_id")+'"> <img src="" width="24" height="24" /></a>',b+='<div class="tip">'+a.get("user_name")+"</div></div>",$("#editSynLowerBar").append(b);var c=function(a){$("#edgeUser img").attr("src",a.get("image"))};Mapmaker.Mapper.get(a.get("user_id"),c)},add_perms_form:function(a){$("#editSynLowerBar").append('<div class="mapPerm '+a.get("permission").substring(0,2)+'"></div>');var b=!1,c=function(c){b=!1;var d=$(this).attr("class");a.save({permission:d}),$("#edit_synapse .mapPerm").removeClass("co pu pr minimize").addClass(d.substring(0,2)),$("#edit_synapse .permissionSelect").remove(),c.stopPropagation()},d=function(a){b||(b=!0,$(this).addClass("minimize"),$(this).hasClass("co")?$(this).append('<ul class="permissionSelect"><li class="public"></li><li class="private"></li></ul>'):$(this).hasClass("pu")?$(this).append('<ul class="permissionSelect"><li class="commons"></li><li class="private"></li></ul>'):$(this).hasClass("pr")&&$(this).append('<ul class="permissionSelect"><li class="commons"></li><li class="public"></li></ul>'),$("#edit_synapse .permissionSelect li").click(c),a.stopPropagation())},e=function(){b=!1,$("#edit_synapse.yourEdge .mapPerm").removeClass("minimize"),$("#edit_synapse .permissionSelect").remove()};a.authorizePermissionChange(Mapmaker.Active.Mapper)&&($("#edit_synapse.yourEdge .mapPerm").click(d),$("#edit_synapse").click(e))},add_direction_form:function(a){$("#editSynLowerBar").append('<div id="edit_synapse_left"></div>'),$("#editSynLowerBar").append('<div id="edit_synapse_right"></div>');var b=a.get("edge");if(b.nodeFrom.pos.x<b.nodeTo.pos.x||b.nodeFrom.pos.x==b.nodeTo.pos.x&&b.nodeFrom.pos.y<b.nodeTo.pos.y)var c=b.nodeTo.getData("topic"),d=b.nodeFrom.getData("topic");else var c=b.nodeFrom.getData("topic"),d=b.nodeTo.getData("topic");var e=a.get("category");if("from-to"==e){var f=[a.get("node1_id"),a.get("node2_id")];f[0]==c.id?$("#edit_synapse_left").addClass("checked"):$("#edit_synapse_right").addClass("checked")}else"both"==e&&($("#edit_synapse_left").addClass("checked"),$("#edit_synapse_right").addClass("checked"));a.authorizeToEdit(Mapmaker.Active.Mapper)&&$("#edit_synapse_left, #edit_synapse_right").click(function(){$(this).toggleClass("checked");var b=$("#edit_synapse_left").is(".checked"),e=$("#edit_synapse_right").is(".checked"),f=a.getDirection(),g="none";b&&e?g="both":!b&&e?(g="from-to",f=[d.id,c.id]):b&&!e&&(g="from-to",f=[c.id,d.id]),a.save({category:g,node1_id:f[0],node2_id:f[1]}),Mapmaker.Visualize.mGraph.plot()})}},"undefined"==typeof Mapmaker&&(Mapmaker={}),Mapmaker.VideoView=function(a){var b={cancelClick:function(){this.mouseIsDown=!1,this.hasMoved,a(document).trigger(Mapmaker.VideoView.events.dragEnd)}},c={mousedown:function(b){this.mouseIsDown=!0,this.hasMoved=!1,this.mouseDownOffset={x:b.offsetX,y:b.offsetY},a(document).trigger(Mapmaker.VideoView.events.mousedown)},mouseup:function(b){a(document).trigger(Mapmaker.VideoView.events.mouseup,[this]);var c=this.lastClick,d=Date.now();this.lastClick=d,d-c<this.view.config.DOUBLE_CLICK_TOLERANCE&&a(document).trigger(Mapmaker.VideoView.events.doubleClick,[this])},mousemove:function(a){var b=this.view.$parent.offset();this.mouseIsDown&&(this.hasMoved||(this.hasMoved=!0),this.$container.css({top:a.pageY-b.top-this.mouseDownOffset.y,left:a.pageX-b.left-this.mouseDownOffset.x}))},audioControlClick:function(){this.audioStatus?this.$audioControl.css({"text-decoration":"line-through"}):this.$audioControl.css({"text-decoration":"none"}),this.audioStatus=!this.audioStatus},videoControlClick:function(){this.videoStatus?this.$videoControl.css({"text-decoration":"line-through"}):this.$videoControl.css({"text-decoration":"none"}),this.videoStatus=!this.videoStatus}},d=function(d,e,f,g){var h=this;this.view=e,this.video=d,this.id=f,this.mouseIsDown=!1,this.mouseDownOffset={x:0,y:0},this.lastClick=null,this.hasMoved=!1,this.audioStatus=!0,this.videoStatus=!0,this.$container=a("<div></div>"),this.$container.addClass("collaborator-video"+(g?" my-video":"")),this.$container.attr("id","container_"+f),this.$container.append(this.video),this.$container.on("mousedown",function(a){c.mousedown.call(h,a)}),this.view.$parent.on("mouseup.video"+this.id,function(a){c.mouseup.call(h,a),b.cancelClick.call(h)}),this.view.$parent.on("mousemove.video"+this.id,function(a){c.mousemove.call(h,a)}),this.$audioControl=a('<div class="video-audio">a</div>'),this.$videoControl=a('<div class="video-video">v</div>'),this.$audioControl.on("click",function(){c.audioControlClick.call(h)}),this.$videoControl.on("click",function(){c.videoControlClick.call(h)}),this.$container.append(this.$audioControl),this.$container.append(this.$videoControl),this.video.oncontextmenu=function(){return!1}};return d.prototype.remove=function(){this.$container.off(),this.view.$parent.off(".video"+this.id),this.$container.remove()},d}(jQuery),Mapmaker.VideoView.events={mousedown:"Mapmaker:VideoView:mousedown",mouseup:"Mapmaker:VideoView:mouseup",doubleClick:"Mapmaker:VideoView:doubleClick",dragEnd:"Mapmaker:VideoView:dragEnd"},"undefined"==typeof Mapmaker&&(Mapmaker={}),Mapmaker.ChatView=function(a){var b={addMessage:function(a){var b=_.clone(a.attributes);b.timestamp=new Date(b.timestamp),b.timestamp=b.timestamp.getDate()+"/"+(b.timestamp.getMonth()+1);var c=this.messageTemplate.render(b);this.$messages.append(c)},initialMessages:function(){for(var a=this.messages.models,c=0;c<a.length;c++)b.addMessage.call(this,a[c])},handleInputMessage:function(){var b={message:this.$messageInput.val(),timestamp:Date.now(),user:this.mapper.get("name")};this.add(b),this.$messageInput.val(""),a(document).trigger(Mapmaker.ChatView.events.message,[b])}},c={buttonClick:function(){this.isOpen?this.close():this.open(),this.isOpen=!this.isOpen},keyUp:function(a){switch(a.which){case 13:b.handleInputMessage.call(this)}}},d=function(d,e,f){var g=this;this.view=d,this.mapper=f,this.messages=e,this.messages.on("add",function(a){b.addMessage.call(g,a)}),this.isOpen=!0;var h=document.getElementById("messageTemplate").innerHTML;this.messageTemplate=Hogan.compile(h),this.$button=a('<div class="chat-button"></div>'),this.$messageInput=a('<textarea placeholder="Send a message..." class="chat-input"></textarea>'),this.$messages=a('<div class="chat-messages"></div>'),this.$button.on("click",function(){c.buttonClick.call(g)}),this.$messageInput.on("keyup",function(a){c.keyUp.call(g,a)}),this.$container=a('<div class="chat-box"></div>'),this.$container.append(this.$messageInput),this.$container.append(this.$button),this.$container.append(this.$messages),this.view.$parent.append(this.$container),b.initialMessages.call(this)};return d.prototype.add=function(a){this.messages.add(a)},d.prototype.open=function(){this.$container.css({right:"0"})},d.prototype.close=function(){this.$container.css({right:"-300px"})},d.prototype.remove=function(){this.$button.off(),this.$container.remove()},d}(jQuery),Mapmaker.ChatView.events={message:"Mapmaker:ChatView:message"},Mapmaker.Map=function(){return Backbone.Model.extend({urlRoot:"/maps",blacklist:["created_at","updated_at","user_name","contributor_count","topic_count","synapse_count","topics","synapses","synapseMappings","topicMappings","mappers","messages"],toJSON:function(a){return _.omit(this.attributes,this.blacklist)},save:function(a,b,c){var d;null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b;var e=c||{},f=e.success;return e.success=function(a,b,c){f&&f(a,b,c),a.trigger("saved")},Backbone.Model.prototype.save.call(this,d,e)},initialize:function(){this.on("saved",this.savedEvent)},savedEvent:function(){},authorizeToEdit:function(a){return!a||"commons"!==this.get("permission")&&this.get("user_id")!==a.get("id")?!1:!0},authorizePermissionChange:function(a){return a&&this.get("user_id")===a.get("id")?!0:!1}})}(),Mapmaker.Map.events={mapChanged:"Mapmaker:Map:mapChanged"},"undefined"==typeof Mapmaker&&(Mapmaker={}),Mapmaker.MapView=function(a,b){var c=b.core.Engine,d=b.physics.PhysicsEngine,e=(b.core.Surface,b.modifiers.StateModifier),f=b.core.Transform,g=(b.transitions.Easing,{paths:{metacodes:"/json/metacodes/metacodes.json"},DOUBLE_CLICK_TOLERANCE:300,embed:!1,sandbox:!1,colors:{background:"#344A58",synapses:{normal:"#888888",hover:"#888888",selected:"#FFFFFF"},topics:{selected:"#FFFFFF"},labels:{background:"#18202E",text:"#DDD"}}}),h={addModules:function(){this.Create=new Mapmaker.Create(this),this.Control=new Mapmaker.Control(this),this.Realtime=new Mapmaker.Realtime(this),this.Visualize=new Mapmaker.Visualize(this),this.JIT=new Mapmaker.JIT(this),this.$parent.append(this.Realtime.myVideo.$container)},createViews:function(){this.infoBox=new Mapmaker.MapInfoBoxView({model:this.currentMap,mapView:this}),this.filter=new Mapmaker.FilterView({mapView:this}),this.junto=new Mapmaker.JuntoView({mapView:this}),this.newTopic=new Mapmaker.NewTopicView({mapView:this}),this.$parent.append(this.newTopic.render().el),this.newSynapse=new Mapmaker.NewSynapseView({mapView:this})},createGraphContainer:function(){this.$graphContainer=a(document.createElement("div")),this.$graphContainer.attr("id","graphContainer").css({overflow:"hidden",position:"absolute",top:"0"}).width(this.$parent.width()).height(this.$parent.height()).appendTo(this.$parent),this.mainContext=c.createContext(this.$graphContainer[0]),this.translateX=this.translateY=0,this.translateModifier=new e({transform:f.translate(this.translateX,this.translateY,0)
}),this.translateModNode=this.mainContext.add(this.translateModifier);var b=new e({origin:[.5,.5],align:[.5,.5]});this.originModNode=this.translateModNode.add(b),this.pe=new d},subscribeEvents:function(){var b=this;a(document).on("keydown",function(a){switch(a.which){case 13:b.JIT.enterKeyHandler(),a.preventDefault();break;case 27:b.JIT.escKeyHandler();break;case 65:a.ctrlKey&&(b.Control.deselectAllNodes(),b.Control.deselectAllEdges(),a.preventDefault(),b.Visualize.mGraph.graph.eachNode(function(c){b.Control.selectNode(c,a)}),b.Visualize.mGraph.plot());break;case 69:a.ctrlKey&&(a.preventDefault(),Mapmaker.Active.Map&&Mapmaker.JIT.zoomExtents(null,Mapmaker.Visualize.mGraph.canvas));break;case 77:a.ctrlKey&&(a.preventDefault(),b.Control.removeSelectedNodes(),b.Control.removeSelectedEdges());break;case 68:a.ctrlKey&&(a.preventDefault(),b.Control.deleteSelected());break;case 72:a.ctrlKey&&(a.preventDefault(),b.Control.hideSelectedNodes(),b.Control.hideSelectedEdges());break;case 67:b.newTopic.toggle()}}),a(window).resize(function(){b.Visualize&&b.Visualize.mGraph&&b.Visualize.mGraph.canvas.resize(a(window).width(),a(window).height())});var d=function(a){i.mousedown.call(b,a)};c.on("mousedown",d);var e=function(a){i.mouseup.call(b,a)};c.on("mouseup",e);var f=function(a){i.mousemove.call(b,a)};c.on("mousemove",f);var g=this.currentMap.get("synapseMappings");g.bind("add",this.addSynapseMappingView),g.bind("remove",this.removeSynapseMappingView);var h=this.currentMap.get("topicMappings");h.bind("add",this.addTopicMappingView),h.bind("remove",this.removeTopicMappingView),a(document).on(Mapmaker.JuntoView.events.turnOn,function(a){}),a(document).on(Mapmaker.JuntoView.events.turnOff,function(a){}),a(document).on(Mapmaker.FilterView.events.change,function(a){}),a(document).on(Mapmaker.NewTopicView.events.create,function(a,b){}),a(document).on(Mapmaker.NewSynapseView.events.create,function(a,b){}),a(document).on(Mapmaker.TopicMappingView.events.mousedown,function(a){i.topicMousedown.call(b)}),a(document).on(Mapmaker.TopicMappingView.events.mouseup,function(a,c){i.topicMouseup.call(b,c)}),a(document).on(Mapmaker.TopicMappingView.events.doubleClick,function(a,c){i.topicDoubleClick.call(b,c)}),a(document).on(Mapmaker.TopicMappingView.events.dragEnd,function(a){i.topicDragEnd.call(b)}),a(document).on(Mapmaker.VideoView.events.mousedown,function(a){i.videoMousedown.call(b)}),a(document).on(Mapmaker.VideoView.events.mouseup,function(a,c){i.videoMouseup.call(b,c)}),a(document).on(Mapmaker.VideoView.events.dragEnd,function(a){i.videoDragEnd.call(b)})},loadGraph:function(){var a=this,b=this.currentMap.get("synapseMappings");b.each(function(b){a.addSynapseMappingView(b)});var d=this.currentMap.get("topicMappings");d.each(function(b){a.addTopicMappingView(b)}),c.on("prerender",function(){Object.keys(a.synapses).forEach(function(b){a.synapses[b].updateDisplay()})})},getMetacodes:function(b){var c=this,d=function(a){c.metacodes=new Mapmaker.MetacodeCollection(a);var b=new Mapmaker.MetacodeCollection(a.slice(0,20));c.newTopic.initializeCarousel(b),h.loadGraph.call(c)};a.ajax({url:b,success:d})}},i={mousedown:function(a){this.mouseIsDown=!0},mouseup:function(a){this.mouseIsDown=!1},canvasDoubleClick:function(a){},mousemove:function(a){var b;!this.mouseIsDown||this.draggingTopic||this.draggingVideo||(this.translateX=this.translateX+a.movementX,this.translateY=this.translateY+a.movementY,b=f.translate(this.translateX,this.translateY,0),this.translateModifier.setTransform(b))},topicMousedown:function(){this.draggingTopic=!0},topicMouseup:function(a){},topicDoubleClick:function(a){var b=a.topic;this.topicCards[b.id]||(this.topicCards[b.id]=new Mapmaker.TopicCardView({model:b,mapView:this})),this.topicCards[b.id].show()},topicDragEnd:function(){this.draggingTopic=!1},videoMousedown:function(){this.draggingVideo=!0},videoMouseup:function(){},videoDragEnd:function(){this.draggingVideo=!1}},j=function(a,b,c){function d(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;5>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}var e=this;this.$parent=c,this.parseConfig(b),this.currentMap=a,this.currentMapper=new Mapmaker.Mapper({id:Math.floor(20*Math.random()),name:d(),permission:"commons",image:"http://www.fitness-training-at-home.com/image-files/zflowericon.gif"}),this.metacodes=null,this.topicCards={},this.synapseCards={},this.topics={},this.synapses={},this.mouseIsDown=!1,this.draggingTopic=!1,this.draggingVideo=!1,this.Touch={touchPos:null,touchDragNode:null},this.Mouse={didPan:!1,didBoxZoom:!1,changeInX:0,changeInY:0,edgeHoveringOver:!1,boxStartCoordinates:!1,boxEndCoordinates:!1,synapseStartCoordinates:[],synapseEndCoordinates:null,lastNodeClick:0,lastCanvasClick:0,DOUBLE_CLICK_TOLERANCE:300},this.Selected={reset:function(){e.Selected.Nodes=[],e.Selected.Edges=[]},Nodes:[],Edges:[]},h.createGraphContainer.call(this),h.createViews.call(this),h.addModules.call(this),h.getMetacodes.call(this,this.config.paths.metacodes),h.subscribeEvents.call(this)};return j.prototype.parseConfig=function(a){Mapmaker.Utility.extendIf(a,g),this.config=a},j.prototype.addTopicMappingView=function(a){var b=new Mapmaker.TopicMappingView(this,a);this.topics[a.cid]=b},j.prototype.removeTopicMappingView=function(a){this.topics[a.cid].remove(),delete this.topics[a.cid]},j.prototype.addSynapseMappingView=function(a){var b=new Mapmaker.SynapseMappingView(this,a);this.synapses[a.cid]=b},j.prototype.removeSynapseMappingView=function(a){this.synapses[a.cid].remove(),delete this.synapses[a.cid]},j}(jQuery,famous),Mapmaker.MapView.events={mappingSelected:"Mapmaker:MapView:mappingSelected"},Mapmaker.Mapper=function(){return Backbone.Model.extend({urlRoot:"/users",blacklist:["created_at","updated_at"],toJSON:function(a){return _.omit(this.attributes,this.blacklist)},prepareLiForFilter:function(){var a="";return a+='<li data-id="'+this.id.toString()+'">',a+='<img src="'+this.get("image")+'" data-id="'+this.id.toString()+'"',a+=' alt="'+this.get("name")+'" />',a+="<p>"+this.get("name")+"</p></li>"}})}(),"undefined"==typeof Mapmaker&&(Mapmaker={}),Mapmaker.Control=function(a){var b=function(a){this.mapView=a};return b.prototype.init=function(){},b.prototype.selectNode=function(a,b){var c=0===a.getData("alpha");c||-1!=this.mapView.Selected.Nodes.indexOf(a)||(a.selected=!0,a.setData("dim",30,"current"),this.mapView.Selected.Nodes.push(a))},b.prototype.deselectAllNodes=function(){for(var a=this.mapView.Selected.Nodes.length,b=a-1;b>=0;b-=1){var c=this.mapView.Selected.Nodes[b];this.mapView.Control.deselectNode(c)}this.mapView.Visualize.mGraph.plot()},b.prototype.deselectNode=function(a){delete a.selected,a.setData("dim",25,"current"),this.mapView.Selected.Nodes.splice(this.mapView.Selected.Nodes.indexOf(a),1)},b.prototype.deleteSelected=function(){if(this.mapView.Active.Map){var a=this.mapView.Selected.Nodes.length,b=this.mapView.Selected.Edges.length,c=1==a?"1 topic":a+" topics",d=1==b?"1 synapse":b+" synapses",e="You have "+c+" and "+d+" selected. ",f=this.mapView.Active.Map.authorizeToEdit(this.mapView.Active.Mapper);if(!f)return void this.mapView.GlobalUI.notifyUser("Cannot edit Public map.");var g=confirm(e+"Are you sure you want to permanently delete them all? This will remove them from all maps they appear on.");1==g&&(this.mapView.Control.deleteSelectedEdges(),this.mapView.Control.deleteSelectedNodes())}},b.prototype.deleteSelectedNodes=function(){if(this.mapView.Active.Map){var a=this.mapView.Active.Map.authorizeToEdit(this.mapView.Active.Mapper);if(!a)return void this.mapView.GlobalUI.notifyUser("Cannot edit Public map.");for(var b=this.mapView.Selected.Nodes.length,c=b-1;c>=0;c-=1){var d=this.mapView.Selected.Nodes[c];this.mapView.Control.deleteNode(d.id)}}},b.prototype.deleteNode=function(b){if(this.mapView.Active.Map){var c=this.mapView.Active.Map.authorizeToEdit(this.mapView.Active.Mapper);if(!c)return void this.mapView.GlobalUI.notifyUser("Cannot edit Public map.");var d=this.mapView.Visualize.mGraph.graph.getNode(b),e=d.getData("topic"),f=e.id,g=d.getData("mapping");e.destroy(),this.mapView.Mappings.remove(g),a(document).trigger(this.mapView.JIT.events.deleteTopic,[{topicid:f}]),this.mapView.Control.hideNode(b)}},b.prototype.removeSelectedNodes=function(){if(this.mapView.Active.Map){var a,b,c=this.mapView.Selected.Nodes.length,d=this.mapView.Active.Map.authorizeToEdit(this.mapView.Active.Mapper);if(!d)return void this.mapView.GlobalUI.notifyUser("Cannot edit Public map.");for(a=c-1;a>=0;a-=1)b=this.mapView.Selected.Nodes[a],this.mapView.Control.removeNode(b.id)}},b.prototype.removeNode=function(b){if(this.mapView.Active.Map){var c=this.mapView.Active.Map.authorizeToEdit(this.mapView.Active.Mapper),d=this.mapView.Visualize.mGraph.graph.getNode(b);if(!c)return void this.mapView.GlobalUI.notifyUser("Cannot edit Public map.");var e=d.getData("topic"),f=e.id,g=d.getData("mapping");g.destroy(),this.mapView.Topics.remove(e),a(document).trigger(this.mapView.JIT.events.removeTopic,[{topicid:f}]),this.mapView.Control.hideNode(b)}},b.prototype.hideSelectedNodes=function(){var a,b,c=this.mapView.Selected.Nodes.length;for(a=c-1;a>=0;a-=1)b=this.mapView.Selected.Nodes[a],this.mapView.Control.hideNode(b.id)},b.prototype.hideNode=function(a){var b=this.mapView.Visualize.mGraph.graph.getNode(a),c=this.mapView.Visualize.mGraph;if(a==this.mapView.Visualize.mGraph.root){var d=_.find(c.graph.nodes,function(b){return b.id!==a});c.root=d?d.id:null}this.mapView.Control.deselectNode(b),b.setData("alpha",0,"end"),b.eachAdjacency(function(a){a.setData("alpha",0,"end")}),this.mapView.Visualize.mGraph.fx.animate({modes:["node-property:alpha","edge-property:alpha"],duration:500}),setTimeout(function(){this.mapView.Visualize.mGraph.graph.removeNode(a)},500),this.mapView.Filter.checkMetacodes(),this.mapView.Filter.checkMappers()},b.prototype.selectEdge=function(a){var b=0===a.getData("alpha");if(!b&&-1==this.mapView.Selected.Edges.indexOf(a)){var c=this.mapView.Mouse.edgeHoveringOver===a?4:2;a.setDataset("current",{showDesc:!0,lineWidth:c,color:this.mapView.Settings.colors.synapses.selected}),this.mapView.Visualize.mGraph.plot(),this.mapView.Selected.Edges.push(a)}},b.prototype.deselectAllEdges=function(){for(var a=this.mapView.Selected.Edges.length,b=a-1;b>=0;b-=1){var c=this.mapView.Selected.Edges[b];this.mapView.Control.deselectEdge(c)}this.mapView.Visualize.mGraph.plot()},b.prototype.deselectEdge=function(a){a.setData("showDesc",!1,"current"),a.setDataset("current",{lineWidth:2,color:this.mapView.Settings.colors.synapses.normal}),this.mapView.Mouse.edgeHoveringOver==a&&a.setDataset("current",{showDesc:!0,lineWidth:4}),this.mapView.Visualize.mGraph.plot(),this.mapView.Selected.Edges.splice(this.mapView.Selected.Edges.indexOf(a),1)},b.prototype.deleteSelectedEdges=function(){var a,b=this.mapView.Selected.Edges.length;if(this.mapView.Active.Map){var c=this.mapView.Active.Map.authorizeToEdit(this.mapView.Active.Mapper);if(!c)return void this.mapView.GlobalUI.notifyUser("Cannot edit Public map.");for(var d=b-1;d>=0;d-=1)a=this.mapView.Selected.Edges[d],this.mapView.Control.deleteEdge(a)}},b.prototype.deleteEdge=function(b){if(this.mapView.Active.Map){var c=this.mapView.Active.Map.authorizeToEdit(this.mapView.Active.Mapper);if(!c)return void this.mapView.GlobalUI.notifyUser("Cannot edit Public map.");b.getData("synapses").length-1===0&&this.mapView.Control.hideEdge(b);var d=b.getData("displayIndex")?b.getData("displayIndex"):0,e=b.getData("synapses")[d],f=b.getData("mappings")[d],g=e.id;e.destroy(),this.mapView.Mappings.remove(f),b.getData("mappings").splice(d,1),b.getData("synapses").splice(d,1),b.getData("displayIndex")&&delete b.data.$displayIndex,a(document).trigger(this.mapView.JIT.events.deleteSynapse,[{synapseid:g}])}},b.prototype.removeSelectedEdges=function(){var a,b,c=this.mapView.Selected.Edges.length;if(this.mapView.Active.Map){var d=this.mapView.Active.Map.authorizeToEdit(this.mapView.Active.Mapper);if(!d)return void this.mapView.GlobalUI.notifyUser("Cannot edit Public map.");for(a=c-1;a>=0;a-=1)b=this.mapView.Selected.Edges[a],this.mapView.Control.removeEdge(b);this.mapView.Selected.Edges=new Array}},b.prototype.removeEdge=function(b){if(this.mapView.Active.Map){var c=this.mapView.Active.Map.authorizeToEdit(this.mapView.Active.Mapper);if(!c)return void this.mapView.GlobalUI.notifyUser("Cannot edit Public map.");b.getData("mappings").length-1===0&&this.mapView.Control.hideEdge(b);var d=b.getData("displayIndex")?b.getData("displayIndex"):0,e=b.getData("synapses")[d],f=b.getData("mappings")[d],g=e.id;f.destroy(),this.mapView.Synapses.remove(e),b.getData("mappings").splice(d,1),b.getData("synapses").splice(d,1),b.getData("displayIndex")&&delete b.data.$displayIndex,a(document).trigger(this.mapView.JIT.events.removeSynapse,[{synapseid:g}])}},b.prototype.hideSelectedEdges=function(){var a,b,c=this.mapView.Selected.Edges.length;for(b=c-1;b>=0;b-=1)a=this.mapView.Selected.Edges[b],this.mapView.Control.hideEdge(a);this.mapView.Selected.Edges=new Array},b.prototype.hideEdge=function(a){var b=a.nodeFrom.id,c=a.nodeTo.id;a.setData("alpha",0,"end"),this.mapView.Control.deselectEdge(a),this.mapView.Visualize.mGraph.fx.animate({modes:["edge-property:alpha"],duration:500}),setTimeout(function(){this.mapView.Visualize.mGraph.graph.removeAdjacence(b,c)},500),this.mapView.Filter.checkSynapses(),this.mapView.Filter.checkMappers()},b.prototype.updateSelectedPermissions=function(a){var b,c,d,e;this.mapView.GlobalUI.notifyUser("Working...");for(var f=0,g=0,h=this.mapView.Selected.Edges.length,i=h-1;i>=0;i-=1)b=this.mapView.Selected.Edges[i],c=b.getData("synapses")[0],c.authorizePermissionChange(this.mapView.Active.Mapper)&&(c.save({permission:a}),g++);for(var h=this.mapView.Selected.Nodes.length,i=h-1;i>=0;i-=1)d=this.mapView.Selected.Nodes[i],e=d.getData("topic"),e.authorizePermissionChange(this.mapView.Active.Mapper)&&(e.save({permission:a}),f++);var j=1==f?f.toString()+" topic and ":f.toString()+" topics and ",k=1==g?g.toString()+" synapse":g.toString()+" synapses",l=j+k+" you created updated to "+a;this.mapView.GlobalUI.notifyUser(l)},b.prototype.updateSelectedMetacodes=function(a){var b,c;this.mapView.GlobalUI.notifyUser("Working...");for(var d=this.mapView.Metacodes.get(a),e=0,f=this.mapView.Selected.Nodes.length,g=f-1;g>=0;g-=1)b=this.mapView.Selected.Nodes[g],c=b.getData("topic"),c.authorizeToEdit(this.mapView.Active.Mapper)&&(c.save({metacode_id:a}),e++);var h=1==e?e.toString()+" topic":e.toString()+" topics",i=h+" you can edit updated to "+d.get("name");this.mapView.GlobalUI.notifyUser(i),this.mapView.Visualize.mGraph.plot()},b}(jQuery),"undefined"==typeof Mapmaker&&(Mapmaker={}),Mapmaker.Create=function(a){var b=function(a){this.mapView=a,this.name=null,this.newId=1,this.beingCreated=!1,this.metacode=null,this.x=null,this.y=null,this.addSynapse=!1};b.prototype.init=function(){var b=this;a("#topic_name").keyup(function(){b.name=a(this).val()}),a("#topic_name").typeahead([{name:"topic_autocomplete",limit:8,template:a("#topicAutocompleteTemplate").html(),remote:{url:"/topics/autocomplete_topic?term=%QUERY"},engine:Hogan}]),a("#topic_name").bind("typeahead:selected",function(a,b,c){this.mapView.Topic.getTopicFromAutocomplete(b.id)}),a("#metacodeImg").CloudCarousel({titleBox:a("#metacodeImgTitle"),yRadius:40,xRadius:190,xPos:170,yPos:40,speed:.3,mouseWheel:!0,bringToFront:!0}),a(".new_topic").hide()},b.prototype.open=function(){a("#new_topic").fadeIn("fast",function(){a("#topic_name").focus()}),this.beingCreated=!0,this.name=""},b.prototype.hide=function(){a("#new_topic").fadeOut("fast"),a("#topic_name").typeahead("setQuery",""),this.beingCreated=!1};var c=function(a){this.mapView=a,this.beingCreated=!1,this.description=null,this.topic1id=null,this.topic2id=null,this.newSynapseId=null};c.prototype.init=function(){var b=this;a("#synapse_desc").keyup(function(){this.newSynapse.description=a(this).val()}),a("#synapse_desc").typeahead([{name:"synapse_autocomplete",template:"<div class='genericSynapseDesc'>{{label}}</div>",remote:{url:"/search/synapses?term=%QUERY"},engine:Hogan},{name:"existing_synapses",limit:50,template:a("#synapseAutocompleteTemplate").html(),remote:{url:"/search/synapses",replace:function(){return b.getSearchQuery()}},engine:Hogan,header:"<h3>Existing synapses</h3>"}]),a("#synapse_desc").bind("typeahead:selected",function(a,c,d){c.id?this.mapView.Synapse.getSynapseFromAutocomplete(c.id):(b.description=c.value,this.mapView.Synapse.createSynapseLocally())})},c.prototype.open=function(){a("#new_synapse").fadeIn("fast",function(){a("#synapse_desc").focus()}),this.beingCreated=!0},c.prototype.hide=function(){a("#new_synapse").fadeOut("fast"),a("#synapse_desc").typeahead("setQuery",""),this.newSynapse.beingCreated=!1,this.newTopic.addSynapse=!1,this.topic1id=0,this.topic2id=0,this.mapView.Mouse.synapseStartCoordinates=[],this.mapView.Visualize.mGraph.plot()},c.prototype.getSearchQuery=function(){var a=this.newSynapse;return this.mapView.Selected.Nodes.length<2?"/search/synapses?topic1id="+a.topic1id+"&topic2id="+a.topic2id:""};var d=function(a){this.mapView=a,this.isSwitchingSet=!1,this.selectedMetacodeSet=null,this.selectedMetacodeSetIndex=null,this.selectedMetacodeNames=[],this.newSelectedMetacodeNames=[],this.selectedMetacodes=[],this.newSelectedMetacodes=[],this.newTopic=new b(this.mapView),this.newSynapse=new c(this.mapView)};return d.prototype.init=function(){var b=this;b.newTopic.init(),b.newSynapse.init(),a("#metacodeSwitchTabs").tabs({selected:b.selectedMetacodeSetIndex}).addClass("ui-tabs-vertical ui-helper-clearfix"),a("#metacodeSwitchTabs .ui-tabs-nav li").removeClass("ui-corner-top").addClass("ui-corner-left"),a(".customMetacodeList li").click(b.toggleMetacodeSelected)},d.prototype.toggleMetacodeSelected=function(){var b=this;if("toggledOff"!=a(this).attr("class")){a(this).addClass("toggledOff");var c=a(this).attr("id"),d=a(this).attr("data-name");b.newSelectedMetacodes.splice(b.newSelectedMetacodes.indexOf(c),1),b.newSelectedMetacodeNames.splice(b.newSelectedMetacodeNames.indexOf(d),1)}else"toggledOff"==a(this).attr("class")&&(a(this).removeClass("toggledOff"),b.newSelectedMetacodes.push(a(this).attr("id")),b.newSelectedMetacodeNames.push(a(this).attr("data-name")))},d.prototype.updateMetacodeSet=function(b,c,d){if(d&&0==this.newSelectedMetacodes.length)return alert("Please select at least one metacode to use!"),!1;var e,f=new this.mapView.Backbone.MetacodeCollection;this.selectedMetacodeSetIndex=c,this.selectedMetacodeSet="metacodeset-"+b,d?d&&(this.selectedMetacodes=this.newSelectedMetacodes.slice(0),this.selectedMetacodeNames=this.newSelectedMetacodeNames.slice(0),e=this.selectedMetacodes.slice(0)):(e=a("#metacodeSwitchTabs"+b).attr("data-metacodes").split(","),a(".customMetacodeList li").addClass("toggledOff"),this.selectedMetacodes=[],this.selectedMetacodeNames=[],this.newSelectedMetacodes=[],this.newSelectedMetacodeNames=[]);for(var g=0;g<e.length;g++)f.add(this.mapView.Metacodes.get(e[g]));f.sort(),a("#metacodeImg, #metacodeImgTitle").empty(),a("#metacodeImg").removeData("cloudcarousel");var h="";f.each(function(a){h+='<img class="cloudcarousel" width="40" height="40" src="'+a.get("icon")+'" data-id="'+a.id+'" title="'+a.get("name")+'" alt="'+a.get("name")+'"/>'}),a("#metacodeImg").empty().append(h).CloudCarousel({titleBox:a("#metacodeImgTitle"),yRadius:40,xRadius:190,xPos:170,yPos:40,speed:.3,mouseWheel:!0,bringToFront:!0}),this.mapView.GlobalUI.closeLightbox(),a("#topic_name").focus();var i={metacodes:{value:d?this.selectedMetacodes.toString():this.selectedMetacodeSet}};a.ajax({type:"POST",dataType:"json",url:"/user/updatemetacodes",data:i,success:function(a){console.log("selected metacodes saved")},error:function(){console.log("failed to save selected metacodes")}})},d.prototype.cancelMetacodeSetSwitch=function(){var b=this;if(b.isSwitchingSet=!1,"metacodeset-custom"!=b.selectedMetacodeSet)a(".customMetacodeList li").addClass("toggledOff"),b.selectedMetacodes=[],b.selectedMetacodeNames=[],b.newSelectedMetacodes=[],b.newSelectedMetacodeNames=[];else{a(".customMetacodeList li").addClass("toggledOff");for(var c=0;c<b.selectedMetacodes.length;c++)a("#"+b.selectedMetacodes[c]).removeClass("toggledOff");b.newSelectedMetacodeNames=b.selectedMetacodeNames.slice(0),b.newSelectedMetacodes=b.selectedMetacodes.slice(0)}a("#metacodeSwitchTabs").tabs("select",b.selectedMetacodeSetIndex),a("#topic_name").focus()},d}(jQuery),"undefined"==typeof Mapmaker&&(Mapmaker={}),Mapmaker.JIT=function(a){var b={ForceDirected:{animateSavedLayout:{modes:["linear"],transition:$jit.Trans.Quad.easeInOut,duration:800,onComplete:function(){this.mapView.Visualize.mGraph.busy=!1,a(document).trigger(this.events.animationDone)}},animateFDLayout:{modes:["linear"],transition:$jit.Trans.Elastic.easeOut,duration:800,onComplete:function(){this.mapView.Visualize.mGraph.busy=!1}},graphSettings:{injectInto:"infovis",Navigation:{enable:!0,panning:"avoid nodes",zooming:28},Node:{overridable:!0,color:"#2D6A5D",type:"customNode",dim:25},Edge:{overridable:!0,color:"#123",type:"customEdge",lineWidth:2,alpha:1},Label:{type:"Native",size:20,family:"arial",textBaseline:"alphabetic",color:"#123"},Tips:{enable:!1,onShow:function(a,b){}},Events:{enable:!0,enableForEdges:!0,onMouseMove:function(a,b,c){this.onMouseMoveHandler(a,b,c)},onDragMove:function(a,b,c){this.onDragMoveTopicHandler(a,b,c)},onDragEnd:function(a,b,c){this.onDragEndTopicHandler(a,b,c,!1)},onDragCancel:function(a,b,c){this.onDragCancelHandler(a,b,c,!1)},onTouchStart:function(a,b,c){this.mapView.Visualize.mGraph.events.touched=!0,this.mapView.Touch.touchPos=b.getPos();var d=this.mapView.Visualize.mGraph.canvas,e=d.translateOffsetX;oy=d.translateOffsetY,sx=d.scaleOffsetX,sy=d.scaleOffsetY,this.mapView.Touch.touchPos.x*=sx,this.mapView.Touch.touchPos.y*=sy,this.mapView.Touch.touchPos.x+=e,this.mapView.Touch.touchPos.y+=oy,touchDragNode=a},onTouchMove:function(a,b,c){this.mapView.Touch.touchDragNode?this.onDragMoveTopicHandler(this.mapView.Touch.touchDragNode,b,c):this.touchPanZoomHandler(b,c)},onTouchEnd:function(a,b,c){},onTouchCancel:function(a,b,c){},onClick:function(b,c,d){if(a(".rightclickmenu").remove(),this.mapView.Mouse.boxStartCoordinates){if(d.ctrlKey){this.mapView.Visualize.mGraph.busy=!1,this.mapView.Mouse.boxEndCoordinates=c.getPos();var e=this.mapView.Mouse.boxStartCoordinates,f=this.mapView.Mouse.boxEndCoordinates;if(Math.abs(e.x-f.x)>20&&Math.abs(e.y-f.y)>20)return void this.zoomToBox(d);this.mapView.Mouse.boxStartCoordinates=null,this.mapView.Mouse.boxEndCoordinates=null}if(d.shiftKey)return this.mapView.Visualize.mGraph.busy=!1,this.mapView.Mouse.boxEndCoordinates=c.getPos(),void this.selectWithBox(d)}return"infovis-canvas"!=d.target.id?!1:void(b.nodeFrom?this.selectEdgeOnClickHandler(b,d):b&&!b.nodeFrom?this.selectNodeOnClickHandler(b,d):this.canvasClickHandler(c.getPos(),d))},onRightClick:function(b,c,d){return a(".rightclickmenu").remove(),this.mapView.Mouse.boxStartCoordinates?(this.mapView.Visualize.mGraph.busy=!1,this.mapView.Mouse.boxEndCoordinates=c.getPos(),void this.selectWithBox(d)):"infovis-canvas"!=d.target.id?!1:void(b.nodeFrom?this.selectEdgeOnRightClickHandler(b,d):b&&!b.nodeFrom&&this.selectNodeOnRightClickHandler(b,d))}},iterations:200,levelDistance:200},nodeSettings:{customNode:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim"),e=a.getData("topic"),f=e?e.getMetacode():!1,g=b.getCtx();!b.denySelected&&a.selected&&(g.beginPath(),g.arc(c.x,c.y,d+3,0,2*Math.PI,!1),g.strokeStyle=this.mapView.Settings.colors.topics.selected,g.lineWidth=2,g.stroke()),f&&f.get("image")&&f.get("image").complete&&("undefined"==typeof f.get("image").naturalWidth||0!==f.get("image").naturalWidth)?g.drawImage(f.get("image"),c.x-d,c.y-d,2*d,2*d):(g.beginPath(),g.arc(c.x,c.y,d,0,2*Math.PI,!1),g.fillStyle="#B6B2FD",g.fill());var h=e&&""!==e.get("link")&&null!==e.get("link"),i=this.topicLinkImage,j=i.complete||"undefined"!=typeof i.naturalWidth&&0!==i.naturalWidth;h&&j&&g.drawImage(i,c.x-d-8,c.y-d-8,16,16);var k=e&&""!==e.get("desc")&&null!==e.get("desc"),l=this.topicDescImage,m=l.complete||"undefined"!=typeof l.naturalWidth&&0!==l.naturalWidth;k&&m&&g.drawImage(l,c.x+d-8,c.y-d-8,16,16)},contains:function(a,b){var c,d=a.pos.getc(!0),e=a.getData("dim"),f=this.mapView.Util.splitLine(a.name,30).split("\n"),g=this.mapView.Visualize.mGraph.canvas.getCtx(),h=25*f.length,i=[];for(c=0;c<f.length;++c)i.push(g.measureText(f[c]).width);var j=Math.max.apply(null,i)+8,k=d.y+a.getData("height")+5+h/2,l=this.nodeHelper.rectangle.contains({x:d.x,y:k},b,j,h);return this.nodeHelper.circle.contains(d,b,e)||l}}},edgeSettings:{customEdge:{render:function(a,b){this.edgeRender(a,b)},contains:function(a,b){var c=a.nodeFrom.pos.getc(),d=a.nodeTo.pos.getc();return-1<b.x&&b.x<1&&(b.x=0),-1<b.y&&b.y<1&&(b.y=0),$jit.Graph.Plot.edgeHelper.line.contains(c,d,b,a.Edge.epsilon+5)}}}},RGraph:{animate:{modes:["polar"],duration:800,onComplete:function(){this.mapView.Visualize.mGraph.busy=!1}},background:{levelDistance:200,numberOfCircles:4,CanvasStyles:{strokeStyle:"#333",lineWidth:1.5}},levelDistance:200}},c=function(a){this.mapView=a,this.vizData=[],Mapmaker.Utility.extendIf(this,b)};return c.prototype.init=function(){var b=this;a(".zoomIn").click(b.zoomIn),a(".zoomOut").click(b.zoomOut);var c=function(a){b.zoomExtents(a,this.mapView.Visualize.mGraph.canvas)};a(".zoomExtents").click(c),a(".takeScreenshot").click(this.mapView.Map.exportImage),b.topicDescImage=new Image,b.topicDescImage.src="/assets/topic_description_signifier.png",b.topicLinkImage=new Image,b.topicLinkImage.src="/assets/topic_link_signifier.png"},c.prototype.convertModelsToJIT=function(a,b){var c,d,e,f,g=[],h=[],i={},j=[];return a.each(function(a){d=a.createNode(),i[d.id]=d}),b.each(function(b){f=b.createEdge(),void 0===a.get(b.get("node1_id"))||void 0===a.get(b.get("node2_id"))?h.push(b):i[f.nodeFrom]&&i[f.nodeTo]&&(e=_.findWhere(j,{nodeFrom:f.nodeFrom,nodeTo:f.nodeTo})||_.findWhere(j,{nodeFrom:f.nodeTo,nodeTo:f.nodeFrom}),e?(this.mapView.Active.Map&&(c=b.getMapping(),e.data.$mappingIDs.push(c.id)),e.data.$synapseIDs.push(b.id)):(i[f.nodeFrom].adjacencies.push(f),j.push(f)))}),_.each(i,function(a){g.push(a)}),[g,h]},c.prototype.prepareVizData=function(){var a,b=this;b.vizData=[],this.mapView.Visualize.loadLater=!1;var c=b.convertModelsToJIT(this.mapView.Topics,this.mapView.Synapses);b.vizData=c[0],_.each(c[1],function(b){a=b.getMapping(),this.mapView.Synapses.remove(b),this.mapView.Mappings.remove(a)}),0==b.vizData.length?(this.mapView.Famous.viz.showInstructions(),this.mapView.Visualize.loadLater=!0):this.mapView.Famous.viz.hideInstructions(),this.mapView.Visualize.render()},c.prototype.edgeRender=function(a,b){var c,d=a.nodeFrom.pos.getc(!0),e=a.nodeTo.pos.getc(!0);if(a.getData("displayIndex")?(c=a.getData("synapses")[a.getData("displayIndex")],c||(delete a.data.$displayIndex,c=a.getData("synapses")[0])):c=a.getData("synapses")[0],c){c.get("category");if(b.denySelected){var f=this.mapView.Settings.colors.synapses.normal;b.getCtx().fillStyle=b.getCtx().strokeStyle=f}this.renderEdgeArrows($jit.Graph.Plot.edgeHelper,a,c,b);var g=c.get("desc"),h=a.getData("showDesc"),i=function(a,b,c,d){a.beginPath(),a.arc(b,c,8,0,2*Math.PI,!1),a.fillStyle="#DAB539",a.strokeStyle="#424242",a.lineWidth=1.5,a.closePath(),a.fill(),a.stroke(),a.fillStyle="#424242",a.textAlign="center",a.font="14px din-medium",a.fillText(d,b,c+5)};if(!b.denySelected&&""!=g&&h){g=this.mapView.Util.decodeEntities(g);var j=b.getCtx();j.font="bold 14px arial",j.fillStyle="#FFF",j.textBaseline="alphabetic";var k,l=this.mapView.Util.splitLine(g,30).split("\n"),m=[];for(k=0;k<l.length;++k)m.push(j.measureText(l[k]).width);var n=Math.max.apply(null,m)+16,o=16*l.length+8,p=(d.x+e.x-n)/2,q=(d.y+e.y)/2-o/2,r=5;j.beginPath(),j.moveTo(p+r,q),j.lineTo(p+n-r,q),j.quadraticCurveTo(p+n,q,p+n,q+r),j.lineTo(p+n,q+o-r),j.quadraticCurveTo(p+n,q+o,p+n-r,q+o),j.lineTo(p+r,q+o),j.quadraticCurveTo(p,q+o,p,q+o-r),j.lineTo(p,q+r),j.quadraticCurveTo(p,q,p+r,q),j.closePath(),j.fill();var s=a.getData("synapses").length;for(j.fillStyle="#424242",j.textAlign="center",k=0;k<l.length;++k)j.fillText(l[k],p+n/2,q+18+16*k);s>1&&i(j,p+n,q,s)}else if(!b.denySelected&&h){var s=a.getData("synapses").length;if(s>1){var j=b.getCtx(),p=(d.x+e.x)/2,q=(d.y+e.y)/2;i(j,p,q,s)}}}},c.prototype.onMouseEnter=function(b){var c=0===b.getData("alpha");if(!c&&!this.mapView.Visualize.mGraph.busy){a("canvas").css("cursor","pointer");var d=this.mapView.Selected.Edges.indexOf(b);-1==d&&b.setData("showDesc",!0,"current"),b.setDataset("end",{lineWidth:4}),this.mapView.Visualize.mGraph.fx.animate({modes:["edge-property:lineWidth"],duration:100}),this.mapView.Visualize.mGraph.plot()}},c.prototype.onMouseLeave=function(b){if(0!==b.getData("alpha")){a("canvas").css("cursor","default");var c=this.mapView.Selected.Edges.indexOf(b);-1==c&&b.setData("showDesc",!1,"current"),b.setDataset("end",{lineWidth:2}),this.mapView.Visualize.mGraph.fx.animate({modes:["edge-property:lineWidth"],duration:100}),this.mapView.Visualize.mGraph.plot()}},c.prototype.onMouseMoveHandler=function(b,c,d){var e=this;if(!this.mapView.Visualize.mGraph.busy){var b=c.getNode(),f=c.getEdge();if(0!=b)return this.mapView.Mouse.edgeHoveringOver&&e.onMouseLeave(this.mapView.Mouse.edgeHoveringOver),void a("canvas").css("cursor","pointer");0==f&&0!=this.mapView.Mouse.edgeHoveringOver?e.onMouseLeave(this.mapView.Mouse.edgeHoveringOver):0!=f&&0==this.mapView.Mouse.edgeHoveringOver?e.onMouseEnter(f):0!=f&&this.mapView.Mouse.edgeHoveringOver!=f&&(e.onMouseLeave(this.mapView.Mouse.edgeHoveringOver),e.onMouseEnter(f)),this.mapView.Mouse.edgeHoveringOver=f,b||f||a("canvas").css("cursor","default")}},c.prototype.enterKeyHandler=function(){},c.prototype.escKeyHandler=function(){this.mapView.Control.deselectAllEdges(),this.mapView.Control.deselectAllNodes()},c.prototype.touchPanZoomHandler=function(a,b){if(1==b.touches.length){var c=this.mapView.Touch.touchPos,d=a.getPos(),e=this.mapView.Visualize.mGraph.canvas,f=e.translateOffsetX,g=e.translateOffsetY,h=e.scaleOffsetX,i=e.scaleOffsetY;d.x*=h,d.y*=i,d.x+=f,d.y+=g;var j=d.x-c.x,k=d.y-c.y;this.mapView.Touch.touchPos=d,this.mapView.Visualize.mGraph.canvas.translate(1*j/h,1*k/i)}else if(2==b.touches.length){var l=b.touches[0],m=b.touches[1],n=this.mapView.Util.getDistance({x:l.clientX,y:l.clientY},{x:m.clientX,y:m.clientY});lastDist||(lastDist=n);var o=n/lastDist;8>=this.mapView.Visualize.mGraph.canvas.scaleOffsetX*o&&this.mapView.Visualize.mGraph.canvas.scaleOffsetX*o>=1&&this.mapView.Visualize.mGraph.canvas.scale(o,o),this.mapView.Visualize.mGraph.canvas.scaleOffsetX<.5?this.mapView.Visualize.mGraph.canvas.viz.labels.hideLabels(!0):this.mapView.Visualize.mGraph.canvas.scaleOffsetX>.5&&this.mapView.Visualize.mGraph.canvas.viz.labels.hideLabels(!1),lastDist=n}},c.prototype.onDragMoveTopicHandler=function(b,c,d){var e,f=this,g={},h=this.mapView.Active.Map&&this.mapView.Active.Map.authorizeToEdit(this.mapView.Active.Mapper);if(b&&!b.nodeFrom){var i=c.getPos();if(!d.touches&&(0!=d.button||d.altKey||d.ctrlKey||d.shiftKey||0!=d.buttons&&1!=d.buttons&&void 0!=d.buttons))if((2==d.button||0==d.button&&d.altKey||2==d.buttons)&&h){if(0==tempInit){tempNode=b,tempInit=!0,this.mapView.Create.newTopic.hide(),this.mapView.Create.newSynapse.hide();var j=this.mapView.Selected.Nodes.length;if(j>0)for(var k=j-1;k>=0;k-=1){var l=this.mapView.Selected.Nodes[k];this.mapView.Mouse.synapseStartCoordinates.push({x:l.pos.getc().x,y:l.pos.getc().y})}else this.mapView.Mouse.synapseStartCoordinates=[{x:tempNode.pos.getc().x,y:tempNode.pos.getc().y}];this.mapView.Mouse.synapseEndCoordinates={x:i.x,y:i.y}}if(temp=c.getNode(),0!=temp&&temp.id!=b.id&&-1==this.mapView.Selected.Nodes.indexOf(temp))tempNode2=temp,this.mapView.Mouse.synapseEndCoordinates={x:tempNode2.pos.getc().x,y:tempNode2.pos.getc().y},this.mapView.Visualize.mGraph.graph.eachNode(function(a){a.setData("dim",25,"current");
}),temp.setData("dim",35,"current"),this.mapView.Visualize.mGraph.plot();else if(!temp){tempNode2=null,this.mapView.Visualize.mGraph.graph.eachNode(function(a){a.setData("dim",25,"current")});var m=d.clientX-110,n=d.clientY-30;a("#new_topic").css("left",m+"px"),a("#new_topic").css("top",n+"px"),this.mapView.Create.newTopic.x=c.getPos().x,this.mapView.Create.newTopic.y=c.getPos().y,this.mapView.Visualize.mGraph.plot(),this.mapView.Mouse.synapseEndCoordinates={x:i.x,y:i.y}}}else(2==d.button||0==d.button&&d.altKey||2==d.buttons)&&this.mapView.Active.Topic?this.mapView.GlobalUI.notifyUser("Cannot create in Topic view."):(2==d.button||0==d.button&&d.altKey||2==d.buttons)&&!h&&this.mapView.GlobalUI.notifyUser("Cannot edit Public map.");else{var o=f.handleSelectionBeforeDragging(b,d);if(b.pos.rho||0===b.pos.rho){var p=Math.sqrt(i.x*i.x+i.y*i.y),q=Math.atan2(i.y,i.x);b.pos.setp(q,p)}else if("only-drag-this-one"==o)b.pos.setc(i.x,i.y),this.mapView.Active.Map&&(e=b.getData("topic"),g[e.id]=i,a(document).trigger(this.events.topicDrag,[g]));else{for(var r=this.mapView.Selected.Nodes.length,s=new Array,t=new Array,k=0;r>k;k+=1){var l=this.mapView.Selected.Nodes[k];s[k]=l.pos.x-b.pos.x,t[k]=l.pos.y-b.pos.y}for(var k=0;r>k;k+=1){var l=this.mapView.Selected.Nodes[k],u=i.x+s[k],v=i.y+t[k];l.pos.setc(u,v),this.mapView.Active.Map&&(e=l.getData("topic"),g[e.id]=l.pos)}this.mapView.Active.Map&&a(document).trigger(this.events.topicDrag,[g])}"deselect"==o&&this.mapView.Control.deselectNode(b),this.mapView.Visualize.mGraph.plot()}}},c.prototype.onDragCancelHandler=function(a,b,c){tempNode=null,tempNode2&&tempNode2.setData("dim",25,"current"),tempNode2=null,tempInit=!1,this.mapView.Mouse.synapseStartCoordinates=[],this.mapView.Mouse.synapseEndCoordinates=null,this.mapView.Visualize.mGraph.plot()},c.prototype.onDragEndTopicHandler=function(b,c,d){var e,f,g={};if(tempInit&&null==tempNode2)this.mapView.Create.newTopic.addSynapse=!0,this.mapView.Create.newTopic.open();else if(tempInit&&null!=tempNode2)this.mapView.Create.newTopic.addSynapse=!1,this.mapView.Create.newSynapse.topic1id=tempNode.getData("topic").id,this.mapView.Create.newSynapse.topic2id=tempNode2.getData("topic").id,tempNode2.setData("dim",25,"current"),this.mapView.Visualize.mGraph.plot(),g.x=tempNode.pos.getc().x+(tempNode2.pos.getc().x-tempNode.pos.getc().x)/2,g.y=tempNode.pos.getc().y+(tempNode2.pos.getc().y-tempNode.pos.getc().y)/2,e=this.mapView.Util.coordsToPixels(g),a("#new_synapse").css("left",e.x+"px"),a("#new_synapse").css("top",e.y+"px"),this.mapView.Create.newSynapse.open(),tempNode=null,tempNode2=null,tempInit=!1;else if(!tempInit&&b&&!b.nodeFrom){var h=function(){var a=this.mapView.Active.Map;if(!a)return!1;var b=this.mapView.Active.Mapper,c=a.authorizePermissionChange(b),d="commons"===a.get("permission"),e=this.mapView.Realtime.status;return a&&b&&(d&&e||c&&!d)};if(h()){f=b.getData("mapping"),f.save({xloc:b.getPos().x,yloc:b.getPos().y});for(var i=this.mapView.Selected.Nodes.length,j=i-1;j>=0;j-=1){var k=this.mapView.Selected.Nodes[j];k!==b&&(f=k.getData("mapping"),f.save({xloc:k.getPos().x,yloc:k.getPos().y}))}}}},c.prototype.canvasClickHandler=function(b,c){var d=this.mapView.Mouse.lastCanvasClick,e=Date.now();this.mapView.Mouse.lastCanvasClick=e;var f=this.mapView.Active.Map&&this.mapView.Active.Map.authorizeToEdit(this.mapView.Active.Mapper);if(e-d<this.mapView.Mouse.DOUBLE_CLICK_TOLERANCE&&!this.mapView.Mouse.didPan){if(this.mapView.Active.Map&&!f)return void this.mapView.GlobalUI.notifyUser("Cannot edit Public map.");if(this.mapView.Active.Topic)return void this.mapView.GlobalUI.notifyUser("Cannot create in Topic view.");this.mapView.Create.newTopic.addSynapse=!1,this.mapView.Create.newTopic.x=b.x,this.mapView.Create.newTopic.y=b.y,a("#new_topic").css("left",c.clientX+"px"),a("#new_topic").css("top",c.clientY+"px"),this.mapView.Create.newTopic.open()}else this.mapView.Mouse.didPan||(this.mapView.Filter.close(),this.mapView.TopicCard.hideCard(),this.mapView.SynapseCard.hideCard(),this.mapView.Create.newTopic.hide(),this.mapView.Create.newSynapse.hide(),a(".rightclickmenu").remove(),this.mapView.Mouse.synapseStartCoordinates=[],this.mapView.Mouse.synapseEndCoordinates=null,tempInit=!1,tempNode=null,tempNode2=null,c.ctrlKey||c.shiftKey||(this.mapView.Control.deselectAllEdges(),this.mapView.Control.deselectAllNodes()))},c.prototype.nodeDoubleClickHandler=function(a,b){this.mapView.TopicCard.showCard(a)},c.prototype.edgeDoubleClickHandler=function(a,b){this.mapView.SynapseCard.showCard(a,b)},c.prototype.nodeWasDoubleClicked=function(){var a=this.mapView.Mouse.lastNodeClick,b=Date.now();return this.mapView.Mouse.lastNodeClick=b,b-a<this.mapView.Mouse.DOUBLE_CLICK_TOLERANCE?!0:!1},c.prototype.handleSelectionBeforeDragging=function(a,b){return 0==this.mapView.Selected.Nodes.length?"only-drag-this-one":-1==this.mapView.Selected.Nodes.indexOf(a)?b.shiftKey?(this.mapView.Control.selectNode(a,b),"nothing"):"only-drag-this-one":"nothing"},c.prototype.selectWithBox=function(a){var b=this.mapView.Mouse.boxStartCoordinates.x,c=this.mapView.Mouse.boxStartCoordinates.y,d=this.mapView.Mouse.boxEndCoordinates.x,e=this.mapView.Mouse.boxEndCoordinates.y;a.shiftKey||(this.mapView.Control.deselectAllNodes(),this.mapView.Control.deselectAllEdges()),this.mapView.Visualize.mGraph.graph.eachNode(function(f){var g=f.pos.x,h=f.pos.y;(g>b&&d>g&&h>c&&e>h||b>g&&g>d&&c>h&&h>e||b>g&&g>d&&h>c&&e>h||g>b&&d>g&&c>h&&h>e)&&(a.shiftKey&&f.selected?this.mapView.Control.deselectNode(f):this.mapView.Control.selectNode(f,a))}),c=-1*c,e=-1*e;var f=[];this.mapView.Synapses.each(function(a){var b=a.get("edge");-1===f.indexOf(b)&&f.push(b)}),f.forEach(function(f){var g=f.nodeFrom.pos.x,h=-1*f.nodeFrom.pos.y,i=f.nodeTo.pos.x,j=-1*f.nodeTo.pos.y,k=g,l=h,m=g,n=h;i>k?k=i:m=i,j>l?l=j:n=j;var o=b,p=c,q=b,r=c;d>o?o=d:q=d,e>p?p=e:r=e;var s=[];s.push((c-h)/(b-g)),s.push((c-h)/(d-g)),s.push((e-h)/(d-g)),s.push((e-h)/(b-g));var t=s[0],u=s[0];s.forEach(function(a){a>u&&(u=a),t>a&&(t=a)});var v,w=(j-h)/(i-g),x=h-w*g,y=b,z=w*y+x;y>=m&&k>=y&&z>=n&&l>=z&&z>=r&&p>=z&&(v=!0),y=d,z=w*y+x,y>=m&&k>=y&&z>=n&&l>=z&&z>=r&&p>=z&&(v=!0),z=c,y=(z-x)/w,y>=m&&k>=y&&z>=n&&l>=z&&y>=q&&o>=y&&(v=!0),z=e,y=(z-x)/w,y>=m&&k>=y&&z>=n&&l>=z&&y>=q&&o>=y&&(v=!0),g>=q&&o>=g&&h>=r&&p>=h&&i>=q&&o>=i&&j>=r&&p>=j&&(v=!0),v&&(a.shiftKey&&-1!=this.mapView.Selected.Edges.indexOf(f)?this.mapView.Control.deselectEdge(f):this.mapView.Control.selectEdge(f))}),this.mapView.Mouse.boxStartCoordinates=!1,this.mapView.Mouse.boxEndCoordinates=!1,this.mapView.Visualize.mGraph.plot()},c.prototype.drawSelectBox=function(a,b){var c=this.mapView.Visualize.mGraph.canvas.getCtx(),d=this.mapView.Mouse.boxStartCoordinates.x,e=this.mapView.Mouse.boxStartCoordinates.y,f=a.getPos().x,g=a.getPos().y;this.mapView.Visualize.mGraph.canvas.clear(),this.mapView.Visualize.mGraph.plot(),c.beginPath(),c.moveTo(d,e),c.lineTo(d,g),c.lineTo(f,g),c.lineTo(f,e),c.lineTo(d,e),c.strokeStyle="black",c.stroke()},c.prototype.selectNodeOnClickHandler=function(a,b){if(!this.mapView.Visualize.mGraph.busy){var c=this;if(-1!=navigator.platform.indexOf("Mac")&&b.ctrlKey)return void c.selectNodeOnRightClickHandler(a,b);if(this.mapView.Active.Topic&&b.altKey)return void this.mapView.RGraph.centerOn(a.id);var d=c.nodeWasDoubleClicked();return d?void c.nodeDoubleClickHandler(a,b):void setTimeout(function(){if(!this.nodeWasDoubleClicked()){var c=a.selected;b.shiftKey||(this.mapView.Control.deselectAllNodes(),this.mapView.Control.deselectAllEdges()),c?this.mapView.Control.deselectNode(a):this.mapView.Control.selectNode(a,b),this.mapView.Visualize.mGraph.fx.animate({modes:["edge-property:lineWidth:color:alpha"],duration:500}),this.mapView.Visualize.mGraph.plot()}},this.mapView.Mouse.DOUBLE_CLICK_TOLERANCE)}},c.prototype.selectNodeOnRightClickHandler=function(b,c){if(c.preventDefault(),c.stopPropagation(),!this.mapView.Visualize.mGraph.busy){this.mapView.Control.selectNode(b,c),a(".rightclickmenu").remove();var d=document.createElement("div");d.className="rightclickmenu";var e="<ul>",f=this.mapView.Active.Map&&this.mapView.Active.Map.authorizeToEdit(this.mapView.Active.Mapper),g=f?"":"disabled";if(this.mapView.Active.Map&&(e+='<li class="rc-hide"><div class="rc-icon"></div>Hide until refresh<div class="rc-keyboard">Ctrl+H</div></li>'),this.mapView.Active.Map&&this.mapView.Active.Mapper&&(e+='<li class="rc-remove '+g+'"><div class="rc-icon"></div>Remove from map<div class="rc-keyboard">Ctrl+M</div></li>'),this.mapView.Active.Map&&this.mapView.Active.Mapper&&(e+='<li class="rc-delete '+g+'"><div class="rc-icon"></div>Delete<div class="rc-keyboard">Ctrl+D</div></li>'),this.mapView.Active.Topic&&(e+='<li class="rc-center"><div class="rc-icon"></div>Center this topic</li>'),e+='<li class="rc-popout"><div class="rc-icon"></div>Open in new tab</li>',this.mapView.Active.Mapper){var h='<ul><li class="changeP toCommons"><div class="rc-perm-icon"></div>commons</li>                          <li class="changeP toPublic"><div class="rc-perm-icon"></div>public</li>                          <li class="changeP toPrivate"><div class="rc-perm-icon"></div>private</li>                      </ul>';e+='<li class="rc-spacer"></li>',e+='<li class="rc-permission"><div class="rc-icon"></div>Change permissions'+h+'<div class="expandLi"></div></li>';var i=a("#metacodeOptions").html();e+='<li class="rc-metacode"><div class="rc-icon"></div>Change metacode'+i+'<div class="expandLi"></div></li>'}if(this.mapView.Active.Topic){this.mapView.Active.Mapper||(e+='<li class="rc-spacer"></li>');var j='<ul id="fetchSiblingList">                                 <li class="fetchAll">All</li>                                 <li id="loadingSiblings"></li>                             </ul>';e+='<li class="rc-siblings"><div class="rc-icon"></div>Get siblings'+j+'<div class="expandLi"></div></li>'}e+="</ul>",d.innerHTML=e;var k={},l=300,m=144,n=256,o=270,p=a(window).width(),q=a(window).height();p-c.clientX<n?(k.right=p-c.clientX,a(d).addClass("moveMenusToLeft")):p-c.clientX<l?k.right=p-c.clientX:p-c.clientX<l+n?(k.left=c.clientX,a(d).addClass("moveMenusToLeft")):k.left=c.clientX,q-c.clientY<o?(k.bottom=q-c.clientY,a(d).addClass("moveMenusUp")):q-c.clientY<m+o?(k.top=c.clientY,a(d).addClass("moveMenusUp")):k.top=c.clientY,a(d).css(k),a("#wrapper").append(d),f&&a(".rc-delete").click(function(){a(".rightclickmenu").remove(),this.mapView.Control.deleteSelected()}),f&&a(".rc-remove").click(function(){a(".rightclickmenu").remove(),this.mapView.Control.removeSelectedEdges(),this.mapView.Control.removeSelectedNodes()}),a(".rc-hide").click(function(){a(".rightclickmenu").remove(),this.mapView.Control.hideSelectedEdges(),this.mapView.Control.hideSelectedNodes()}),a(".rc-center").click(function(){a(".rightclickmenu").remove(),this.mapView.Topic.centerOn(b.id)}),a(".rc-popout").click(function(){a(".rightclickmenu").remove();var c=window.open("/topics/"+b.id,"_blank");c.focus()}),a(".rc-permission li").click(function(){a(".rightclickmenu").remove(),this.mapView.Control.updateSelectedPermissions(a(this).text())}),a(".rc-metacode li li").click(function(){a(".rightclickmenu").remove(),this.mapView.Control.updateSelectedMetacodes(a(this).attr("data-id"))});var r=!1;a(".rc-siblings").hover(function(){r||(this.populateRightClickSiblings(b),r=!0)}),a(".rc-siblings .fetchAll").click(function(){a(".rightclickmenu").remove(),this.mapView.Topic.fetchRelatives(b)})}},c.prototype.populateRightClickSiblings=function(b){var c=b.getData("topic"),d=new CanvasLoader("loadingSiblings");d.setColor("#4FC059"),d.setDiameter(15),d.setDensity(41),d.setRange(.9),d.show();var e=this.mapView.Topics.map(function(a){return a.id}),f=e.join(),g=function(c){a("#loadingSiblings").remove();for(var d in c){var e=this.mapView.Metacodes.get(d).get("name")+" ("+c[d]+")";a("#fetchSiblingList").append('<li class="getSiblings" data-id="'+d+'">'+e+"</li>")}a(".rc-siblings .getSiblings").click(function(){a(".rightclickmenu").remove(),this.mapView.Topic.fetchRelatives(b,a(this).attr("data-id"))})};a.ajax({type:"Get",url:"/topics/"+c.id+"/relative_numbers.json?network="+f,success:g,error:function(){}})},c.prototype.selectEdgeOnClickHandler=function(a,b){if(!this.mapView.Visualize.mGraph.busy){var c=this;if(-1!=navigator.platform.indexOf("Mac")&&b.ctrlKey)return void c.selectEdgeOnRightClickHandler(a,b);var d=c.nodeWasDoubleClicked();return d?void c.edgeDoubleClickHandler(a,b):void setTimeout(function(){if(!this.nodeWasDoubleClicked()){var c=-1!==this.mapView.Selected.Edges.indexOf(a);b.shiftKey||(this.mapView.Control.deselectAllNodes(),this.mapView.Control.deselectAllEdges()),c?this.mapView.Control.deselectEdge(a):this.mapView.Control.selectEdge(a),this.mapView.Visualize.mGraph.plot()}},this.mapView.Mouse.DOUBLE_CLICK_TOLERANCE)}},c.prototype.selectEdgeOnRightClickHandler=function(b,c){if(0!==b.getData("alpha")){var d;if(c.preventDefault(),c.stopPropagation(),!this.mapView.Visualize.mGraph.busy){this.mapView.Control.selectEdge(b),a(".rightclickmenu").remove();var e=document.createElement("div");e.className="rightclickmenu";var f="<ul>",d=this.mapView.Active.Map&&this.mapView.Active.Map.authorizeToEdit(this.mapView.Active.Mapper),g=d?"":"disabled";if(this.mapView.Active.Map&&(f+='<li class="rc-hide"><div class="rc-icon"></div>Hide until refresh<div class="rc-keyboard">Ctrl+H</div></li>'),this.mapView.Active.Map&&this.mapView.Active.Mapper&&(f+='<li class="rc-remove '+g+'"><div class="rc-icon"></div>Remove from map<div class="rc-keyboard">Ctrl+M</div></li>'),this.mapView.Active.Map&&this.mapView.Active.Mapper&&(f+='<li class="rc-delete '+g+'"><div class="rc-icon"></div>Delete<div class="rc-keyboard">Ctrl+D</div></li>'),this.mapView.Active.Map&&this.mapView.Active.Mapper&&(f+='<li class="rc-spacer"></li>'),this.mapView.Active.Mapper){var h='<ul><li class="changeP toCommons"><div class="rc-perm-icon"></div>commons</li>                          <li class="changeP toPublic"><div class="rc-perm-icon"></div>public</li>                          <li class="changeP toPrivate"><div class="rc-perm-icon"></div>private</li>                      </ul>';f+='<li class="rc-permission"><div class="rc-icon"></div>Change permissions'+h+'<div class="expandLi"></div></li>'}f+="</ul>",e.innerHTML=f;var i={},j=300,k=144,l=256,m=270,n=a(window).width(),o=a(window).height();n-c.clientX<l?(i.right=n-c.clientX,a(e).addClass("moveMenusToLeft")):n-c.clientX<j?i.right=n-c.clientX:i.left=c.clientX,o-c.clientY<m?(i.bottom=o-c.clientY,a(e).addClass("moveMenusUp")):o-c.clientY<k+m?(i.top=c.clientY,a(e).addClass("moveMenusUp")):i.top=c.clientY,a(e).css(i),a("#wrapper").append(e),d&&a(".rc-delete").click(function(){a(".rightclickmenu").remove(),this.mapView.Control.deleteSelected()}),d&&a(".rc-remove").click(function(){a(".rightclickmenu").remove(),this.mapView.Control.removeSelectedEdges(),this.mapView.Control.removeSelectedNodes()}),a(".rc-hide").click(function(){a(".rightclickmenu").remove(),this.mapView.Control.hideSelectedEdges(),this.mapView.Control.hideSelectedNodes()}),a(".rc-permission li").click(function(){a(".rightclickmenu").remove(),this.mapView.Control.updateSelectedPermissions(a(this).text())})}}},c.prototype.SmoothPanning=function(){function b(){this.mapView.Visualize.mGraph.canvas.translate(f*g*1/c,e*g*1/d),a(document).trigger(this.events.pan),g=.75*g,.1>g&&window.clearInterval(panningInt)}var c=this.mapView.Visualize.mGraph.canvas.scaleOffsetX,d=this.mapView.Visualize.mGraph.canvas.scaleOffsetY,e=this.mapView.Mouse.changeInY,f=this.mapView.Mouse.changeInX,g=1;g=1,window.clearInterval(panningInt),panningInt=setInterval(function(){b()},1)},c.prototype.renderMidArrow=function(a,b,c,d,e,f,g){var h=e.getCtx();if(d){var i=a;a=b,b=i}var j=new $jit.Complex(b.x-a.x,b.y-a.y);j.$scale(c/j.norm());var k=(b.x-a.x)*f+a.x,l=(b.y-a.y)*f+a.y,m=new $jit.Complex(k,l),n=new $jit.Complex(j.x/.7+m.x,j.y/.7+m.y),o=new $jit.Complex(n.x-j.x,n.y-j.y),p=new $jit.Complex(-j.y/2,j.x/2),q=o.add(p),r=o.$add(p.$scale(-1));g&&(h.strokeStyle="#4fc059",h.lineWidth=2,h.globalAlpha=1),h.beginPath(),h.moveTo(a.x,a.y),h.lineTo(b.x,b.y),h.stroke(),h.beginPath(),h.moveTo(q.x,q.y),h.lineTo(n.x,n.y),h.lineTo(r.x,r.y),h.stroke()},c.prototype.renderEdgeArrows=function(a,b,c,d){var e=this,f=c.get("category"),g=c.getDirection(),h=b.nodeFrom.pos.getc(!0),i=b.nodeTo.pos.getc(!0);if("none"==f)a.line.render({x:h.x,y:h.y},{x:i.x,y:i.y},d);else if("both"==f)e.renderMidArrow({x:h.x,y:h.y},{x:i.x,y:i.y},13,!0,d,.7),e.renderMidArrow({x:h.x,y:h.y},{x:i.x,y:i.y},13,!1,d,.7);else if("from-to"==f){var j=g[0]!=b.nodeFrom.id;e.renderMidArrow({x:h.x,y:h.y},{x:i.x,y:i.y},13,j,d,.7),e.renderMidArrow({x:h.x,y:h.y},{x:i.x,y:i.y},13,j,d,.3)}},c.prototype.zoomIn=function(b){this.mapView.Visualize.mGraph.canvas.scale(1.25,1.25),a(document).trigger(this.events.zoom,[b])},c.prototype.zoomOut=function(b){this.mapView.Visualize.mGraph.canvas.scale(.8,.8),a(document).trigger(this.events.zoom,[b])},c.prototype.centerMap=function(a){var b=a.scaleOffsetX;a.scale(1/b,1/b);var c=a.translateOffsetX,d=a.translateOffsetY;a.translate(-1*c,-1*d)},c.prototype.zoomToBox=function(b){var c=this.mapView.Mouse.boxStartCoordinates.x,d=this.mapView.Mouse.boxStartCoordinates.y,e=this.mapView.Mouse.boxEndCoordinates.x,f=this.mapView.Mouse.boxEndCoordinates.y,g=this.mapView.Visualize.mGraph.canvas;this.centerMap(g);var h=a(document).height(),i=a(document).width(),j=Math.abs(c-e),k=Math.abs(d-f),l=i/j,m=h/k,n=Math.min(l,m);g.scaleOffsetX*n<=5&&g.scaleOffsetX*n>=.2?g.scale(n,n):g.scaleOffsetX*n>5?(n=5/g.scaleOffsetX,g.scale(n,n)):(n=.2/g.scaleOffsetX,g.scale(n,n));var o=(c+e)/2,p=(d+f)/2;g.translate(-1*o,-1*p),a(document).trigger(this.events.zoom,[b]),this.mapView.Mouse.boxStartCoordinates=!1,this.mapView.Mouse.boxEndCoordinates=!1,this.mapView.Visualize.mGraph.plot()},c.prototype.zoomExtents=function(b,c,d){this.centerMap(c);var e,f,g,h,i=c.getSize().height,j=c.getSize().width,k=0;if(!d&&this.mapView.Selected.Nodes.length>0)var l=this.mapView.Selected.Nodes;else var l=_.values(this.mapView.Visualize.mGraph.graph.nodes);if(l.length>1){l.forEach(function(a){var b=a.pos.x,d=a.pos.y;0==k&&1==a.getData("alpha")&&(e=b,f=b,g=d,h=d);var i,j=this.mapView.Util.splitLine(a.name,30).split("\n"),l=a.getData("dim"),m=c.getCtx(),n=25*j.length,o=[];for(i=0;i<j.length;++i)o.push(m.measureText(j[i]).width);var p=Math.max.apply(null,o)+8;1==a.getData("alpha")&&(e=Math.max(b+p/2,e),g=Math.max(d+a.getData("height")+5+n,g),f=Math.min(b-p/2,f),h=Math.min(d-l,h),k++)});var m=e-f,n=g-h,o=m/j,p=n/i,q=(e+f)/2,r=(g+h)/2;c.translate(-1*q,-1*r);var s=Math.max(o,p),t=1/s*.9;c.scaleOffsetX*t<=3&&c.scaleOffsetX*t>=.2?c.scale(t,t):c.scaleOffsetX*t>3?(t=3/c.scaleOffsetX,c.scale(t,t)):(t=.2/c.scaleOffsetX,c.scale(t,t)),a(document).trigger(this.events.zoom,[b])}else 1==l.length&&l.forEach(function(d){var e=d.pos.x,f=d.pos.y;c.translate(-1*e,-1*f),a(document).trigger(this.events.zoom,[b])})},c}(jQuery),Mapmaker.JIT.events={topicDrag:"this.mapView:JIT:events:topicDrag",newTopic:"this.mapView:JIT:events:newTopic",deleteTopic:"this.mapView:JIT:events:deleteTopic",removeTopic:"this.mapView:JIT:events:removeTopic",newSynapse:"this.mapView:JIT:events:newSynapse",deleteSynapse:"this.mapView:JIT:events:deleteSynapse",removeSynapse:"this.mapView:JIT:events:removeSynapse",pan:"this.mapView:JIT:events:pan",zoom:"this.mapView:JIT:events:zoom",animationDone:"this.mapView:JIT:events:animationDone"},"undefined"==typeof Mapmaker&&(Mapmaker={}),Mapmaker.Realtime=function(a){var b=function(b){this.mapView=b,this.$parent=b.$parent,this.$myVideo=a('<video id="video-wrapper"></video>'),this.myVideo=new Mapmaker.VideoView(this.$myVideo[0],this.mapView,"me",!0),this.messages=this.mapView.currentMap.get("messages");var c=this.mapView.currentMapper;this.chat=new Mapmaker.ChatView(this.mapView,this.messages,c),this.webRtcUrl="http://localhost:5002",this.stringForLocalhost="http://localhost:5002",this.stringForMetamaps="http://metamaps.cc:5001",this.stringForHeroku="http://gentle-savannah-1303.herokuapp.com",this.socket=null,this.isOpen=!1,this.changing=!1,this.mappersOnMap={},this.videos={},this.status=!0};return b.prototype.init=function(){var b=this,c=function(){b.reenableRealtime()},d=function(){b.turnOff()};a(".rtOn").click(c),a(".rtOff").click(d),a(".sidebarCollaborateIcon").click(b.toggleBox),a(".sidebarCollaborateBox").click(function(a){a.stopPropagation()}),a("body").click(b.close);var e="development",f="development"===e?b.stringForLocalhost:b.stringForHeroku;b.socket=io.connect(f),b.socket.on("connect",function(){b.startActiveMap()}),this.initVideo()},b.prototype.initVideo=function(){var a=this;this.webrtc=new SimpleWebRTC({localVideoEl:this.$myVideo.attr("id"),remoteVideosEl:"",url:this.webRtcUrl,detectSpeakingEvents:!0,autoAdjustMic:!1,autoRequestMedia:!0,localVideo:{autoplay:!0,mirror:!0,muted:!0},media:{video:!0,audio:!0}}),this.webrtc.on("readyToCall",function(){a.webrtc.joinRoom("map"+a.mapView.currentMap.id,function(a,b){a?console.log(a):console.log("we joined the room!")})}),this.webrtc.createRoom("map"+a.mapView.currentMap.id,function(a,b){a?console.log("room already created"):console.log("created room: "+b)}),this.webrtc.on("videoAdded",this.addVideo.bind(this)),this.webrtc.on("videoRemoved",this.removeVideo.bind(this))},b.prototype.addVideo=function(a,b){var c=this.webrtc.getDomId(b),d=this.videos[c]=new Mapmaker.VideoView(a,this.mapView,c);this.$parent.append(d.$container);var e=Math.floor(Math.random()*(this.$parent.height()-100)+1),f=Math.floor(Math.random()*(this.$parent.width()-100)+1);d.$container.css({top:e+"px",left:f+"px"})},b.prototype.removeVideo=function(a,b){var c=this.webrtc.getDomId(b);this.videos[c].remove(),delete this.videos[c]},b.prototype.toggleBox=function(a){var b=this;b.isOpen?b.close():b.open(),a.stopPropagation()},b.prototype.open=function(){var b=this;this.mapView.GlobalUI.Account.close(),this.mapView.Filter.close(),a(".sidebarCollaborateIcon div").addClass("hide"),b.isOpen||b.changing||(b.changing=!0,a(".sidebarCollaborateBox").fadeIn(200,function(){b.changing=!1,b.isOpen=!0}))},b.prototype.close=function(){var b=this;a(".sidebarCollaborateIcon div").removeClass("hide"),b.changing||(b.changing=!0,a(".sidebarCollaborateBox").fadeOut(200,function(){b.changing=!1,b.isOpen=!1}))},b.prototype.startActiveMap=function(){var a=this;if(this.mapView.currentMap&&this.mapView.currentMapper){var b="commons"===this.mapView.currentMap.get("permission"),c="public"===this.mapView.currentMap.get("permission");b?(a.turnOn(),a.setupSocket()):c&&a.attachMapListener()}},b.prototype.endActiveMap=function(){var b=this;a(document).off("mousemove"),b.socket.removeAllListeners(),b.socket.emit("endMapperNotify"),a(".collabCompass").remove(),b.status=!1},b.prototype.reenableRealtime=function(){var a="The layout of your map has fallen out of sync with the saved copy. ";a+="To save your changes without overwriting the map, hit 'Cancel' and ",a+="then use 'Save to new map'. ",a+="Do you want to discard your changes and enable realtime?";var b=confirm(a);b&&this.mapView.Router.maps(this.mapView.currentMap.id)},b.prototype.turnOn=function(b){var c=this;b&&c.sendRealtimeOn(),a(".rtMapperSelf").removeClass("littleRtOff").addClass("littleRtOn"),a(".rtOn").addClass("active"),a(".rtOff").removeClass("active"),c.status=!0,a(".sidebarCollaborateIcon").addClass("blue"),a(".collabCompass").show()},b.prototype.turnOff=function(b){var c=this;c.status&&(b||c.sendRealtimeOff(),a(".rtMapperSelf").removeClass("littleRtOn").addClass("littleRtOff"),a(".rtOn").removeClass("active"),a(".rtOff").addClass("active"),c.status=!1,a(".sidebarCollaborateIcon").removeClass("blue"),a(".collabCompass").hide())},b.prototype.setupSocket=function(){var b=this,c=this.socket,d=this.mapView.currentMapper.id;c.emit("newMapperNotify",{userid:d,username:this.mapView.currentMapper.get("name"),userimage:this.mapView.currentMapper.get("image"),mapid:this.mapView.currentMap.id}),c.on(d+"-"+this.mapView.currentMap.id+"-UpdateMapperList",b.updateMapperList.bind(b)),c.on("maps-"+this.mapView.currentMap.id+"-newmapper",b.newPeerOnMap.bind(b)),c.on("maps-"+this.mapView.currentMap.id+"-lostmapper",b.lostPeerOnMap.bind(b)),c.on("maps-"+this.mapView.currentMap.id+"-newrealtime",b.newCollaborator.bind(b)),c.on("maps-"+this.mapView.currentMap.id+"-lostrealtime",b.lostCollaborator.bind(b)),c.on("maps-"+this.mapView.currentMap.id+"-topicDrag",b.topicDrag.bind(b)),c.on("maps-"+this.mapView.currentMap.id+"-newTopic",b.newTopic.bind(b)),c.on("maps-"+this.mapView.currentMap.id+"-removeTopic",b.removeTopic.bind(b)),c.on("maps-"+this.mapView.currentMap.id+"-newSynapse",b.newSynapse.bind(b)),c.on("maps-"+this.mapView.currentMap.id+"-removeSynapse",b.removeSynapse.bind(b)),c.on("maps-"+this.mapView.currentMap.id+"-updatePeerCoords",b.updatePeerCoords.bind(b)),c.on("maps-"+this.mapView.currentMap.id+"-chatMessage",function(a){b.messages.add(a)}),c.on("deleteTopicFromServer",b.removeTopic),c.on("deleteSynapseFromServer",b.removeSynapse),c.on("topicChangeFromServer",b.topicChange),c.on("synapseChangeFromServer",b.synapseChange),b.attachMapListener();var e=function(a){var c={x:a.pageX,y:a.pageY},d=Mapmaker.Utility.pixelsToCoords(c,b.mapView);b.sendCoords(d)};a(document).mousemove(e);var f=function(a,c){if(c){var d={x:c.pageX,y:c.pageY},e=Mapmaker.Utility.pixelsToCoords(d,b.mapView);b.sendCoords(e)}b.positionPeerIcons()};a(document).on(Mapmaker.JIT.events.zoom,f),a(document).on(Mapmaker.JIT.events.pan,b.positionPeerIcons);var g=function(a,c){b.sendTopicDrag(c)};a(document).on(Mapmaker.JIT.events.topicDrag,g);var h=function(a,c){b.sendNewTopic(c)};a(document).on(Mapmaker.JIT.events.newTopic,h);var i=function(a,c){b.sendDeleteTopic(c)};a(document).on(Mapmaker.JIT.events.deleteTopic,i);var j=function(a,c){b.sendRemoveTopic(c)};a(document).on(Mapmaker.JIT.events.removeTopic,j);var k=function(a,c){b.sendNewSynapse(c)};a(document).on(Mapmaker.JIT.events.newSynapse,k);var l=function(a,c){b.sendDeleteSynapse(c)};a(document).on(Mapmaker.JIT.events.deleteSynapse,l);var m=function(a,c){b.sendRemoveSynapse(c)};a(document).on(Mapmaker.JIT.events.removeSynapse,m);var n=function(a,c){b.sendChatMessage(c)};a(document).on(Mapmaker.ChatView.events.message,n)},b.prototype.attachMapListener=function(){var a=this,b=this.socket;b.on("mapChangeFromServer",a.mapChange)},b.prototype.sendRealtimeOn=function(){var a=this.socket,b={username:this.mapView.currentMapper.get("name"),userid:this.mapView.currentMapper.id,mapid:this.mapView.currentMap.id};a.emit("notifyStartRealtime",b)},b.prototype.sendRealtimeOff=function(){var a=this.socket,b={username:this.mapView.currentMapper.get("name"),userid:this.mapView.currentMapper.id,mapid:this.mapView.currentMap.id};a.emit("notifyStopRealtime",b)},b.prototype.updateMapperList=function(b){var c=this;this.socket;c.mappersOnMap[b.userid]={name:b.username,image:b.userimage,color:Mapmaker.Utility.getPastelColor(),realtime:b.userrealtime,coords:{x:0,y:0}};var d=b.userrealtime?"On":"Off",e='<li id="mapper';e+=b.userid,e+='" class="rtMapper littleRt',e+=d,e+='">',e+='<img style="border: 2px solid '+c.mappersOnMap[b.userid].color+';"',e+=' src="'+b.userimage+'" width="24" height="24" class="rtUserImage" />',e+=b.username,e+='<div class="littleJuntoIcon"></div>',e+="</li>",b.userid!==this.mapView.currentMapper.id&&(a("#mapper"+b.userid).remove(),a(".realtimeMapperList ul").append(e),c.createCompass(b.username,b.userid,b.userimage,c.mappersOnMap[b.userid].color,!c.status))},b.prototype.newPeerOnMap=function(b){var c=this,d=this.socket;if(c.mappersOnMap[b.userid]={name:b.username,image:b.userimage,color:Mapmaker.Utility.getPastelColor(),realtime:!0,coords:{x:0,y:0}},b.userid!==this.mapView.currentMapper.id&&c.status){var e='<li id="mapper'+b.userid+'" class="rtMapper littleRtOn">';e+='<img style="border: 2px solid '+c.mappersOnMap[b.userid].color+';"',e+=' src="'+b.userimage+'" width="24" height="24" class="rtUserImage" />',e+=b.username,e+='<div class="littleJuntoIcon"></div>',e+="</li>",a("#mapper"+b.userid).remove(),a(".realtimeMapperList ul").append(e),c.createCompass(b.username,b.userid,b.userimage,c.mappersOnMap[b.userid].color,!c.status),console.log(b.username+" just joined the map");var f={userToNotify:b.userid,username:this.mapView.currentMapper.get("name"),userimage:this.mapView.currentMapper.get("image"),userid:this.mapView.currentMapper.id,userrealtime:c.status,mapid:this.mapView.currentMap.id};d.emit("updateNewMapperList",f)}},b.prototype.createCompass=function(b,c,d,e,f){var g='<img width="28" height="28" src="'+d+'" /><p>'+b+"</p>";g+='<div id="compassArrow'+c+'" class="compassArrow"></div>',a("#compass"+c).remove(),a("<div/>",{id:"compass"+c,"class":"collabCompass"}).html(g).appendTo(this.mapView.$parent),f&&a("#compass"+c).hide(),a("#compass"+c+" img").css({border:"2px solid "+e}),a("#compass"+c+" p").css({"background-color":e})},b.prototype.lostPeerOnMap=function(b){var c=this;this.socket;delete c.mappersOnMap[b.userid],a("#mapper"+b.userid).remove(),a("#compass"+b.userid).remove(),console.log(b.username+" just left the map")},b.prototype.newCollaborator=function(b){var c=this;this.socket;c.mappersOnMap[b.userid].realtime=!0,a("#mapper"+b.userid).removeClass("littleRtOff").addClass("littleRtOn"),a("#compass"+b.userid).show(),console.log(b.username+" just turned on realtime")},b.prototype.lostCollaborator=function(b){var c=this;this.socket;c.mappersOnMap[b.userid].realtime=!1,a("#mapper"+b.userid).removeClass("littleRtOn").addClass("littleRtOff"),a("#compass"+b.userid).hide(),console.log(b.username+" just turned off realtime")},b.prototype.updatePeerCoords=function(a){var b=this;this.socket;b.mappersOnMap[a.userid]&&(b.mappersOnMap[a.userid].coords={x:a.usercoords.x,y:a.usercoords.y},b.positionPeerIcon(a.userid))},b.prototype.positionPeerIcons=function(){var a=this;this.socket;if(a.status)for(var b in a.mappersOnMap){var c=a.mappersOnMap[b];c.realtime&&a.positionPeerIcon(b)}},b.prototype.positionPeerIcon=function(b){var c=this,d=(this.socket,c.mappersOnMap[b]),e=(a(document).width(),a(document).height(),Mapmaker.Utility.coordsToPixels(d.coords,c.mapView)),f=c.limitPixelsToScreen(e);if(a("#compass"+b).css({left:f.x+"px",top:f.y+"px"}),e.x!==f.x||e.y!==f.y){var g=e.y-f.y,h=e.x-f.x,i=Math.atan2(g,h);a("#compassArrow"+b).show().css({transform:"rotate("+i+"rad)","-webkit-transform":"rotate("+i+"rad)"}),h>0&&a("#compass"+b).addClass("labelLeft")}else a("#compassArrow"+b).hide(),a("#compass"+b).removeClass("labelLeft")},b.prototype.limitPixelsToScreen=function(a){var b,c,d=(this.socket,this.mapView.$parent.width()),e=this.mapView.$parent.height(),f=56,g=24;return b=Math.max(0+g,a.x),b=Math.min(b,d-f),c=Math.max(0+g,a.y),c=Math.min(c,e-f),{x:b,y:c}},b.prototype.sendCoords=function(a){var b=this,c=this.socket,d=this.mapView.currentMap,e=this.mapView.currentMapper;if(b.status&&d.authorizeToEdit(e)&&c){var f={usercoords:a,userid:this.mapView.currentMapper.id,mapid:this.mapView.currentMap.id};c.emit("updateMapperCoords",f)}},b.prototype.sendTopicDrag=function(a){var b=this,c=b.socket;this.mapView.currentMap&&b.status&&(a.mapid=this.mapView.currentMap.id,c.emit("topicDrag",a))},b.prototype.topicDrag=function(a){var b,c,d=this;d.socket;if(this.mapView.currentMap&&d.status){for(var e in a)b=this.mapView.Topics.get(e),b&&(c=b.get("node")),c&&c.pos.setc(a[e].x,a[e].y);this.mapView.Visualize.mGraph.plot()}},b.prototype.sendTopicChange=function(a){var b=this,c=b.socket,d={topicId:a.id};c.emit("topicChangeFromClient",d)},b.prototype.topicChange=function(a){var b=this.mapView.Topics.get(a.topicId);if(b){var c=b.get("node");b.fetch({success:function(a){a.set({node:c}),a.trigger("changeByOther")}})}},b.prototype.sendSynapseChange=function(a){var b=this,c=b.socket,d={synapseId:a.id};c.emit("synapseChangeFromClient",d)},b.prototype.synapseChange=function(a){var b=this.mapView.Synapses.get(a.synapseId);if(b){var c=b.get("edge");b.fetch({success:function(a){a.set({edge:c}),a.trigger("changeByOther")}})}},b.prototype.sendMapChange=function(a){
var b=this,c=b.socket,d={mapId:a.id};c.emit("mapChangeFromClient",d)},b.prototype.mapChange=function(a){var b=this.mapView.currentMap,c=b&&a.mapId===b.id;if(c){var d=b.get("permission"),e=b.id;b.fetch({success:function(a,b){var c=a.id,f=a.get("permission");c!==e?this.mapView.Map.leavePrivateMap():"public"===f&&"commons"===d?this.mapView.Map.commonsToPublic():"commons"===f&&"public"===d?this.mapView.Map.publicToCommons():(a.fetchContained(),a.trigger("changeByOther"))}})}},b.prototype.sendNewTopic=function(a){var b=this,c=b.socket;this.mapView.currentMap&&b.status&&(a.mapperid=this.mapView.currentMapper.id,a.mapid=this.mapView.currentMap.id,c.emit("newTopic",a))},b.prototype.newTopic=function(b){function c(){d&&e&&f?this.mapView.Topic.renderTopic(e,d,!1,!1):h||setTimeout(c,10)}var d,e,f,g,h,i=this;i.socket;i.status&&(f=this.mapView.Mappers.get(b.mapperid),void 0===f&&(g=function(a){this.mapView.Mappers.add(a),f=a},this.mapView.Mapper.get(b.mapperid,g)),a.ajax({url:"/topics/"+b.topicid+".json",success:function(a){this.mapView.Topics.add(a),d=this.mapView.Topics.get(a.id)},error:function(){h=!0}}),a.ajax({url:"/mappings/"+b.mappingid+".json",success:function(a){this.mapView.Mappings.add(a),e=this.mapView.Mappings.get(a.id)},error:function(){h=!0}}),c())},b.prototype.sendDeleteTopic=function(a){var b=this,c=b.socket;this.mapView.currentMap&&c.emit("deleteTopicFromClient",a)},b.prototype.sendRemoveTopic=function(a){var b=this,c=b.socket;this.mapView.currentMap&&(a.mapid=this.mapView.currentMap.id,c.emit("removeTopic",a))},b.prototype.removeTopic=function(a){var b=this;b.socket;if(b.status){var c=this.mapView.Topics.get(a.topicid);if(c){var d=c.get("node"),e=c.getMapping();this.mapView.Control.hideNode(d.id),this.mapView.Topics.remove(c),this.mapView.Mappings.remove(e)}}},b.prototype.sendNewSynapse=function(a){var b=this,c=b.socket;this.mapView.currentMap&&(a.mapperid=this.mapView.currentMapper.id,a.mapid=this.mapView.currentMap.id,c.emit("newSynapse",a))},b.prototype.newSynapse=function(b){function c(){h&&i&&mapper?(d=h.getTopic1(),f=d.get("node"),e=h.getTopic2(),g=e.get("node"),this.mapView.Synapse.renderSynapse(i,h,f,g,!1)):j||setTimeout(c,10)}var d,e,f,g,h,i,j,k=this;k.socket;k.status&&(mapper=this.mapView.Mappers.get(b.mapperid),void 0===mapper&&(mapperCallback=function(a){this.mapView.Mappers.add(a),mapper=a},this.mapView.Mapper.get(b.mapperid,mapperCallback)),a.ajax({url:"/synapses/"+b.synapseid+".json",success:function(a){this.mapView.Synapses.add(a),h=this.mapView.Synapses.get(a.id)},error:function(){j=!0}}),a.ajax({url:"/mappings/"+b.mappingid+".json",success:function(a){this.mapView.Mappings.add(a),i=this.mapView.Mappings.get(a.id)},error:function(){j=!0}}),c())},b.prototype.sendDeleteSynapse=function(a){var b=this,c=b.socket;this.mapView.currentMap&&(a.mapid=this.mapView.currentMap.id,c.emit("deleteSynapseFromClient",a))},b.prototype.sendRemoveSynapse=function(a){var b=this,c=b.socket;this.mapView.currentMap&&(a.mapid=this.mapView.currentMap.id,c.emit("removeSynapse",a))},b.prototype.removeSynapse=function(a){var b=this;b.socket;if(b.status){var c=this.mapView.Synapses.get(a.synapseid);if(c){var d=c.get("edge"),e=c.getMapping();d.getData("mappings").length-1===0&&this.mapView.Control.hideEdge(d);var f=_.indexOf(d.getData("synapses"),c);d.getData("mappings").splice(f,1),d.getData("synapses").splice(f,1),d.getData("displayIndex")&&delete d.data.$displayIndex,this.mapView.Synapses.remove(c),this.mapView.Mappings.remove(e)}}},b.prototype.sendChatMessage=function(a){var b=this,c=b.socket,d={mapid:this.mapView.currentMap.id,message:a};c.emit("chatMessage",d)},b}(jQuery),"undefined"==typeof Mapmaker&&(Mapmaker={}),Mapmaker.Visualize=function(a){var b=function(a){this.mapView=a,this.mGraph=null,this.cameraPosition=null,this.type="ForceDirected",this.loadLater=!1};return b.prototype.init=function(){var b=this;a("#infovis-canvas").on("dragstart",function(a){a.preventDefault()}),a("#infovis-canvas").bind("touchstart",function(a){a.preventDefault(),b.mGraph.events.touched=!0}),a("#infovis-canvas").bind("touchmove",function(a){}),a("#infovis-canvas").bind("touchend touchcancel",function(a){lastDist=0,b.mGraph.events.touchMoved||b.mapView.Touch.touchDragNode||b.mapView.TopicCard.hideCurrentCard(),b.mGraph.events.touched=b.mGraph.events.touchMoved=!1,b.mapView.Touch.touchDragNode=!1})},b.prototype.computePositions=function(){var a,b=this;if("RGraph"==b.type){var c,d,e,f,g,h;b.mGraph.graph.eachNode(function(a){g=b.mapView.Topics.get(a.id),g.set({node:a},{silent:!0}),g.updateNode(),a.eachAdjacency(function(a){if(!a.getData("init"))for(a.setData("init",!0),d=a.getData("synapseIDs").length,c=0;d>c;c++)h=b.mapView.Synapses.get(a.getData("synapseIDs")[c]),h.set({edge:a},{silent:!0}),h.updateEdge()});var e=a.getPos();e.setc(-200,-200)}),b.mGraph.compute("end")}else if("ForceDirected"==b.type){var c,d,e,f,g,h;b.mGraph.graph.eachNode(function(i){g=b.mapView.Topics.get(i.id),g.set({node:i},{silent:!0}),g.updateNode(),a=g.getMapping(),i.eachAdjacency(function(a){if(!a.getData("init"))for(a.setData("init",!0),d=a.getData("synapseIDs").length,c=0;d>c;c++)h=b.mapView.Synapses.get(a.getData("synapseIDs")[c]),h.set({edge:a},{silent:!0}),h.updateEdge()}),e=new $jit.Complex(0,0),f=new $jit.Complex(a.get("xloc"),a.get("yloc")),i.setPos(e,"start"),i.setPos(f,"end")})}else"ForceDirected3D"==b.type&&b.mGraph.compute()},b.prototype.render=function(){var b,c,d=this;if("RGraph"==d.type&&(!d.mGraph||d.mGraph instanceof $jit.ForceDirected)?(b=a.extend(!0,{},this.mapView.JIT.ForceDirected.graphSettings),$jit.RGraph.Plot.NodeTypes.implement(this.mapView.JIT.ForceDirected.nodeSettings),$jit.RGraph.Plot.EdgeTypes.implement(this.mapView.JIT.ForceDirected.edgeSettings),b.width=a(document).width(),b.height=a(document).height(),b.background=this.mapView.JIT.RGraph.background,b.levelDistance=this.mapView.JIT.RGraph.levelDistance,d.mGraph=new $jit.RGraph(b)):"ForceDirected"==d.type&&(!d.mGraph||d.mGraph instanceof $jit.RGraph)?(c=a.extend(!0,{},this.mapView.JIT.ForceDirected.graphSettings),$jit.ForceDirected.Plot.NodeTypes.implement(this.mapView.JIT.ForceDirected.nodeSettings),$jit.ForceDirected.Plot.EdgeTypes.implement(this.mapView.JIT.ForceDirected.edgeSettings),c.width=a(document).width(),c.height=a(document).height(),d.mGraph=new $jit.ForceDirected(c)):"ForceDirected3D"!=d.type||d.mGraph?d.mGraph.graph.empty():(d.mGraph=new $jit.ForceDirected3D(this.mapView.JIT.ForceDirected3D.graphSettings),d.cameraPosition=d.mGraph.canvas.canvases[0].camera.position),this.mapView.Loading.hide(),!d.loadLater){var e=0;if(this.mapView.Active.Topic){var f=_.find(this.mapView.JIT.vizData,function(a){return a.id===this.mapView.Active.Topic.id});e=_.indexOf(this.mapView.JIT.vizData,f)}d.mGraph.loadJSON(this.mapView.JIT.vizData,e),d.computePositions(),d.mGraph.busy=!0,"RGraph"==d.type?d.mGraph.fx.animate(this.mapView.JIT.RGraph.animate):"ForceDirected"==d.type?d.mGraph.animate(this.mapView.JIT.ForceDirected.animateSavedLayout):"ForceDirected3D"==d.type&&d.mGraph.animate(this.mapView.JIT.ForceDirected.animateFDLayout)}setTimeout(function(){var a=d.mapView.Active.Map,b=d.mapView.Active.Topic;a&&window.location.pathname!=="/maps/"+a.id?d.mapView.Router.navigate("/maps/"+a.id):b&&window.location.pathname!=="/topics/"+b.id&&d.mapView.Router.navigate("/topics/"+b.id)},800)},b}(jQuery),"undefined"==typeof Mapmaker&&(Mapmaker={}),Mapmaker.Maker=function(a){var b=function(a,b){this.view=a,this.map=b};return b.prototype.launch=function(b){var c=Mapmaker.Backbone,d=function(b){Mapmaker.Active.Map=new c.Map(b.map),Mapmaker.Mappers=new c.MapperCollection(b.mappers),Mapmaker.Topics=new c.TopicCollection(b.topics),Mapmaker.Synapses=new c.SynapseCollection(b.synapses),Mapmaker.Mappings=new c.MappingCollection(b.mappings),Mapmaker.Backbone.attachCollectionEvents();var d=Mapmaker.Active.Map,e=Mapmaker.Active.Mapper;d.authorizeToEdit(e)&&a(".wrapper").addClass("canEditMap"),"commons"===d.get("permission")&&a(".wrapper").addClass("commonsMap"),a("#filter_by_mapper h3").html("MAPPERS"),Mapmaker.Visualize.type="ForceDirected",Mapmaker.JIT.prepareVizData(),Mapmaker.Filter.reset(),Mapmaker.Selected.reset(),Mapmaker.Map.InfoBox.load(),Mapmaker.Filter.checkMetacodes(),Mapmaker.Filter.checkSynapses(),Mapmaker.Filter.checkMappers(),Mapmaker.Realtime.startActiveMap(),Mapmaker.Loading.hide()};a.ajax({url:"/maps/"+b+"/contains.json",success:d})},b.prototype.exportImage=function(){var b={};b.canvas=document.createElement("canvas"),b.canvas.width=1880,b.canvas.height=1260,b.scaleOffsetX=1,b.scaleOffsetY=1,b.translateOffsetY=0,b.translateOffsetX=0,b.denySelected=!0,b.getSize=function(){if(this.size)return this.size;var a=this.canvas;return this.size={width:a.width,height:a.height}},b.scale=function(a,b){var c=this.scaleOffsetX*a,d=this.scaleOffsetY*b,e=this.translateOffsetX*(a-1)/c,f=this.translateOffsetY*(b-1)/d;this.scaleOffsetX=c,this.scaleOffsetY=d,this.getCtx().scale(a,b),this.translate(e,f)},b.translate=function(a,b){var c=this.scaleOffsetX,d=this.scaleOffsetY;this.translateOffsetX+=a*c,this.translateOffsetY+=b*d,this.getCtx().translate(a,b)},b.getCtx=function(){return this.canvas.getContext("2d")},b.getCtx().translate(940,630);var c=this.view.Visualize.mGraph,d=c.root,e=c.graph.getNode(d),f=!!e.visited;this.view.JIT.zoomExtents(null,b,!0);var g=b.canvas,h=b.getCtx(),i=b.scaleOffsetX;h.fillStyle="#d8d9da";var j=-(g.width/i)/2-b.translateOffsetX/i,k=-(g.height/i)/2-b.translateOffsetY/i;h.fillRect(j,k,g.width/i,g.height/i),c.graph.eachNode(function(a){var d=a.getData("alpha");a.eachAdjacency(function(d){var e=d.nodeTo;!!e.visited===f&&a.drawn&&e.drawn&&c.fx.plotLine(d,b)}),a.drawn&&c.fx.plotNode(a,b),c.labelsHidden||(a.drawn&&d>=.95?c.labels.plotLabel(b,a):c.labels.hideLabel(a,!1)),a.visited=!f});var l={encoded_image:b.canvas.toDataURL()},m=this.map,n=new Date,o=n.getDate(),p=n.getMonth()+1,q=n.getFullYear();10>o&&(o="0"+o),10>p&&(p="0"+p),n=p+"/"+o+"/"+q;var r=m.get("name").split(" ").join([separator="-"]),s="";s+="Captured map screenshot! ",s+="<a href='"+l.encoded_image+"' ",s+="download='metamap-"+m.id+"-"+r+"-"+n+".png'>DOWNLOAD</a>",a.ajax({type:"POST",dataType:"json",url:"/maps/"+this.map.id+"/upload_screenshot",data:l,success:function(a){console.log("successfully uploaded map screenshot")},error:function(){console.log("failed to save map screenshot")}})},b.prototype["export"]=function(){var a={};return a.map=this.map.toJSON(),delete a.map.arranged,delete a.map.featured,a.messages=this.map.get("messages").models,a.messages=a.messages.map(function(a){return a.attributes}),a.mappings=this.map.get("topicMappings").models.concat(this.map.get("synapseMappings").models),a.mappings=a.mappings.map(function(a){return a.attributes}),a.topics=this.map.get("topics").models.map(function(a){return a.attributes}),a.synapses=this.map.get("synapses").models.map(function(a){return a.attributes}),a},b}(jQuery),Mapmaker.Maker.events={mapChanged:"Mapmaker:mapChanged"},"undefined"==typeof Mapmaker&&(Mapmaker={}),Mapmaker.buildMaker=function(a){return{create:function(b,c,d){var e=a(b),f=new Mapmaker.MapView(d,c,e),g=new Mapmaker.Maker(f,d),h=e.css("position");return"absolute"!==h&&"relative"!==h&&e.css("position","relative"),g}}}(jQuery),Mapmaker.MetacodeCollection=Backbone.Collection.extend({model:Mapmaker.Metacode,url:"/metacodes",comparator:function(a,b){return a=a.get("name").toLowerCase(),b=b.get("name").toLowerCase(),a>b?1:b>a?-1:0}}),Mapmaker.TopicCollection=Backbone.Collection.extend({model:Mapmaker.Topic,url:"/topics"}),Mapmaker.SynapseCollection=Backbone.Collection.extend({model:Mapmaker.Synapse,url:"/synapses"}),Mapmaker.MappingCollection=Backbone.Collection.extend({model:Mapmaker.Mapping,url:"/mappings"}),Mapmaker.MapsCollection=Backbone.Collection.extend({model:Mapmaker.Map,initialize:function(a,b){this.id=b.id,this.sortBy=b.sortBy,b.mapperId&&(this.mapperId=b.mapperId),this.page=a.length>0?a.length<20?"loadedAll":2:1},url:function(){return this.mapperId?"/explore/mapper/"+this.mapperId+".json":"/explore/"+this.id+".json"},comparator:function(a,b){a=a.get(this.sortBy),b=b.get(this.sortBy);var c;return"name"===this.sortBy?(a=a?a.toLowerCase():"",b=b?b.toLowerCase():""):(c=a,a=b,b=c),a>b?1:b>a?-1:0},getMaps:function(){var a=this;if("loadedAll"!=this.page){var b=this.length;this.fetch({remove:!1,data:{page:this.page},success:function(c,d,e){c.length-b<20?a.page="loadedAll":a.page+=1,a.trigger("successOnFetch")},error:function(b,c,d){a.trigger("errorOnFetch")}})}else a.trigger("successOnFetch")}}),Mapmaker.MapperCollection=Backbone.Collection.extend({model:Mapmaker.Mapper,url:"/users"});